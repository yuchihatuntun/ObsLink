/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var C=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var k=(o,a)=>{for(var e in a)C(o,e,{get:a[e],enumerable:!0})},E=(o,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let s of N(a))!I.call(o,s)&&s!==e&&C(o,s,{get:()=>a[s],enumerable:!(t=T(a,s))||t.enumerable});return o};var L=o=>E(C({},"__esModule",{value:!0}),o);var D={};k(D,{default:()=>F});module.exports=L(D);var w=require("obsidian");var P={ignoreRegexes:["^_","^Untitled$","^Untitled \\d+$"],timeoutSeconds:5,caseSensitive:!1,autoCreateFrontmatter:!0,includeFolders:[],excludeFolders:[],fileExtensions:["md"],trackFolderRenames:"",excludePropertyName:""};var c=require("obsidian"),v=class extends c.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new c.Setting(e).setName("Ignore regex patterns").setDesc("Comma-separated regex patterns for file names or immediate parent folder names to ignore (e.g., ^_ for underscore prefixes, ^Untitled$ for Untitled). Leave empty to disable.").addText(t=>t.setPlaceholder("^_,^Untitled$,^Untitled \\d+$").setValue(this.plugin.settings.ignoreRegexes.join(",")).onChange(async s=>{this.plugin.settings.ignoreRegexes=s.split(",").map(i=>i.trim()).filter(i=>i),await this.plugin.saveSettings()})),new c.Setting(e).setName("Timeout seconds").setDesc("Time in seconds the name must be stable before adding aliases.").addSlider(t=>t.setLimits(1,20,1).setValue(this.plugin.settings.timeoutSeconds).setDynamicTooltip().onChange(async s=>{this.plugin.settings.timeoutSeconds=s,await this.plugin.saveSettings()})),new c.Setting(e).setName("Case sensitive uniqueness").setDesc('If enabled, treat "Note" and "note" as different aliases.').addToggle(t=>t.setValue(this.plugin.settings.caseSensitive).onChange(async s=>{this.plugin.settings.caseSensitive=s,await this.plugin.saveSettings()})),new c.Setting(e).setName("Auto-create properties").setDesc("Automatically create properties with aliases if missing.").addToggle(t=>t.setValue(this.plugin.settings.autoCreateFrontmatter).onChange(async s=>{this.plugin.settings.autoCreateFrontmatter=s,await this.plugin.saveSettings()})),new c.Setting(e).setName("Track folder renames for specific file name").setDesc("If a markdown file matches this file name, store old immediate parent folder names as aliases when parent folders are renamed.").addText(t=>t.setPlaceholder("index").setValue(this.plugin.settings.trackFolderRenames).onChange(async s=>{this.plugin.settings.trackFolderRenames=s,await this.plugin.saveSettings()})),new c.Setting(e).setName("File extensions").setDesc("Comma-separated list of file extensions to track.").addText(t=>t.setPlaceholder("md").setValue(this.plugin.settings.fileExtensions.join(",")).onChange(async s=>{this.plugin.settings.fileExtensions=s.split(",").map(i=>i.trim()).filter(i=>i),await this.plugin.saveSettings()})),new c.Setting(e).setName("Include folders").setDesc("Comma-separated list of folder paths to include. If empty, all folders are included. Use {vault} or {root} to include only files directly in the vault root (no subfolders).").addText(t=>t.setValue(this.plugin.settings.includeFolders.join(",")).onChange(async s=>{this.plugin.settings.includeFolders=s.split(",").map(i=>i.trim()).filter(i=>i),await this.plugin.saveSettings()})),new c.Setting(e).setName("Exclude folders").setDesc('Comma-separated list of folder paths to exclude. Supports wildcards: use "folder/*" to exclude direct children, "folder/**" to exclude all descendants. Use {vault} or {root} to exclude files directly in the vault root.').addText(t=>t.setValue(this.plugin.settings.excludeFolders.join(",")).onChange(async s=>{this.plugin.settings.excludeFolders=s.split(",").map(i=>i.trim()).filter(i=>i),await this.plugin.saveSettings()})),new c.Setting(e).setName("Exclude property name").setDesc("Name of a boolean property to check in files. Files with this property set to true will be excluded from tracking. Takes priority over folder filtering.").addText(t=>t.setPlaceholder("skipRenameTracking").setValue(this.plugin.settings.excludePropertyName).onChange(async s=>{this.plugin.settings.excludePropertyName=s,await this.plugin.saveSettings()}))}};var S=class{constructor(a,e){this.app=a;this.settings=e}async processAliases(a,e){let t=this.app.vault.getFileByPath(a);if(!t)return;let s=[];for(let r of this.settings.ignoreRegexes)try{s.push(new RegExp(r))}catch(l){console.error(`Invalid ignore regex: ${r}`,l)}let i=[],m=t.basename,f=m.toLowerCase();for(let r of e){if(s.some(g=>g.test(r)))continue;let l=r.toLowerCase();this.settings.caseSensitive&&r===m||!this.settings.caseSensitive&&l===f||i.push(r)}i.length!==0&&await this.app.fileManager.processFrontMatter(t,r=>{let l=r.aliases;if(!Array.isArray(l)){if(Object.keys(r).length>0&&!this.settings.autoCreateFrontmatter)return;l=[],r.aliases=l}let g=new Set(this.settings.caseSensitive?l:l.map(d=>d.toLowerCase()));for(let d of i){let h=this.settings.caseSensitive?d:d.toLowerCase();g.has(h)||(l.push(d),g.add(h))}})}};function R(o){return(o.split("/").pop()||"").replace(/\.[^/.]+$/,"")}function A(o){let a=o.split("/");return a.pop(),a.pop()||""}var F=class extends w.Plugin{constructor(){super(...arguments);this.debounceMap=new Map}async onload(){await this.loadSettings(),this.aliasProcessor=new S(this.app,this.settings),this.addSettingTab(new v(this.app,this)),this.registerEvent(this.app.vault.on("rename",this.handleRename.bind(this)))}onunload(){for(let e of this.debounceMap.values())e.timeoutId!==0&&window.clearTimeout(e.timeoutId);this.debounceMap.clear()}async loadSettings(){this.settings=Object.assign({},P,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}isPathInFolder(e,t){if(t.includes("{vault}")||t.includes("{root}")){let s=t.replace(/\{vault\}|\{root\}/g,"");return s===""||s==="/"?!e.includes("/"):e.startsWith(s+"/")||e===s}return e.startsWith(t+"/")||e===t}isPathExcluded(e,t){if(t.includes("{vault}")||t.includes("{root}")){let s=t.replace(/\{vault\}|\{root\}/g,"");if(s===""||s==="/")return!e.includes("/");t=s}if(t.endsWith("/**")){let s=t.slice(0,-3);return e.startsWith(s+"/")||e===s}else if(t.endsWith("/*")){let s=t.slice(0,-2);return e.startsWith(s+"/")?e.slice(s.length+1).includes("/"):e===s}return e.startsWith(t+"/")||e===t}handleRename(e,t){if(!(e instanceof w.TFile)||!this.settings.fileExtensions.includes(e.extension))return;let s=R(t),i=e.basename,m=A(t),f=A(e.path),r=this.settings.caseSensitive?s!==i:s.toLowerCase()!==i.toLowerCase(),l=m!==f&&!r;if(!r&&!l)return;let g=e.path;if(this.settings.excludePropertyName&&this.settings.excludePropertyName.trim()!==""){let n=this.app.metadataCache.getFileCache(e),u=n==null?void 0:n.frontmatter;if(u&&u[this.settings.excludePropertyName]===!0)return}if(this.settings.includeFolders.length>0&&!this.settings.includeFolders.some(n=>this.isPathInFolder(g,n)))return;let d=l&&this.settings.trackFolderRenames&&this.settings.trackFolderRenames.trim()!==""&&(this.settings.caseSensitive?e.basename===this.settings.trackFolderRenames:e.basename.toLowerCase()===this.settings.trackFolderRenames.toLowerCase());for(let n of this.settings.excludeFolders)if(this.isPathExcluded(g,n)){if(d&&n.endsWith("/*")&&!n.endsWith("/**")){let u=n.slice(0,-2);if(g.startsWith(u+"/")&&g.slice(u.length+1).split("/").length===2)continue}return}let h=[];for(let n of this.settings.ignoreRegexes)try{h.push(new RegExp(n))}catch(u){console.error(`Invalid ignore regex: ${n}`,u)}let x=null;if(r){if(h.some(n=>n.test(s)||n.test(i)))return;x=s}else if(l&&this.settings.trackFolderRenames&&this.settings.trackFolderRenames.trim()!==""){let n=e.basename;if(!(this.settings.caseSensitive?n===this.settings.trackFolderRenames:n.toLowerCase()===this.settings.trackFolderRenames.toLowerCase())||m===""||f===""||h.some(b=>b.test(m)||b.test(f)))return;x=m}if(!x)return;let p=this.debounceMap.get(e.path);p||(p=this.debounceMap.get(t),p&&this.debounceMap.delete(t)),p&&(p.timeoutId!==0&&window.clearTimeout(p.timeoutId),x=Array.from(p.queue)[0]);let y={queue:new Set([x]),timeoutId:0,currentPath:e.path};y.timeoutId=window.setTimeout(()=>{(async()=>{try{await this.aliasProcessor.processAliases(y.currentPath,y.queue)}catch(n){console.error("Error processing aliases:",n)}this.debounceMap.delete(y.currentPath)})()},this.settings.timeoutSeconds*1e3),this.debounceMap.set(e.path,y)}};
