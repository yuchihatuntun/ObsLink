/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => AliasFilenameHistoryPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// src/settings.ts
var DEFAULT_SETTINGS = {
  ignoreRegexes: ["^_", "^Untitled$", "^Untitled \\d+$"],
  timeoutSeconds: 5,
  caseSensitive: false,
  autoCreateFrontmatter: true,
  includeFolders: [],
  excludeFolders: [],
  fileExtensions: ["md"],
  trackFolderRenames: "",
  excludePropertyName: ""
};

// src/ui/settings-tab.ts
var import_obsidian2 = require("obsidian");

// src/utils/settings-compat.ts
var import_obsidian = require("obsidian");
var Obsidian = __toESM(require("obsidian"));
function createSettingsGroup(containerEl, heading) {
  if ((0, import_obsidian.requireApiVersion)("1.11.0")) {
    const ObsidianTyped = Obsidian;
    const SettingGroupCtor = ObsidianTyped.SettingGroup;
    const group = new SettingGroupCtor(containerEl);
    if (heading) {
      group.setHeading(heading);
    }
    return {
      addSetting(cb) {
        group.addSetting(cb);
      }
    };
  } else {
    const groupEl = containerEl.createDiv("setting-group");
    if (heading) {
      const headingEl = groupEl.createDiv("setting-group-heading");
      headingEl.createEl("h3", { text: heading });
    }
    return {
      addSetting(cb) {
        const setting = new import_obsidian.Setting(groupEl);
        cb(setting);
      }
    };
  }
}

// src/ui/settings-tab.ts
var AliasFilenameHistorySettingTab = class extends import_obsidian2.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    const saveSettings = () => {
      void this.plugin.saveSettings();
    };
    const generalGroup = createSettingsGroup(containerEl);
    generalGroup.addSetting((setting) => {
      setting.setName("Timeout seconds").setDesc("Time in seconds the name must be stable before adding aliases.").addSlider(
        (slider) => slider.setLimits(1, 20, 1).setValue(this.plugin.settings.timeoutSeconds).setDynamicTooltip().onChange((value) => {
          this.plugin.settings.timeoutSeconds = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Case-sensitive uniqueness").setDesc("If enabled, treat note and Note as different aliases.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.caseSensitive).onChange((value) => {
          this.plugin.settings.caseSensitive = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("Auto-create properties").setDesc("Automatically create properties with aliases if missing.").addToggle(
        (toggle) => toggle.setValue(this.plugin.settings.autoCreateFrontmatter).onChange((value) => {
          this.plugin.settings.autoCreateFrontmatter = value;
          saveSettings();
        })
      );
    });
    generalGroup.addSetting((setting) => {
      setting.setName("File extensions").setDesc("Comma-separated list of file extensions to track.").addText(
        (text) => text.setPlaceholder("md, txt").setValue(this.plugin.settings.fileExtensions.join(",")).onChange((value) => {
          this.plugin.settings.fileExtensions = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    const filteringGroup = createSettingsGroup(containerEl, "Filtering");
    const foldersGroup = createSettingsGroup(containerEl, "Folders");
    const advancedGroup = createSettingsGroup(containerEl, "Advanced");
    filteringGroup.addSetting((setting) => {
      setting.setName("Ignore regex patterns").setDesc(
        "Comma-separated regex patterns for file names or immediate parent folder names to ignore (e.g., ^_ for underscore prefixes, ^untitled$ for untitled). Leave empty to disable."
      ).addText(
        (text) => text.setPlaceholder("^_, ^untitled$, ^untitled \\d+$").setValue(this.plugin.settings.ignoreRegexes.join(",")).onChange((value) => {
          this.plugin.settings.ignoreRegexes = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    filteringGroup.addSetting((setting) => {
      setting.setName("Exclude property name").setDesc(
        "Name of a boolean property to check in files. Files with this property set to true will be excluded from tracking. Takes priority over folder filtering."
      ).addText(
        (text) => text.setPlaceholder("skip-rename-tracking").setValue(this.plugin.settings.excludePropertyName).onChange((value) => {
          this.plugin.settings.excludePropertyName = value;
          saveSettings();
        })
      );
    });
    foldersGroup.addSetting((setting) => {
      setting.setName("Include folders").setDesc(
        "Comma-separated list of folder paths to include. If empty, all folders are included. Use {vault} or {root} to include only files directly in the vault root (no subfolders)."
      ).addText(
        (text) => text.setValue(this.plugin.settings.includeFolders.join(",")).onChange((value) => {
          this.plugin.settings.includeFolders = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    foldersGroup.addSetting((setting) => {
      setting.setName("Exclude folders").setDesc(
        'Comma-separated list of folder paths to exclude. Supports wildcards: use "folder/*" to exclude direct children, "folder/**" to exclude all descendants. Use {vault} or {root} to exclude files directly in the vault root.'
      ).addText(
        (text) => text.setValue(this.plugin.settings.excludeFolders.join(",")).onChange((value) => {
          this.plugin.settings.excludeFolders = value.split(",").map((s) => s.trim()).filter((s) => s);
          saveSettings();
        })
      );
    });
    advancedGroup.addSetting((setting) => {
      setting.setName("Track folder renames for specific file name").setDesc(
        // eslint-disable-next-line obsidianmd/ui/sentence-case
        "If a markdown file matches this file name, store old immediate parent folder names as aliases when parent folders are renamed."
      ).addText(
        (text) => text.setPlaceholder("index").setValue(this.plugin.settings.trackFolderRenames).onChange((value) => {
          this.plugin.settings.trackFolderRenames = value;
          saveSettings();
        })
      );
    });
  }
};

// src/utils/alias-processor.ts
var AliasProcessor = class {
  constructor(app, settings) {
    this.app = app;
    this.settings = settings;
  }
  async processAliases(path, queue) {
    const file = this.app.vault.getFileByPath(path);
    if (!file)
      return;
    const regexes = [];
    for (const regexStr of this.settings.ignoreRegexes) {
      try {
        regexes.push(new RegExp(regexStr));
      } catch (e) {
        console.error(`Invalid ignore regex: ${regexStr}`, e);
      }
    }
    const toAdd = [];
    const currentBasename = file.basename;
    const currentBasenameLower = currentBasename.toLowerCase();
    for (const name of queue) {
      if (regexes.some((re) => re.test(name))) {
        continue;
      }
      const nameLower = name.toLowerCase();
      if (this.settings.caseSensitive && name === currentBasename || !this.settings.caseSensitive && nameLower === currentBasenameLower) {
        continue;
      }
      toAdd.push(name);
    }
    if (toAdd.length === 0)
      return;
    await this.app.fileManager.processFrontMatter(file, (fm) => {
      let aliases = fm.aliases;
      if (!Array.isArray(aliases)) {
        const hasFrontmatter = Object.keys(fm).length > 0;
        if (hasFrontmatter && !this.settings.autoCreateFrontmatter)
          return;
        aliases = [];
        fm.aliases = aliases;
      }
      const aliasesArray = aliases;
      const existing = new Set(
        this.settings.caseSensitive ? aliasesArray : aliasesArray.map((a) => a.toLowerCase())
      );
      for (const name of toAdd) {
        const checkName = this.settings.caseSensitive ? name : name.toLowerCase();
        if (!existing.has(checkName)) {
          aliasesArray.push(name);
          existing.add(checkName);
        }
      }
    });
  }
};

// src/utils/path-utils.ts
function getBasename(path) {
  const name = path.split("/").pop() || "";
  return name.replace(/\.[^/.]+$/, "");
}
function getImmediateParentName(path) {
  const parts = path.split("/");
  parts.pop();
  return parts.pop() || "";
}

// src/main.ts
var AliasFilenameHistoryPlugin = class extends import_obsidian3.Plugin {
  constructor() {
    super(...arguments);
    this.debounceMap = /* @__PURE__ */ new Map();
  }
  async onload() {
    await this.loadSettings();
    this.aliasProcessor = new AliasProcessor(this.app, this.settings);
    this.addSettingTab(new AliasFilenameHistorySettingTab(this.app, this));
    this.registerEvent(
      this.app.vault.on("rename", (file, oldPath) => {
        this.handleRename(file, oldPath);
      })
    );
  }
  onunload() {
    for (const entry of this.debounceMap.values()) {
      if (entry.timeoutId !== 0) {
        window.clearTimeout(entry.timeoutId);
      }
    }
    this.debounceMap.clear();
  }
  async loadSettings() {
    const loadedData = await this.loadData();
    this.settings = Object.assign({}, DEFAULT_SETTINGS, loadedData);
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  isPathInFolder(path, folder) {
    if (folder.includes("{vault}") || folder.includes("{root}")) {
      const resolvedFolder = folder.replace(/\{vault\}|\{root\}/g, "");
      if (resolvedFolder === "" || resolvedFolder === "/") {
        const isVaultRoot = !path.includes("/");
        return isVaultRoot;
      }
      return path.startsWith(resolvedFolder + "/") || path === resolvedFolder;
    }
    return path.startsWith(folder + "/") || path === folder;
  }
  isPathExcluded(path, excludePattern) {
    if (excludePattern.includes("{vault}") || excludePattern.includes("{root}")) {
      const resolvedPattern = excludePattern.replace(/\{vault\}|\{root\}/g, "");
      if (resolvedPattern === "" || resolvedPattern === "/") {
        return !path.includes("/");
      }
      excludePattern = resolvedPattern;
    }
    if (excludePattern.endsWith("/**")) {
      const baseFolder = excludePattern.slice(0, -3);
      return path.startsWith(baseFolder + "/") || path === baseFolder;
    } else if (excludePattern.endsWith("/*")) {
      const baseFolder = excludePattern.slice(0, -2);
      if (!path.startsWith(baseFolder + "/")) {
        return path === baseFolder;
      }
      const pathAfterBase = path.slice(baseFolder.length + 1);
      return pathAfterBase.includes("/");
    }
    return path.startsWith(excludePattern + "/") || path === excludePattern;
  }
  handleRename(newFile, oldPath) {
    if (!(newFile instanceof import_obsidian3.TFile))
      return;
    if (!this.settings.fileExtensions.includes(newFile.extension))
      return;
    const oldBasename = getBasename(oldPath);
    const newBasename = newFile.basename;
    const oldImmediateParentName = getImmediateParentName(oldPath);
    const newImmediateParentName = getImmediateParentName(newFile.path);
    const isNameChange = this.settings.caseSensitive ? oldBasename !== newBasename : oldBasename.toLowerCase() !== newBasename.toLowerCase();
    const isFolderChange = oldImmediateParentName !== newImmediateParentName && !isNameChange;
    if (!isNameChange && !isFolderChange) {
      return;
    }
    const path = newFile.path;
    if (this.settings.excludePropertyName && this.settings.excludePropertyName.trim() !== "") {
      const cache = this.app.metadataCache.getFileCache(newFile);
      const frontmatter = cache == null ? void 0 : cache.frontmatter;
      if (frontmatter && frontmatter[this.settings.excludePropertyName] === true) {
        return;
      }
    }
    if (this.settings.includeFolders.length > 0) {
      if (!this.settings.includeFolders.some((f) => this.isPathInFolder(path, f))) {
        return;
      }
    }
    const isIndexFileForFolderRename = isFolderChange && this.settings.trackFolderRenames && this.settings.trackFolderRenames.trim() !== "" && (this.settings.caseSensitive ? newFile.basename === this.settings.trackFolderRenames : newFile.basename.toLowerCase() === this.settings.trackFolderRenames.toLowerCase());
    for (const excludePattern of this.settings.excludeFolders) {
      if (this.isPathExcluded(path, excludePattern)) {
        if (isIndexFileForFolderRename && excludePattern.endsWith("/*") && !excludePattern.endsWith("/**")) {
          const baseFolder = excludePattern.slice(0, -2);
          if (path.startsWith(baseFolder + "/")) {
            const pathAfterBase = path.slice(baseFolder.length + 1);
            const pathParts = pathAfterBase.split("/");
            if (pathParts.length === 2) {
              continue;
            }
          }
        }
        return;
      }
    }
    const regexes = [];
    for (const regexStr of this.settings.ignoreRegexes) {
      try {
        regexes.push(new RegExp(regexStr));
      } catch (e) {
        console.error(`Invalid ignore regex: ${regexStr}`, e);
      }
    }
    let toQueue = null;
    if (isNameChange) {
      if (regexes.some((re) => re.test(oldBasename) || re.test(newBasename))) {
        return;
      }
      toQueue = oldBasename;
    } else if (isFolderChange && this.settings.trackFolderRenames && this.settings.trackFolderRenames.trim() !== "") {
      const currentBasename = newFile.basename;
      const matchesFilename = this.settings.caseSensitive ? currentBasename === this.settings.trackFolderRenames : currentBasename.toLowerCase() === this.settings.trackFolderRenames.toLowerCase();
      if (!matchesFilename) {
        return;
      }
      if (oldImmediateParentName === "" || newImmediateParentName === "") {
        return;
      }
      if (regexes.some((re) => re.test(oldImmediateParentName) || re.test(newImmediateParentName))) {
        return;
      }
      toQueue = oldImmediateParentName;
    }
    if (!toQueue)
      return;
    let existingEntry = this.debounceMap.get(newFile.path);
    if (!existingEntry) {
      existingEntry = this.debounceMap.get(oldPath);
      if (existingEntry) {
        this.debounceMap.delete(oldPath);
      }
    }
    if (existingEntry) {
      if (existingEntry.timeoutId !== 0) {
        window.clearTimeout(existingEntry.timeoutId);
      }
      toQueue = Array.from(existingEntry.queue)[0];
    }
    const entry = {
      queue: /* @__PURE__ */ new Set([toQueue]),
      timeoutId: 0,
      currentPath: newFile.path
    };
    entry.timeoutId = window.setTimeout(() => {
      void (async () => {
        try {
          await this.aliasProcessor.processAliases(entry.currentPath, entry.queue);
        } catch (error) {
          console.error("Error processing aliases:", error);
        }
        this.debounceMap.delete(entry.currentPath);
      })();
    }, this.settings.timeoutSeconds * 1e3);
    this.debounceMap.set(newFile.path, entry);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIiwgInNyYy91aS9zZXR0aW5ncy10YWIudHMiLCAic3JjL3V0aWxzL3NldHRpbmdzLWNvbXBhdC50cyIsICJzcmMvdXRpbHMvYWxpYXMtcHJvY2Vzc29yLnRzIiwgInNyYy91dGlscy9wYXRoLXV0aWxzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBQbHVnaW4sIFRBYnN0cmFjdEZpbGUsIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgQWxpYXNGaWxlbmFtZUhpc3RvcnlTZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gJy4vc2V0dGluZ3MnO1xuaW1wb3J0IHsgQWxpYXNGaWxlbmFtZUhpc3RvcnlTZXR0aW5nVGFiIH0gZnJvbSAnLi91aS9zZXR0aW5ncy10YWInO1xuaW1wb3J0IHsgQWxpYXNQcm9jZXNzb3IgfSBmcm9tICcuL3V0aWxzL2FsaWFzLXByb2Nlc3Nvcic7XG5pbXBvcnQgeyBnZXRCYXNlbmFtZSwgZ2V0SW1tZWRpYXRlUGFyZW50TmFtZSB9IGZyb20gJy4vdXRpbHMvcGF0aC11dGlscyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFsaWFzRmlsZW5hbWVIaXN0b3J5UGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgc2V0dGluZ3M6IEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3M7XG4gIHByaXZhdGUgZGVib3VuY2VNYXA6IE1hcDxzdHJpbmcsIHsgcXVldWU6IFNldDxzdHJpbmc+OyB0aW1lb3V0SWQ6IG51bWJlcjsgY3VycmVudFBhdGg6IHN0cmluZyB9PiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBhbGlhc1Byb2Nlc3NvcjogQWxpYXNQcm9jZXNzb3I7XG5cbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG4gICAgdGhpcy5hbGlhc1Byb2Nlc3NvciA9IG5ldyBBbGlhc1Byb2Nlc3Nvcih0aGlzLmFwcCwgdGhpcy5zZXR0aW5ncyk7XG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBBbGlhc0ZpbGVuYW1lSGlzdG9yeVNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLmFwcC52YXVsdC5vbigncmVuYW1lJywgKGZpbGU6IFRBYnN0cmFjdEZpbGUsIG9sZFBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZVJlbmFtZShmaWxlLCBvbGRQYXRoKTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIG9udW5sb2FkKCkge1xuICAgIC8vIENsZWFyIGFueSBwZW5kaW5nIHRpbWVvdXRzXG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiB0aGlzLmRlYm91bmNlTWFwLnZhbHVlcygpKSB7XG4gICAgICBpZiAoZW50cnkudGltZW91dElkICE9PSAwKSB7XG4gICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQoZW50cnkudGltZW91dElkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5kZWJvdW5jZU1hcC5jbGVhcigpO1xuICB9XG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgIGNvbnN0IGxvYWRlZERhdGEgPSAoYXdhaXQgdGhpcy5sb2FkRGF0YSgpKSBhcyBQYXJ0aWFsPEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3M+IHwgbnVsbDtcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgbG9hZGVkRGF0YSk7XG4gIH1cblxuICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNQYXRoSW5Gb2xkZXIocGF0aDogc3RyaW5nLCBmb2xkZXI6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIC8vIEhhbmRsZSB2YXVsdCByb290IHZhcmlhYmxlXG4gICAgaWYgKGZvbGRlci5pbmNsdWRlcygne3ZhdWx0fScpIHx8IGZvbGRlci5pbmNsdWRlcygne3Jvb3R9JykpIHtcbiAgICAgIGNvbnN0IHJlc29sdmVkRm9sZGVyID0gZm9sZGVyLnJlcGxhY2UoL1xce3ZhdWx0XFx9fFxce3Jvb3RcXH0vZywgJycpO1xuICAgICAgLy8gSWYgdGhlIGZvbGRlciBpcyBqdXN0IHRoZSB2YXJpYWJsZSwgaXQgbWVhbnMgaW5jbHVkZSBvbmx5IHZhdWx0IHJvb3QgZmlsZXNcbiAgICAgIGlmIChyZXNvbHZlZEZvbGRlciA9PT0gJycgfHwgcmVzb2x2ZWRGb2xkZXIgPT09ICcvJykge1xuICAgICAgICAvLyBJbmNsdWRlIG9ubHkgZmlsZXMgZGlyZWN0bHkgaW4gdGhlIHZhdWx0IHJvb3QgKG5vIHN1YmZvbGRlcnMpXG4gICAgICAgIGNvbnN0IGlzVmF1bHRSb290ID0gIXBhdGguaW5jbHVkZXMoJy8nKTtcbiAgICAgICAgcmV0dXJuIGlzVmF1bHRSb290O1xuICAgICAgfVxuICAgICAgLy8gT3RoZXJ3aXNlLCByZXBsYWNlIHRoZSB2YXJpYWJsZSBhbmQgY2hlY2sgbm9ybWFsbHlcbiAgICAgIHJldHVybiBwYXRoLnN0YXJ0c1dpdGgocmVzb2x2ZWRGb2xkZXIgKyAnLycpIHx8IHBhdGggPT09IHJlc29sdmVkRm9sZGVyO1xuICAgIH1cbiAgICBcbiAgICAvLyBOb3JtYWwgZm9sZGVyIG1hdGNoaW5nXG4gICAgcmV0dXJuIHBhdGguc3RhcnRzV2l0aChmb2xkZXIgKyAnLycpIHx8IHBhdGggPT09IGZvbGRlcjtcbiAgfVxuXG4gIHByaXZhdGUgaXNQYXRoRXhjbHVkZWQocGF0aDogc3RyaW5nLCBleGNsdWRlUGF0dGVybjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgLy8gSGFuZGxlIHZhdWx0IHJvb3QgdmFyaWFibGVcbiAgICBpZiAoZXhjbHVkZVBhdHRlcm4uaW5jbHVkZXMoJ3t2YXVsdH0nKSB8fCBleGNsdWRlUGF0dGVybi5pbmNsdWRlcygne3Jvb3R9JykpIHtcbiAgICAgIGNvbnN0IHJlc29sdmVkUGF0dGVybiA9IGV4Y2x1ZGVQYXR0ZXJuLnJlcGxhY2UoL1xce3ZhdWx0XFx9fFxce3Jvb3RcXH0vZywgJycpO1xuICAgICAgaWYgKHJlc29sdmVkUGF0dGVybiA9PT0gJycgfHwgcmVzb2x2ZWRQYXR0ZXJuID09PSAnLycpIHtcbiAgICAgICAgLy8gRXhjbHVkZSBvbmx5IGZpbGVzIGRpcmVjdGx5IGluIHRoZSB2YXVsdCByb290IChubyBzdWJmb2xkZXJzKVxuICAgICAgICByZXR1cm4gIXBhdGguaW5jbHVkZXMoJy8nKTtcbiAgICAgIH1cbiAgICAgIGV4Y2x1ZGVQYXR0ZXJuID0gcmVzb2x2ZWRQYXR0ZXJuO1xuICAgIH1cblxuICAgIC8vIEhhbmRsZSB3aWxkY2FyZHNcbiAgICBpZiAoZXhjbHVkZVBhdHRlcm4uZW5kc1dpdGgoJy8qKicpKSB7XG4gICAgICAvLyBSZWN1cnNpdmUgZXhjbHVzaW9uOiBkb2NzLyoqIG1hdGNoZXMgZG9jcyBhbmQgYWxsIHN1YmZvbGRlcnNcbiAgICAgIGNvbnN0IGJhc2VGb2xkZXIgPSBleGNsdWRlUGF0dGVybi5zbGljZSgwLCAtMyk7XG4gICAgICByZXR1cm4gcGF0aC5zdGFydHNXaXRoKGJhc2VGb2xkZXIgKyAnLycpIHx8IHBhdGggPT09IGJhc2VGb2xkZXI7XG4gICAgfSBlbHNlIGlmIChleGNsdWRlUGF0dGVybi5lbmRzV2l0aCgnLyonKSkge1xuICAgICAgLy8gRGlyZWN0IGNoaWxkcmVuIG9ubHk6IGRvY3MvKiBtYXRjaGVzIGRvY3Mvc3ViZm9sZGVyIGJ1dCBub3QgZG9jcy9zdWJmb2xkZXIvbmVzdGVkXG4gICAgICAvLyBTaG91bGQgZXhjbHVkZSBmaWxlcyBpbiBzdWJmb2xkZXJzLCBidXQgTk9UIGZpbGVzIGRpcmVjdGx5IGluIHRoZSBiYXNlIGZvbGRlclxuICAgICAgY29uc3QgYmFzZUZvbGRlciA9IGV4Y2x1ZGVQYXR0ZXJuLnNsaWNlKDAsIC0yKTtcbiAgICAgIGlmICghcGF0aC5zdGFydHNXaXRoKGJhc2VGb2xkZXIgKyAnLycpKSB7XG4gICAgICAgIHJldHVybiBwYXRoID09PSBiYXNlRm9sZGVyO1xuICAgICAgfVxuICAgICAgY29uc3QgcGF0aEFmdGVyQmFzZSA9IHBhdGguc2xpY2UoYmFzZUZvbGRlci5sZW5ndGggKyAxKTtcbiAgICAgIC8vIEV4Y2x1ZGUgaWYgcGF0aCBpcyBpbiBhIHN1YmZvbGRlciAoaGFzIGF0IGxlYXN0IG9uZSBzbGFzaClcbiAgICAgIC8vIERvbid0IGV4Y2x1ZGUgZmlsZXMgZGlyZWN0bHkgaW4gdGhlIGJhc2UgZm9sZGVyIChubyBzbGFzaClcbiAgICAgIHJldHVybiBwYXRoQWZ0ZXJCYXNlLmluY2x1ZGVzKCcvJyk7XG4gICAgfVxuICAgIFxuICAgIC8vIE5vcm1hbCBmb2xkZXIgbWF0Y2hpbmdcbiAgICByZXR1cm4gcGF0aC5zdGFydHNXaXRoKGV4Y2x1ZGVQYXR0ZXJuICsgJy8nKSB8fCBwYXRoID09PSBleGNsdWRlUGF0dGVybjtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlUmVuYW1lKG5ld0ZpbGU6IFRBYnN0cmFjdEZpbGUsIG9sZFBhdGg6IHN0cmluZykge1xuICAgIGlmICghKG5ld0ZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHJldHVybjtcbiAgICBpZiAoIXRoaXMuc2V0dGluZ3MuZmlsZUV4dGVuc2lvbnMuaW5jbHVkZXMobmV3RmlsZS5leHRlbnNpb24pKSByZXR1cm47XG5cbiAgICBjb25zdCBvbGRCYXNlbmFtZSA9IGdldEJhc2VuYW1lKG9sZFBhdGgpO1xuICAgIGNvbnN0IG5ld0Jhc2VuYW1lID0gbmV3RmlsZS5iYXNlbmFtZTtcbiAgICBjb25zdCBvbGRJbW1lZGlhdGVQYXJlbnROYW1lID0gZ2V0SW1tZWRpYXRlUGFyZW50TmFtZShvbGRQYXRoKTtcbiAgICBjb25zdCBuZXdJbW1lZGlhdGVQYXJlbnROYW1lID0gZ2V0SW1tZWRpYXRlUGFyZW50TmFtZShuZXdGaWxlLnBhdGgpO1xuXG4gICAgY29uc3QgaXNOYW1lQ2hhbmdlID0gdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlXG4gICAgICA/IG9sZEJhc2VuYW1lICE9PSBuZXdCYXNlbmFtZVxuICAgICAgOiBvbGRCYXNlbmFtZS50b0xvd2VyQ2FzZSgpICE9PSBuZXdCYXNlbmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbnN0IGlzRm9sZGVyQ2hhbmdlID0gb2xkSW1tZWRpYXRlUGFyZW50TmFtZSAhPT0gbmV3SW1tZWRpYXRlUGFyZW50TmFtZSAmJiAhaXNOYW1lQ2hhbmdlO1xuXG4gICAgaWYgKCFpc05hbWVDaGFuZ2UgJiYgIWlzRm9sZGVyQ2hhbmdlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGF0aCA9IG5ld0ZpbGUucGF0aDtcbiAgICBcbiAgICAvLyBBcHBseSBmaWx0ZXJpbmcgY2hlY2tzIHRvIGJvdGggZmlsZSBuYW1lIGNoYW5nZXMgYW5kIGZvbGRlciByZW5hbWVzXG4gICAgLy8gUHJpb3JpdHk6IFByb3BlcnR5IGV4Y2x1c2lvbiAtPiBJbmNsdWRlIGZvbGRlcnMgLT4gRXhjbHVkZSBmb2xkZXJzXG4gICAgXG4gICAgLy8gMS4gQ2hlY2sgcHJvcGVydHktYmFzZWQgZXhjbHVzaW9uIGZpcnN0IChoaWdoZXN0IHByaW9yaXR5KVxuICAgIGlmICh0aGlzLnNldHRpbmdzLmV4Y2x1ZGVQcm9wZXJ0eU5hbWUgJiYgdGhpcy5zZXR0aW5ncy5leGNsdWRlUHJvcGVydHlOYW1lLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgIGNvbnN0IGNhY2hlID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUobmV3RmlsZSk7XG4gICAgICBjb25zdCBmcm9udG1hdHRlciA9IGNhY2hlPy5mcm9udG1hdHRlcjtcbiAgICAgIGlmIChmcm9udG1hdHRlciAmJiBmcm9udG1hdHRlclt0aGlzLnNldHRpbmdzLmV4Y2x1ZGVQcm9wZXJ0eU5hbWVdID09PSB0cnVlKSB7XG4gICAgICAgIHJldHVybjsgLy8gRXhjbHVkZSB0aGlzIGZpbGVcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gMi4gQ2hlY2sgaW5jbHVkZSBmb2xkZXJzIChpZiBpbmNsdWRlRm9sZGVycyBpcyBub3QgZW1wdHksIG9ubHkgaW5jbHVkZSB0aG9zZSlcbiAgICBpZiAodGhpcy5zZXR0aW5ncy5pbmNsdWRlRm9sZGVycy5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAoIXRoaXMuc2V0dGluZ3MuaW5jbHVkZUZvbGRlcnMuc29tZShmID0+IHRoaXMuaXNQYXRoSW5Gb2xkZXIocGF0aCwgZikpKSB7XG4gICAgICAgIHJldHVybjsgLy8gTm90IGluIGFueSBpbmNsdWRlZCBmb2xkZXJcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gMy4gQ2hlY2sgZXhjbHVkZSBmb2xkZXJzICh3aXRoIHdpbGRjYXJkIHN1cHBvcnQpXG4gICAgLy8gU3BlY2lhbCBjYXNlOiBpZiB0cmFja2luZyBmb2xkZXIgcmVuYW1lcyBmb3IgYSBzcGVjaWZpYyBmaWxlIG5hbWUsIGFsbG93IGl0IGV2ZW4gaW4gZXhjbHVkZWQgc3ViZm9sZGVyc1xuICAgIC8vIHVubGVzcyB1c2luZyByZWN1cnNpdmUgZXhjbHVzaW9uICgqKikgb3IgdGhlIGZpbGUgaXMgbmVzdGVkIGRlZXBlciB0aGFuIG9uZSBsZXZlbFxuICAgIGNvbnN0IGlzSW5kZXhGaWxlRm9yRm9sZGVyUmVuYW1lID0gaXNGb2xkZXJDaGFuZ2UgJiYgXG4gICAgICB0aGlzLnNldHRpbmdzLnRyYWNrRm9sZGVyUmVuYW1lcyAmJiBcbiAgICAgIHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzLnRyaW0oKSAhPT0gJycgJiZcbiAgICAgICh0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgXG4gICAgICAgID8gbmV3RmlsZS5iYXNlbmFtZSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXNcbiAgICAgICAgOiBuZXdGaWxlLmJhc2VuYW1lLnRvTG93ZXJDYXNlKCkgPT09IHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzLnRvTG93ZXJDYXNlKCkpO1xuICAgIFxuICAgIGZvciAoY29uc3QgZXhjbHVkZVBhdHRlcm4gb2YgdGhpcy5zZXR0aW5ncy5leGNsdWRlRm9sZGVycykge1xuICAgICAgaWYgKHRoaXMuaXNQYXRoRXhjbHVkZWQocGF0aCwgZXhjbHVkZVBhdHRlcm4pKSB7XG4gICAgICAgIC8vIElmIHRoaXMgaXMgYW4gaW5kZXggZmlsZSBmb3IgZm9sZGVyIHJlbmFtZSB0cmFja2luZywgYW5kIHRoZSBwYXR0ZXJuIGlzIC8qIChub3QgLyoqKSxcbiAgICAgICAgLy8gYWxsb3cgaXQgdGhyb3VnaCBvbmx5IGlmIGl0J3MgaW4gYSBkaXJlY3QgY2hpbGQgZm9sZGVyIChvbmUgbGV2ZWwgZGVlcClcbiAgICAgICAgaWYgKGlzSW5kZXhGaWxlRm9yRm9sZGVyUmVuYW1lICYmIGV4Y2x1ZGVQYXR0ZXJuLmVuZHNXaXRoKCcvKicpICYmICFleGNsdWRlUGF0dGVybi5lbmRzV2l0aCgnLyoqJykpIHtcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgZmlsZSBpcyBpbiBhIGRpcmVjdCBjaGlsZCAob25seSBvbmUgbGV2ZWwgZGVlcClcbiAgICAgICAgICBjb25zdCBiYXNlRm9sZGVyID0gZXhjbHVkZVBhdHRlcm4uc2xpY2UoMCwgLTIpO1xuICAgICAgICAgIGlmIChwYXRoLnN0YXJ0c1dpdGgoYmFzZUZvbGRlciArICcvJykpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhdGhBZnRlckJhc2UgPSBwYXRoLnNsaWNlKGJhc2VGb2xkZXIubGVuZ3RoICsgMSk7XG4gICAgICAgICAgICBjb25zdCBwYXRoUGFydHMgPSBwYXRoQWZ0ZXJCYXNlLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICAvLyBJZiB0aGVyZSdzIG9ubHkgb25lIHBhdGggcGFydCBiZWZvcmUgdGhlIGZpbGVuYW1lLCBpdCdzIGEgZGlyZWN0IGNoaWxkXG4gICAgICAgICAgICAvLyBwYXRoUGFydHMgd2lsbCBiZSBsaWtlIFsnc3ViZm9sZGVyJywgJ2ZpbGVuYW1lLm1kJ10gLSB3ZSB3YW50IGV4YWN0bHkgMiBwYXJ0c1xuICAgICAgICAgICAgaWYgKHBhdGhQYXJ0cy5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBleGNsdXNpb24gLSBpdCdzIGEgZGlyZWN0IGNoaWxkIGluZGV4IGZpbGVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuOyAvLyBFeGNsdWRlZCBieSBmb2xkZXIgcGF0dGVyblxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENoZWNrIGlnbm9yZSByZWdleGVzXG4gICAgY29uc3QgcmVnZXhlczogUmVnRXhwW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHJlZ2V4U3RyIG9mIHRoaXMuc2V0dGluZ3MuaWdub3JlUmVnZXhlcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmVnZXhlcy5wdXNoKG5ldyBSZWdFeHAocmVnZXhTdHIpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgSW52YWxpZCBpZ25vcmUgcmVnZXg6ICR7cmVnZXhTdHJ9YCwgZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IHRvUXVldWU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgIGlmIChpc05hbWVDaGFuZ2UpIHtcbiAgICAgIGlmIChyZWdleGVzLnNvbWUocmUgPT4gcmUudGVzdChvbGRCYXNlbmFtZSkgfHwgcmUudGVzdChuZXdCYXNlbmFtZSkpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRvUXVldWUgPSBvbGRCYXNlbmFtZTtcbiAgICB9IGVsc2UgaWYgKGlzRm9sZGVyQ2hhbmdlICYmIHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzICYmIHRoaXMuc2V0dGluZ3MudHJhY2tGb2xkZXJSZW5hbWVzLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoZSBjdXJyZW50IGZpbGUgbmFtZSBtYXRjaGVzIHRoZSBzcGVjaWZpZWQgbmFtZSAod2l0aG91dCBleHRlbnNpb24pXG4gICAgICBjb25zdCBjdXJyZW50QmFzZW5hbWUgPSBuZXdGaWxlLmJhc2VuYW1lO1xuICAgICAgY29uc3QgbWF0Y2hlc0ZpbGVuYW1lID0gdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlIFxuICAgICAgICA/IGN1cnJlbnRCYXNlbmFtZSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXNcbiAgICAgICAgOiBjdXJyZW50QmFzZW5hbWUudG9Mb3dlckNhc2UoKSA9PT0gdGhpcy5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXMudG9Mb3dlckNhc2UoKTtcbiAgICAgIFxuICAgICAgaWYgKCFtYXRjaGVzRmlsZW5hbWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAob2xkSW1tZWRpYXRlUGFyZW50TmFtZSA9PT0gJycgfHwgbmV3SW1tZWRpYXRlUGFyZW50TmFtZSA9PT0gJycpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHJlZ2V4ZXMuc29tZShyZSA9PiByZS50ZXN0KG9sZEltbWVkaWF0ZVBhcmVudE5hbWUpIHx8IHJlLnRlc3QobmV3SW1tZWRpYXRlUGFyZW50TmFtZSkpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRvUXVldWUgPSBvbGRJbW1lZGlhdGVQYXJlbnROYW1lO1xuICAgIH1cblxuICAgIGlmICghdG9RdWV1ZSkgcmV0dXJuO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUncyBhbHJlYWR5IGEgcGVuZGluZyB0aW1lb3V0IGZvciB0aGlzIGZpbGVcbiAgICAvLyBXZSBuZWVkIHRvIGNoZWNrIGJvdGggdGhlIG5ldyBwYXRoIGFuZCB0aGUgb2xkIHBhdGggc2luY2UgdGhlIGZpbGUgd2FzIGp1c3QgcmVuYW1lZFxuICAgIGxldCBleGlzdGluZ0VudHJ5ID0gdGhpcy5kZWJvdW5jZU1hcC5nZXQobmV3RmlsZS5wYXRoKTtcbiAgICBpZiAoIWV4aXN0aW5nRW50cnkpIHtcbiAgICAgIC8vIENoZWNrIGlmIHRoZXJlJ3MgYSB0aW1lb3V0IGZvciB0aGUgb2xkIHBhdGggKHRoZSBmaWxlIHdhcyBqdXN0IHJlbmFtZWQgZnJvbSB0aGVyZSlcbiAgICAgIGV4aXN0aW5nRW50cnkgPSB0aGlzLmRlYm91bmNlTWFwLmdldChvbGRQYXRoKTtcbiAgICAgIGlmIChleGlzdGluZ0VudHJ5KSB7XG4gICAgICAgIC8vIFJlbW92ZSB0aGUgb2xkIGVudHJ5IHNpbmNlIHdlJ3JlIHVwZGF0aW5nIGl0IHdpdGggdGhlIG5ldyBwYXRoXG4gICAgICAgIHRoaXMuZGVib3VuY2VNYXAuZGVsZXRlKG9sZFBhdGgpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBpZiAoZXhpc3RpbmdFbnRyeSkge1xuICAgICAgLy8gRmlsZSB3YXMgcmVuYW1lZCBhZ2FpbiBiZWZvcmUgdGltZW91dCBleHBpcmVkIC0gY2FuY2VsIHRoZSBwcmV2aW91cyB0aW1lb3V0XG4gICAgICBpZiAoZXhpc3RpbmdFbnRyeS50aW1lb3V0SWQgIT09IDApIHtcbiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChleGlzdGluZ0VudHJ5LnRpbWVvdXRJZCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFVzZSB0aGUgb3JpZ2luYWwgc3RhYmxlIG5hbWUgZnJvbSB0aGUgcHJldmlvdXMgdGltZW91dCwgbm90IHRoZSB0ZW1wb3JhcnkgbmFtZVxuICAgICAgdG9RdWV1ZSA9IEFycmF5LmZyb20oZXhpc3RpbmdFbnRyeS5xdWV1ZSlbMF07IC8vIFVzZSB0aGUgb3JpZ2luYWwgc3RhYmxlIG5hbWVcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgZW50cnkgdG8gdHJhY2sgdGhlIHRpbWVvdXRcbiAgICBjb25zdCBlbnRyeSA9IHsgXG4gICAgICBxdWV1ZTogbmV3IFNldDxzdHJpbmc+KFt0b1F1ZXVlXSksIFxuICAgICAgdGltZW91dElkOiAwLCBcbiAgICAgIGN1cnJlbnRQYXRoOiBuZXdGaWxlLnBhdGggXG4gICAgfTtcblxuICAgIC8vIFNldCB0aW1lb3V0IHRvIGFjdHVhbGx5IHN0b3JlIHRoZSBhbGlhcyBhZnRlciB0aGUgZGVib3VuY2UgcGVyaW9kXG4gICAgZW50cnkudGltZW91dElkID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdm9pZCAoYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHRoaXMuYWxpYXNQcm9jZXNzb3IucHJvY2Vzc0FsaWFzZXMoZW50cnkuY3VycmVudFBhdGgsIGVudHJ5LnF1ZXVlKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIGFsaWFzZXM6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGVib3VuY2VNYXAuZGVsZXRlKGVudHJ5LmN1cnJlbnRQYXRoKTtcbiAgICAgIH0pKCk7XG4gICAgfSwgdGhpcy5zZXR0aW5ncy50aW1lb3V0U2Vjb25kcyAqIDEwMDApO1xuXG4gICAgdGhpcy5kZWJvdW5jZU1hcC5zZXQobmV3RmlsZS5wYXRoLCBlbnRyeSk7XG4gIH1cbn1cbiIsICJleHBvcnQgaW50ZXJmYWNlIEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3Mge1xyXG4gIGlnbm9yZVJlZ2V4ZXM6IHN0cmluZ1tdO1xyXG4gIHRpbWVvdXRTZWNvbmRzOiBudW1iZXI7XHJcbiAgY2FzZVNlbnNpdGl2ZTogYm9vbGVhbjtcclxuICBhdXRvQ3JlYXRlRnJvbnRtYXR0ZXI6IGJvb2xlYW47XHJcbiAgaW5jbHVkZUZvbGRlcnM6IHN0cmluZ1tdO1xyXG4gIGV4Y2x1ZGVGb2xkZXJzOiBzdHJpbmdbXTtcclxuICBmaWxlRXh0ZW5zaW9uczogc3RyaW5nW107XHJcbiAgdHJhY2tGb2xkZXJSZW5hbWVzOiBzdHJpbmc7XHJcbiAgZXhjbHVkZVByb3BlcnR5TmFtZTogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogQWxpYXNGaWxlbmFtZUhpc3RvcnlTZXR0aW5ncyA9IHtcclxuICBpZ25vcmVSZWdleGVzOiBbJ15fJywgJ15VbnRpdGxlZCQnLCAnXlVudGl0bGVkIFxcXFxkKyQnXSxcclxuICB0aW1lb3V0U2Vjb25kczogNSxcclxuICBjYXNlU2Vuc2l0aXZlOiBmYWxzZSxcclxuICBhdXRvQ3JlYXRlRnJvbnRtYXR0ZXI6IHRydWUsXHJcbiAgaW5jbHVkZUZvbGRlcnM6IFtdLFxyXG4gIGV4Y2x1ZGVGb2xkZXJzOiBbXSxcclxuICBmaWxlRXh0ZW5zaW9uczogWydtZCddLFxyXG4gIHRyYWNrRm9sZGVyUmVuYW1lczogJycsXHJcbiAgZXhjbHVkZVByb3BlcnR5TmFtZTogJycsXHJcbn07IiwgImltcG9ydCB7IEFwcCwgUGx1Z2luLCBQbHVnaW5TZXR0aW5nVGFiIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBBbGlhc0ZpbGVuYW1lSGlzdG9yeVNldHRpbmdzIH0gZnJvbSAnLi4vc2V0dGluZ3MnO1xyXG5pbXBvcnQgeyBjcmVhdGVTZXR0aW5nc0dyb3VwIH0gZnJvbSAnLi4vdXRpbHMvc2V0dGluZ3MtY29tcGF0JztcclxuXHJcbmludGVyZmFjZSBBbGlhc0ZpbGVuYW1lSGlzdG9yeVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcbiAgc2V0dGluZ3M6IEFsaWFzRmlsZW5hbWVIaXN0b3J5U2V0dGluZ3M7XHJcbiAgc2F2ZVNldHRpbmdzKCk6IFByb21pc2U8dm9pZD47XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBBbGlhc0ZpbGVuYW1lSGlzdG9yeVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuICBwbHVnaW46IEFsaWFzRmlsZW5hbWVIaXN0b3J5UGx1Z2luO1xyXG5cclxuICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBBbGlhc0ZpbGVuYW1lSGlzdG9yeVBsdWdpbikge1xyXG4gICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xyXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XHJcbiAgfVxyXG5cclxuICBkaXNwbGF5KCk6IHZvaWQge1xyXG4gICAgY29uc3QgeyBjb250YWluZXJFbCB9ID0gdGhpcztcclxuICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XHJcblxyXG4gICAgLy8gSGVscGVyIHRvIHNhdmUgc2V0dGluZ3Mgd2l0aG91dCByZXR1cm5pbmcgYSBwcm9taXNlXHJcbiAgICBjb25zdCBzYXZlU2V0dGluZ3MgPSAoKTogdm9pZCA9PiB7XHJcbiAgICAgIHZvaWQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGdlbmVyYWxHcm91cCA9IGNyZWF0ZVNldHRpbmdzR3JvdXAoY29udGFpbmVyRWwpO1xyXG5cclxuICAgIC8vIEdlbmVyYWwgYmVoYXZpb3Igc2V0dGluZ3MgKGdyb3VwZWQsIG5vIGhlYWRpbmcpXHJcbiAgICBnZW5lcmFsR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xyXG4gICAgICBzZXR0aW5nXHJcbiAgICAgICAgLnNldE5hbWUoJ1RpbWVvdXQgc2Vjb25kcycpXHJcbiAgICAgICAgLnNldERlc2MoJ1RpbWUgaW4gc2Vjb25kcyB0aGUgbmFtZSBtdXN0IGJlIHN0YWJsZSBiZWZvcmUgYWRkaW5nIGFsaWFzZXMuJylcclxuICAgICAgICAuYWRkU2xpZGVyKChzbGlkZXIpID0+XHJcbiAgICAgICAgICBzbGlkZXJcclxuICAgICAgICAgICAgLnNldExpbWl0cygxLCAyMCwgMSlcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnRpbWVvdXRTZWNvbmRzKVxyXG4gICAgICAgICAgICAuc2V0RHluYW1pY1Rvb2x0aXAoKVxyXG4gICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGltZW91dFNlY29uZHMgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZ2VuZXJhbEdyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcclxuICAgICAgc2V0dGluZ1xyXG4gICAgICAgIC5zZXROYW1lKCdDYXNlLXNlbnNpdGl2ZSB1bmlxdWVuZXNzJylcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgb2JzaWRpYW5tZC91aS9zZW50ZW5jZS1jYXNlXHJcbiAgICAgICAgLnNldERlc2MoJ0lmIGVuYWJsZWQsIHRyZWF0IG5vdGUgYW5kIE5vdGUgYXMgZGlmZmVyZW50IGFsaWFzZXMuJylcclxuICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XHJcbiAgICAgICAgICB0b2dnbGVcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUpXHJcbiAgICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGdlbmVyYWxHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnQXV0by1jcmVhdGUgcHJvcGVydGllcycpXHJcbiAgICAgICAgLnNldERlc2MoJ0F1dG9tYXRpY2FsbHkgY3JlYXRlIHByb3BlcnRpZXMgd2l0aCBhbGlhc2VzIGlmIG1pc3NpbmcuJylcclxuICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XHJcbiAgICAgICAgICB0b2dnbGVcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9DcmVhdGVGcm9udG1hdHRlcilcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmF1dG9DcmVhdGVGcm9udG1hdHRlciA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBnZW5lcmFsR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xyXG4gICAgICBzZXR0aW5nXHJcbiAgICAgICAgLnNldE5hbWUoJ0ZpbGUgZXh0ZW5zaW9ucycpXHJcbiAgICAgICAgLnNldERlc2MoJ0NvbW1hLXNlcGFyYXRlZCBsaXN0IG9mIGZpbGUgZXh0ZW5zaW9ucyB0byB0cmFjay4nKVxyXG4gICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgb2JzaWRpYW5tZC91aS9zZW50ZW5jZS1jYXNlXHJcbiAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignbWQsIHR4dCcpXHJcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5maWxlRXh0ZW5zaW9ucy5qb2luKCcsJykpXHJcbiAgICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5maWxlRXh0ZW5zaW9ucyA9IHZhbHVlXHJcbiAgICAgICAgICAgICAgICAuc3BsaXQoJywnKVxyXG4gICAgICAgICAgICAgICAgLm1hcCgocykgPT4gcy50cmltKCkpXHJcbiAgICAgICAgICAgICAgICAuZmlsdGVyKChzKSA9PiBzKTtcclxuICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgZmlsdGVyaW5nR3JvdXAgPSBjcmVhdGVTZXR0aW5nc0dyb3VwKGNvbnRhaW5lckVsLCAnRmlsdGVyaW5nJyk7XHJcbiAgICBjb25zdCBmb2xkZXJzR3JvdXAgPSBjcmVhdGVTZXR0aW5nc0dyb3VwKGNvbnRhaW5lckVsLCAnRm9sZGVycycpO1xyXG4gICAgY29uc3QgYWR2YW5jZWRHcm91cCA9IGNyZWF0ZVNldHRpbmdzR3JvdXAoY29udGFpbmVyRWwsICdBZHZhbmNlZCcpO1xyXG5cclxuICAgIC8vIEZpbHRlcmluZyBzZXR0aW5nc1xyXG4gICAgZmlsdGVyaW5nR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xyXG4gICAgICBzZXR0aW5nXHJcbiAgICAgICAgLnNldE5hbWUoJ0lnbm9yZSByZWdleCBwYXR0ZXJucycpXHJcbiAgICAgICAgLnNldERlc2MoXHJcbiAgICAgICAgICAnQ29tbWEtc2VwYXJhdGVkIHJlZ2V4IHBhdHRlcm5zIGZvciBmaWxlIG5hbWVzIG9yIGltbWVkaWF0ZSBwYXJlbnQgZm9sZGVyIG5hbWVzIHRvIGlnbm9yZSAoZS5nLiwgXl8gZm9yIHVuZGVyc2NvcmUgcHJlZml4ZXMsIF51bnRpdGxlZCQgZm9yIHVudGl0bGVkKS4gTGVhdmUgZW1wdHkgdG8gZGlzYWJsZS4nXHJcbiAgICAgICAgKVxyXG4gICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxyXG4gICAgICAgICAgdGV4dFxyXG4gICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ15fLCBedW50aXRsZWQkLCBedW50aXRsZWQgXFxcXGQrJCcpXHJcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5pZ25vcmVSZWdleGVzLmpvaW4oJywnKSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmlnbm9yZVJlZ2V4ZXMgPSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgLnNwbGl0KCcsJylcclxuICAgICAgICAgICAgICAgIC5tYXAoKHMpID0+IHMudHJpbSgpKVxyXG4gICAgICAgICAgICAgICAgLmZpbHRlcigocykgPT4gcyk7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGZpbHRlcmluZ0dyb3VwLmFkZFNldHRpbmcoKHNldHRpbmcpID0+IHtcclxuICAgICAgc2V0dGluZ1xyXG4gICAgICAgIC5zZXROYW1lKCdFeGNsdWRlIHByb3BlcnR5IG5hbWUnKVxyXG4gICAgICAgIC5zZXREZXNjKFxyXG4gICAgICAgICAgJ05hbWUgb2YgYSBib29sZWFuIHByb3BlcnR5IHRvIGNoZWNrIGluIGZpbGVzLiBGaWxlcyB3aXRoIHRoaXMgcHJvcGVydHkgc2V0IHRvIHRydWUgd2lsbCBiZSBleGNsdWRlZCBmcm9tIHRyYWNraW5nLiBUYWtlcyBwcmlvcml0eSBvdmVyIGZvbGRlciBmaWx0ZXJpbmcuJ1xyXG4gICAgICAgIClcclxuICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICAgIHRleHRcclxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG9ic2lkaWFubWQvdWkvc2VudGVuY2UtY2FzZVxyXG4gICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ3NraXAtcmVuYW1lLXRyYWNraW5nJylcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVQcm9wZXJ0eU5hbWUpXHJcbiAgICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlUHJvcGVydHlOYW1lID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEZvbGRlciBpbmNsdWRlL2V4Y2x1ZGUgc2V0dGluZ3NcclxuICAgIGZvbGRlcnNHcm91cC5hZGRTZXR0aW5nKChzZXR0aW5nKSA9PiB7XHJcbiAgICAgIHNldHRpbmdcclxuICAgICAgICAuc2V0TmFtZSgnSW5jbHVkZSBmb2xkZXJzJylcclxuICAgICAgICAuc2V0RGVzYyhcclxuICAgICAgICAgICdDb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBmb2xkZXIgcGF0aHMgdG8gaW5jbHVkZS4gSWYgZW1wdHksIGFsbCBmb2xkZXJzIGFyZSBpbmNsdWRlZC4gVXNlIHt2YXVsdH0gb3Ige3Jvb3R9IHRvIGluY2x1ZGUgb25seSBmaWxlcyBkaXJlY3RseSBpbiB0aGUgdmF1bHQgcm9vdCAobm8gc3ViZm9sZGVycykuJ1xyXG4gICAgICAgIClcclxuICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICAgIHRleHRcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGVGb2xkZXJzLmpvaW4oJywnKSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmluY2x1ZGVGb2xkZXJzID0gdmFsdWVcclxuICAgICAgICAgICAgICAgIC5zcGxpdCgnLCcpXHJcbiAgICAgICAgICAgICAgICAubWFwKChzKSA9PiBzLnRyaW0oKSlcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHMpID0+IHMpO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmb2xkZXJzR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xyXG4gICAgICBzZXR0aW5nXHJcbiAgICAgICAgLnNldE5hbWUoJ0V4Y2x1ZGUgZm9sZGVycycpXHJcbiAgICAgICAgLnNldERlc2MoXHJcbiAgICAgICAgICAnQ29tbWEtc2VwYXJhdGVkIGxpc3Qgb2YgZm9sZGVyIHBhdGhzIHRvIGV4Y2x1ZGUuIFN1cHBvcnRzIHdpbGRjYXJkczogdXNlIFwiZm9sZGVyLypcIiB0byBleGNsdWRlIGRpcmVjdCBjaGlsZHJlbiwgXCJmb2xkZXIvKipcIiB0byBleGNsdWRlIGFsbCBkZXNjZW5kYW50cy4gVXNlIHt2YXVsdH0gb3Ige3Jvb3R9IHRvIGV4Y2x1ZGUgZmlsZXMgZGlyZWN0bHkgaW4gdGhlIHZhdWx0IHJvb3QuJ1xyXG4gICAgICAgIClcclxuICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT5cclxuICAgICAgICAgIHRleHRcclxuICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVGb2xkZXJzLmpvaW4oJywnKSlcclxuICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVGb2xkZXJzID0gdmFsdWVcclxuICAgICAgICAgICAgICAgIC5zcGxpdCgnLCcpXHJcbiAgICAgICAgICAgICAgICAubWFwKChzKSA9PiBzLnRyaW0oKSlcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKHMpID0+IHMpO1xyXG4gICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBBZHZhbmNlZCAvIG5pY2hlIG9wdGlvbnNcclxuICAgIGFkdmFuY2VkR3JvdXAuYWRkU2V0dGluZygoc2V0dGluZykgPT4ge1xyXG4gICAgICBzZXR0aW5nXHJcbiAgICAgICAgLnNldE5hbWUoJ1RyYWNrIGZvbGRlciByZW5hbWVzIGZvciBzcGVjaWZpYyBmaWxlIG5hbWUnKVxyXG4gICAgICAgIC5zZXREZXNjKFxyXG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG9ic2lkaWFubWQvdWkvc2VudGVuY2UtY2FzZVxyXG4gICAgICAgICAgJ0lmIGEgbWFya2Rvd24gZmlsZSBtYXRjaGVzIHRoaXMgZmlsZSBuYW1lLCBzdG9yZSBvbGQgaW1tZWRpYXRlIHBhcmVudCBmb2xkZXIgbmFtZXMgYXMgYWxpYXNlcyB3aGVuIHBhcmVudCBmb2xkZXJzIGFyZSByZW5hbWVkLidcclxuICAgICAgICApXHJcbiAgICAgICAgLmFkZFRleHQoKHRleHQpID0+XHJcbiAgICAgICAgICB0ZXh0XHJcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBvYnNpZGlhbm1kL3VpL3NlbnRlbmNlLWNhc2VcclxuICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdpbmRleCcpXHJcbiAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXMpXHJcbiAgICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50cmFja0ZvbGRlclJlbmFtZXMgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxufVxyXG4iLCAiLyoqXHJcbiAqIENvbXBhdGliaWxpdHkgdXRpbGl0aWVzIGZvciBzZXR0aW5nc1xyXG4gKiBQcm92aWRlcyBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IGZvciBTZXR0aW5nR3JvdXAgKHJlcXVpcmVzIEFQSSAxLjExLjArKVxyXG4gKi9cclxuaW1wb3J0IHsgU2V0dGluZywgcmVxdWlyZUFwaVZlcnNpb24gfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCAqIGFzIE9ic2lkaWFuIGZyb20gJ29ic2lkaWFuJztcclxuXHJcbmludGVyZmFjZSBTZXR0aW5nR3JvdXBJbnN0YW5jZSB7XHJcbiAgc2V0SGVhZGluZyhoZWFkaW5nOiBzdHJpbmcpOiB2b2lkO1xyXG4gIGFkZFNldHRpbmcoY2I6IChzZXR0aW5nOiBTZXR0aW5nKSA9PiB2b2lkKTogdm9pZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEludGVyZmFjZSB0aGF0IHdvcmtzIHdpdGggYm90aCBTZXR0aW5nR3JvdXAgYW5kIGZhbGxiYWNrIGNvbnRhaW5lclxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBTZXR0aW5nc0NvbnRhaW5lciB7XHJcbiAgYWRkU2V0dGluZyhjYjogKHNldHRpbmc6IFNldHRpbmcpID0+IHZvaWQpOiB2b2lkO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlcyBhIHNldHRpbmdzIGNvbnRhaW5lciB0aGF0IHVzZXMgU2V0dGluZ0dyb3VwIGlmIGF2YWlsYWJsZSAoQVBJIDEuMTEuMCspLFxyXG4gKiBvdGhlcndpc2UgZmFsbHMgYmFjayB0byBjcmVhdGluZyBhIGhlYWRpbmcgYW5kIHVzaW5nIHRoZSBjb250YWluZXIgZGlyZWN0bHkuXHJcbiAqXHJcbiAqIFVzZXMgcmVxdWlyZUFwaVZlcnNpb24oJzEuMTEuMCcpIHRvIGNoZWNrIGlmIFNldHRpbmdHcm91cCBpcyBhdmFpbGFibGUuXHJcbiAqIFRoaXMgaXMgdGhlIG9mZmljaWFsIE9ic2lkaWFuIEFQSSBtZXRob2QgZm9yIHZlcnNpb24gY2hlY2tpbmcuXHJcbiAqXHJcbiAqIEBwYXJhbSBjb250YWluZXJFbCAtIFRoZSBjb250YWluZXIgZWxlbWVudCBmb3Igc2V0dGluZ3NcclxuICogQHBhcmFtIGhlYWRpbmcgLSBUaGUgaGVhZGluZyB0ZXh0IGZvciB0aGUgc2V0dGluZ3MgZ3JvdXBcclxuICogQHJldHVybnMgQSBjb250YWluZXIgdGhhdCBjYW4gYmUgdXNlZCB0byBhZGQgc2V0dGluZ3NcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTZXR0aW5nc0dyb3VwKFxyXG4gIGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCxcclxuICBoZWFkaW5nPzogc3RyaW5nXHJcbik6IFNldHRpbmdzQ29udGFpbmVyIHtcclxuICAvLyBDaGVjayBpZiBTZXR0aW5nR3JvdXAgaXMgYXZhaWxhYmxlIChBUEkgMS4xMS4wKylcclxuICAvLyByZXF1aXJlQXBpVmVyc2lvbiBpcyB0aGUgb2ZmaWNpYWwgT2JzaWRpYW4gQVBJIG1ldGhvZCBmb3IgdmVyc2lvbiBjaGVja2luZ1xyXG4gIGlmIChyZXF1aXJlQXBpVmVyc2lvbignMS4xMS4wJykpIHtcclxuICAgIC8vIFVzZSBTZXR0aW5nR3JvdXAgLSBpdCdzIGd1YXJhbnRlZWQgdG8gZXhpc3QgYXQgcnVudGltZSBpZiByZXF1aXJlQXBpVmVyc2lvbiByZXR1cm5zIHRydWUuXHJcbiAgICAvLyBXZSBhY2Nlc3MgaXQgdmlhIHRoZSBuYW1lc3BhY2UgaW1wb3J0IHRvIGF2b2lkIHJlcXVpcmluZyB0aGUgdHlwZSBpbiBvbGRlciBBUEkgZC50cyBmaWxlcy5cclxuICAgIHR5cGUgT2JzaWRpYW5XaXRoU2V0dGluZ0dyb3VwID0gdHlwZW9mIE9ic2lkaWFuICYge1xyXG4gICAgICBTZXR0aW5nR3JvdXA6IG5ldyAoY29udGFpbmVyRWw6IEhUTUxFbGVtZW50KSA9PiBTZXR0aW5nR3JvdXBJbnN0YW5jZTtcclxuICAgIH07XHJcbiAgICBjb25zdCBPYnNpZGlhblR5cGVkID0gT2JzaWRpYW4gYXMgdW5rbm93biBhcyBPYnNpZGlhbldpdGhTZXR0aW5nR3JvdXA7XHJcbiAgICBjb25zdCBTZXR0aW5nR3JvdXBDdG9yID0gT2JzaWRpYW5UeXBlZC5TZXR0aW5nR3JvdXA7XHJcbiAgICBjb25zdCBncm91cCA9IG5ldyBTZXR0aW5nR3JvdXBDdG9yKGNvbnRhaW5lckVsKTtcclxuICAgIGlmIChoZWFkaW5nKSB7XHJcbiAgICAgIGdyb3VwLnNldEhlYWRpbmcoaGVhZGluZyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBhZGRTZXR0aW5nKGNiOiAoc2V0dGluZzogU2V0dGluZykgPT4gdm9pZCkge1xyXG4gICAgICAgIGdyb3VwLmFkZFNldHRpbmcoY2IpO1xyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9IGVsc2Uge1xyXG4gICAgLy8gRmFsbGJhY2s6IGNyZWF0ZSBhIGRlZGljYXRlZCBjb250YWluZXIgdG8ga2VlcCBoZWFkaW5nICsgc2V0dGluZ3MgdG9nZXRoZXJcclxuICAgIGNvbnN0IGdyb3VwRWwgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoJ3NldHRpbmctZ3JvdXAnKTtcclxuICAgIGlmIChoZWFkaW5nKSB7XHJcbiAgICAgIGNvbnN0IGhlYWRpbmdFbCA9IGdyb3VwRWwuY3JlYXRlRGl2KCdzZXR0aW5nLWdyb3VwLWhlYWRpbmcnKTtcclxuICAgICAgaGVhZGluZ0VsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogaGVhZGluZyB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBhZGRTZXR0aW5nKGNiOiAoc2V0dGluZzogU2V0dGluZykgPT4gdm9pZCkge1xyXG4gICAgICAgIGNvbnN0IHNldHRpbmcgPSBuZXcgU2V0dGluZyhncm91cEVsKTtcclxuICAgICAgICBjYihzZXR0aW5nKTtcclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5cclxuIiwgImltcG9ydCB7IEFwcCB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgQWxpYXNGaWxlbmFtZUhpc3RvcnlTZXR0aW5ncyB9IGZyb20gJy4uL3NldHRpbmdzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBBbGlhc1Byb2Nlc3NvciB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGFwcDogQXBwLFxyXG4gICAgcHJpdmF0ZSBzZXR0aW5nczogQWxpYXNGaWxlbmFtZUhpc3RvcnlTZXR0aW5nc1xyXG4gICkge31cclxuXHJcbiAgYXN5bmMgcHJvY2Vzc0FsaWFzZXMocGF0aDogc3RyaW5nLCBxdWV1ZTogU2V0PHN0cmluZz4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRGaWxlQnlQYXRoKHBhdGgpO1xyXG4gICAgaWYgKCFmaWxlKSByZXR1cm47XHJcblxyXG4gICAgY29uc3QgcmVnZXhlczogUmVnRXhwW10gPSBbXTtcclxuICAgIGZvciAoY29uc3QgcmVnZXhTdHIgb2YgdGhpcy5zZXR0aW5ncy5pZ25vcmVSZWdleGVzKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgcmVnZXhlcy5wdXNoKG5ldyBSZWdFeHAocmVnZXhTdHIpKTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEludmFsaWQgaWdub3JlIHJlZ2V4OiAke3JlZ2V4U3RyfWAsIGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdG9BZGQ6IHN0cmluZ1tdID0gW107XHJcbiAgICBjb25zdCBjdXJyZW50QmFzZW5hbWUgPSBmaWxlLmJhc2VuYW1lO1xyXG4gICAgY29uc3QgY3VycmVudEJhc2VuYW1lTG93ZXIgPSBjdXJyZW50QmFzZW5hbWUudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgcXVldWUpIHtcclxuICAgICAgaWYgKHJlZ2V4ZXMuc29tZShyZSA9PiByZS50ZXN0KG5hbWUpKSkge1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IG5hbWVMb3dlciA9IG5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgaWYgKFxyXG4gICAgICAgICh0aGlzLnNldHRpbmdzLmNhc2VTZW5zaXRpdmUgJiYgbmFtZSA9PT0gY3VycmVudEJhc2VuYW1lKSB8fFxyXG4gICAgICAgICghdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlICYmIG5hbWVMb3dlciA9PT0gY3VycmVudEJhc2VuYW1lTG93ZXIpXHJcbiAgICAgICkge1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcbiAgICAgIHRvQWRkLnB1c2gobmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRvQWRkLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG5cclxuICAgIGF3YWl0IHRoaXMuYXBwLmZpbGVNYW5hZ2VyLnByb2Nlc3NGcm9udE1hdHRlcihmaWxlLCAoZm06IFJlY29yZDxzdHJpbmcsIHVua25vd24+KSA9PiB7XHJcbiAgICAgIGxldCBhbGlhc2VzID0gZm0uYWxpYXNlcztcclxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGFsaWFzZXMpKSB7XHJcbiAgICAgICAgLy8gSWYgdGhlcmUncyBubyBmcm9udG1hdHRlciBhdCBhbGwsIHdlIG5lZWQgdG8gY3JlYXRlIGl0IHRvIGFkZCBhbGlhc2VzXHJcbiAgICAgICAgLy8gSWYgdGhlcmUncyBmcm9udG1hdHRlciBidXQgbm8gYWxpYXNlcyBwcm9wZXJ0eSwgcmVzcGVjdCB0aGUgYXV0b0NyZWF0ZUZyb250bWF0dGVyIHNldHRpbmdcclxuICAgICAgICBjb25zdCBoYXNGcm9udG1hdHRlciA9IE9iamVjdC5rZXlzKGZtKS5sZW5ndGggPiAwO1xyXG4gICAgICAgIGlmIChoYXNGcm9udG1hdHRlciAmJiAhdGhpcy5zZXR0aW5ncy5hdXRvQ3JlYXRlRnJvbnRtYXR0ZXIpIHJldHVybjtcclxuICAgICAgICBhbGlhc2VzID0gW107XHJcbiAgICAgICAgZm0uYWxpYXNlcyA9IGFsaWFzZXM7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGFsaWFzZXNBcnJheSA9IGFsaWFzZXMgYXMgc3RyaW5nW107XHJcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gbmV3IFNldDxzdHJpbmc+KFxyXG4gICAgICAgIHRoaXMuc2V0dGluZ3MuY2FzZVNlbnNpdGl2ZSA/IGFsaWFzZXNBcnJheSA6IGFsaWFzZXNBcnJheS5tYXAoKGE6IHN0cmluZykgPT4gYS50b0xvd2VyQ2FzZSgpKVxyXG4gICAgICApO1xyXG5cclxuICAgICAgZm9yIChjb25zdCBuYW1lIG9mIHRvQWRkKSB7XHJcbiAgICAgICAgY29uc3QgY2hlY2tOYW1lID0gdGhpcy5zZXR0aW5ncy5jYXNlU2Vuc2l0aXZlID8gbmFtZSA6IG5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICBpZiAoIWV4aXN0aW5nLmhhcyhjaGVja05hbWUpKSB7XHJcbiAgICAgICAgICBhbGlhc2VzQXJyYXkucHVzaChuYW1lKTtcclxuICAgICAgICAgIGV4aXN0aW5nLmFkZChjaGVja05hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsICJleHBvcnQgZnVuY3Rpb24gZ2V0QmFzZW5hbWUocGF0aDogc3RyaW5nKTogc3RyaW5nIHtcclxuICBjb25zdCBuYW1lID0gcGF0aC5zcGxpdCgnLycpLnBvcCgpIHx8ICcnO1xyXG4gIHJldHVybiBuYW1lLnJlcGxhY2UoL1xcLlteLy5dKyQvLCAnJyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRJbW1lZGlhdGVQYXJlbnROYW1lKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgY29uc3QgcGFydHMgPSBwYXRoLnNwbGl0KCcvJyk7XHJcbiAgcGFydHMucG9wKCk7IC8vIFJlbW92ZSBmaWxlIG5hbWVcclxuICByZXR1cm4gcGFydHMucG9wKCkgfHwgJyc7IC8vIEdldCBpbW1lZGlhdGUgcGFyZW50IGZvbGRlciBuYW1lIG9yICcnIGlmIHJvb3RcclxufVxyXG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBQUFBLG1CQUE2Qzs7O0FDWXRDLElBQU0sbUJBQWlEO0FBQUEsRUFDNUQsZUFBZSxDQUFDLE1BQU0sY0FBYyxpQkFBaUI7QUFBQSxFQUNyRCxnQkFBZ0I7QUFBQSxFQUNoQixlQUFlO0FBQUEsRUFDZix1QkFBdUI7QUFBQSxFQUN2QixnQkFBZ0IsQ0FBQztBQUFBLEVBQ2pCLGdCQUFnQixDQUFDO0FBQUEsRUFDakIs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QkFBa0IsS0FBSyxTQUFTLHNCQUFzQixLQUFLLFNBQVMsbUJBQW1CLEtBQUssTUFBTSxJQUFJO0FBRS9HLFlBQU0sa0JBQWtCLFFBQVE7QUFDaEMsWUFBTSxrQkFBa0IsS0FBSyxTQUFTLGdCQUNsQyxvQkFBb0IsS0FBSyxTQUFTLHFCQUNsQyxnQkFBZ0IsWUFBWSxNQUFNLEtBQUssU0FBUyxtQkFBbUIsWUFBWTtBQUVuRixVQUFJLENBQUMsaUJBQWlCO0FBQ3BCO0FBQUEsTUFDRjtBQUVBLFVBQUksMkJBQTJCLE1BQU0sMkJBQTJCLElBQUk7QUFDbEU7QUFBQSxNQUNGO0FBQ0EsVUFBSSxRQUFRLEtBQUssUUFBTSxHQUFHLEtBQUssc0JBQXNCLEtBQUssR0FBRyxLQUFLLHNCQUFzQixDQUFDLEdBQUc7QUFDMUY7QUFBQSxNQUNGO0FBQ0EsZ0JBQVU7QUFBQSxJQUNaO0FBRUEsUUFBSSxDQUFDO0FBQVM7QUFJZCxRQUFJLGdCQUFnQixLQUFLLFlBQVksSUFBSSxRQUFRLElBQUk7QUFDckQsUUFBSSxDQUFDLGVBQWU7QUFFbEIsc0JBQWdCLEtBQUssWUFBWSxJQUFJLE9BQU87QUFDNUMsVUFBSSxlQUFlO0FBRWpCLGFBQUssWUFBWSxPQUFPLE9BQU87QUFBQSxNQUNqQztBQUFBLElBQ0Y7QUFFQSxRQUFJLGVBQWU7QUFFakIsVUFBSSxjQUFjLGNBQWMsR0FBRztBQUNqQyxlQUFPLGFBQWEsY0FBYyxTQUFTO0FBQUEsTUFDN0M7QUFHQSxnQkFBVSxNQUFNLEtBQUssY0FBYyxLQUFLLEVBQUUsQ0FBQztBQUFBLElBQzdDO0FBR0EsVUFBTSxRQUFRO0FBQUEsTUFDWixPQUFPLG9CQUFJLElBQVksQ0FBQyxPQUFPLENBQUM7QUFBQSxNQUNoQyxXQUFXO0FBQUEsTUFDWCxhQUFhLFFBQVE7QUFBQSxJQUN2QjtBQUdBLFVBQU0sWUFBWSxPQUFPLFdBQVcsTUFBTTtBQUN4QyxZQUFNLFlBQVk7QUFDaEIsWUFBSTtBQUNGLGdCQUFNLEtBQUssZUFBZSxlQUFlLE1BQU0sYUFBYSxNQUFNLEtBQUs7QUFBQSxRQUN6RSxTQUFTLE9BQVA7QUFDQSxrQkFBUSxNQUFNLDZCQUE2QixLQUFLO0FBQUEsUUFDbEQ7QUFDQSxhQUFLLFlBQVksT0FBTyxNQUFNLFdBQVc7QUFBQSxNQUMzQyxHQUFHO0FBQUEsSUFDTCxHQUFHLEtBQUssU0FBUyxpQkFBaUIsR0FBSTtBQUV0QyxTQUFLLFlBQVksSUFBSSxRQUFRLE1BQU0sS0FBSztBQUFBLEVBQzFDO0FBQ0Y7IiwKICAibmFtZXMiOiBbImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iXQp9Cg==
