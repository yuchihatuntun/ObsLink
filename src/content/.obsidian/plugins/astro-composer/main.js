/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var J=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var be=Object.getOwnPropertyNames;var ye=Object.prototype.hasOwnProperty;var Ce=(u,a)=>{for(var e in a)J(u,e,{get:a[e],enumerable:!0})},Te=(u,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let s of be(a))!ye.call(u,s)&&s!==e&&J(u,s,{get:()=>a[s],enumerable:!(t=fe(a,s))||t.enumerable});return u};var we=u=>Te(J({},"__esModule",{value:!0}),u);var Se={};Ce(Se,{default:()=>z});module.exports=we(Se);var S=require("obsidian");var D=["tags","aliases","cssclasses"],V={DEBOUNCE_MS:500,STAT_MTIME_THRESHOLD:1e3,EDITOR_STABILIZE_DELAY:100,FILE_EXPLORER_REVEAL_DELAY:200};var se={defaultTemplate:`---
title: "{{title}}"
date: {{date}}
tags: []
---
`,autoInsertProperties:!0,dateFormat:"YYYY-MM-DD",enableCopyHeadingLink:!0,copyHeadingLinkFormat:"obsidian",addTrailingSlashToLinks:!1,enableOpenTerminalCommand:!1,terminalProjectRootPath:"",enableTerminalRibbonIcon:!1,enableOpenConfigFileCommand:!1,configFilePath:"",enableConfigRibbonIcon:!1,contentTypes:[],migrationCompleted:!1,helpButtonReplacement:{enabled:!1,commandId:"edit-astro-config",iconId:"wrench"}};var C=require("obsidian");var y=require("obsidian");function M(u,a){if(!a||a.trim()==="")return!u.includes("/")||u.split("/").length===1;if(!a.includes("*"))return u===a||u.startsWith(a+"/");let t=`^${a.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,"[^/]+")}(?:/|$)`;return new RegExp(t).test(u)}function oe(u){return!u||u.trim()===""?0:u.split("/").length}function R(u){return[...u].sort((a,e)=>{let t=oe(a.folder);return oe(e.folder)-t})}var k=class{constructor(a,e,t){this.app=a;this.settings=e;this.plugin=t}getSettings(){var a;return(a=this.plugin)!=null&&a.settings?this.plugin.settings:this.settings}toKebabCase(a){return a.toLowerCase().replace(/[<>:"/\\|?*]/g,"").replace(/['"]/g,"").replace(/[^\w\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}generateFilename(a,e=!1){let s=this.toKebabCase(a)||"untitled";return`${e?"_":""}${s}`}determineType(a){let e=a.path,s=this.getSettings().contentTypes||[],n=R(s);for(let i of n)if(i.enabled){if(!i.folder||i.folder.trim()===""){if(!e.includes("/")||e.split("/").length===1)return i.id}else if(M(e,i.folder))if(i.ignoreSubfolders){let r=e.split("/").length,l=i.folder.split("/").length;if(i.creationMode==="folder"){let p=r-1;if(p===l||p===l+1)return i.id}else if(r===l)return i.id}else return i.id}return"note"}getContentType(a){return(this.getSettings().contentTypes||[]).find(s=>s.id===a)||null}getTitleKey(a){if(a==="note")return"title";let e=this.getContentType(a);if(!e)return"title";let s=e.template.split(`
`),n=!1;for(let i of s){let o=i.trim();if(o==="---"){n=!n;continue}if(n){let r=o.match(/^(\w+):\s*(.+)$/);if(r){let c=r[1];if(r[2].includes("{{title}}"))return c}}}return"title"}async createFile(a){var p;let{file:e,title:t,type:s}=a;if(!t)return new y.Notice(`Title is required to create a ${s}.`),null;let n=this.getContentType(s);if(!n&&s!=="note")return new y.Notice(`Content type ${s} not found.`),null;let i=this.toKebabCase(t),r=(n==null?void 0:n.enableUnderscorePrefix)||!1?"_":"",c="";if(s==="note")c="";else if(n){let d=((p=e.parent)==null?void 0:p.path)||"";d===""||d==="/"?c=n.folder||"":c=d}return c&&(this.app.vault.getAbstractFileByPath(c)instanceof y.TFolder||await this.app.vault.createFolder(c)),((n==null?void 0:n.creationMode)||"file")==="folder"?this.createFolderStructure(e,i,r,c,s,n):this.createFileStructure(e,i,r,c)}async createFolderStructure(a,e,t,s,n,i){var h;let o=`${t}${e}`,r;if(s)r=`${s}/${o}`;else{let g=a.parent?a.parent.path:"";g&&g!=="/"?r=`${g}/${o}`:r=o}try{this.app.vault.getAbstractFileByPath(r)instanceof y.TFolder||await this.app.vault.createFolder(r)}catch(g){}let l=`${(i==null?void 0:i.indexFileName)||"index"}.md`,p=`${r}/${l}`;if(this.app.vault.getAbstractFileByPath(p)instanceof y.TFile)return new y.Notice(`File already exists at ${p}.`),null;this.plugin&&"pluginCreatedFiles"in this.plugin&&((h=this.plugin.pluginCreatedFiles)==null||h.add(p));try{await this.app.fileManager.renameFile(a,p);let g=this.app.vault.getAbstractFileByPath(p);return g instanceof y.TFile?(setTimeout(()=>{let f=this.app.workspace.getLeavesOfType("file-explorer")[0];if(f&&f.view){let w=f.view;if(w&&typeof w=="object"&&"tree"in w){let b=w.tree;b&&g instanceof y.TFile&&typeof b.revealFile=="function"&&b.revealFile(g)}}},200),await this.app.workspace.getLeaf(!1).openFile(g),g):null}catch(g){let m=g instanceof Error?g.message:String(g);return new y.Notice(`Failed to create folder structure: ${m}.`),null}}async createFileStructure(a,e,t,s){var r;let n=`${t}${e}.md`,i;if(s)i=`${s}/${n}`;else{let c=a.parent?a.parent.path:"";c&&c!=="/"?i=`${c}/${n}`:i=n}let o=this.app.vault.getAbstractFileByPath(i);if(o instanceof y.TFile&&o!==a)return new y.Notice(`File with name "${n}" already exists.`),null;this.plugin&&"pluginCreatedFiles"in this.plugin&&((r=this.plugin.pluginCreatedFiles)==null||r.add(i));try{await this.app.fileManager.renameFile(a,i);let c=this.app.vault.getAbstractFileByPath(i);return c instanceof y.TFile?(await this.app.workspace.getLeaf(!1).openFile(c),c):(new y.Notice("Failed to locate renamed file."),null)}catch(c){let l=c instanceof Error?c.message:String(c);return new y.Notice(`Failed to rename file: ${l}.`),null}}async renameFile(a){let{file:e,title:t,type:s}=a;if(!t)return new y.Notice("Title is required to rename the content."),null;let n=this.getContentType(s);if(!n&&s!=="note")return new y.Notice(`Content type ${s} not found.`),null;let i=this.toKebabCase(t),o="";return((n==null?void 0:n.creationMode)||"file")==="folder"?this.renameFolderStructure(e,i,o,s,n):this.renameFileStructure(e,i,o,n)}async renameFolderStructure(a,e,t,s,n){let i=(n==null?void 0:n.indexFileName)||"index";if(a.basename===i){if(!a.parent)return new y.Notice("Cannot rename: file has no parent folder."),null;t=a.parent.name.startsWith("_")?"_":"";let r=`${t}${e}`,c=a.parent.parent;if(!c)return new y.Notice("Cannot rename: parent folder has no parent."),null;let l;if(c.path===""||c.path==="/"?l=r:l=`${c.path}/${r}`,this.app.vault.getAbstractFileByPath(l)instanceof y.TFolder)return new y.Notice(`Folder already exists at ${l}.`),null;try{await this.app.fileManager.renameFile(a.parent,l)}catch(g){let m=g instanceof Error?g.message:String(g);return new y.Notice(`Failed to rename folder: ${m}.`),null}let d=`${l}/${a.name}`,h=this.app.vault.getAbstractFileByPath(d);return h instanceof y.TFile?h:(new y.Notice("Failed to locate renamed file."),null)}else{if(!a.parent)return new y.Notice("Cannot rename: file has no parent folder."),null;t=a.basename.startsWith("_")?"_":"";let r=`${t}${e}.md`,c=`${a.parent.path}/${r}`,l=this.app.vault.getAbstractFileByPath(c);if(l instanceof y.TFile&&l!==a)return new y.Notice(`File already exists at ${c}.`),null;await this.app.fileManager.renameFile(a,c);let p=this.app.vault.getAbstractFileByPath(c);return p instanceof y.TFile?p:(new y.Notice("Failed to locate renamed file."),null)}}async renameFileStructure(a,e,t,s){if(!a.parent)return new y.Notice("Cannot rename: file has no parent folder."),null;let n=(s==null?void 0:s.indexFileName)||"";if(n&&n.trim()!==""&&a.basename===n){t=a.parent.name.startsWith("_")?"_":"";let p=`${t}${e}`,d=a.parent.parent;if(!d)return new y.Notice("Cannot rename: parent folder has no parent."),null;let h;if(d.path===""||d.path==="/"?h=p:h=`${d.path}/${p}`,this.app.vault.getAbstractFileByPath(h)instanceof y.TFolder)return new y.Notice(`Folder already exists at ${h}.`),null;try{await this.app.fileManager.renameFile(a.parent,h)}catch(w){console.error("FileOperations: Folder rename failed:",w);let b=w instanceof Error?w.message:String(w);return new y.Notice(`Failed to rename folder: ${b}.`),null}let m=`${h}/${a.name}`,f=this.app.vault.getAbstractFileByPath(m);return f instanceof y.TFile?f:(new y.Notice("Failed to locate renamed file."),null)}t=a.basename.startsWith("_")?"_":"";let o=`${t}${e}.md`,r;a.parent.path===""||a.parent.path==="/"?r=o:r=`${a.parent.path}/${o}`;let c=this.app.vault.getAbstractFileByPath(r);if(c instanceof y.TFile&&c!==a)return new y.Notice(`File already exists at ${r}.`),null;try{await this.app.fileManager.renameFile(a,r)}catch(p){console.error("FileOperations: File rename failed:",p);let d=p instanceof Error?p.message:String(p);return new y.Notice(`Failed to rename file: ${d}.`),null}let l=this.app.vault.getAbstractFileByPath(r);return l instanceof y.TFile?l:(new y.Notice("Failed to locate renamed file."),null)}};var ae=require("obsidian");var $=class{constructor(a,e){this.app=a;this.settings=e}parseFrontmatter(a){let e=0,t="",s={};if(a.startsWith("---")){e=a.indexOf(`
---`,3),e===-1?e=a.length:e+=4,t=a.slice(4,e-4).trim();try{let i=null,o=new Set;t.split(`
`).forEach(r=>{let c=r.trim(),l=c.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(l){let[,p,d]=l;i=p;let h=D.includes(p),g=!d||d.trim()===""||d.trim()==="[]";h||g?(s[p]=[],o.add(p)):s[p]=[d?d.trim():""]}else if(i&&c.startsWith("- ")){if(o.has(i)){let d=c.replace(/^-\s*/,"");d&&s[i].push(d)}}else if(c&&!c.startsWith("- ")&&!c.startsWith("#")){let p=c.match(/^([^:]+):\s*(.*)$/);if(p){let[,d,h]=p;s[d]||(s[d]=[h?h.trim():""])}}}),D.forEach(r=>{t.includes(r+":")&&!s[r]&&(s[r]=[])})}catch(i){new ae.Notice("Falling back to template due to parsing error.")}}let n=a.slice(e);return{properties:s,propertiesText:t,propertiesEnd:e,bodyContent:n}}parseTemplate(a,e){let t=a.split(`
`),s=[],n={},i=!1;for(let o=0;o<t.length;o++){let r=t[o].trim();if(r==="---"){if(i=!i,!i)break;continue}if(i){let c=r.match(/^(\w+):\s*(.*)$/);if(c){let[,l,p]=c;s.push(l);let d=D.includes(l),h=!p||p.trim()===""||p.trim()==="[]";if(d||h)if(p&&p.startsWith("[")){let m=p.replace(/[[\]]/g,"").split(",").map(f=>f.trim()).filter(f=>f);n[l]=m}else{n[l]=[];for(let m=o+1;m<t.length;m++){let f=t[m].trim();if(f.startsWith("- ")){let w=f.replace(/^-\s*/,"").trim();if(w){let b=n[l];Array.isArray(b)&&b.push(w)}}else if(f==="---"||f&&!f.startsWith("- ")&&f.includes(":"))break}}else{let m=(p||"").replace(/\{\{title\}\}/g,e).replace(/\{\{date\}\}/g,window.moment(new Date).format(this.settings.dateFormat));n[l]=m}}}}return{templateProps:s,templateValues:n}}buildFrontmatterContent(a,e){let t=`---
`;for(let s in a)D.includes(s)||e&&e.has(s)?(t+=`${s}:
`,a[s].length>0&&a[s].forEach(i=>{t+=`  - ${i}
`})):t+=`${s}: ${a[s][0]||""}
`;return t+="---",t}async updateTitleInFrontmatter(a,e,t){let s=this.getTitleKey(t);if(!this.templateHasTitle(t))return;let i=await this.app.vault.read(a),o=0,r="",c=!1;i.startsWith("---")&&(c=!0,o=i.indexOf(`
---`,3),o===-1?o=i.length:o+=4,r=i.slice(4,o-4).trim());let l=[],p={},d=null,h=-1,g=new Set;r.split(`
`).forEach((b,P)=>{let I=b.trim(),N=I.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(N){let[,x,E]=N;l.push(x),d=x,x===s&&(h=P);let H=D.includes(x),G=!E||E.trim()===""||E.trim()==="[]";H||G?(p[x]=[],g.add(x)):p[x]=E?E.trim():""}else if(d&&g.has(d)&&I.startsWith("- ")){let x=I.replace(/^-\s*/,"");x&&p[d].push(x)}else if(I&&!I.startsWith("- ")&&!I.startsWith("#")){let x=I.match(/^([^:]+):\s*(.*)$/);if(x){let[,E,H]=x;l.includes(E)||(l.push(E),p[E]=H?H.trim():"")}}});let m;if(e.includes('"')||e.includes("'")||e.includes(`
`)||e.includes("\\")?m=`'${e.replace(/'/g,"''")}'`:e.includes(" ")||e.includes(":")||e.includes("#")||e.includes("@")?m=`"${e.replace(/"/g,'\\"')}"`:m=e,p[s]=m,h===-1&&l.push(s),!c)return;let f=`---
`;for(let b of l){let P=p[b];Array.isArray(P)?(f+=`${b}:
`,P.length>0&&P.forEach(I=>{f+=`  - ${I}
`})):f+=`${b}: ${P||""}
`}f+=`---
`;let w=i.slice(o);f+=w,await this.app.vault.modify(a,f)}getTitleKey(a){if(a==="note")return"title";let t=(this.settings.contentTypes||[]).find(o=>o.id===a);if(!t)return"title";let n=t.template.split(`
`),i=!1;for(let o of n){let r=o.trim();if(r==="---"){i=!i;continue}if(i){let c=r.match(/^(\w+):\s*(.+)$/);if(c){let l=c[1];if(c[2].includes("{{title}}"))return l}}}return"title"}templateHasTitle(a){if(a==="note")return!0;let t=(this.settings.contentTypes||[]).find(n=>n.id===a);return t?t.template.includes("{{title}}"):!0}};var L=require("obsidian");var W=class{constructor(a,e){this.settings=a;this.plugin=e}getSettings(){var a;return(a=this.plugin)!=null&&a.settings?this.plugin.settings:this.settings}toKebabCase(a){return a.toLowerCase().replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}getAstroUrlFromInternalLink(a){let e=a.indexOf("#"),t=e>=0?a.slice(0,e):a,s=e>=0?a.slice(e):"";t=decodeURIComponent(t),t=t.replace(/\.md$/,"");let n=this.getContentTypeForPath(t+".md"),i=n.basePath||"",o=n.contentFolder||"",r=n.indexFileName||"";o&&(t=t.slice(o.length+1));let c=!1,l=t.split("/"),p=l[l.length-1];(r&&r.trim()!==""&&p===r||(!r||r.trim()==="")&&p==="index")&&(l.pop(),t=l.join("/"),c=!0);let h=t.split("/").map(f=>this.toKebabCase(f)).join("/");i?(i.startsWith("/")||(i="/"+i),i.endsWith("/")||(i+="/")):i="/";let m=(this.getSettings().addTrailingSlashToLinks||c)&&!s;return`${i}${h}${m?"/":""}${s}`}getAstroUrlFromInternalLinkWithContext(a,e,t){let s=a.indexOf("#"),n=s>=0?a.slice(0,s):a,i=s>=0?a.slice(s):"";n=decodeURIComponent(n),n=n.replace(/\.md$/,"");let o="",r="",c="",l=this.getContentTypeForPath(n+".md");!l.basePath&&t.basePath?(o=t.basePath,c=t.indexFileName,r=t.contentFolder):(o=l.basePath,c=l.indexFileName,r=l.contentFolder),r&&(n=n.slice(r.length+1));let p=!1,d=n.split("/"),h=d[d.length-1];(c&&c.trim()!==""&&h===c||(!c||c.trim()==="")&&h==="index")&&(d.pop(),n=d.join("/"),p=!0);let m=n.split("/").map(b=>this.toKebabCase(b)).join("/");o?(o.startsWith("/")||(o="/"+o),o.endsWith("/")||(o+="/")):o="/";let w=(this.getSettings().addTrailingSlashToLinks||p)&&!i;return`${o}${m}${w?"/":""}${i}`}isInConfiguredContentDirectory(a){let t=this.getSettings().contentTypes||[],s=R(t);for(let n of s)if(n.enabled){if(!n.folder||n.folder.trim()===""){if(!a.includes("/")||a.split("/").length===1)return!0}else if(M(a,n.folder))if(n.ignoreSubfolders){let o=a.split("/").length,c=n.folder.split("/").length;if(n.creationMode==="folder"){let l=o-1;if(l===c||l===c+1)return!0}else if(o===c)return!0}else return!0}return!1}getContentTypeForPath(a){let t=this.getSettings().contentTypes||[],s=R(t);for(let n of s)if(n.enabled){if(!n.folder||n.folder.trim()===""){if(!a.includes("/")||a.split("/").length===1)return{basePath:n.linkBasePath||"",creationMode:n.creationMode,indexFileName:n.indexFileName||"",contentFolder:""}}else if(M(a,n.folder))if(n.ignoreSubfolders){let o=a.split("/").length,c=n.folder.split("/").length;if(n.creationMode==="folder"){let l=o-1;if(l===c||l===c+1)return{basePath:n.linkBasePath||"",creationMode:n.creationMode,indexFileName:n.indexFileName||"",contentFolder:n.folder}}else if(o===c)return{basePath:n.linkBasePath||"",creationMode:n.creationMode,indexFileName:n.indexFileName||"",contentFolder:n.folder}}else return{basePath:n.linkBasePath||"",creationMode:n.creationMode,indexFileName:n.indexFileName||"",contentFolder:n.folder}}return{basePath:"",creationMode:"file",indexFileName:"",contentFolder:""}}convertWikilinksForAstro(a,e){if(!(e instanceof L.TFile)){new L.Notice("No active file.");return}let s=a.getValue(),n=0,i=0,o=[],r=this.getContentTypeForPath(e.path),c=/\.(png|jpg|jpeg|gif|svg)$/i,l=p=>{if(c.test(p)||p.match(/^https?:\/\//)||!p.includes(".md")&&!p.match(/^[a-zA-Z0-9_-]+(\/[a-zA-Z0-9_-]+)*$/))return!1;let d=p.endsWith(".md")?p:p+".md",h=this.isInConfiguredContentDirectory(d),g=!d.includes("/"),m=r.basePath!==""||r.creationMode!=="file"||r.indexFileName!=="";return h||g&&m};s=s.replace(/\[\[([^\]|]+)(\|([^\]]+))?\]\]/g,(p,d,h,g)=>{if(c.test(d)||!l(d))return i++,o.push(d),p;let m=g||d.replace(/\.md$/,""),f=this.getAstroUrlFromInternalLinkWithContext(d,e.path,r);return n++,`[${m}](${f})`}),s=s.replace(/\[([^\]]+)\]\(([^)]+\.md[^)]*)\)/g,(p,d,h)=>{if(h.match(/^https?:\/\//)||c.test(h)||!l(h))return i++,o.push(h),p;let g=this.getAstroUrlFromInternalLinkWithContext(h,e.path,r);return n++,`[${d}](${g})`}),s=s.replace(/!\[(.*?)\]\(([^)]+)\)/g,p=>(i++,p)),s=s.replace(/\{\{([^}]+)\}\}/g,(p,d)=>{if(c.test(d)||!l(d))return i++,o.push(d),p;let h=this.getAstroUrlFromInternalLinkWithContext(d,e.path,r);return n++,`[Embedded: ${d}](${h})`}),a.setValue(s),n>0&&i===0?new L.Notice(`Converted ${n} internal link${n>1?"s":""} for Astro.`):n>0&&i>0?new L.Notice(`Converted ${n} link${n>1?"s":""} for Astro. Skipped ${i} link${i>1?"s":""} outside configured content directories.`):i>0?new L.Notice(`No links converted. All ${i} link${i>1?"s":""} are outside configured content directories or are images/external links.`):new L.Notice("No internal links found to convert.")}};var B=require("obsidian");var O=class extends B.Modal{constructor(e,t,s,n,i=!1,o=!1){super(e);this.file=t,this.plugin=s,this.type=n,this.isRename=i,this.isNewNote=o;let r=s.settings;this.fileOps=new k(e,r,s),this.templateParser=new $(e,r)}getCurrentTitle(){if(!this.file)return"";let e=this.fileOps.getTitleKey(this.type),t=this.app.metadataCache.getFileCache(this.file),s=this.file.basename;if(this.file.parent&&this.type!=="note"){let i=this.fileOps.getContentType(this.type),o=(i==null?void 0:i.indexFileName)||"";o.trim()!==""&&s===o&&(s=this.file.parent.name)}s.startsWith("_")&&(s=s.slice(1));let n=s.replace(/-/g," ").split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ");return t!=null&&t.frontmatter&&t.frontmatter[e]?t.frontmatter[e]:n}getSuggestedTitleFromBasename(){if(!this.file)return"";let e=this.file.basename;if(this.file.parent&&this.type!=="note"){let t=this.fileOps.getContentType(this.type),s=(t==null?void 0:t.indexFileName)||"";s.trim()!==""&&e===s&&(e=this.file.parent.name)}return e.startsWith("_")&&(e=e.slice(1)),e}onOpen(){let{contentEl:e}=this;if(e.empty(),(window.innerWidth<=768||B.Platform.isMobile)&&this.modalEl.addClass("astro-composer-mobile-modal"),this.isRename){let o=this.getTypeDisplayName();this.type==="note"?(e.createEl("h2",{text:"Rename content"}),e.createEl("p",{text:"Enter a title for this content:"})):(e.createEl("h2",{text:`Rename ${o} content`}),e.createEl("p",{text:`Enter new title for your ${o} content:`})),this.titleInput=e.createEl("input",{type:"text",placeholder:"New Title",cls:"astro-composer-title-input"}),this.titleInput.value=this.getCurrentTitle()}else if(this.isNewNote){let o=this.getTypeDisplayName();this.type==="note"?(e.createEl("h2",{text:"New content"}),e.createEl("p",{text:"Enter a title for this content:"})):(e.createEl("h2",{text:`Create new ${o} content`}),e.createEl("p",{text:`Enter a title for your new ${o} content:`})),this.titleInput=e.createEl("input",{type:"text",placeholder:"New Title",cls:"astro-composer-title-input"})}else{let o=this.getTypeDisplayName();if(this.type==="note"?(e.createEl("h2",{text:"New content"}),e.createEl("p",{text:"Enter a title for this content:"})):(e.createEl("h2",{text:`Create new ${o} content`}),e.createEl("p",{text:`Enter a title for your new ${o} content:`})),this.titleInput=e.createEl("input",{type:"text",placeholder:"New Title",cls:"astro-composer-title-input"}),this.file){let r=this.getSuggestedTitleFromBasename();r&&(this.titleInput.value=r)}}this.titleInput.focus(),this.isNewNote&&setTimeout(()=>{this.titleInput.setSelectionRange(0,0)},0);let s=e.createDiv({cls:"astro-composer-button-container"}),n=s.createEl("button",{text:"Cancel",cls:"astro-composer-cancel-button"});n.onclick=()=>this.close();let i=s.createEl("button",{text:this.isRename?"Rename":"Create",cls:["astro-composer-create-button","mod-cta"]});i.onclick=()=>this.submit(),this.titleInput.addEventListener("keypress",o=>{o.key==="Enter"&&this.submit()})}async submit(){let e=this.titleInput.value.trim();if(!e){new B.Notice("Please enter a title.");return}try{let t=null;if(this.isRename)if(t=await this.fileOps.renameFile({file:this.file,title:e,type:this.type}),t)await this.templateParser.updateTitleInFrontmatter(t,e,this.type);else{this.close();return}else if(this.isNewNote){if(this.file){t=await this.fileOps.createFile({file:this.file,title:e,type:this.type});let s=this.plugin.settings.autoInsertProperties;t&&s&&await this.addPropertiesToFile(t,e,this.type)}}else if(this.file){t=await this.fileOps.createFile({file:this.file,title:e,type:this.type});let s=this.plugin.settings.autoInsertProperties;t&&s&&await this.addPropertiesToFile(t,e,this.type)}else t=await this.createNewFile(e);if(!t){new B.Notice(`Failed to ${this.isRename?"rename":"create"} ${this.type}.`),this.close();return}}catch(t){console.error("TitleModal: Error during process:",t);let s=t instanceof Error?t.message:String(t);new B.Notice(`Error ${this.isRename?"renaming":"creating"} ${this.type}: ${s}.`),this.close();return}this.close()}getTypeDisplayName(){if(this.type==="note")return"Content";let e=this.fileOps.getContentType(this.type);return e?e.name:"Content"}async createNewFile(e){var r,c,l;let t,s=((c=(r=this.file)==null?void 0:r.parent)==null?void 0:c.path)||"";if(this.type!=="note"){let p=this.fileOps.getContentType(this.type);s===""||s==="/"?t=(p==null?void 0:p.folder)||"":t=s}else t=s;let n=this.fileOps.generateFilename(e),i=t?`${t}/${n}.md`:`${n}.md`;this.plugin&&"pluginCreatedFiles"in this.plugin&&((l=this.plugin.pluginCreatedFiles)==null||l.add(i));let o="";this.plugin.settings.autoInsertProperties&&(o=this.generateInitialContent(e));try{let p=await this.app.vault.create(i,o);return await this.app.workspace.getLeaf().openFile(p),p}catch(p){let d=p instanceof Error?p.message:String(p);throw new Error(`Failed to create file: ${d}`)}}generateInitialContent(e){let t=new Date,s=window.moment(t).format(this.plugin.settings.dateFormat),n;if(this.type==="note")n=`---
title: ${this.escapeYamlString(e)}
date: ${s}
---
`;else{let i=this.fileOps.getContentType(this.type);i?n=i.template:n=`---
title: ${this.escapeYamlString(e)}
date: ${s}
---
`}return n=n.replace(/\{\{title\}\}/g,e),n=n.replace(/\{\{date\}\}/g,s),n}async addPropertiesToFile(e,t,s){let n=new Date,i=window.moment(n).format(this.plugin.settings.dateFormat),o;if(s==="note")o=`---
title: ${this.escapeYamlString(t)}
date: ${i}
---
`;else{let r=this.fileOps.getContentType(s);r?o=r.template:o=`---
title: ${this.escapeYamlString(t)}
date: ${i}
---
`}o=o.replace(/\{\{title\}\}/g,t),o=o.replace(/\{\{date\}\}/g,i),await this.app.vault.modify(e,o)}escapeYamlString(e){return e.includes('"')||e.includes("'")||e.includes(`
`)||e.includes("\\")?`'${e.replace(/'/g,"''")}'`:e.includes(" ")||e.includes(":")||e.includes("#")||e.includes("@")?`"${e.replace(/"/g,'\\"')}"`:e}onClose(){let{contentEl:e}=this;e.empty()}};function le(u,a){let e=C.Platform.isMobile;if(e){let l=function(d,h){let g=r.determineType(d);if(g==="note")return!1;let m=r.getContentType(g);return m!==null&&m.enabled};var i=l;let o=u,r=new k(u.app,a,o),c=new W(a,o);u.addCommand({id:"standardize-properties",name:"Standardize properties",icon:"file-check",editorCallback:(d,h)=>{let g=(h instanceof C.MarkdownView,h.file);if(g instanceof C.TFile){let m=o.settings||a;re(u.app,m,g,o)}}}),u.addCommand({id:"convert-wikilinks-astro",name:"Convert internal links for Astro",icon:"link-2",editorCallback:(d,h)=>{let g=(h instanceof C.MarkdownView,h.file);g instanceof C.TFile&&c.convertWikilinksForAstro(d,g)}}),u.addCommand({id:"rename-content",name:"Rename current content",icon:"pencil",editorCallback:(d,h)=>{let g=(h instanceof C.MarkdownView,h.file);if(g instanceof C.TFile){if(!l(g,a)){new C.Notice("Cannot rename: this file is not part of a configured content type folder.");return}let m=r.determineType(g),f=u.app.metadataCache.getFileCache(g),w=r.getTitleKey(m);if(!(f!=null&&f.frontmatter)||!(w in f.frontmatter)){new C.Notice(`Cannot rename: No ${w} found in properties`);return}new O(u.app,g,u,m,!0).open()}}});return}let t=u,s=new k(u.app,a,t),n=new W(a,t);function i(o,r){let c=(u==null?void 0:u.settings)||r,l=new k(u.app,c,u),p=l.determineType(o);if(p==="note")return!1;let d=l.getContentType(p);return d!==null&&d.enabled}u.addCommand({id:"standardize-properties",name:"Standardize properties",icon:"file-check",editorCallback:(o,r)=>{let c=(r instanceof C.MarkdownView,r.file);c instanceof C.TFile&&re(u.app,a,c,u)}}),u.addCommand({id:"convert-wikilinks-astro",name:"Convert internal links for Astro",icon:"link-2",editorCallback:(o,r)=>{let c=(r instanceof C.MarkdownView,r.file);if(c instanceof C.TFile){let l=t.settings||a;new W(l,t).convertWikilinksForAstro(o,c)}}}),u.addCommand({id:"rename-content",name:"Rename current content",icon:"pencil",editorCallback:(o,r)=>{let c=(r instanceof C.MarkdownView,r.file);if(c instanceof C.TFile){let l=t.settings||a,p=new k(u.app,l,t);if(!i(c,l)){new C.Notice("Cannot rename: this file is not part of a configured content type folder.");return}let d=p.determineType(c);new O(u.app,c,t,d,!0).open()}}}),e||u.addCommand({id:"open-project-terminal",name:"Open project terminal",icon:"terminal-square",callback:async()=>{let o=u.settings;if(!o.enableOpenTerminalCommand){new C.Notice("Open terminal command is disabled. Enable it in settings to use this command.");return}await Q(u.app,o)}}),e||u.addCommand({id:"edit-astro-config",name:"Edit Astro config",icon:"wrench",callback:async()=>{let o=u.settings;if(!o.enableOpenConfigFileCommand){new C.Notice("Edit config file command is disabled. Enable it in settings to use this command.");return}await ee(u.app,o)}})}async function re(u,a,e,t){let s=(t==null?void 0:t.settings)||a,n=new $(u,s),i=new k(u,s,t),o=i.determineType(e);if(o==="note"){new C.Notice("No properties template specified for this content. This file doesn't match any configured content type folders.");return}let r;if(o==="note"){new C.Notice("No properties template specified for this content. This file doesn't match any configured content type folders.");return}let c=i.getContentType(o);if(!c){new C.Notice("Content type not found.");return}r=c.template,await new Promise(b=>setTimeout(b,100));let l=await u.vault.read(e),p=e.basename.replace(/^_/,""),d=n.parseFrontmatter(l),{templateProps:h,templateValues:g}=n.parseTemplate(r,p),m={...d.properties},f=new Set;for(let b of h)if(b in d.properties){let P=g[b];if(Array.isArray(P)){let N=d.properties[b]||[],x=P.filter(E=>!N.includes(E));m[b]=[...N,...x],f.add(b)}}else{let P=g[b];Array.isArray(P)?(m[b]=P,f.add(b)):m[b]=[P||""]}for(let b in d.properties)d.properties[b].length>1&&f.add(b);let w=n.buildFrontmatterContent(m,f)+d.bodyContent;await u.vault.modify(e,w),new C.Notice("Properties standardized using template.")}async function ce(u,a,e,t){let s=u.vault.getAbstractFileByPath(a);if(!(s instanceof C.TFile)){new C.Notice(`File not found: ${a}`);return}let n=new k(u,e,t);function i(r,c){let l=n.determineType(r);if(l==="note")return!1;let p=n.getContentType(l);return p!==null&&p.enabled}if(!i(s,e)){new C.Notice("Cannot rename: this file is not part of a configured content type folder.");return}let o=n.determineType(s);new O(u,s,t,o,!0).open()}async function Q(u,a){try{let{exec:e}=require("child_process"),t=require("path"),s=require("fs"),n=u.vault.adapter.basePath||u.vault.adapter.path,i=typeof n=="string"?n:n.toString(),o;if(a.terminalProjectRootPath&&a.terminalProjectRootPath.trim()?o=t.resolve(i,a.terminalProjectRootPath):o=i,!s.existsSync(o)){new C.Notice(`Project root directory not found at: ${o}`);return}let r=process.platform,c;if(r==="win32"){e("where wt",l=>{l?e(`cmd /k cd /d "${o}"`,p=>{p&&new C.Notice(`Error opening terminal: ${p.message}`)}):e(`wt -d "${o}"`,p=>{p&&e(`cmd /k cd /d "${o}"`,d=>{d&&new C.Notice(`Error opening terminal: ${d.message}`)})})});return}else if(r==="darwin")c=`osascript -e 'tell application "Terminal" to do script "cd \\"${o}\\" && bash"'`;else{let l=[`gnome-terminal --working-directory="${o}"`,`konsole --workdir "${o}"`,`xterm -e "cd \\"${o}\\" && bash"`],p=d=>{if(d>=l.length){new C.Notice("No supported terminal found. Please install gnome-terminal, konsole, or xterm.");return}e(`which ${l[d].split(" ")[0]}`,h=>{h?p(d+1):e(l[d],g=>{g&&d<l.length-1?p(d+1):g&&new C.Notice(`Error opening terminal: ${g.message}`)})})};p(0);return}c&&e(c,l=>{l&&new C.Notice(`Error opening terminal: ${l.message}`)})}catch(e){new C.Notice(`Error opening terminal: ${e instanceof Error?e.message:String(e)}`)}}async function ee(u,a){try{let e=require("fs"),t=require("path"),{shell:s}=require("electron"),n=u.vault.adapter.basePath||u.vault.adapter.path,i=typeof n=="string"?n:n.toString();if(!a.configFilePath||!a.configFilePath.trim()){new C.Notice("Please specify a config file path in settings.");return}let o=t.resolve(i,a.configFilePath);if(!e.existsSync(o)){new C.Notice(`Config file not found at: ${o}`);return}await s.openPath(o)}catch(e){new C.Notice(`Error opening config file: ${e instanceof Error?e.message:String(e)}`)}}var T=require("obsidian");var pe=require("obsidian"),j=class extends pe.FuzzySuggestModal{constructor(e,t){super(e);this.onSelect=t}getItems(){let e=this.app.commands,t=new Map;if(e&&typeof e.listCommands=="function")try{let n=e.listCommands();for(let i of n)i&&i.id&&i.name&&!t.has(i.id)&&t.set(i.id,{id:i.id,name:i.name})}catch(n){console.warn("[Astro Composer] Error getting commands via listCommands():",n)}try{let n=e==null?void 0:e.commands;if(n&&typeof n=="object"){let i=Object.values(n);for(let o of i)o&&o.id&&o.name&&!t.has(o.id)&&t.set(o.id,{id:o.id,name:o.name})}}catch(n){console.warn("[Astro Composer] Error getting commands via registry:",n)}try{let n=e==null?void 0:e.commandRegistry;if(n&&typeof n=="object"){let i=Object.values(n);for(let o of i)o&&o.id&&o.name&&!t.has(o.id)&&t.set(o.id,{id:o.id,name:o.name})}}catch(n){console.warn("[Astro Composer] Error getting commands via internal registry:",n)}let s=Array.from(t.values());return s.sort((n,i)=>n.name.localeCompare(i.name)),s}getItemText(e){return e.name}onChooseItem(e,t){this.onSelect(e.id)}renderSuggestion(e,t){let s=e.item;t.createDiv({cls:"suggestion-title",text:s.name})}};var A=require("obsidian"),ve=()=>{if(A.requireApiVersion&&(0,A.requireApiVersion)("1.7.3")&&A.getIconIds)try{return(0,A.getIconIds)()}catch(u){console.warn("[Astro Composer] Error getting icon IDs from Obsidian:",u)}return["settings-2","settings","help-circle","info","star","heart","bookmark","home","search","bell","mail","user","users","folder","file","file-text","image","video","music","calendar","clock","edit","pencil","trash","copy","cut","paste","download","upload","save","share","link","external-link","lock","unlock","eye","eye-off","key","shield","check","x","plus","minus","arrow-left","arrow-right","arrow-up","arrow-down","chevron-left","chevron-right","chevron-up","chevron-down","menu","more-horizontal","more-vertical","grid","list","layout","columns","rows","maximize","minimize","zoom-in","zoom-out","refresh-cw","play","pause","stop","sun","moon","cloud","zap","wand-2","wand","wand-sparkles","palette","brush","sliders","power","wifi","bluetooth","monitor","laptop","smartphone","camera","mic","headphones","code","terminal","terminal-square","github","gitlab","git-branch","git-commit","database","server","cloud-download","cloud-upload","tag","tags","flag","pin","map-pin","compass","globe","rocket","car","bike","robot","apple","windows","linux","chrome","firefox","safari","credit-card","wallet","coins","book","book-open","award","trophy","badge","wrench","tool","package","box","archive","send","reply","forward","mail-open","tag-plus","tag-minus","flag-off","pin-off","map-pin-off","navigation","map","earth","plane","ship","anchor","helicopter","drone","android","keyhole","keys","fingerprint","scan","qr-code","barcode","receipt","piggy-bank","banknote"]},Fe=ve().map(u=>({id:u,name:u.replace(/^lucide-/,"").replace(/-/g," ").replace(/(^\w{1})|(\s+\w{1})/g,a=>a.toUpperCase())})).sort((u,a)=>u.name.localeCompare(a.name)),U=class extends A.FuzzySuggestModal{constructor(e,t){super(e);this.onSelect=t}getItems(){return Fe}getItemText(e){return e.name}onChooseItem(e,t){this.onSelect(e.id)}renderSuggestion(e,t){let s=e.item;t.addClass("mod-complex"),t.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title",text:s.name});let i=t.createDiv({cls:"suggestion-aux"});(0,A.setIcon)(i.createSpan({cls:"suggestion-flair"}),s.id)}};var de=require("obsidian"),q=class extends de.Modal{constructor(e,t,s="Confirm",n="Cancel"){super(e);this.message=t;this.confirmText=s;this.cancelText=n;this.result=!1;this.resolvePromise=null}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("astro-composer-confirm-modal"),e.createEl("p",{text:this.message});let t=e.createDiv({cls:"modal-button-container"}),s=t.createEl("button",{text:this.cancelText});s.onclick=()=>{this.result=!1,this.close()};let n=t.createEl("button",{text:this.confirmText,cls:"mod-cta mod-warning"});n.onclick=()=>{this.result=!0,this.close()}}onClose(){let{contentEl:e}=this;e.empty(),this.resolvePromise&&this.resolvePromise(this.result)}async waitForResult(){return new Promise(e=>{this.resolvePromise=e,this.open()})}};var K=class extends T.PluginSettingTab{constructor(e,t){super(e,t);this.autoRenameContainer=null;this.postsFolderContainer=null;this.onlyAutomateContainer=null;this.creationModeContainer=null;this.indexFileContainer=null;this.excludedDirsContainer=null;this.underscorePrefixContainer=null;this.autoInsertContainer=null;this.pagesFieldsContainer=null;this.pagesIndexFileContainer=null;this.pagesOnlyAutomateContainer=null;this.copyHeadingContainer=null;this.terminalCommandContainer=null;this.configCommandContainer=null;this.customContentTypesContainer=null;this.terminalRibbonToggle=null;this.configRibbonToggle=null;this.terminalRibbonToggleComponent=null;this.configRibbonToggleComponent=null;this.plugin=t}refreshContentTypes(){this.customContentTypesContainer&&this.renderCustomContentTypes()}display(){let{containerEl:e}=this;e.empty();let t=this.plugin.settings;this.renderSettingsTab(e,t)}renderSettingsTab(e,t){var s;if(new T.Setting(e).setName("Date format").setDesc("Format for the date in properties (e.g., YYYY-MM-DD, MMMM D, YYYY, YYYY-MM-DD HH:mm).").addText(n=>n.setPlaceholder("YYYY-MM-DD").setValue(t.dateFormat).onChange(async i=>{t.dateFormat=i||"YYYY-MM-DD",await this.plugin.saveSettings()})),new T.Setting(e).setName("Enable copy heading links").setDesc("Add right-click context menu option to copy heading links in various formats.").addToggle(n=>n.setValue(t.enableCopyHeadingLink).onChange(async i=>{t.enableCopyHeadingLink=i,await this.plugin.saveSettings(),this.updateCopyHeadingFields()})),this.copyHeadingContainer=e.createDiv({cls:"copy-heading-fields"}),this.copyHeadingContainer.classList.toggle("astro-composer-setting-container-visible",t.enableCopyHeadingLink),this.copyHeadingContainer.classList.toggle("astro-composer-setting-container-hidden",!t.enableCopyHeadingLink),new T.Setting(this.copyHeadingContainer).setName("Default heading link format").setDesc("Choose the default format for copied heading links. Obsidian format respects your Obsidian settings for wikilink vs markdown preference. Astro link uses your Link base path from above and converts the heading into kebab-case format as an anchor link.").addDropdown(n=>n.addOption("obsidian","Obsidian link").addOption("astro","Astro link").setValue(t.copyHeadingLinkFormat).onChange(async i=>{t.copyHeadingLinkFormat=i,await this.plugin.saveSettings()})),new T.Setting(e).setName("Add trailing slash to links").setDesc("Add trailing slashes to all converted internal links (e.g., /about/ instead of /about).").addToggle(n=>n.setValue(t.addTrailingSlashToLinks).onChange(async i=>{t.addTrailingSlashToLinks=i,await this.plugin.saveSettings()})),new T.Setting(e).setName("Auto-insert properties").setDesc("Automatically insert the properties template when creating new files for any content type.").addToggle(n=>n.setValue(t.autoInsertProperties).onChange(async i=>{t.autoInsertProperties=i,await this.plugin.saveSettings()})),new T.Setting(e).setName("Content types").setDesc("").setHeading(),this.customContentTypesContainer=e.createDiv({cls:"custom-content-types-container"}),this.renderCustomContentTypes(),!T.Platform.isMobile){new T.Setting(e).setName("Developer commands").setDesc("").setHeading(),new T.Setting(e).setName("Enable open terminal command").setDesc("Enable command to open terminal in project root directory.").addToggle(c=>c.setValue(t.enableOpenTerminalCommand).onChange(async l=>{t.enableOpenTerminalCommand=l,await this.plugin.saveSettings(),this.updateTerminalCommandFields(),this.plugin.registerRibbonIcons&&this.plugin.registerRibbonIcons()})),this.terminalCommandContainer=e.createDiv({cls:"terminal-command-fields"}),this.terminalCommandContainer.classList.toggle("astro-composer-setting-container-visible",t.enableOpenTerminalCommand),this.terminalCommandContainer.classList.toggle("astro-composer-setting-container-hidden",!t.enableOpenTerminalCommand);let n=new T.Setting(this.terminalCommandContainer).setName("Project root directory path").setDesc("Path relative to the Obsidian vault root folder. Use ../.. for two levels up. Leave blank to use the vault folder. This is where the terminal will open. Absolute paths work also.").addText(c=>c.setPlaceholder("../..").setValue(t.terminalProjectRootPath).onChange(async l=>{t.terminalProjectRootPath=l,await this.plugin.saveSettings()})),i=new T.Setting(this.terminalCommandContainer).setName("Show open terminal ribbon icon").setDesc("Add a ribbon icon to launch the terminal command.").addToggle(c=>{this.terminalRibbonToggleComponent=c,c.setValue(t.enableTerminalRibbonIcon).setDisabled(!t.enableOpenTerminalCommand).onChange(async l=>{this.plugin.settings.enableTerminalRibbonIcon=l,t.enableTerminalRibbonIcon=l,await this.plugin.saveSettings(),setTimeout(()=>{this.plugin.registerRibbonIcons&&this.plugin.registerRibbonIcons()},50)})});this.terminalRibbonToggle=i,new T.Setting(e).setName("Enable edit config file command").setDesc("Enable command to open Astro config file in default editor.").addToggle(c=>c.setValue(t.enableOpenConfigFileCommand).onChange(async l=>{t.enableOpenConfigFileCommand=l,await this.plugin.saveSettings(),this.updateConfigCommandFields(),this.plugin.registerRibbonIcons&&this.plugin.registerRibbonIcons()})),this.configCommandContainer=e.createDiv({cls:"config-command-fields"}),this.configCommandContainer.classList.toggle("astro-composer-setting-container-visible",t.enableOpenConfigFileCommand),this.configCommandContainer.classList.toggle("astro-composer-setting-container-hidden",!t.enableOpenConfigFileCommand);let o=new T.Setting(this.configCommandContainer).setName("Config file path").setDesc("Path to the config file relative to the vault root. Use ../config.ts or ../../astro.config.mjs. This setting is required. Absolute paths work also.").addText(c=>c.setPlaceholder("../config.ts").setValue(t.configFilePath).onChange(async l=>{t.configFilePath=l,await this.plugin.saveSettings()})),r=new T.Setting(this.configCommandContainer).setName("Show open config ribbon icon").setDesc("Add a ribbon icon to launch the config file command.").addToggle(c=>{this.configRibbonToggleComponent=c,c.setValue(t.enableConfigRibbonIcon).setDisabled(!t.enableOpenConfigFileCommand).onChange(async l=>{this.plugin.settings.enableConfigRibbonIcon=l,t.enableConfigRibbonIcon=l,await this.plugin.saveSettings(),setTimeout(()=>{this.plugin.registerRibbonIcons&&this.plugin.registerRibbonIcons()},50)})});this.configRibbonToggle=r}if(!T.Platform.isMobile){let n=new T.Setting(e).setName("Swap out help button for custom action").setDesc("Replace the help button in the vault profile area with a custom action.").addToggle(i=>{var o,r;return i.setValue((r=(o=t.helpButtonReplacement)==null?void 0:o.enabled)!=null?r:!1).onChange(async c=>{t.helpButtonReplacement||(t.helpButtonReplacement={enabled:!1,commandId:"edit-astro-config",iconId:"wrench"}),t.helpButtonReplacement.enabled=c,await this.plugin.saveSettings(),this.plugin.updateHelpButton&&await this.plugin.updateHelpButton(),this.display()})});if((s=t.helpButtonReplacement)!=null&&s.enabled){let i=this.getCommandName(t.helpButtonReplacement.commandId);new T.Setting(e).setName("Command").setDesc("Select the command to execute when the button is clicked.").addButton(r=>r.setButtonText(i||"Select command").onClick(()=>{new j(this.app,async l=>{t.helpButtonReplacement||(t.helpButtonReplacement={enabled:!0,commandId:"edit-astro-config",iconId:"wrench"}),t.helpButtonReplacement.commandId=l,await this.plugin.saveSettings(),this.plugin.updateHelpButton&&await this.plugin.updateHelpButton(),this.display()}).open()}));let o=this.getIconName(t.helpButtonReplacement.iconId);new T.Setting(e).setName("Icon").setDesc("Select the icon to display on the button.").addButton(r=>r.setButtonText(o||"Select icon...").onClick(()=>{new U(this.app,async l=>{t.helpButtonReplacement||(t.helpButtonReplacement={enabled:!0,commandId:"edit-astro-config",iconId:"wrench"}),t.helpButtonReplacement.iconId=l,await this.plugin.saveSettings(),this.plugin.updateHelpButton&&await this.plugin.updateHelpButton(),this.display()}).open()}))}}this.updateCopyHeadingFields(),T.Platform.isMobile||(this.updateTerminalCommandFields(),this.updateConfigCommandFields())}updateCopyHeadingFields(){if(this.copyHeadingContainer){let e=this.plugin.settings;this.copyHeadingContainer.classList.toggle("astro-composer-setting-container-visible",e.enableCopyHeadingLink),this.copyHeadingContainer.classList.toggle("astro-composer-setting-container-hidden",!e.enableCopyHeadingLink)}}updateTerminalCommandFields(){if(this.terminalCommandContainer){let e=this.plugin.settings;this.terminalCommandContainer.classList.toggle("astro-composer-setting-container-visible",e.enableOpenTerminalCommand),this.terminalCommandContainer.classList.toggle("astro-composer-setting-container-hidden",!e.enableOpenTerminalCommand)}this.terminalRibbonToggleComponent&&this.terminalRibbonToggleComponent.setDisabled(!this.plugin.settings.enableOpenTerminalCommand)}updateConfigCommandFields(){if(this.configCommandContainer){let e=this.plugin.settings;this.configCommandContainer.classList.toggle("astro-composer-setting-container-visible",e.enableOpenConfigFileCommand),this.configCommandContainer.classList.toggle("astro-composer-setting-container-hidden",!e.enableOpenConfigFileCommand)}this.configRibbonToggleComponent&&this.configRibbonToggleComponent.setDisabled(!this.plugin.settings.enableOpenConfigFileCommand)}checkForFolderConflicts(){let e=this.plugin.settings,t=[],s={},n=e.contentTypes||[];for(let i of n)i.enabled&&(!i.folder||i.folder.trim()===""?t.push(i.name||"Content"):(s[i.folder]||(s[i.folder]=[]),s[i.folder].push(i.name||"Content")))}addCustomContentType(){let e=this.plugin.settings,t=e.contentTypes||[],s={id:`content-${Date.now()}`,name:`Content ${t.length+1}`,folder:"",linkBasePath:"",template:`---
title: "{{title}}"
date: {{date}}
---
`,enabled:!0,creationMode:"file",indexFileName:"",ignoreSubfolders:!1,enableUnderscorePrefix:!1};t.push(s),e.contentTypes=t,this.plugin.saveSettings(),this.renderCustomContentTypes(),this.plugin.registerCreateEvent()}renderCustomContentTypes(){if(!this.customContentTypesContainer)return;this.customContentTypesContainer.empty();let t=this.plugin.settings.contentTypes||[];t.forEach((i,o)=>{var ne;if(!this.customContentTypesContainer)return;let r=this.customContentTypesContainer.createDiv({cls:"custom-content-type-item",attr:{"data-type-id":i.id}}),c=r.createDiv({cls:"custom-content-type-header"});c.classList.add("astro-composer-custom-type-header");let l=c.createEl("button",{cls:"astro-composer-collapse-button",attr:{"aria-label":"Collapse/expand"}}),p=(ne=i.collapsed)!=null?ne:!1;(0,T.setIcon)(l,"chevron-down"),p&&l.classList.add("is-collapsed"),l.addEventListener("click",()=>{this.toggleContentTypeCollapse(i.id);let F=this.plugin.settings.contentTypes.find(v=>v.id===i.id);F&&(F.collapsed?l.classList.add("is-collapsed"):l.classList.remove("is-collapsed"))}),c.createDiv({cls:"astro-composer-header-name"}).createEl("div",{text:i.name||`Content ${o+1}`,cls:"setting-item-name"});let h=c.createDiv({cls:"astro-composer-reorder-buttons"}),g=h.createEl("button",{cls:"astro-composer-reorder-button",attr:{"aria-label":"Move up"}});(0,T.setIcon)(g,"chevron-up"),g.disabled=o===0,g.addEventListener("click",()=>{this.moveContentTypeUp(i.id)});let m=h.createEl("button",{cls:"astro-composer-reorder-button",attr:{"aria-label":"Move down"}});(0,T.setIcon)(m,"chevron-down"),m.disabled=o===t.length-1,m.addEventListener("click",()=>{this.moveContentTypeDown(i.id)});let f=c.createDiv({cls:"checkbox-container"});i.enabled&&f.classList.add("is-enabled");let w=f.createEl("input",{type:"checkbox",cls:"checkbox-input"});w.checked=i.enabled,f.addEventListener("click",F=>{(async()=>{F.preventDefault();let v=!i.enabled;i.enabled=v,w.checked=v,await this.plugin.saveSettings(),this.plugin.registerCreateEvent(),v?f.classList.add("is-enabled"):f.classList.remove("is-enabled"),this.updateCustomContentTypeVisibility(i.id,v)})()}),w.addEventListener("change",F=>{(async()=>{let v=F.target.checked;i.enabled=v,await this.plugin.saveSettings(),this.plugin.registerCreateEvent(),v?f.classList.add("is-enabled"):f.classList.remove("is-enabled"),this.updateCustomContentTypeVisibility(i.id,v)})()});let b=r.createDiv({cls:"custom-content-type-settings",attr:{"data-type-id":i.id}}),P=b.createDiv();new T.Setting(P).setName("Content type name").setDesc("Display name for this content type (e.g., 'Projects', 'Notes', 'Tutorials')").addText(F=>{F.setPlaceholder("Enter content type name").setValue(i.name).onChange(async v=>{i.name=v,await this.plugin.saveSettings()})});let I=b.createDiv(),N=new T.Setting(I).setName("Folder location").setDesc("Folder path where this content type will be created. Leave blank to use the vault folder. Supports wildcards like directory/* or directory/*/* to match specific folder depths.").addText(F=>{F.setPlaceholder("Enter folder path (e.g., 'docs', 'docs/*', 'docs/*/*') or leave blank for vault root").setValue(i.folder).onChange(async v=>{i.folder=v,await this.plugin.saveSettings(),this.plugin.registerCreateEvent(),this.updateCustomContentTypeIgnoreSubfoldersField(i.id);let X=this.plugin.settings.contentTypes||[];for(let ie of X)this.updateFolderConflictWarning(ie.id,null)})}),x=I.createDiv({cls:"astro-composer-conflict-warning",attr:{"data-type-id":i.id}});x.style.display="none",this.updateFolderConflictWarning(i.id,N);let E=b.createDiv({cls:"custom-ignore-subfolders-field"});E.setAttribute("data-type-id",i.id),E.classList.toggle("astro-composer-setting-container-visible",!!i.folder),E.classList.toggle("astro-composer-setting-container-hidden",!i.folder),new T.Setting(E).setName("Ignore subfolders").setDesc("When enabled, automation will only trigger for new .md files within this content type's folder and one level down (for folder-based content). Files in deeper subfolders will be ignored.").addToggle(F=>F.setValue(i.ignoreSubfolders||!1).onChange(async v=>{i.ignoreSubfolders=v,await this.plugin.saveSettings()}));let H=b.createDiv();new T.Setting(H).setName("Use underscore prefix for drafts").setDesc("Add an underscore prefix (_content-title) to new notes by default when enabled. This hides them from Astro, which can be helpful for drafts.").addToggle(F=>F.setValue(i.enableUnderscorePrefix||!1).onChange(async v=>{i.enableUnderscorePrefix=v,await this.plugin.saveSettings()}));let G=b.createDiv();new T.Setting(G).setName("Link base path").setDesc("Base path for converted links (e.g., '/projects/', '/notes/tutorials/', leave blank for root /).").addText(F=>{F.setPlaceholder("Enter link base path").setValue(i.linkBasePath||"").onChange(async v=>{i.linkBasePath=v,await this.plugin.saveSettings()})});let te=b.createDiv();new T.Setting(te).setName("Creation mode").setDesc("How to create new entries: file-based or folder-based with an index file.").addDropdown(F=>F.addOption("file","File-based (content-title.md)").addOption("folder","Folder-based (content-title/index.md)").setValue(i.creationMode).onChange(async v=>{i.creationMode=v,await this.plugin.saveSettings(),this.updateCustomContentTypeIndexFileField(i.id)}));let Z=b.createDiv({cls:"custom-index-file-field"});Z.classList.toggle("astro-composer-setting-container-visible",i.creationMode==="folder"),Z.classList.toggle("astro-composer-setting-container-hidden",i.creationMode!=="folder"),new T.Setting(Z).setName("Index file name").setDesc("Name for index files in folder-based content (without .md extension). Defaults to 'index' if left blank.").addText(F=>F.setPlaceholder("index").setValue(i.indexFileName).onChange(async v=>{i.indexFileName=v,await this.plugin.saveSettings()}));let ue=b.createDiv();new T.Setting(ue).setName("Properties template").addTextArea(F=>(F.setPlaceholder(`---
title: "{{title}}"
date: {{date}}
---
`).setValue(i.template).onChange(async v=>{i.template=v,await this.plugin.saveSettings()}),F.inputEl.classList.add("astro-composer-template-textarea"),F)).then(F=>{F.descEl.empty();let v=F.descEl.createEl("div");v.createEl("div",{text:"Template for new files of this content type."}),v.createEl("div",{text:"Variables include {{title}} and {{date}}."}),v.createEl("div",{text:"Do not wrap {{date}} in quotes as it represents a datetime value, not a string."})});let ge=b.createDiv();new T.Setting(ge).setName("").addButton(F=>{F.setButtonText("Remove").setWarning().onClick(async()=>{let v=this.plugin.settings.contentTypes.find(he=>he.id===i.id),X=(v==null?void 0:v.name)||"content type";await new q(this.app,`Are you sure you want to remove "${X}"? This action cannot be undone.`,"Remove","Cancel").waitForResult()&&await this.removeCustomContentType(i.id)})}).settingEl.classList.add("astro-composer-remove-setting"),this.updateCustomContentTypeVisibility(i.id,i.enabled)}),t.forEach(i=>{this.updateFolderConflictWarning(i.id,null)});let s=this.customContentTypesContainer.createDiv();new T.Setting(s).setName("").addButton(i=>{i.setButtonText("Add content type").setCta().onClick(()=>{this.addCustomContentType()})}).settingEl.classList.add("astro-composer-add-button")}updateCustomContentTypeVisibility(e,t){var n,i;let s=(n=this.customContentTypesContainer)==null?void 0:n.querySelector(`[data-type-id="${e}"].custom-content-type-settings`);if(s){let r=(this.plugin.settings.contentTypes||[]).find(p=>p.id===e),c=(i=r==null?void 0:r.collapsed)!=null?i:!1,l=t&&!c;s.classList.toggle("astro-composer-setting-container-visible",l),s.classList.toggle("astro-composer-setting-container-hidden",!l)}}updateCustomContentTypeIndexFileField(e){var i;let s=(this.plugin.settings.contentTypes||[]).find(o=>o.id===e);if(!s)return;let n=(i=this.customContentTypesContainer)==null?void 0:i.querySelector(`[data-type-id="${e}"] .custom-index-file-field`);n&&(n.classList.toggle("astro-composer-setting-container-visible",s.creationMode==="folder"),n.classList.toggle("astro-composer-setting-container-hidden",s.creationMode!=="folder"))}updateCustomContentTypeIgnoreSubfoldersField(e){var i;let s=(this.plugin.settings.contentTypes||[]).find(o=>o.id===e);if(!s)return;let n=(i=this.customContentTypesContainer)==null?void 0:i.querySelector(`[data-type-id="${e}"].custom-ignore-subfolders-field`);n&&(n.classList.toggle("astro-composer-setting-container-visible",!!s.folder&&s.folder.trim()!==""),n.classList.toggle("astro-composer-setting-container-hidden",!s.folder||s.folder.trim()===""))}updateFolderConflictWarning(e,t){var c;let s=this.plugin.settings.contentTypes||[],n=s.find(l=>l.id===e);if(!n)return;let i=(c=this.customContentTypesContainer)==null?void 0:c.querySelector(`[data-type-id="${e}"].astro-composer-conflict-warning`);if(!i)return;let o=(n.folder||"").trim(),r=[];for(let l of s){if(l.id===e||!l.enabled)continue;let p=(l.folder||"").trim();(o===""&&p===""||o===p&&o!=="")&&r.push(l.name||"Unnamed")}r.length>0?(i.style.display="block",i.textContent=`Conflict: ${r.join(", ")} also use${r.length===1?"s":""} this folder. More specific patterns will take priority.`,i.style.color="var(--text-warning)",i.style.fontSize="0.9em",i.style.marginTop="0.5em"):i.style.display="none"}async moveContentTypeUp(e){let t=this.plugin.settings,s=t.contentTypes||[],n=s.findIndex(i=>i.id===e);n<=0||([s[n],s[n-1]]=[s[n-1],s[n]],t.contentTypes=s,await this.plugin.saveSettings(),this.renderCustomContentTypes())}async moveContentTypeDown(e){let t=this.plugin.settings,s=t.contentTypes||[],n=s.findIndex(i=>i.id===e);n<0||n>=s.length-1||([s[n],s[n+1]]=[s[n+1],s[n]],t.contentTypes=s,await this.plugin.saveSettings(),this.renderCustomContentTypes())}async toggleContentTypeCollapse(e){let n=(this.plugin.settings.contentTypes||[]).find(i=>i.id===e);n&&(n.collapsed=!n.collapsed,await this.plugin.saveSettings(),this.updateCustomContentTypeVisibility(e,n.enabled))}async removeCustomContentType(e){let t=this.plugin.settings,s=t.contentTypes||[];t.contentTypes=s.filter(n=>n.id!==e),await this.plugin.saveSettings(),this.renderCustomContentTypes(),this.plugin.registerCreateEvent()}getCommandName(e){if(!e)return"";try{let t=this.app.commands;if(t&&typeof t.listCommands=="function")try{let n=t.listCommands().find(i=>i.id===e);if(n!=null&&n.name)return n.name}catch(s){console.warn("[Astro Composer] Error getting command name via listCommands():",s)}try{let s=t==null?void 0:t.commands;if(s&&typeof s=="object"){let n=s[e];if(n!=null&&n.name)return n.name}}catch(s){console.warn("[Astro Composer] Error getting command name via registry:",s)}}catch(t){console.warn("[Astro Composer] Error getting command name:",t)}return""}getIconName(e){return e?e.replace(/^lucide-/,"").split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "):""}};var me=require("obsidian"),_=class extends me.Modal{constructor(e,t){super(e);this.result=null;this.resolvePromise=null}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("astro-composer-migration-modal"),e.createEl("h2",{text:"Migration Conflict Detected"}),e.createEl("p",{text:"You have existing content types with names that conflict with Posts or Pages. How would you like to proceed?"});let t=e.createEl("ul");t.createEl("li",{text:"Skip migration: Keep your existing Posts/Pages settings (they will be ignored)"}),t.createEl("li",{text:"Migrate with renamed types: Create 'Posts (migrated)' and 'Pages (migrated)' content types"});let s=e.createDiv({cls:"modal-button-container"}),n=s.createEl("button",{text:"Skip Migration",cls:"mod-cta"});n.onclick=()=>{this.result={action:"skip"},this.close()};let i=s.createEl("button",{text:"Migrate with Renamed Types",cls:"mod-cta"});i.onclick=()=>{this.result={action:"migrate"},this.close()}}onClose(){let{contentEl:e}=this;e.empty(),this.resolvePromise&&this.result&&this.resolvePromise(this.result)}async waitForResult(){return new Promise(e=>{this.resolvePromise=e,this.open()})}};var Y=class{constructor(a){this.settings=a}toKebabCase(a){return a.toLowerCase().replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}getAstroUrlFromInternalLink(a){let e=a.indexOf("#"),t=e>=0?a.slice(0,e):a,s=e>=0?a.slice(e):"";t=t.replace(/\.md$/,"");let n="",i="",o="file",r="",c=this.settings.contentTypes||[],l=R(c);for(let m of l){if(!m.enabled)continue;let f=!1;if(!m.folder||m.folder.trim()===""?(!t.includes("/")||t.split("/").length===1)&&(f=!0):M(t,m.folder)&&(f=!0),f){i=m.folder||"",n=m.linkBasePath||"",o=m.creationMode,r=m.indexFileName||"";break}}i&&(t=t.slice(i.length+1));let p=!1;if(r&&r.trim()!==""){let m=t.split("/");m[m.length-1]===r&&(m.pop(),t=m.join("/"),p=!0)}else if(o==="folder"){let m="index",f=t.split("/");f[f.length-1]===m&&(f.pop(),t=f.join("/"),p=!0)}let h=t.split("/").map(m=>this.toKebabCase(m)).join("/");n&&(n.startsWith("/")||(n="/"+n),n.endsWith("/")||(n+="/"));let g=(this.settings.addTrailingSlashToLinks||p)&&!s;return`${n}${h}${g?"/":""}${s}`}generateObsidianLink(a,e,t){let s=t.heading;if(a.fileManager.generateMarkdownLink(e,"","").startsWith("[["))return`[[${e.basename}#${s}|${s}]]`;{let i=a.fileManager.generateMarkdownLink(e,"","");if(i.startsWith("[["))return`[[${e.basename}#${s}|${s}]]`;{let o=i.match(/\[([^\]]+)\]\(([^)]+)\)/);if(o){let[,,r]=o;return`[${s}](${r}#${encodeURIComponent(s)})`}else{let r=encodeURIComponent(e.name);return`[${s}](${r}#${encodeURIComponent(s)})`}}}}generateObsidianWikilink(a,e){let t=e.heading;return`[[${a.basename}#${t}|${t}]]`}generateAstroLink(a,e){let t=e.heading,s=this.toKebabCase(t),n=`${a.path}#${s}`,i=this.getAstroUrlFromInternalLink(n);return`[${t}](${i})`}generateAstroWikilink(a,e){let t=e.heading,s=this.toKebabCase(t),n=`${a.path}#${s}`,i=this.getAstroUrlFromInternalLink(n);return`[[${t}|${i}]]`}extractUrl(a){let e=a.match(/\[([^\]]+)\]\(([^)]+)\)/);if(e)return e[2];let t=a.match(/\[\[([^\]]+)\]\]/);return t?t[1].split("|")[0]:a}generateLink(a,e,t){return this.settings.copyHeadingLinkFormat==="astro"?this.generateAstroLink(e,t):this.generateObsidianLink(a,e,t)}findHeadingAtLine(a,e,t){let s=a.metadataCache.getFileCache(e);if(!s||!s.headings)return null;for(let n=s.headings.length-1;n>=0;n--){let i=s.headings[n];if(i.position.start.line<=t)return i}return null}};var z=class extends S.Plugin{constructor(){super(...arguments);this.pluginCreatedFiles=new Set;this.terminalRibbonIcon=null;this.configRibbonIcon=null}async migrateSettingsIfNeeded(){if(this.settings.migrationCompleted)return;let e=this.settings.automatePostCreation!==void 0&&this.settings.automatePostCreation,t=this.settings.enablePages!==void 0&&this.settings.enablePages;if(!e&&!t){this.settings.migrationCompleted=!0,await this.saveSettings();return}let s=this.settings.contentTypes||this.settings.customContentTypes||[],n=[];s.some(m=>m.name==="Posts")&&n.push("Posts"),s.some(m=>m.name==="Pages")&&n.push("Pages");let i=!0,o=!1;if(n.length>0&&await new Promise(m=>{setTimeout(async()=>{try{let f=new _(this.app,n),w=new Promise(P=>{setTimeout(()=>{P({action:"skip"})},3e4)});(await Promise.race([f.waitForResult(),w])).action==="skip"?(i=!1,new S.Notice("Migration skipped. Old Posts/Pages settings will be ignored.")):o=!0}catch(f){console.error("Migration modal error:",f),i=!1,new S.Notice("Migration skipped due to error. You can migrate manually in settings.")}m()},500)}),!i){this.settings.migrationCompleted=!0,await this.saveSettings();return}let r=[];if(e&&!n.includes("Posts")){let m={id:`posts-${Date.now()}`,name:"Posts",folder:this.settings.postsFolder||"",linkBasePath:this.settings.postsLinkBasePath||"",template:this.settings.defaultTemplate||`---
title: "{{title}}"
date: {{date}}
tags: []
---
`,enabled:this.settings.automatePostCreation||!1,creationMode:this.settings.creationMode||"file",indexFileName:this.settings.indexFileName||"",ignoreSubfolders:this.settings.onlyAutomateInPostsFolder||!1,enableUnderscorePrefix:this.settings.enableUnderscorePrefix||!1};r.push(m)}if(t&&!n.includes("Pages")){let m={id:`pages-${Date.now()}`,name:"Pages",folder:this.settings.pagesFolder||"",linkBasePath:this.settings.pagesLinkBasePath||"",template:this.settings.pageTemplate||`---
title: "{{title}}"
description: ""
---
`,enabled:this.settings.enablePages||!1,creationMode:this.settings.pagesCreationMode||"file",indexFileName:this.settings.pagesIndexFileName||"",ignoreSubfolders:this.settings.onlyAutomateInPagesFolder||!1,enableUnderscorePrefix:!1};r.push(m)}let c=this.settings.contentTypes&&Array.isArray(this.settings.contentTypes)?this.settings.contentTypes:[],l=this.settings.customContentTypes&&Array.isArray(this.settings.customContentTypes)?this.settings.customContentTypes:[],p=[];c.length>0?p=c:l.length>0&&(p=l);let d=[...p];if(r.length>0){let m=new Set(p.map(w=>w.name)),f=r.filter(w=>!m.has(w.name));f.length>0&&(d=[...p,...f])}this.settings.contentTypes=d;let h=["customContentTypes","enableUnderscorePrefix","postsFolder","postsLinkBasePath","automatePostCreation","creationMode","indexFileName","excludedDirectories","onlyAutomateInPostsFolder","enablePages","pagesFolder","pagesLinkBasePath","pagesCreationMode","pagesIndexFileName","pageTemplate","onlyAutomateInPagesFolder"],g=!1;for(let m of h)this.settings[m]!==void 0&&(delete this.settings[m],g=!0);this.settings.migrationCompleted=!0,await this.saveSettings(),await this.loadSettings(),r.length>0&&(new S.Notice(`Migration completed: ${r.length} content type(s) migrated.`),setTimeout(()=>{if(this.settingsTab)try{(this.settingsTab.customContentTypesContainer||this.settingsTab.containerEl)&&this.settingsTab.display()}catch(m){console.log("Could not refresh settings tab after migration:",m)}},300))}async onload(){await this.loadSettings(),this.fileOps=new k(this.app,this.settings,this),this.templateParser=new $(this.app,this.settings),this.headingLinkGenerator=new Y(this.settings),this.app.workspace.onLayoutReady(()=>{this.registerCreateEvent(),S.Platform.isMobile||this.updateHelpButton(),this.migrateSettingsIfNeeded()}),le(this,this.settings),this.settingsTab=new K(this.app,this),this.addSettingTab(this.settingsTab),this.registerContextMenu(),this.registerRibbonIcons(),this.setupRibbonContextMenuHandling()}registerCreateEvent(){let e=0;this.createEvent=t=>{(async()=>{let s=Date.now();if(!(s-e<V.DEBOUNCE_MS)&&(e=s,t instanceof S.TFile&&t.extension==="md")){let n=t.path;if(this.pluginCreatedFiles.has(n)){this.pluginCreatedFiles.delete(n);return}await this.loadSettings();let i=this.settings.contentTypes||[];if(!i.some(g=>g.enabled))return;let r=R(i),c=null,l=[];for(let g of r){if(!g.enabled)continue;let m=!1;if(!g.folder||g.folder.trim()==="")(!n.includes("/")||n.split("/").length===1)&&(m=!0);else if(M(n,g.folder))if(g.ignoreSubfolders){let w=n.split("/").length,P=g.folder.split("/").length;if(g.creationMode==="folder"){let I=w-1;(I===P||I===P+1)&&(m=!0)}else w===P&&(m=!0)}else m=!0;m&&(l.push(g),c||(c=g.id))}if(l.length>1){let g=l.map(m=>m.name||"Unnamed").join(", ");new S.Notice(`Multiple content types (${g}) match this file. Using most specific: ${l[0].name||"Unnamed"}`)}if(!c)return;let p=await this.app.vault.adapter.stat(t.path);if(!((p==null?void 0:p.mtime)&&s-p.mtime<V.STAT_MTIME_THRESHOLD))return;let h=this.app.metadataCache.getFileCache(t);if(h!=null&&h.frontmatter){let g=Object.keys(h.frontmatter);if(g.length>1||!g.includes("title"))return}this.pluginCreatedFiles.add(t.path),new O(this.app,t,this,c,!1,!0).open()}})()},this.registerEvent(this.app.vault.on("create",t=>{t instanceof S.TFile&&this.createEvent(t)}))}async loadSettings(){let e=await this.loadData();if(this.settings=Object.assign({},se,e),(!this.settings.contentTypes||!Array.isArray(this.settings.contentTypes))&&(this.settings.contentTypes=[]),this.settings.migrationCompleted){let t=["customContentTypes","enableUnderscorePrefix","postsFolder","postsLinkBasePath","automatePostCreation","creationMode","indexFileName","excludedDirectories","onlyAutomateInPostsFolder","enablePages","pagesFolder","pagesLinkBasePath","pagesCreationMode","pagesIndexFileName","pageTemplate","onlyAutomateInPagesFolder"],s=!1;for(let n of t)this.settings[n]!==void 0&&(delete this.settings[n],s=!0);s&&await this.saveSettings()}else{let t=this.settings.customContentTypes&&Array.isArray(this.settings.customContentTypes)&&this.settings.customContentTypes.length>0,s=this.settings.contentTypes&&Array.isArray(this.settings.contentTypes)&&this.settings.contentTypes.length>0;t&&!s&&(this.settings.contentTypes=this.settings.customContentTypes)}}async saveSettings(){await this.saveData(this.settings)}registerContextMenu(){this.registerEvent(this.app.workspace.on("editor-menu",(e,t,s)=>{if(!this.settings.enableCopyHeadingLink)return;let n=t.getCursor(),i=s.file;if(!(i instanceof S.TFile))return;let o=this.headingLinkGenerator.findHeadingAtLine(this.app,i,n.line);if(o){let r=this.headingLinkGenerator.generateLink(this.app,i,o),c=this.headingLinkGenerator.extractUrl(r);e.addItem(l=>{l.setTitle("Copy heading link").setIcon("link-2").onClick(async()=>{await navigator.clipboard.writeText(c),new S.Notice("Heading link copied to clipboard")})}),e.addItem(l=>{l.setTitle("Copy heading link with text").setIcon("heading").onClick(async()=>{await navigator.clipboard.writeText(r),new S.Notice("Heading link with text copied to clipboard")})})}}))}async renameContentByPath(e){await ce(this.app,e,this.settings,this)}registerRibbonIcons(){if(S.Platform.isMobile){if(this.terminalRibbonIcon){try{this.terminalRibbonIcon.parentNode&&this.terminalRibbonIcon.remove()}catch(r){}this.terminalRibbonIcon=null}if(this.configRibbonIcon){try{this.configRibbonIcon.parentNode&&this.configRibbonIcon.remove()}catch(r){}this.configRibbonIcon=null}try{document.querySelectorAll('.side-dock-ribbon-action[aria-label="Open project terminal"]').forEach(l=>l.remove()),document.querySelectorAll('.side-dock-ribbon-action[aria-label="Edit Astro config"]').forEach(l=>l.remove())}catch(r){}return}let e=this.settings.enableTerminalRibbonIcon===!0,t=this.settings.enableOpenTerminalCommand===!0,s=e&&t,n=this.settings.enableConfigRibbonIcon===!0,i=this.settings.enableOpenConfigFileCommand===!0,o=n&&i;if(this.terminalRibbonIcon){try{this.terminalRibbonIcon.parentNode&&this.terminalRibbonIcon.remove()}catch(r){}this.terminalRibbonIcon=null}if(this.configRibbonIcon){try{this.configRibbonIcon.parentNode&&this.configRibbonIcon.remove()}catch(r){}this.configRibbonIcon=null}try{document.querySelectorAll('.side-dock-ribbon-action[aria-label="Open project terminal"]').forEach(l=>l.remove()),document.querySelectorAll('.side-dock-ribbon-action[aria-label="Edit Astro config"]').forEach(l=>l.remove())}catch(r){}if(s){let r=document.querySelector('.side-dock-ribbon-action[aria-label="Open project terminal"]');if(r?this.terminalRibbonIcon=r:(this.terminalRibbonIcon=this.addRibbonIcon("terminal-square","Open project terminal",async()=>{if(!this.settings.enableOpenTerminalCommand){new S.Notice("Open terminal command is disabled. Enable it in settings to use this command.");return}await Q(this.app,this.settings)}),this.terminalRibbonIcon&&this.terminalRibbonIcon.setAttribute("data-astro-composer-terminal-ribbon","true")),!o){let c=document.querySelectorAll('.side-dock-ribbon-action[aria-label="Edit Astro config"]');c.length>0&&(c.forEach(l=>l.remove()),this.configRibbonIcon=null)}}else this.terminalRibbonIcon=null;if(o){let r=document.querySelector('.side-dock-ribbon-action[aria-label="Edit Astro config"]');if(r?this.configRibbonIcon=r:(this.configRibbonIcon=this.addRibbonIcon("wrench","Edit Astro config",async()=>{if(!this.settings.enableOpenConfigFileCommand){new S.Notice("Edit config file command is disabled. Enable it in settings to use this command.");return}await ee(this.app,this.settings)}),this.configRibbonIcon&&this.configRibbonIcon.setAttribute("data-astro-composer-config-ribbon","true")),!s){let c=document.querySelectorAll('.side-dock-ribbon-action[aria-label="Open project terminal"]');c.length>0&&(c.forEach(l=>l.remove()),this.terminalRibbonIcon=null)}}else this.configRibbonIcon=null;this.updateRibbonContextMenuCSS(),this.setupRibbonContextMenuObserver(),setTimeout(()=>{s||(document.querySelectorAll('.side-dock-ribbon-action[aria-label="Open project terminal"]').forEach(c=>c.remove()),this.terminalRibbonIcon=null),o||(document.querySelectorAll('.side-dock-ribbon-action[aria-label="Edit Astro config"]').forEach(c=>c.remove()),this.configRibbonIcon=null)},100)}onunload(){this.terminalRibbonIcon&&(this.terminalRibbonIcon.remove(),this.terminalRibbonIcon=null),this.configRibbonIcon&&(this.configRibbonIcon.remove(),this.configRibbonIcon=null),this.ribbonContextMenuObserver&&(this.ribbonContextMenuObserver.disconnect(),this.ribbonContextMenuObserver=void 0),this.ribbonContextMenuStyleEl&&(this.ribbonContextMenuStyleEl.remove(),this.ribbonContextMenuStyleEl=void 0),this.helpButtonObserver&&(this.helpButtonObserver.disconnect(),this.helpButtonObserver=void 0),this.helpButtonStyleEl&&(this.helpButtonStyleEl.remove(),this.helpButtonStyleEl=void 0),this.customHelpButton&&(this.customHelpButton.remove(),this.customHelpButton=void 0),this.helpButtonElement=void 0}setupRibbonContextMenuHandling(){this.updateRibbonContextMenuCSS(),this.setupRibbonContextMenuObserver()}updateRibbonContextMenuCSS(){this.ribbonContextMenuStyleEl&&this.ribbonContextMenuStyleEl.remove();let e=!this.settings.enableTerminalRibbonIcon||!this.settings.enableOpenTerminalCommand,t=!this.settings.enableConfigRibbonIcon||!this.settings.enableOpenConfigFileCommand;if(e||t){this.ribbonContextMenuStyleEl=document.createElement("style"),this.ribbonContextMenuStyleEl.id="astro-composer-hide-ribbon-context-menu";let s="";e&&(s+=`
					/* Hide terminal icon from context menu when disabled */
					.menu-item:has(svg[data-lucide="terminal-square"]),
					.menu-item:has(.lucide-terminal-square),
					.menu-item .menu-item-icon:has(svg[data-lucide="terminal-square"]),
					.menu-item .menu-item-icon:has(.lucide-terminal-square) {
						display: none !important;
					}
				`),t&&(s+=`
					/* Hide config icon from context menu when disabled */
					.menu-item:has(svg[data-lucide="wrench"]),
					.menu-item:has(.lucide-wrench),
					.menu-item .menu-item-icon:has(svg[data-lucide="wrench"]),
					.menu-item .menu-item-icon:has(.lucide-wrench) {
						display: none !important;
					}
				`),this.ribbonContextMenuStyleEl.textContent=s,document.head.appendChild(this.ribbonContextMenuStyleEl)}}setupRibbonContextMenuObserver(){this.ribbonContextMenuObserver&&this.ribbonContextMenuObserver.disconnect();let e=!this.settings.enableTerminalRibbonIcon||!this.settings.enableOpenTerminalCommand,t=!this.settings.enableConfigRibbonIcon||!this.settings.enableOpenConfigFileCommand;!e&&!t||(this.ribbonContextMenuObserver=new MutationObserver(s=>{for(let n of s)if(n.addedNodes.length>0)for(let i of Array.from(n.addedNodes))i instanceof HTMLElement&&(i.classList.contains("menu")||i.querySelector(".menu"))&&this.removeRibbonIconsFromContextMenu(i)}),this.ribbonContextMenuObserver.observe(document.body,{childList:!0,subtree:!0}))}updateHelpButtonCSS(){var e;this.helpButtonStyleEl&&this.helpButtonStyleEl.remove(),(e=this.settings.helpButtonReplacement)!=null&&e.enabled&&(this.helpButtonStyleEl=document.createElement("style"),this.helpButtonStyleEl.id="astro-composer-hide-help-button",this.helpButtonStyleEl.textContent=`
				.workspace-drawer-vault-actions .clickable-icon:has(svg.help) {
					display: none !important;
				}
			`,document.head.appendChild(this.helpButtonStyleEl))}async updateHelpButton(){var o,r,c;if(S.Platform.isMobile){this.restoreHelpButton();return}if(this.helpButtonObserver&&this.helpButtonObserver.disconnect(),await this.loadSettings(),this.updateHelpButtonCSS(),!((o=this.settings.helpButtonReplacement)!=null&&o.enabled)){this.restoreHelpButton(),this.setupHelpButtonObserver();return}let e=document.querySelector(".workspace-drawer-vault-actions");if(!e){this.setupHelpButtonObserver(),setTimeout(()=>{var l;(l=this.settings.helpButtonReplacement)!=null&&l.enabled&&this.updateHelpButton()},500);return}let t=Array.from(e.querySelectorAll(".clickable-icon")),s=null;for(let l of t)if(l.querySelector("svg.help")){s=l;break}if(!s){this.setupHelpButtonObserver(),setTimeout(()=>{var l;(l=this.settings.helpButtonReplacement)!=null&&l.enabled&&this.updateHelpButton()},500);return}this.helpButtonElement=s,this.customHelpButton&&this.customHelpButton.parentElement&&document.body.contains(this.customHelpButton)&&this.customHelpButton.hasAttribute("data-astro-composer-help-replacement")&&this.customHelpButton.remove(),this.customHelpButton=void 0;let n=s.cloneNode(!0);n.style.display="",n.removeAttribute("aria-label"),n.setAttribute("data-astro-composer-help-replacement","true"),n.classList.add("astro-composer-help-replacement"),n.onclick=null;let i=((r=n.querySelector("svg"))==null?void 0:r.parentElement)||n;try{(0,S.setIcon)(i,this.settings.helpButtonReplacement.iconId)}catch(l){console.warn("[Astro Composer] Error setting icon:",l)}n.addEventListener("click",async l=>{var d;l.preventDefault(),l.stopPropagation();let p=(d=this.settings.helpButtonReplacement)==null?void 0:d.commandId;if(p)try{await this.app.commands.executeCommandById(p)}catch(h){console.warn("[Astro Composer] Error executing command:",h),new S.Notice(`Failed to execute command: ${p}`)}},!0),(c=s.parentElement)==null||c.insertBefore(n,s.nextSibling),this.customHelpButton=n,setTimeout(()=>{var l;(l=this.settings.helpButtonReplacement)!=null&&l.enabled&&this.setupHelpButtonObserver()},1e3)}setupHelpButtonObserver(){var n;if(this.helpButtonObserver&&this.helpButtonObserver.disconnect(),!((n=this.settings.helpButtonReplacement)!=null&&n.enabled))return;let e=null;this.helpButtonObserver=new MutationObserver(()=>{e&&clearTimeout(e),e=window.setTimeout(()=>{if(!document.querySelector(".workspace-drawer-vault-actions"))return;this.customHelpButton&&this.customHelpButton.parentElement&&document.body.contains(this.customHelpButton)&&this.customHelpButton.hasAttribute("data-astro-composer-help-replacement")||(this.customHelpButton&&(!document.body.contains(this.customHelpButton)||!this.customHelpButton.hasAttribute("data-astro-composer-help-replacement"))&&(this.customHelpButton=void 0),this.updateHelpButton())},100)});let t=document.querySelector(".workspace-drawer-vault-actions");t&&this.helpButtonObserver.observe(t,{childList:!0,subtree:!0});let s=document.querySelector(".workspace-sidedock-vault-profile");if(s&&this.helpButtonObserver.observe(s,{childList:!0,subtree:!0}),!t&&!s){let i=document.querySelector(".workspace-split");i?this.helpButtonObserver.observe(i,{childList:!0,subtree:!0}):this.helpButtonObserver.observe(document.body,{childList:!0,subtree:!0})}}restoreHelpButton(){this.helpButtonStyleEl&&(this.helpButtonStyleEl.remove(),this.helpButtonStyleEl=void 0),this.customHelpButton&&(this.customHelpButton.remove(),this.customHelpButton=void 0),this.helpButtonElement=void 0}removeRibbonIconsFromContextMenu(e){var i,o;let t=!this.settings.enableTerminalRibbonIcon||!this.settings.enableOpenTerminalCommand,s=!this.settings.enableConfigRibbonIcon||!this.settings.enableOpenConfigFileCommand,n=e.querySelectorAll(".menu-item");for(let r of Array.from(n)){let c=r.querySelector("svg");if(c){let l=c.getAttribute("data-lucide")||c.getAttribute("xmlns:lucide")||(c.classList.contains("lucide-terminal-square")?"terminal-square":null)||(c.classList.contains("lucide-wrench")?"wrench":null);if(t&&l==="terminal-square"){let p=((i=r.textContent)==null?void 0:i.toLowerCase())||"";(p.includes("terminal")||p.includes("project terminal"))&&r.remove()}if(s&&l==="wrench"){let p=((o=r.textContent)==null?void 0:o.toLowerCase())||"";(p.includes("config")||p.includes("astro config"))&&r.remove()}}}}};
