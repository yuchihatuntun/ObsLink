/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ne=Object.defineProperty;var Ue=Object.getOwnPropertyDescriptor;var Ne=Object.getOwnPropertyNames;var He=Object.prototype.hasOwnProperty;var We=(n,i)=>()=>(n&&(i=n(n=0)),i);var ue=(n,i)=>{for(var e in i)ne(n,e,{get:i[e],enumerable:!0})},qe=(n,i,e,s)=>{if(i&&typeof i=="object"||typeof i=="function")for(let t of Ne(i))!He.call(n,t)&&t!==e&&ne(n,t,{get:()=>i[t],enumerable:!(s=Ue(i,t))||s.enumerable});return n};var fe=n=>qe(ne({},"__esModule",{value:!0}),n);var be={};ue(be,{getCMSViewOptions:()=>je,readCMSSettings:()=>V});function V(n,i){var e,s,t,a,r,o,l,c,d,f,h,p,u,g;return{titleProperty:n.get("titleProperty")||"title",descriptionProperty:n.get("descriptionProperty")||"description",imageProperty:n.get("imageProperty")||"image",showTitle:(e=n.get("showTitle"))!=null?e:!0,showDate:(s=n.get("showDate"))!=null?s:!1,dateProperty:n.get("dateProperty")||"date",showTextPreview:(t=n.get("showTextPreview"))!=null?t:!0,fallbackToContent:(a=n.get("fallbackToContent"))!=null?a:!0,fallbackToEmbeds:(r=n.get("fallbackToEmbeds"))!=null?r:!1,propertyDisplay1:n.get("propertyDisplay1")||"",propertyDisplay2:n.get("propertyDisplay2")||"",propertyDisplay3:n.get("propertyDisplay3")||"",propertyDisplay4:n.get("propertyDisplay4")||"",propertyLayout12SideBySide:(o=n.get("propertyLayout12SideBySide"))!=null?o:!1,propertyLayout34SideBySide:(l=n.get("propertyLayout34SideBySide"))!=null?l:!1,imageFormat:n.get("imageFormat")||"thumbnail",propertyLabels:n.get("propertyLabels")||"hide",showDraftStatus:(c=n.get("showDraftStatus"))!=null?c:!1,draftStatusProperty:n.get("draftStatusProperty")||"draft",draftStatusReverse:(d=n.get("draftStatusReverse"))!=null?d:!1,showTags:(f=n.get("showTags"))!=null?f:!1,tagsProperty:n.get("tagsProperty")||"",maxTagsToShow:(h=n.get("maxTagsToShow"))!=null?h:3,customizeNewButton:(p=n.get("customizeNewButton"))!=null?p:!1,newNoteLocation:n.get("newNoteLocation")||"",thumbnailCacheSize:i.thumbnailCacheSize,cardSize:(u=n.get("cardSize"))!=null?u:250,imageAspectRatio:(g=n.get("imageAspectRatio"))!=null?g:.55}}function je(){return[{type:"slider",displayName:"Card size",key:"cardSize",min:50,max:800,step:10,default:250},{type:"dropdown",displayName:"Card image",key:"imageFormat",options:{none:"No image",thumbnail:"Thumbnail",cover:"Cover"},default:"thumbnail"},{type:"slider",displayName:"Image aspect ratio",key:"imageAspectRatio",min:.1,max:2,step:.05,default:.55,showWhen:{key:"imageFormat",value:"cover"}},{type:"property",displayName:"Image property",key:"imageProperty",placeholder:"Select property",default:"image"},{type:"toggle",displayName:"Use in-note images if image property unavailable",key:"fallbackToEmbeds",default:!1},{type:"toggle",displayName:"Show title",key:"showTitle",default:!0},{type:"property",displayName:"Title property",key:"titleProperty",placeholder:"Select property",default:"title"},{type:"toggle",displayName:"Show date",key:"showDate",default:!1},{type:"property",displayName:"Date property",key:"dateProperty",placeholder:"Select property",default:"date"},{type:"toggle",displayName:"Show draft status",key:"showDraftStatus",default:!1},{type:"property",displayName:"Draft status property",key:"draftStatusProperty",placeholder:"Select property",default:"draft"},{type:"toggle",displayName:"Reverse logic",key:"draftStatusReverse",default:!1},{type:"toggle",displayName:"Show text preview",key:"showTextPreview",default:!0},{type:"property",displayName:"Text preview property",key:"descriptionProperty",placeholder:"Select property",default:"description"},{type:"toggle",displayName:"Use note content if text preview property unavailable",key:"fallbackToContent",default:!0},{type:"toggle",displayName:"Show tags",key:"showTags",default:!1},{type:"property",displayName:"Tags property",key:"tagsProperty",placeholder:"Select property",default:""},{type:"slider",displayName:"Maximum tags to show",key:"maxTagsToShow",min:1,max:50,step:1,default:3,showWhen:{key:"showTags",value:!0}},{type:"property",displayName:"First property",key:"propertyDisplay1",placeholder:"Select property",default:""},{type:"property",displayName:"Second property",key:"propertyDisplay2",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show first and second properties side by side",key:"propertyLayout12SideBySide",default:!1},{type:"property",displayName:"Third property",key:"propertyDisplay3",placeholder:"Select property",default:""},{type:"property",displayName:"Fourth property",key:"propertyDisplay4",placeholder:"Select property",default:""},{type:"toggle",displayName:"Show third and fourth properties side by side",key:"propertyLayout34SideBySide",default:!1},{type:"dropdown",displayName:"Show property labels",key:"propertyLabels",options:{hide:"Hide",inline:"Inline",above:"On top"},default:"hide"},{type:"toggle",displayName:"Customize new button behavior",key:"customizeNewButton",default:!1},{type:"text",displayName:"Default location for new notes",key:"newNoteLocation",placeholder:"Simply use / for vault folder",default:""}]}var re=We(()=>{});var nt={};ue(nt,{default:()=>ae});module.exports=fe(nt);var ze=require("obsidian");var F=require("obsidian"),Y=class extends F.PluginSettingTab{constructor(e,s){super(e,s);this.plugin=s}display(){let{containerEl:e}=this;e.empty(),new F.Setting(e).setName("Confirm bulk operations").setDesc("Show confirmation dialogs before performing bulk operations").addToggle(s=>s.setValue(this.plugin.settings.confirmBulkOperations).onChange(async t=>{this.plugin.settings.confirmBulkOperations=t,await this.plugin.saveData(this.plugin.settings)})),e.createEl("h3",{text:"Deletions"}),new F.Setting(e).setName("Delete parent folder for specific file name").setDesc("When enabled, deleting a note will delete its parent folder if the note filename matches the specified name").addToggle(s=>s.setValue(this.plugin.settings.deleteParentFolder).onChange(async t=>{this.plugin.settings.deleteParentFolder=t,await this.plugin.saveData(this.plugin.settings)})),new F.Setting(e).setName("Folder deletion filename").setDesc('Filename that triggers parent folder deletion (e.g., "index")').addText(s=>s.setPlaceholder("index").setValue(this.plugin.settings.deleteParentFolderFilename).onChange(async t=>{this.plugin.settings.deleteParentFolderFilename=t,await this.plugin.saveData(this.plugin.settings)})).setDisabled(!this.plugin.settings.deleteParentFolder),new F.Setting(e).setName("Delete associated unique attachments").setDesc("When deleting a note, automatically delete attachments that are only used by that note. Attachments used by other notes will be preserved.").addToggle(s=>s.setValue(this.plugin.settings.deleteUniqueAttachments).onChange(async t=>{this.plugin.settings.deleteUniqueAttachments=t,await this.plugin.saveData(this.plugin.settings)})),new F.Setting(e).setName("Confirm deletions").setDesc("Show confirmation dialog before deleting files").addToggle(s=>s.setValue(this.plugin.settings.confirmDeletions).onChange(async t=>{this.plugin.settings.confirmDeletions=t,await this.plugin.saveData(this.plugin.settings)})),e.createEl("h3",{text:"Appearance"}),new F.Setting(e).setName("Use home icon for CMS view").setDesc("Use the home icon instead of blocks icon for the CMS view in the Bases view selector. Restart Obsidian for this change to take effect.").addToggle(s=>s.setValue(this.plugin.settings.useHomeIcon).onChange(async t=>{this.plugin.settings.useHomeIcon=t,await this.plugin.saveData(this.plugin.settings)})),e.createEl("h3",{text:"Performance"}),new F.Setting(e).setName("Thumbnail cache size").setDesc("Maximum size for generated thumbnails. Larger sizes provide better quality but use more memory. This setting caps the thumbnail size regardless of card size.").addDropdown(s=>s.addOption("minimal","Minimal (100x100, fastest)").addOption("small","Small (200x200)").addOption("balanced","Balanced (400x400, recommended)").addOption("large","Large (800x800)").addOption("unlimited","Unlimited (full resolution)").setValue(this.plugin.settings.thumbnailCacheSize).onChange(async t=>{this.plugin.settings.thumbnailCacheSize=t,await this.plugin.saveData(this.plugin.settings)}))}};var q=require("obsidian");function D(n,i){if(!i||!i.trim())return null;let e=i.split(",").map(s=>s.trim()).filter(s=>s);for(let s of e){let t=n.getValue(s),a=t;if(a&&("date"in a&&a.date instanceof Date||"data"in a))return t}return null}function ge(n,i){if(!i||!i.trim())return[];let e=i.split(",")[0].trim();if(!e)return[];let s=n.getValue(e);if(!s||!("data"in s))return[];let t=s.data,a=[];if(Array.isArray(t)){for(let r of t)if(typeof r=="string"||typeof r=="number"){let o=String(r);if(o&&o.trim()){a.push(o);break}}}else if(t!=null&&t!==""&&(typeof t=="string"||typeof t=="number")){let r=String(t);r.trim()&&a.push(r)}return a}function me(n,i,e,s){if(!n||n==="")return"";if(e&&typeof e.getDisplayName=="function")try{let t=e.getDisplayName(n);if(t&&typeof t=="string"&&t.trim()!=="")return t}catch(t){}return n}function _e(n,i,e,s,t,a,r){let o=n.file.basename||n.file.name,l=D(n,i.titleProperty),c=l==null?void 0:l.data,d=c!=null&&c!==""&&(typeof c=="string"||typeof c=="number")?String(c):o,f=n.file.path,h=f.split("/").slice(0,-1).join("/"),p=n.getValue("note.tags"),u=[];if(p&&p.data!=null){let S=p.data;u=(Array.isArray(S)?S.map(y=>y&&typeof y=="object"&&"data"in y?String(y.data):typeof y=="string"||typeof y=="number"?String(y):"").filter(y=>y):typeof S=="string"||typeof S=="number"?[String(S)]:[]).map(y=>y.replace(/^#/,""))}let g=n.getValue("file.tags"),m=[];if(g&&g.data!=null){let S=g.data;m=(Array.isArray(S)?S.map(y=>y&&typeof y=="object"&&y!==null&&"data"in y?String(y.data):typeof y=="string"||typeof y=="number"?String(y):"").filter(y=>typeof y=="string"&&y.length>0):typeof S=="string"||typeof S=="number"?[String(S)]:[]).map(y=>y.replace(/^#/,""))}let b=n.file.stat.ctime,T=n.file.stat.mtime,v=[];if(i.showTags&&i.tagsProperty){let S=D(n,i.tagsProperty);if(S&&S.data!=null){let C=S.data;Array.isArray(C)?v=C.map(y=>y&&typeof y=="object"&&"data"in y?String(y.data):typeof y=="string"||typeof y=="number"?String(y):"").filter(y=>typeof y=="string"&&y.length>0):(typeof C=="string"||typeof C=="number")&&(v=[String(C)])}}let E={path:f,name:o,title:d,tags:m,yamlTags:u,ctime:b,mtime:T,folderPath:h,snippet:t,imageUrl:a,hasImageAvailable:r||!1,displayTags:v.length>0?v:void 0},P=[i.propertyDisplay1,i.propertyDisplay2,i.propertyDisplay3,i.propertyDisplay4],x=new Set,w=P.map(S=>!S||S===""||x.has(S)?"":(x.add(S),S));return E.propertyName1=w[0]||void 0,E.propertyName2=w[1]||void 0,E.propertyName3=w[2]||void 0,E.propertyName4=w[3]||void 0,E.property1=w[0]?U(w[0],n,E,i):null,E.property2=w[1]?U(w[1],n,E,i):null,E.property3=w[2]?U(w[2],n,E,i):null,E.property4=w[3]?U(w[3],n,E,i):null,E}function ye(n,i,e,s,t,a,r){return n.map(o=>_e(o,i,e,s,t[o.file.path],a[o.file.path],r[o.file.path]))}function U(n,i,e,s){if(!n||n==="")return null;if(n==="file.path"||n==="file path")return e.folderPath||null;if(n==="tags"||n==="note.tags")return e.yamlTags.length>0?"tags":null;if(n==="file.tags"||n==="file tags")return e.tags.length>0?"tags":null;if(n==="file.ctime"||n==="created time")return new Date(e.ctime).toLocaleDateString();if(n==="file.mtime"||n==="modified time")return new Date(e.mtime).toLocaleDateString();let t=D(i,n);if(!t)return null;let a=t;if(!a)return null;if("date"in a&&a.date instanceof Date)return a.date.toLocaleDateString();let r=a.data;return r==null||r===""?null:Array.isArray(r)?r.length===0?null:r.map(o=>o&&typeof o=="object"&&"data"in o?String(o.data):String(o)).filter(o=>o&&o.trim()!=="").join(", "):typeof r=="string"||typeof r=="number"||typeof r=="boolean"?String(r):null}re();function ve(n){return/^https?:\/\//i.test(n)}function oe(n){return/\.(avif|bmp|gif|jpe?g|png|svg|webp)$/i.test(n)}function Ge(n){let i=n.match(/^!?\[\[([^\]|]+)(?:\|[^\]]*)?\]\]$/);return i?i[1].trim():n}function we(n){let i=[],e=[];for(let s of n){let t=Ge(s);t.length!==0&&(ve(t)?(oe(t)||!t.includes("."))&&e.push(t):oe(t)&&i.push(t))}return{internalPaths:i,externalUrls:e}}async function Te(n,i){let e=["avif","bmp","gif","jpeg","jpg","png","svg","webp"],s=i.metadataCache.getFileCache(n);if(!(s!=null&&s.embeds))return[];let t=[],a=[];for(let r of s.embeds){let o=r.link;if(ve(o))(oe(o)||!o.includes("."))&&a.push(o);else{let l=i.metadataCache.getFirstLinkpathDest(o,n.path);if(l&&e.includes(l.extension)){let c=i.vault.getResourcePath(l);t.push(c)}}}return[...t,...a]}var Ye=[/`([^`]+)`/g,/\*\*\*((?:(?!\*\*\*).)+)\*\*\*/g,/___((?:(?!___).)+)___/g,/\*\*((?:(?!\*\*).)+)\*\*/g,/__((?:(?!__).)+)__/g,/\*((?:(?!\*).)+)\*/g,/_((?:(?!_).)+)_/g,/~~((?:(?!~~).)+)~~/g,/==((?:(?!==).)+)==/g,/\[([^\]]+)\]\([^)]+\)/g,/!\[\[[^\]]+\]\]/g,/\[\[[^\]|]+\|[^\]]+\]\]/g,/\[\[[^\]]+\]\]/g,/#[a-zA-Z0-9_\-/]+/g,/^[-*+]\s*\[[ xX]\]\s+/gm,/^(\d+\.\s*)\[[ xX]\]\s+/gm,/^(\d+\)\s*)\[[ xX]\]\s+/gm,/^[-*+]\s+/gm,/^#{1,6}\s+.+$/gm,/^\s*(?:[-_*])\s*(?:[-_*])\s*(?:[-_*])[\s\-_*]*$/gm,/^\s*\|.*\|.*$/gm,/\^\[[^\]]*?]/g,/\[\^[^\]]+]/g,/^\s*\[\^[^\]]+]:.*$/gm,/<([a-z][a-z0-9]*)\b[^>]*>(.*?)<\/\1>/gi,/<[^>]+>/g];function Ze(n){let i=new Map,e=0;return{text:n.replace(/\\(.)/g,(t,a)=>{let r=`\xA7\xA7ESCAPED${e}\xA7\xA7`;return i.set(r,a),e++,r}),map:i}}function Ke(n,i){let e=n;return i.forEach((s,t)=>{e=e.split(t).join(s)}),e}function Qe(n){let i=n,e=!0;for(;e;){e=!1;let s=i.match(/^([`~]{3,})/m);if(!s)break;let t=s[1][0],a=s[1].length,r=s.index,o=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=new RegExp(`^${o}{${a}}\\s*$`,"m"),d=i.substring(r+s[1].length).match(l);if(d){let h=r+s[1].length+d.index+d[0].length;i=i.substring(0,r)+i.substring(h),e=!0}else{let f=i.indexOf(`
`,r);f===-1?i=i.substring(0,r):i=i.substring(0,r)+i.substring(f+1),e=!0}}return i}function Xe(n){if(!n||n.trim().length===0)return"";n=n.replace(/^>\s*\[![\w-]+\][+-]?.*$/gm,""),n=n.replace(/^>\s?/gm,"");let{text:i,map:e}=Ze(n),s=Qe(i);return Ye.forEach(t=>{s=s.replace(t,(a,...r)=>{if(a.match(/<[a-z][a-z0-9]*\b[^>]*>.*?<\//i))return r[1]||"";if(r.length>0&&r[0]!==void 0){for(let o=0;o<r.length-2;o++)if(typeof r[o]=="string")return r[o]}return""})}),s=Ke(s,e),s}function Je(n,i=!1,e,s){let t=n.replace(/^---[\s\S]*?---/,"").trim(),a=Xe(t),r=a.indexOf(`
`),o=(r!==-1?a.substring(0,r):a).trim();(i||e&&o===e||s&&o===s)&&(a=r!==-1?a.substring(r+1).trim():"");let l=a.replace(/\^[a-zA-Z0-9-]+/g,"").split(/\s+/).filter(f=>f).join(" ").trim().replace(/\.{2,}/g,f=>f.replace(/\./g,"\u2024")),c=l.length>500,d=l.substring(0,500);return c&&(d+="\u2026"),d}async function Ee(n,i,e,s,t,a){if(e!=null&&(typeof e=="string"||typeof e=="number")&&String(e).trim().length>0)return String(e).trim();if(s.fallbackToContent){let o=await i.vault.cachedRead(n);return Je(o,s.omitFirstLine,t,a)}return""}var Z={minimal:{maxWidth:100,maxHeight:100,quality:.6},small:{maxWidth:200,maxHeight:200,quality:.7},balanced:{maxWidth:400,maxHeight:400,quality:.8},large:{maxWidth:800,maxHeight:800,quality:.9},unlimited:{maxWidth:1/0,maxHeight:1/0,quality:1}};function Se(n,i,e){if(e==="unlimited")return Z.unlimited;let s=Z[e];if(i==="cover"){let t=Math.ceil(n*2);return{maxWidth:Math.min(t,s.maxWidth),maxHeight:Math.min(t,s.maxHeight),quality:s.quality}}if(i==="thumbnail"){let a=n/250,r=Math.ceil(80*a*2);return{maxWidth:Math.min(r,s.maxWidth),maxHeight:Math.min(r,s.maxHeight),quality:s.quality}}return s}async function xe(n,i,e,s){try{if(e==="unlimited"&&!s)return i.vault.getResourcePath(n);let t=s||Z[e],a=await i.vault.readBinary(n),r=new Blob([a]),o=URL.createObjectURL(r);return new Promise((l,c)=>{let d=new Image;d.onload=()=>{try{let f=d.width,h=d.height;if(f>t.maxWidth||h>t.maxHeight){let m=f/h;f>h?(f=Math.min(f,t.maxWidth),h=f/m):(h=Math.min(h,t.maxHeight),f=h*m)}let p=document.createElement("canvas");p.width=f,p.height=h;let u=p.getContext("2d");if(!u){URL.revokeObjectURL(o),l(null);return}u.drawImage(d,0,0,f,h);let g=p.toDataURL("image/jpeg",t.quality);URL.revokeObjectURL(o),l(g)}catch(f){URL.revokeObjectURL(o),c(f)}},d.onerror=()=>{URL.revokeObjectURL(o),l(null)},d.src=o})}catch(t){return console.error(`Failed to generate thumbnail for ${n.path}:`,t),null}}async function Ce(n,i,e){try{if(i==="unlimited"&&!e)return n;let s=e||Z[i];return new Promise((t,a)=>{let r=new Image;r.crossOrigin="anonymous",r.onload=()=>{try{let o=r.width,l=r.height;if(o>s.maxWidth||l>s.maxHeight){let h=o/l;o>l?(o=Math.min(o,s.maxWidth),l=o/h):(l=Math.min(l,s.maxHeight),o=l*h)}let c=document.createElement("canvas");c.width=o,c.height=l;let d=c.getContext("2d");if(!d){t(null);return}d.drawImage(r,0,0,o,l);let f=c.toDataURL("image/jpeg",s.quality);t(f)}catch(o){a(o)}},r.onerror=()=>{t(null)},r.src=n})}catch(s){return console.error(`Failed to generate thumbnail from URL ${n}:`,s),null}}async function le(n,i,e,s,t,a="balanced",r,o){for(let l of n)if(!(l.path in s))try{let{internalPaths:c,externalUrls:d}=we(l.imagePropertyValues),f=[],h=["avif","bmp","gif","jpeg","jpg","png","svg","webp"];for(let b of c){let T=e.metadataCache.getFirstLinkpathDest(b,l.path);T&&h.includes(T.extension)&&f.push(T)}let p=[],u=r!==void 0&&o!==void 0?Se(r,o,a):void 0;for(let b of f)p.push(xe(b,e,a,u));for(let b of d)p.push(Ce(b,a,u));let m=(await Promise.all(p)).filter(b=>b!==null);m.length>0?(s[l.path]=m.length>1?m:m[0],t[l.path]=!0):i&&(t[l.path]=!1)}catch(c){console.error(`Failed to load image for ${l.path}:`,c)}}async function Pe(n,i,e,s){await Promise.all(n.map(async t=>{if(!(t.path in e||s[t.path]))try{let a=await Te(t.file,i);a.length>0&&(e[t.path]=a.length>1?a:a[0],s[t.path]=!0)}catch(a){console.error(`Failed to load embed images for ${t.path}:`,a)}}))}async function ke(n,i,e,s,t){await Promise.all(n.map(async a=>{if(!(a.path in t))try{a.file.extension==="md"?t[a.path]=await Ee(a.file,s,a.descriptionData,{fallbackToContent:i,omitFirstLine:e},a.fileName,a.titleString):t[a.path]=""}catch(r){console.error(`Failed to load snippet for ${a.path}:`,r),t[a.path]=""}}))}var j=require("obsidian");var K=class{constructor(i,e,s,t,a,r){this.app=i;this.plugin=e;this.propertyObservers=s;this.updateLayoutRef=t;this.basesConfig=a,this.basesController=r}renderCard(i,e,s,t,a,r,o,l){let c=i.createDiv("card bases-cms-card");t.imageFormat==="cover"?c.classList.add("image-format-cover"):t.imageFormat==="thumbnail"&&c.classList.add("image-format-thumbnail"),c.setAttribute("data-path",e.path),c.setAttribute("data-href",e.path),c.style.cursor="pointer";let d=c.createDiv("bases-cms-select-checkbox"),f=d.createEl("input",{type:"checkbox",cls:"selection-checkbox"});if(f.checked=r,f.addEventListener("change",h=>{h.stopPropagation(),h.stopImmediatePropagation(),o(e.path,f.checked)}),f.addEventListener("click",h=>{h.stopPropagation(),h.stopImmediatePropagation()}),t.showDraftStatus&&t.draftStatusProperty&&t.imageFormat!=="cover"){let h=D(s,t.draftStatusProperty);if(h){let p=h;if(p&&"data"in p&&typeof p.data=="boolean"){let u=p.data,g=t.draftStatusReverse?!u:u,m=c.createDiv("card-status-badge");g?(m.addClass("status-draft"),m.appendText("Draft")):(m.addClass("status-published"),m.appendText("Published")),l&&(m.style.cursor="pointer",m.addEventListener("click",async b=>{b.stopPropagation();let T=!u,v=t.draftStatusProperty.startsWith("note.")?t.draftStatusProperty.substring(5):t.draftStatusProperty;await l(e.path,v,T)}))}}}if(c.addEventListener("click",h=>{let p=h.target;if(d.contains(p)||p.tagName==="INPUT"||p.closest("input")||p.closest(".bases-cms-property")||p.closest(".card-status-badge"))return;let u=h.metaKey||h.ctrlKey;this.app.workspace.openLinkText(e.path,"",u)}),c.addEventListener("contextmenu",h=>{let p=h.target;if(d.contains(p)||p.tagName==="INPUT"||p.closest("input")||p.closest(".bases-cms-property")||p.closest(".card-status-badge"))return;let u=this.app.vault.getAbstractFileByPath(e.path);if(u&&u instanceof j.TFile){h.stopPropagation();let g=new j.Menu;this.app.workspace.trigger("file-menu",g,u,"bases"),g.showAtMouseEvent(h)}}),t.showTitle&&c.createDiv("card-title").appendText(e.title),t.showDate&&t.dateProperty){let h=D(s,t.dateProperty);if(h){let p=h,u="";if(p&&"date"in p&&p.date instanceof Date)u=p.date.toLocaleDateString();else if(p&&"data"in p&&p.data){let g=p.data;if(g instanceof Date)u=g.toLocaleDateString();else if(typeof g=="string"||typeof g=="number"){let m=new Date(g);isNaN(m.getTime())?u=String(g):u=m.toLocaleDateString()}}u&&c.createDiv("card-date").appendText(u)}}if(t.showTextPreview&&e.snippet||t.showTags&&e.displayTags&&e.displayTags.length>0||t.imageFormat!=="none"&&(e.imageUrl||e.hasImageAvailable)||t.imageFormat==="cover"){let h=c.createDiv("card-content");if(t.imageFormat==="thumbnail"){let p=h.createDiv("card-text-wrapper");if(t.showTextPreview&&e.snippet&&p.createDiv({cls:"card-text-preview",text:e.snippet}),t.showTags&&e.displayTags&&e.displayTags.length>0){let u=p.createDiv("card-tags"),g=t.maxTagsToShow,m=e.displayTags.slice(0,g),b=e.displayTags.length-g;m.forEach(T=>{u.createSpan("card-tag").appendText(T)}),b>0&&u.createSpan("card-tag-more").appendText(`+${b} more`)}}else{if(t.showTextPreview){let p=h.createDiv("card-text-preview");e.snippet&&p.setText(e.snippet),c.__textPreviewEl=p,c.__cardPath=e.path}if(t.showTags&&e.displayTags&&e.displayTags.length>0){let p=h.createDiv("card-tags"),u=t.maxTagsToShow,g=e.displayTags.slice(0,u),m=e.displayTags.length-u;g.forEach(b=>{p.createSpan("card-tag").appendText(b)}),m>0&&p.createSpan("card-tag-more").appendText(`+${m} more`)}}if(t.imageFormat!=="none"&&e.imageUrl){let u=(Array.isArray(e.imageUrl)?e.imageUrl:[e.imageUrl]).filter(b=>b&&typeof b=="string"&&b.trim().length>0),g=t.imageFormat==="cover"?"card-cover":"card-thumbnail",m=h.createDiv(g);if(t.showDraftStatus&&t.draftStatusProperty&&t.imageFormat==="cover"){let b=D(s,t.draftStatusProperty);if(b){let T=b;if(T&&"data"in T&&typeof T.data=="boolean"){let v=T.data,E=t.draftStatusReverse?!v:v,P=m.createDiv("card-status-badge");E?(P.addClass("status-draft"),P.appendText("Draft")):(P.addClass("status-published"),P.appendText("Published")),l&&(P.style.cursor="pointer",P.addEventListener("click",async x=>{x.stopPropagation();let w=!v,S=t.draftStatusProperty.startsWith("note.")?t.draftStatusProperty.substring(5):t.draftStatusProperty;await l(e.path,S,w)}))}}}if(u.length>0){let b=m.createDiv("image-embed"),T=b.createEl("img",{attr:{alt:"",decoding:"async",sizes:t.imageFormat==="cover"?"100vw":"80px"}});return b.style.setProperty("--cover-image-url",`url("${u[0]}")`),this.renderProperties(c,e,s,t,l),{img:T,src:u[0]}}}else if(t.imageFormat==="cover"){let p=h.createDiv("card-cover-placeholder");if(t.showDraftStatus&&t.draftStatusProperty){let u=D(s,t.draftStatusProperty);if(u){let g=u;if(g&&"data"in g&&typeof g.data=="boolean"){let m=g.data,b=t.draftStatusReverse?!m:m,T=p.createDiv("card-status-badge");b?(T.addClass("status-draft"),T.appendText("Draft")):(T.addClass("status-published"),T.appendText("Published")),l&&(T.style.cursor="pointer",T.addEventListener("click",async v=>{v.stopPropagation();let E=!m,P=t.draftStatusProperty.startsWith("note.")?t.draftStatusProperty.substring(5):t.draftStatusProperty;await l(e.path,P,E)}))}}}}}return this.renderProperties(c,e,s,t,l),null}renderProperties(i,e,s,t,a){let r=[t.propertyDisplay1,t.propertyDisplay2,t.propertyDisplay3,t.propertyDisplay4],o=new Set,l=r.map(p=>!p||p===""||o.has(p)?"":(o.add(p),p)),c=l.map(p=>p?U(p,s,e,t):null),d=l[0]!==""||l[1]!=="",f=l[2]!==""||l[3]!=="";if(!d&&!f)return;let h=i.createDiv("card-properties properties-4field");if(d){let p=h.createDiv("property-row property-row-1");t.propertyLayout12SideBySide&&p.addClass("property-row-side-by-side");let u=p.createDiv("property-field property-field-1");l[0]&&this.renderPropertyContent(u,l[0],c[0],e,s,t,a);let g=p.createDiv("property-field property-field-2");l[1]&&this.renderPropertyContent(g,l[1],c[1],e,s,t,a)}if(f){let p=h.createDiv("property-row property-row-2");t.propertyLayout34SideBySide&&p.addClass("property-row-side-by-side");let u=p.createDiv("property-field property-field-3");l[2]&&this.renderPropertyContent(u,l[2],c[2],e,s,t,a);let g=p.createDiv("property-field property-field-4");l[3]&&this.renderPropertyContent(g,l[3],c[3],e,s,t,a)}}renderPropertyContent(i,e,s,t,a,r,o){if(e===""||!s&&r.propertyLabels==="hide"||r.propertyLabels==="hide"&&((e==="tags"||e==="note.tags")&&t.yamlTags.length===0||(e==="file.tags"||e==="file tags")&&t.tags.length===0||(e==="file.path"||e==="path"||e==="file path")&&t.folderPath.length===0))return;let l=me(e,this.app,this.basesConfig,this.basesController),c=l.toLowerCase()!==e.toLowerCase();if(r.propertyLabels==="above"){let h=i.createDiv("property-label");c&&h.addClass("property-label-custom"),h.textContent=l}let d=i.createDiv("property-content");if(r.propertyLabels==="inline"){let h=d.createSpan("property-label-inline");h.textContent=l+": "}if(!s){d.appendText("\u2026");return}if(e==="file.mtime"||e==="file.ctime"||e==="modified time"||e==="created time")d.createSpan().appendText(s);else if((e==="tags"||e==="note.tags")&&t.yamlTags.length>0){let h=d.createDiv("tags-wrapper");t.yamlTags.forEach(p=>{h.createEl("a",{cls:"tag",text:p,href:"#"}).addEventListener("click",g=>{var b,T,v;g.preventDefault();let m=(T=(b=this.app.internalPlugins)==null?void 0:b.plugins)==null?void 0:T["global-search"];(v=m==null?void 0:m.instance)!=null&&v.openGlobalSearch&&m.instance.openGlobalSearch("tag:"+p)})})}else if((e==="file.tags"||e==="file tags")&&t.tags.length>0){let h=d.createDiv("tags-wrapper");t.tags.forEach(p=>{h.createEl("a",{cls:"tag",text:p,href:"#"}).addEventListener("click",g=>{var b,T,v;g.preventDefault();let m=(T=(b=this.app.internalPlugins)==null?void 0:b.plugins)==null?void 0:T["global-search"];(v=m==null?void 0:m.instance)!=null&&v.openGlobalSearch&&m.instance.openGlobalSearch("tag:"+p)})})}else if((e==="file.path"||e==="path"||e==="file path")&&t.path.length>0){let h=d.createDiv("path-wrapper"),p=t.path.split("/").filter(u=>u);p.forEach((u,g)=>{let m=h.createSpan(),b=g===p.length-1,T=b?"path-segment filename-segment":"path-segment file-path-segment";m.createSpan({cls:T,text:u}).addEventListener("click",E=>{if(E.stopPropagation(),b){let P=this.app.vault.getAbstractFileByPath(t.path);P instanceof j.TFile&&this.app.workspace.getLeaf(!1).openFile(P)}}),g<p.length-1&&m.createSpan({cls:"path-separator",text:"/"})})}else{let h=this.app.metadataCache,u=((typeof h.getAllPropertyInfos=="function"?h.getAllPropertyInfos():{})||{})[e.toLowerCase()],g=a.getValue(e);if(((u==null?void 0:u.widget)==="checkbox"||g&&"data"in g&&typeof g.data=="boolean")&&o){let b=d.createEl("input",{type:"checkbox",cls:"checkbox-input"});b.checked=g&&"data"in g?Boolean(g.data):!1;let T=e.startsWith("note.")?e.substring(5):e;d.createSpan({cls:"checkbox-label",text:T}),b.addEventListener("click",v=>{v.stopPropagation()}),b.addEventListener("change",async v=>{v.stopPropagation();try{let E=e.startsWith("note.")?e.substring(5):e;await o(t.path,E,b.checked)}catch(E){console.error("Error toggling property:",E),b.checked=!b.checked}})}else d.createDiv("text-wrapper").appendText(s)}(!d.textContent||d.textContent.trim().length===0)&&d.remove()}};var Oe=require("obsidian");var B=require("obsidian");async function ce(n,i,e,s){await n.fileManager.processFrontMatter(i,t=>{for(let[a,r]of e){if(a==="tags"&&!t.hasOwnProperty("tags")&&!Array.isArray(r.data)){t[a]=[r.data];continue}if(!t[a]||s){t[a]=r.data;continue}let o=r.type,l=t[a],c=Array.isArray(l)?"list":typeof l=="number"?"number":typeof l=="boolean"?"checkbox":"text";if(et(o,c)){if(t[a]===r.data||!r.data)continue;let d=tt(t[a],r.data);t[a]=d;continue}else{t[a]=r.data;continue}}})}async function De(n,i,e){await n.fileManager.processFrontMatter(i,s=>{for(let t of e)s[t]=void 0})}function et(n,i){let e=["number","date","datetime","checkbox"];return!(e.includes(n)||e.includes(i))}function tt(...n){let e=n.map(t=>Array.isArray(t)?t:[t]).flat();return[...new Set(e)]}var A=class{constructor(i){this.app=i}async setDraft(i,e){await this.batchProcessFiles(i,async s=>{await this.app.fileManager.processFrontMatter(s,t=>{t.draft=e})}),new B.Notice(`Set ${i.length} file${i.length!==1?"s":""} to ${e?"draft":"published"}`)}async addTags(i,e){let s=new Map;s.set("tags",{type:"tags",data:e,overwrite:!1,delimiter:","}),await this.batchProcessFiles(i,async t=>{await ce(this.app,t,s,!1)}),new B.Notice(`Added tags to ${i.length} file${i.length!==1?"s":""}`)}async removeTags(i,e){await this.batchProcessFiles(i,async s=>{let t=this.app.metadataCache.getFileCache(s),a=t==null?void 0:t.frontmatter;if(a!=null&&a.tags){let o=(Array.isArray(a.tags)?a.tags:[a.tags]).filter(l=>!e.includes(l));await this.app.fileManager.processFrontMatter(s,l=>{o.length>0?l.tags=o:l.tags=void 0})}}),new B.Notice(`Removed tags from ${i.length} file${i.length!==1?"s":""}`)}async setProperty(i,e,s,t="text"){let a=e.startsWith("note.")?e.substring(5):e,r=new Map;r.set(a,{type:t,data:s,overwrite:!0,delimiter:","}),await this.batchProcessFiles(i,async o=>{await ce(this.app,o,r,!0)}),new B.Notice(`Set ${a} on ${i.length} file${i.length!==1?"s":""}`)}async removeProperty(i,e){let s=e.startsWith("note.")?e.substring(5):e;await this.batchProcessFiles(i,async t=>{await De(this.app,t,[s])}),new B.Notice(`Removed ${s} from ${i.length} file${i.length!==1?"s":""}`)}async batchProcessFiles(i,e){let s=0,t=i.length;for(let a of i){let r=this.app.vault.getAbstractFileByPath(a);if(r instanceof B.TFile)try{await e(r),s++}catch(o){console.error(`Error processing ${a}:`,o)}}s<t&&new B.Notice(`Processed ${s} of ${t} files`)}};var z=require("obsidian");var Q=class extends z.Modal{constructor(e,s){super(e);this.tagsToAdd="";this.tagsToRemove=new Set;this.files=s,this.bulkOps=new A(e)}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Manage Tags"}),e.createEl("p",{text:`Managing tags for ${this.files.length} file${this.files.length!==1?"s":""}`}),new z.Setting(e).setName("Add tags").setDesc("Enter tags to add (comma-separated)").addText(l=>{l.setPlaceholder("tag1, tag2, tag3").onChange(c=>{this.tagsToAdd=c})}),e.createEl("h3",{text:"Remove tags"});let s=e.createDiv(),t=new Set;for(let l of this.files){let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof z.TFile){let d=this.app.metadataCache.getFileCache(c),f=d==null?void 0:d.frontmatter;f!=null&&f.tags&&(Array.isArray(f.tags)?f.tags:[f.tags]).forEach(p=>t.add(p))}}for(let l of Array.from(t).sort())new z.Setting(s).setName(l).addToggle(c=>{c.setValue(this.tagsToRemove.has(l)).onChange(d=>{d?this.tagsToRemove.add(l):this.tagsToRemove.delete(l)})});let a=e.createDiv();a.style.display="flex",a.style.gap="0.5rem",a.style.justifyContent="flex-end",a.style.marginTop="1rem";let r=a.createEl("button");r.setText("Cancel"),r.addEventListener("click",()=>this.close());let o=a.createEl("button");o.setText("Apply"),o.addClass("mod-cta"),o.addEventListener("click",async()=>{await this.applyChanges(),this.close()})}async applyChanges(){if(this.tagsToAdd.trim()){let e=this.tagsToAdd.split(",").map(s=>s.trim()).filter(s=>s.length>0);e.length>0&&await this.bulkOps.addTags(this.files,e)}this.tagsToRemove.size>0&&await this.bulkOps.removeTags(this.files,Array.from(this.tagsToRemove))}onClose(){let{contentEl:e}=this;e.empty()}};var N=require("obsidian");var X=class extends N.Modal{constructor(e,s){super(e);this.propertyName="";this.propertyValue="";this.propertyType="text";this.files=s,this.bulkOps=new A(e)}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Set Property"}),e.createEl("p",{text:`Setting property on ${this.files.length} file${this.files.length!==1?"s":""}`}),new N.Setting(e).setName("Property name").setDesc("Enter the property name to set").addText(r=>{r.setPlaceholder("e.g., status, category, priority").onChange(o=>{this.propertyName=o})}),new N.Setting(e).setName("Property type").setDesc("Select the property type").addDropdown(r=>{r.addOption("text","Text").addOption("number","Number").addOption("checkbox","Checkbox").addOption("date","Date").setValue(this.propertyType).onChange(o=>{this.propertyType=o})}),new N.Setting(e).setName("Property value").setDesc("Enter the property value").addText(r=>{r.setPlaceholder("Enter value").onChange(o=>{this.propertyValue=o})});let s=e.createDiv();s.style.display="flex",s.style.gap="0.5rem",s.style.justifyContent="flex-end",s.style.marginTop="1rem";let t=s.createEl("button");t.setText("Cancel"),t.addEventListener("click",()=>this.close());let a=s.createEl("button");a.setText("Apply"),a.addClass("mod-cta"),a.addEventListener("click",async()=>{this.propertyName&&this.propertyValue&&(await this.applyChanges(),this.close())})}async applyChanges(){let e=this.propertyValue;this.propertyType==="number"?e=Number(this.propertyValue):this.propertyType==="checkbox"?e=this.propertyValue.toLowerCase()==="true"||this.propertyValue==="1":this.propertyType==="date"&&(e=this.propertyValue),await this.bulkOps.setProperty(this.files,this.propertyName,e,this.propertyType)}onClose(){let{contentEl:e}=this;e.empty()}};var H=require("obsidian");var J=class extends H.Modal{constructor(e,s){super(e);this.propertiesToRemove=new Set;this.files=s,this.bulkOps=new A(e)}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Remove Property"}),e.createEl("p",{text:`Removing properties from ${this.files.length} file${this.files.length!==1?"s":""}`});let s=new Set;for(let l of this.files){let c=this.app.vault.getAbstractFileByPath(l);if(c instanceof H.TFile){let d=this.app.metadataCache.getFileCache(c),f=d==null?void 0:d.frontmatter;if(f)for(let h in f)h!=="tags"&&h!=="title"&&s.add(h)}}let t=e.createDiv();for(let l of Array.from(s).sort())new H.Setting(t).setName(l).addToggle(c=>{c.setValue(this.propertiesToRemove.has(l)).onChange(d=>{d?this.propertiesToRemove.add(l):this.propertiesToRemove.delete(l)})});s.size===0&&e.createEl("p",{text:"No properties found in selected files."});let a=e.createDiv();a.style.display="flex",a.style.gap="0.5rem",a.style.justifyContent="flex-end",a.style.marginTop="1rem";let r=a.createEl("button");r.setText("Cancel"),r.addEventListener("click",()=>this.close());let o=a.createEl("button");o.setText("Apply"),o.addClass("mod-cta"),o.addEventListener("click",async()=>{this.propertiesToRemove.size>0&&(await this.applyChanges(),this.close())})}async applyChanges(){for(let e of this.propertiesToRemove)await this.bulkOps.removeProperty(this.files,e)}onClose(){let{contentEl:e}=this;e.empty()}};var Be=require("obsidian");var O=require("obsidian");var $=require("obsidian");function Fe(n,i){let e=[],s=n.vault.getAbstractFileByPath(i.path);if(s instanceof $.TFile){let t=n.metadataCache.getFileCache(s),a=(t==null?void 0:t.embeds)||[];for(let r of a){let o=n.metadataCache.getFirstLinkpathDest(r.link,i.path);o instanceof $.TFile&&e.push(o)}}return e}function Ae(n,i){let e=[];for(let s of i.children)s instanceof $.TFile&&s.extension==="md"?e.push(...Fe(n,s)):s instanceof $.TFolder&&e.push(...Ae(n,s));return e}async function st(n,i,e,s){let t=n.vault.getMarkdownFiles().filter(l=>l.path!==e.path),a=i.path,r=i.name,o=i.basename;for(let l of t){if(s&&l.path.startsWith(s.path+"/"))continue;let c=await n.vault.read(l);if(c.includes(a)||c.includes(r)||c.includes(o)||c.includes(`![[${r}]]`)||c.includes(`[[${r}]]`)||c.includes(`(${r})`)||c.includes(`(${a})`))return!0}return!1}async function Le(n,i,e){let s=[];s.push(...Fe(n,i)),e&&s.push(...Ae(n,e));let t=Array.from(new Set(s.map(r=>r.path))).map(r=>n.vault.getAbstractFileByPath(r)).filter(r=>r instanceof $.TFile),a=[];for(let r of t)await st(n,r,i,e)||a.push(r);return a}function it(n,i){let e=i.deleteParentFolderFilename||"index";return n.basename===e&&n.parent!==null}function Me(n,i){return i.deleteParentFolder&&it(n,i)}async function pe(n,i,e){let s=[],t=[],a=[];for(let l of i){let c=n.vault.getAbstractFileByPath(l);if(c instanceof O.TFile){if(Me(c,e)){let d=c.parent;if(d&&!t.includes(d)){t.push(d);let f=d.children.filter(h=>h instanceof O.TFile);s.push(...f)}}else s.push(c);if(e.deleteUniqueAttachments){let d=Me(c,e)&&c.parent||void 0,f=await Le(n,c,d);a.push(...f)}}}let r=Array.from(new Set(s.map(l=>l.path))).map(l=>n.vault.getAbstractFileByPath(l)).filter(l=>l instanceof O.TFile),o=Array.from(new Set(a.map(l=>l.path))).map(l=>n.vault.getAbstractFileByPath(l)).filter(l=>l instanceof O.TFile);return{filesToDelete:r,foldersToDelete:Array.from(new Set(t)),attachmentsToDelete:o}}async function ee(n,i){let e=0,s=0;for(let t of i.filesToDelete)try{await n.vault.delete(t),e++}catch(a){console.error(`Error deleting file ${t.path}:`,a),s++}for(let t of i.attachmentsToDelete)try{await n.vault.delete(t),e++}catch(a){console.error(`Error deleting attachment ${t.path}:`,a),s++}for(let t of i.foldersToDelete)try{await n.vault.delete(t,!0),e++}catch(a){console.error(`Error deleting folder ${t.path}:`,a),s++}s>0?new O.Notice(`Deleted ${e} items, ${s} errors occurred`):new O.Notice(`Successfully deleted ${e} item${e!==1?"s":""}`)}var te=class extends Be.Modal{constructor(e,s,t){super(e);this.preview=s,this.onConfirm=t}onOpen(){let{contentEl:e}=this;if(e.empty(),e.createEl("h2",{text:"Confirm Deletion"}),e.createEl("p",{text:"The following items will be deleted:",cls:"bases-cms-deletion-warning"}),this.preview.filesToDelete.length>0){e.createEl("h3",{text:`Files (${this.preview.filesToDelete.length})`});let r=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let o of this.preview.filesToDelete.slice(0,20))r.createEl("li").setText(o.path);this.preview.filesToDelete.length>20&&r.createEl("li",{text:`... and ${this.preview.filesToDelete.length-20} more files`})}if(this.preview.foldersToDelete.length>0){e.createEl("h3",{text:`Folders (${this.preview.foldersToDelete.length})`});let r=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let o of this.preview.foldersToDelete)r.createEl("li").setText(o.path)}if(this.preview.attachmentsToDelete.length>0){e.createEl("h3",{text:`Attachments (${this.preview.attachmentsToDelete.length})`});let r=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let o of this.preview.attachmentsToDelete.slice(0,20))r.createEl("li").setText(o.path);this.preview.attachmentsToDelete.length>20&&r.createEl("li",{text:`... and ${this.preview.attachmentsToDelete.length-20} more attachments`})}e.createEl("p",{text:"\u26A0\uFE0F This action cannot be undone!",cls:"bases-cms-deletion-warning"});let s=e.createDiv();s.style.display="flex",s.style.gap="0.5rem",s.style.justifyContent="flex-end",s.style.marginTop="1rem";let t=s.createEl("button");t.setText("Cancel"),t.addEventListener("click",()=>this.close());let a=s.createEl("button");a.setText("Delete"),a.addClass("mod-cta"),a.addClass("destructive"),a.addEventListener("click",async()=>{await ee(this.app,this.preview),this.onConfirm(),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var Ie=require("obsidian"),G=class extends Ie.Modal{constructor(e,s,t,a){super(e);this.files=s,this.operation=t,this.onConfirm=a}onOpen(){let{contentEl:e}=this;e.empty();let s=this.operation==="draft"?"mark as draft":"mark as published";if(e.createEl("h2",{text:`Confirm ${s.charAt(0).toUpperCase()+s.slice(1)}`}),e.createEl("p",{text:`Are you sure you want to ${s} ${this.files.length} file${this.files.length!==1?"s":""}?`}),this.files.length>0){let o=e.createEl("ul",{cls:"bases-cms-deletion-list"});for(let l of this.files.slice(0,20))o.createEl("li").setText(l);this.files.length>20&&o.createEl("li",{text:`... and ${this.files.length-20} more file${this.files.length-20!==1?"s":""}`})}let t=e.createDiv();t.style.display="flex",t.style.gap="0.5rem",t.style.justifyContent="flex-end",t.style.marginTop="1rem";let a=t.createEl("button");a.setText("Cancel"),a.addEventListener("click",()=>this.close());let r=t.createEl("button");r.setText("Confirm"),r.addClass("mod-cta"),r.addEventListener("click",()=>{this.onConfirm(),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var se=class{constructor(i,e,s,t,a,r,o){this.app=i;this.plugin=e;this.container=s;this.getSelectedFiles=t;this.clearSelection=a;this.refreshView=r;this.toolbarEl=null;this.countEl=null;this.resizeObserver=null;this.bulkOps=new A(i),this.selectAllCallback=o,this.createToolbar()}createToolbar(){this.toolbarEl=document.createElement("div"),this.toolbarEl.className="bases-toolbar bases-cms-bulk-toolbar",this.toolbarEl.style.display="none",this.toolbarEl.style.opacity="0",this.toolbarEl.style.transform="translateY(-10px)",this.toolbarEl.style.transition="opacity 0.2s ease, transform 0.2s ease",this.toolbarEl.__bulkToolbarInstance=this,this.createToolbarContent(),this.positionToolbar(),setTimeout(()=>this.positionToolbar(),100)}positionToolbar(){if(!this.toolbarEl)return;let i=this.container.closest(".bases-header");if(!i){let s=this.container.parentElement;for(;s&&!i;){if(s.classList.contains("bases-header")){i=s;break}s=s.parentElement}}if(!i){let s=Array.from(document.querySelectorAll(".bases-header"));for(let t of s)if(t.contains(this.container)){i=t;break}}let e=this.container.closest(".view-content");if(e)this.toolbarEl.parentElement!==e?(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container)):this.toolbarEl.nextSibling!==this.container&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),e.insertBefore(this.toolbarEl,this.container));else if(i&&i.parentElement)this.toolbarEl.parentElement!==i.parentElement&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),i.parentElement.insertBefore(this.toolbarEl,i.nextSibling));else{let s=this.container.parentElement;s&&(this.toolbarEl.parentElement!==s||this.toolbarEl.nextSibling!==this.container)&&(this.toolbarEl.parentElement&&this.toolbarEl.remove(),s.insertBefore(this.toolbarEl,this.container))}}createToolbarContent(){if(!this.toolbarEl)return;let i=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-left"),e=(a,r,o,l,c=!1)=>{let f=l.createDiv("bases-toolbar-item").createDiv("text-icon-button");c&&f.addClass("destructive"),f.setAttribute("tabindex","0");let h=f.createSpan("text-button-icon");return(0,Oe.setIcon)(h,a),f.createSpan("text-button-label").setText(r),f.addEventListener("click",o),f};e("copy-check","Select all",()=>this.handleSelectAll(),i),e("square-x","Clear",()=>this.clearSelection(),i);let s=i.createDiv("bases-toolbar-item bases-cms-selected-count");this.countEl=s.createSpan("text-button-label"),this.countEl.setText("0 items selected");let t=this.toolbarEl.createDiv("bases-cms-bulk-toolbar-right");e("pencil-line","Draft",()=>this.handleSetDraft(),t),e("book-check","Publish",()=>this.handlePublish(),t),e("tags","Tags",()=>this.handleManageTags(),t),e("list-check","Set",()=>this.handleSetProperty(),t),e("list-x","Remove",()=>this.handleRemoveProperty(),t),e("trash-2","Delete",()=>this.handleDelete(),t,!0),this.setupResponsiveBehavior()}setupResponsiveBehavior(){if(!this.toolbarEl)return;setTimeout(()=>{this.updateCollapsedState()},100),this.toolbarEl&&(this.resizeObserver=new ResizeObserver(()=>{this.updateCollapsedState()}),this.resizeObserver.observe(this.toolbarEl));let i=this.container;if(i){let e=new ResizeObserver(()=>{setTimeout(()=>{this.updateCollapsedState()},10)});e.observe(i),this.containerObserver=e}}updateCollapsedState(){if(!this.toolbarEl)return;this.toolbarEl.offsetWidth<680?this.toolbarEl.addClass("collapsed"):this.toolbarEl.removeClass("collapsed")}updateCount(i){this.countEl&&this.countEl.setText(`${i} item${i!==1?"s":""} selected`)}handleSelectAll(){this.selectAllCallback&&this.selectAllCallback()}show(){this.toolbarEl||(console.warn("[Bases CMS] Toolbar element not found, recreating..."),this.createToolbar()),this.toolbarEl?(this.positionToolbar(),this.toolbarEl.parentElement||(console.warn("[Bases CMS] Toolbar not in DOM, repositioning..."),this.positionToolbar()),this.toolbarEl.style.display="flex",this.toolbarEl.style.visibility="visible",this.toolbarEl.offsetHeight,setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.style.opacity="1",this.toolbarEl.style.transform="translateY(0)")},10)):console.error("[Bases CMS] Failed to show toolbar - element is null")}hide(){this.toolbarEl&&(this.toolbarEl.style.opacity="0",this.toolbarEl.style.transform="translateY(-10px)",setTimeout(()=>{this.toolbarEl&&(this.toolbarEl.style.display="none")},200))}async handleSetDraft(){let i=this.getSelectedFiles();i.length!==0&&(this.plugin.settings.confirmBulkOperations?new G(this.app,i,"draft",async()=>{await this.bulkOps.setDraft(i,!0),this.refreshView()}).open():(await this.bulkOps.setDraft(i,!0),this.refreshView()))}async handlePublish(){let i=this.getSelectedFiles();i.length!==0&&(this.plugin.settings.confirmBulkOperations?new G(this.app,i,"publish",async()=>{await this.bulkOps.setDraft(i,!1),this.refreshView()}).open():(await this.bulkOps.setDraft(i,!1),this.refreshView()))}async handleManageTags(){let i=this.getSelectedFiles();if(i.length===0)return;let e=new Q(this.app,i);e.onClose=()=>{this.show(),this.refreshView()},e.open()}async handleSetProperty(){let i=this.getSelectedFiles();if(i.length===0)return;let e=new X(this.app,i);e.onClose=()=>{this.show(),this.refreshView()},e.open()}async handleRemoveProperty(){let i=this.getSelectedFiles();if(i.length===0)return;let e=new J(this.app,i);e.onClose=()=>{this.show(),this.refreshView()},e.open()}async handleDelete(){let i=this.getSelectedFiles();if(i.length!==0)if(this.plugin.settings.confirmDeletions){let e=await pe(this.app,i,this.plugin.settings);new te(this.app,e,()=>{this.clearSelection(),this.refreshView()}).open()}else{let e=await pe(this.app,i,this.plugin.settings);await ee(this.app,e),this.clearSelection(),this.refreshView()}}destroy(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null);let i=this.containerObserver;i&&(i.disconnect(),this.containerObserver=null),this.toolbarEl&&(this.toolbarEl.remove(),this.toolbarEl=null)}};var W="bases-cms",ie=class extends q.BasesView{constructor(e,s,t){super(e);this.type=W;this.selectedFiles=new Set;this.snippets={};this.images={};this.hasImageAvailable={};this.updateLayoutRef={current:null};this.displayedCount=50;this.isLoading=!1;this.scrollListener=null;this.scrollThrottleTimeout=null;this.resizeObserver=null;this.propertyObservers=[];this.bulkToolbar=null;this.isRefreshingWithSelection=!1;this.viewTypeCheckInterval=null;this.lastActiveViewType=null;this.containerEl=s,this.plugin=t,this.cardRenderer=new K(this.app,this.plugin,this.propertyObservers,this.updateLayoutRef,void 0,e),this.containerEl.addClass("bases-cms"),this.containerEl.addClass("bases-cms-container"),this.containerEl.style.overflowY="auto",this.containerEl.style.overflowX="hidden",this.containerEl.style.height="100%";let a=this.app.isMobile;this.displayedCount=a?25:50,this.setupNewNoteInterceptor(),this.setupViewSwitchListener()}setupViewSwitchListener(){this.viewTypeCheckInterval=window.setInterval(()=>{var r;if(this.selectedFiles.size===0){this.lastActiveViewType=null;return}let e=this.app.workspace.activeLeaf;if(!e)return;let s=e.view;if(!s)return;let t=s==null?void 0:s.containerEl;if(!t||!t.contains(this.containerEl)){this.lastActiveViewType=null;return}let a=document.querySelector(".bases-view-selector")||((r=this.containerEl.closest(".bases-view"))==null?void 0:r.querySelector(".bases-view-selector"))||document.querySelector('[class*="view-selector"]');if(a){let o=a.querySelector("[data-view-type].is-active")||a.querySelector('[data-view-type][aria-selected="true"]')||a.querySelector("[data-view-type].mod-active")||a.querySelector('[data-view-type][class*="active"]');if(o){let l=o.getAttribute("data-view-type");if(this.lastActiveViewType===null){this.lastActiveViewType=l;return}this.lastActiveViewType===W&&l&&l!==W&&(this.selectedFiles.clear(),this.updateSelectionUI()),this.lastActiveViewType=l}}},200)}setupNewNoteInterceptor(){let e=async r=>{var p,u,g,m,b;let o=r.target,l=o.closest(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu");if(!l||o.closest(".bases-cms-bulk-toolbar, .bases-cms-container .card"))return;console.log("[CMS View] New button clicked!",l);let c=this.app.workspace.getLeavesOfType(W).find(T=>{let v=T.view;return v&&v.containerEl===this.containerEl}),d=this.app.workspace.activeLeaf;if(!(c&&d&&c===d)){console.log("[CMS View] Not our active view, skipping. Active leaf:",d,"Our leaf:",c);return}let h=V(this.config,this.plugin.settings);if(console.log("[CMS View] Settings:",{customizeNewButton:h.customizeNewButton,newNoteLocation:h.newNoteLocation}),h.customizeNewButton){r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation();let T=((p=h.newNoteLocation)==null?void 0:p.trim())||"";if(T===""){console.log("[CMS View] Using Obsidian default new note location");let v=((g=(u=this.app.vault)==null?void 0:u.getConfig)==null?void 0:g.call(u,"newFileLocation"))||"folder",E=((b=(m=this.app.vault)==null?void 0:m.getConfig)==null?void 0:b.call(m,"newFileFolderPath"))||"",P=v==="folder"&&E?E:"";if(P){let x=await this.app.vault.create(`${P}/Untitled.md`,"");await this.app.workspace.openLinkText(x.path,"",!1)}else{let x=await this.app.vault.create("Untitled.md","");await this.app.workspace.openLinkText(x.path,"",!1)}return}if(T==="/"){console.log("[CMS View] Creating note in vault root");try{let v=await this.app.vault.create("Untitled.md","");await this.app.workspace.openLinkText(v.path,"",!1)}catch(v){console.error("[CMS View] Error creating new note:",v)}return}console.log("[CMS View] Intercepting and creating note in:",T);try{let v=T.replace(/^\/+|\/+$/g,"");console.log("[CMS View] Folder path:",v);let E=this.app.vault.getAbstractFileByPath(v);if((!E||!("children"in E))&&(console.log("[CMS View] Folder does not exist, creating:",v),await this.app.vault.createFolder(v),E=this.app.vault.getAbstractFileByPath(v)),E&&"children"in E){let P=await this.app.vault.create(`${v}/Untitled.md`,"");console.log("[CMS View] Created new file:",P.path),await this.app.workspace.openLinkText(P.path,"",!1)}else console.error("[CMS View] Failed to create or access folder:",v)}catch(v){console.error("[CMS View] Error creating new note:",v)}}else console.log("[CMS View] Custom new button not enabled")},s=r=>{let o=r.target,l=o.closest(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu");if(!l||o.closest(".bases-cms-bulk-toolbar, .bases-cms-container .card"))return;let c=this.app.workspace.activeLeaf,d=c==null?void 0:c.view,f=c==null?void 0:c.containerEl;if(!(d&&(d.containerEl===this.containerEl||d===this||l.closest(".workspace-leaf")===f)))return;let p=V(this.config,this.plugin.settings);p.customizeNewButton&&(r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),(async()=>{var b,T,v;let u=((b=p.newNoteLocation)==null?void 0:b.trim())||"";if(u===""){let E=this.app.vault,P=((T=E.getConfig)==null?void 0:T.call(E,"newFileLocation"))||"folder",x=((v=E.getConfig)==null?void 0:v.call(E,"newFileFolderPath"))||"",w=P==="folder"&&x?x:"";if(w){let S=await this.app.vault.create(`${w}/Untitled.md`,"");await this.app.workspace.openLinkText(S.path,"",!1)}else{let S=await this.app.vault.create("Untitled.md","");await this.app.workspace.openLinkText(S.path,"",!1)}return}if(u==="/"){let E=await this.app.vault.create("Untitled.md","");await this.app.workspace.openLinkText(E.path,"",!1);return}let g=u.replace(/^\/+|\/+$/g,""),m=this.app.vault.getAbstractFileByPath(g);if((!m||!("children"in m))&&(await this.app.vault.createFolder(g),m=this.app.vault.getAbstractFileByPath(g)),m&&"children"in m){let E=await this.app.vault.create(`${g}/Untitled.md`,"");await this.app.workspace.openLinkText(E.path,"",!1)}})())};document.addEventListener("click",s,!0),new MutationObserver(()=>{document.querySelectorAll(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu").forEach(o=>{o.__cmsIntercepted||(o.__cmsIntercepted=!0,o.addEventListener("click",s,!0))})}).observe(document.body,{childList:!0,subtree:!0}),document.querySelectorAll(".bases-toolbar-new-item-menu .text-icon-button, .bases-toolbar-new-item-menu").forEach(r=>{r.__cmsIntercepted||(r.__cmsIntercepted=!0,r.addEventListener("click",s,!0))})}onDataUpdated(){if(!(this.containerEl&&this.containerEl.isConnected&&this.containerEl.offsetParent!==null)&&this.selectedFiles.size>0){this.selectedFiles.clear(),this.updateSelectionUI();return}(async()=>{var P;let s=this.data.groupedData,t=this.data.data;this.cardRenderer.basesConfig=this.config;let a=V(this.config,this.plugin.settings),r=this.containerEl.clientWidth,o=a.cardSize,l=1,c=8,d=Math.max(l,Math.floor((r+c)/(o+c))),f=(r-c*(d-1))/d;this.containerEl.style.setProperty("--card-min-width",`${f}px`),this.containerEl.style.setProperty("--grid-columns",String(d)),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(a.imageAspectRatio));let h=this.containerEl.scrollTop,p=this.getSortMethod(),u=s.map(x=>({group:x,entries:[...x.entries]})),g=[],m=this.displayedCount;for(let x of u){if(m<=0)break;let w=Math.min(x.entries.length,m);g.push(...x.entries.slice(0,w)),m-=w}if(a.imageFormat!=="none"){let x=t.filter(C=>!(C.file.path in this.images)).map(C=>{let y=this.app.vault.getAbstractFileByPath(C.file.path);if(!(y instanceof q.TFile))return null;let k=ge(C,a.imageProperty);return{path:C.file.path,file:y,imagePropertyValues:k}}).filter(C=>C!==null),w=x.filter(C=>g.some(y=>y.file.path===C.path)),S=x.filter(C=>!g.some(y=>y.file.path===C.path));if(w.length>0&&await le(w,a.fallbackToEmbeds,this.app,this.images,this.hasImageAvailable,a.thumbnailCacheSize,a.cardSize,a.imageFormat),S.length>0&&le(S,a.fallbackToEmbeds,this.app,this.images,this.hasImageAvailable,a.thumbnailCacheSize,a.cardSize,a.imageFormat),a.fallbackToEmbeds){let C=x.filter(y=>!(y.path in this.images)&&!this.hasImageAvailable[y.path]);C.length>0&&Pe(C,this.app,this.images,this.hasImageAvailable).then(()=>{C.forEach(y=>{var k;if(y.path in this.images){let L=this.containerEl.querySelector(`.card[data-path="${y.path}"]`);if(L){let R=this.images[y.path],M=Array.isArray(R)?R[0]:R;if(M){let _=L.querySelector("img");if(_){if(_.src!==M){_.src=M;let I=_.parentElement;I&&I.classList.contains("image-embed")&&I.style.setProperty("--cover-image-url",`url("${M}")`)}}else{let I=L.querySelector(".card-cover-placeholder, .card-thumbnail-placeholder");if(I){let $e=I.classList.contains("card-cover-placeholder")?"card-cover":"card-thumbnail",he=(k=I.parentElement)==null?void 0:k.createDiv($e);if(he){let de=he.createDiv("image-embed");_=de.createEl("img",{attr:{src:M,alt:"",decoding:"async"}}),de.style.setProperty("--cover-image-url",`url("${M}")`),I.remove()}}}}}}})})}}if(a.showTextPreview){let x=g.filter(w=>!(w.file.path in this.snippets)).map(w=>{let S=this.app.vault.getAbstractFileByPath(w.file.path);if(!(S instanceof q.TFile))return null;let C=D(w,a.descriptionProperty);return{path:w.file.path,file:S,descriptionData:C==null?void 0:C.data}}).filter(w=>w!==null);ke(x,a.fallbackToContent,!1,this.app,this.snippets).then(()=>{x.forEach(w=>{if(w.path in this.snippets&&this.snippets[w.path]){let S=this.containerEl.querySelector(`[data-path="${w.path}"]`);if(S){let C=S.__textPreviewEl;C&&!C.textContent&&C.setText(this.snippets[w.path])}}})})}let b=null;if(this.isRefreshingWithSelection&&this.bulkToolbar){let x=this.containerEl.querySelector(".bases-cms-bulk-toolbar");x&&(b=x,b.remove())}this.containerEl.empty(),this.propertyObservers.forEach(x=>x.disconnect()),this.propertyObservers=[];let T=this.containerEl.createDiv("bases-cms-grid"),v=0,E=[];for(let x of u){if(v>=this.displayedCount)break;let w=Math.min(x.entries.length,this.displayedCount-v);if(w===0)continue;let S=x.entries.slice(0,w),C=T.createDiv("bases-cms-group");if(x.group.hasKey()){let L=C.createDiv("bases-cms-group-heading").createDiv("bases-cms-group-value"),R=((P=x.group.key)==null?void 0:P.toString())||"";L.setText(R)}let y=ye(S,a,p,!1,this.snippets,this.images,this.hasImageAvailable);for(let k=0;k<y.length;k++){let L=y[k],R=S[k],M=this.renderCard(C,L,R,v+k,a);M&&E.push(M)}v+=w}E.length>0&&requestAnimationFrame(()=>{for(let{img:x,src:w}of E)x.src=w}),h>0&&(this.containerEl.scrollTop=h),this.setupInfiniteScroll(t.length),this.resizeObserver||(this.resizeObserver=new ResizeObserver(()=>{let x=this.containerEl.clientWidth,w=V(this.config,this.plugin.settings),S=w.cardSize,C=1,y=8,k=Math.max(C,Math.floor((x+y)/(S+y))),L=(x-y*(k-1))/k;this.containerEl.style.setProperty("--card-min-width",`${L}px`),this.containerEl.style.setProperty("--grid-columns",String(k)),this.containerEl.style.setProperty("--dynamic-views-image-aspect-ratio",String(w.imageAspectRatio))}),this.resizeObserver.observe(this.containerEl)),b&&this.bulkToolbar&&(this.containerEl.appendChild(b),this.bulkToolbar.toolbarEl=b),this.isRefreshingWithSelection?(this.containerEl.querySelectorAll(".card").forEach(w=>{let S=w.getAttribute("data-path"),C=w.querySelector('input[type="checkbox"].selection-checkbox');if(S){let y=this.selectedFiles.has(S);y?w.addClass("selected"):w.removeClass("selected"),C&&(C.checked=y)}}),b&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size))):this.updateSelectionUI(),this.isLoading=!1})()}renderCard(e,s,t,a,r){let o=this.selectedFiles.has(s.path);return this.cardRenderer.renderCard(e,s,t,r,this,o,(l,c)=>{this.handleSelectionChange(l,c)},(l,c,d)=>{this.handlePropertyToggle(l,c,d)})}getSortMethod(){let e=this.config.getSort();if(e&&e.length>0){let s=e[0],t=s.property,a=s.direction.toLowerCase();if(t.includes("ctime"))return`ctime-${a}`;if(t.includes("mtime"))return`mtime-${a}`}return"mtime-desc"}setupInfiniteScroll(e){this.scrollListener&&(this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),!(this.displayedCount>=e)&&(this.scrollListener=()=>{if(this.scrollThrottleTimeout!==null||this.isLoading)return;let s=this.containerEl.scrollTop,t=this.containerEl.scrollHeight,a=this.containerEl.clientHeight,r=t-(s+a),l=this.app.isMobile?1:2,c=a*l;if(r<c&&this.displayedCount<e){this.isLoading=!0;let d=50;this.displayedCount=Math.min(this.displayedCount+d,e),this.onDataUpdated()}this.scrollThrottleTimeout=window.setTimeout(()=>{this.scrollThrottleTimeout=null},100)},this.containerEl.addEventListener("scroll",this.scrollListener),this.register(()=>{this.scrollListener&&this.containerEl.removeEventListener("scroll",this.scrollListener),this.scrollThrottleTimeout!==null&&window.clearTimeout(this.scrollThrottleTimeout)}))}handleSelectionChange(e,s){s?this.selectedFiles.add(e):this.selectedFiles.delete(e),this.updateSelectionUI()}async handlePropertyToggle(e,s,t){try{let a=this.app.vault.getAbstractFileByPath(e);if(!(a instanceof q.TFile))return;let r=s.startsWith("note.")?s.substring(5):s;await this.app.fileManager.processFrontMatter(a,o=>{o[r]=t}),requestAnimationFrame(()=>{setTimeout(()=>{try{this.onDataUpdated()}catch(o){console.error("Error refreshing view after property toggle:",o)}},100)})}catch(a){console.error("Error toggling property:",a)}}selectAll(){this.containerEl.querySelectorAll(".bases-cms-card").forEach(s=>{let t=s.getAttribute("data-path");t&&this.selectedFiles.add(t)}),this.updateSelectionUI()}deselectAll(){this.selectedFiles.clear(),this.updateSelectionUI()}updateSelectionUI(){this.containerEl.querySelectorAll(".card").forEach(s=>{let t=s.getAttribute("data-path"),a=s.querySelector('input[type="checkbox"].selection-checkbox');if(t){let r=this.selectedFiles.has(t);r?s.addClass("selected"):s.removeClass("selected"),a&&(a.checked=r)}}),this.selectedFiles.size>0?(document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(t=>{let a=t.__bulkToolbarInstance;(!a||a!==this.bulkToolbar)&&t.remove()}),this.bulkToolbar||(this.bulkToolbar=new se(this.app,this.plugin,this.containerEl,()=>Array.from(this.selectedFiles),()=>{this.selectedFiles.clear(),this.updateSelectionUI()},()=>{let t=Array.from(this.selectedFiles);this.isRefreshingWithSelection=!0,this.bulkToolbar&&t.length>0&&this.bulkToolbar.show(),this.onDataUpdated(),setTimeout(()=>{t.forEach(a=>{this.app.vault.getAbstractFileByPath(a)&&this.selectedFiles.add(a)}),this.isRefreshingWithSelection=!1,this.updateSelectionUI(),this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size)),setTimeout(()=>{this.selectedFiles.size>0&&this.bulkToolbar&&(this.bulkToolbar.show(),this.bulkToolbar.updateCount(this.selectedFiles.size))},100)},250)},()=>{this.selectAll()})),this.bulkToolbar.updateCount(this.selectedFiles.size),this.bulkToolbar.show()):this.bulkToolbar&&!this.isRefreshingWithSelection&&this.bulkToolbar.hide()}onClose(){this.resizeObserver&&this.resizeObserver.disconnect(),this.viewTypeCheckInterval!==null&&(window.clearInterval(this.viewTypeCheckInterval),this.viewTypeCheckInterval=null),this.propertyObservers.forEach(s=>s.disconnect()),this.propertyObservers=[],this.bulkToolbar&&this.bulkToolbar.destroy(),this.selectedFiles.clear(),document.querySelectorAll(".bases-cms-bulk-toolbar").forEach(s=>s.remove())}async onNew(){let e=V(this.config,this.plugin.settings);if(e.customizeNewButton&&e.newNoteLocation&&e.newNoteLocation.trim()!=="")try{let s=e.newNoteLocation.trim().replace(/^\/+|\/+$/g,""),t=this.app.vault.getAbstractFileByPath(s);if((!t||!("children"in t))&&(await this.app.vault.createFolder(s),t=this.app.vault.getAbstractFileByPath(s)),t&&"children"in t){let a=await this.app.vault.create(`${s}/Untitled.md`,"");return await this.app.workspace.openLinkText(a.path,"",!1),!0}}catch(s){console.error("[CMS View] Error creating new note:",s)}return!1}};var Ve={confirmBulkOperations:!0,deleteParentFolder:!1,deleteParentFolderFilename:"index",deleteUniqueAttachments:!1,confirmDeletions:!0,useHomeIcon:!1,thumbnailCacheSize:"balanced"};var ae=class extends ze.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new Y(this.app,this));try{this.registerBasesView(W,{name:"CMS",icon:this.settings.useHomeIcon?"lucide-home":"lucide-blocks",factory:(e,s)=>new ie(e,s,this),options:this.getCMSViewOptions()})}catch(e){console.log("Bases CMS: Base plugin not available")}}onunload(){}async loadSettings(){this.settings=Object.assign({},Ve,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}getCMSViewOptions(){let{getCMSViewOptions:e}=(re(),fe(be));return e}};
