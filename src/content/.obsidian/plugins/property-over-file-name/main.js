/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var M=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var H=Object.prototype.hasOwnProperty;var z=(u,h)=>()=>(u&&(h=u(u=0)),h);var U=(u,h)=>{for(var t in h)M(u,t,{get:h[t],enumerable:!0})},W=(u,h,t,e)=>{if(h&&typeof h=="object"||typeof h=="function")for(let i of B(h))!H.call(u,i)&&i!==t&&M(u,i,{get:()=>h[i],enumerable:!(e=$(h,i))||e.enumerable});return u};var j=u=>W(M({},"__esModule",{value:!0}),u);function x(u,h,t){let e=new Map;return u.forEach(i=>{let s=h.getFileCache(i),n=s==null?void 0:s.frontmatter,a=i.basename,o=!1,c=[];if(n&&n[t]!==void 0&&n[t]!==null){let l=String(n[t]).trim();l!==""&&(a=l,o=!0)}n!=null&&n.aliases&&(c=Array.isArray(n.aliases)?n.aliases:[n.aliases],c=c.map(l=>String(l).trim()).filter(l=>l!=="")),e.set(i.path,{file:i,displayName:a,aliases:c,lastModified:i.stat.mtime,isCustomDisplay:o})}),e}var L=z(()=>{"use strict"});var Q={};U(Q,{QuickSwitchModal:()=>O});var g,O,R=z(()=>{"use strict";g=require("obsidian");L();O=class extends g.FuzzySuggestModal{constructor(t,e){super(t);this.fileCache=new Map;this.recentFiles=[];this.searchTimeout=null;this.matchReasons=new Map;this.plugin=e,this.limit=8,this.plugin.settings.enableForQuickSwitcher?this.setPlaceholder("Type to search notes by title or file name..."):this.setPlaceholder("Type to search files..."),this.buildFileCache(),this.updateRecentFiles(),this.addKeyboardNavigation(),this.addFooter(),this.plugin.settings.enableForQuickSwitcher&&this.containerEl.addClass("property-over-filename-modal")}addKeyboardNavigation(){this.inputEl.addEventListener("keydown",t=>{t.key==="Escape"&&(this.close(),t.preventDefault(),t.stopPropagation())})}addFooter(){let t=this.containerEl.querySelector(".prompt");if(t){let e=t.createDiv({cls:"prompt-instructions"});[{command:"\u2191\u2193",action:"to navigate"},{command:"\u21B5",action:"to open"},{command:"ctrl \u21B5",action:"to open in new tab"},{command:"ctrl alt \u21B5",action:"to open to the right"},{command:"shift \u21B5",action:"to create"},{command:"esc",action:"to dismiss"}].forEach(({command:s,action:n})=>{let a=e.createDiv({cls:"prompt-instruction"});a.createSpan({cls:"prompt-instruction-command",text:s}),a.createSpan({text:n})})}}buildFileCache(){let t=this.getFilteredFiles();this.fileCache=x(t,this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=t.basename,n=!1,a=[];if(i&&i[this.plugin.settings.propertyKey]!==void 0&&i[this.plugin.settings.propertyKey]!==null){let o=String(i[this.plugin.settings.propertyKey]).trim();o!==""&&(s=o,n=!0)}i!=null&&i.aliases&&(a=Array.isArray(i.aliases)?i.aliases:[i.aliases],a=a.map(o=>String(o).trim()).filter(o=>o!=="")),this.fileCache.set(t.path,{file:t,displayName:s,aliases:a,lastModified:t.stat.mtime,isCustomDisplay:n})}updateRecentFiles(){var o,c;let t=[],e=this.app.workspace,i=this.getQuickSwitcherOptions(),s=(o=i==null?void 0:i.showAttachments)!=null?o:!0;(c=e.recentFileTracker)!=null&&c.getLastOpenFiles&&(t=e.recentFileTracker.getLastOpenFiles().map(r=>this.app.vault.getAbstractFileByPath(r)).filter(r=>r instanceof g.TFile)),t.length===0&&(t=[...this.app.workspace.getLeavesOfType("markdown").map(r=>r.view).filter(r=>r instanceof g.MarkdownView).map(r=>r.file).filter(r=>r!==null).filter((r,p,d)=>d.indexOf(r)===p)]),s||(t=t.filter(l=>l.extension==="md"));let n=8,a=new Set(t.map(l=>l.path));if(t.length<n)if(s){let r=this.app.vault.getFiles().filter(p=>p instanceof g.TFile).filter(p=>!a.has(p.path)).slice(0,n-t.length);t.push(...r)}else{let r=this.app.vault.getMarkdownFiles().filter(p=>!a.has(p.path)).slice(0,n-t.length);t.push(...r)}this.recentFiles=t.slice(0,n)}getItems(){return this.getFilteredFiles()}getFilteredFiles(){let t=this.getQuickSwitcherOptions(),e=this.app.vault.getMarkdownFiles();return t!=null&&t.showAttachments&&(e=this.app.vault.getFiles().filter(s=>s instanceof g.TFile).filter(s=>s.extension==="md"||this.isAttachment(s))),e}isAttachment(t){return["png","jpg","jpeg","gif","svg","webp","pdf","mp4","mp3","wav","ogg","webm"].includes(t.extension.toLowerCase())}getQuickSwitcherOptions(){var t;try{let e=this.app.internalPlugins;if(!e)return null;let i=(t=e.getPluginById)==null?void 0:t.call(e,"switcher");return!i||!i.instance?null:i.instance.options||null}catch(e){return console.warn("Property Over Filename: Could not access Quick Switcher options:",e),null}}getItemText(t){return"isNewNote"in t?t.newName:"isUnresolved"in t?t.unresolvedText:this.plugin.settings.enableForQuickSwitcher?this.getDisplayName(t):t.basename}getDisplayName(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=i==null?void 0:i[this.plugin.settings.propertyKey];if(s!=null){let n=String(s).trim();if(n!=="")return n}return t.basename}getSuggestions(t){var i;if(!this.plugin.settings.enableForQuickSwitcher){let s=t.trim();if(!s)return this.getRecentFilesResults();let n=this.getFilteredFiles(),a=this.plugin.settings.useSimpleSearch?(0,g.prepareSimpleSearch)(s):(0,g.prepareFuzzySearch)(s),o=[];for(let c of n){let l=(i=a(c.basename))!=null?i:{score:0,matches:[]};l.matches.length>0&&o.push({item:c,match:l})}if((0,g.sortSearchResults)(o),o.length===0){let c={isNewNote:!0,newName:s};o.push({item:c,match:{score:1e3,matches:[[0,s.length]]}})}return o.slice(0,this.limit)}let e=t.trim();return this.searchTimeout&&clearTimeout(this.searchTimeout),e?this.performSearch(e):this.getRecentFilesResults()}getRecentFilesResults(){return this.updateRecentFiles(),this.matchReasons.clear(),this.recentFiles.map(t=>({item:t,match:{score:1e3,matches:[]}}))}performSearch(t){var a;let e=this.plugin.settings.useSimpleSearch?(0,g.prepareSimpleSearch)(t):(0,g.prepareFuzzySearch)(t),i=[];this.matchReasons.clear();for(let o of this.fileCache.values()){let{file:c,displayName:l,aliases:r}=o,p=this.getItemText(c),d={matchedInTitle:!1,matchedInFilename:!1,matchedInAlias:!1},w=e(p),m=w,f=null;if(w&&w.matches.length>0)d.matchedInTitle=!0,f="title";else{if(this.plugin.settings.includeFilenameInSearch&&c.basename!==l){let S=e(c.basename);S&&S.matches.length>0&&(d.matchedInFilename=!0,m={...S,score:S.score-1},f="filename")}if(!f&&this.plugin.settings.includeAliasesInSearch&&r.length>0)for(let S of r){let v=e(S);if(v&&v.matches.length>0){d.matchedInAlias=!0,m={...v,score:v.score-1},f="alias";break}}}m&&m.matches.length>0&&(i.push({item:c,match:m}),this.matchReasons.set(c.path,d))}let s=this.getQuickSwitcherOptions(),n=(a=s==null?void 0:s.showExistingOnly)!=null?a:!1;if(!n){let{unresolvedLinks:o}=this.app.metadataCache,c=new Set;for(let l in o)Object.keys(o[l]).forEach(p=>c.add(p));for(let l of c){let r=e(l);if(r&&r.matches.length>0){let p={isUnresolved:!0,unresolvedText:l};i.push({item:p,match:r})}}}try{(0,g.sortSearchResults)(i);let o=i;n&&(o=i.filter(r=>r.item instanceof g.TFile||"isNewNote"in r.item&&r.item.isNewNote===!0));let c=t.toLowerCase(),l=o.some(r=>{var p;return r.item instanceof g.TFile&&(this.getDisplayName(r.item).toLowerCase()===c||this.plugin.settings.includeFilenameInSearch&&r.item.basename.toLowerCase()===c||this.plugin.settings.includeAliasesInSearch&&((p=this.fileCache.get(r.item.path))==null?void 0:p.aliases.some(d=>d.toLowerCase()===c)))});if(!n&&!l){let{unresolvedLinks:r}=this.app.metadataCache,p=new Set;for(let d in r)Object.keys(r[d]).forEach(m=>p.add(m));l=Array.from(p).some(d=>d.toLowerCase()===c)}if(!l&&t){let r={isNewNote:!0,newName:t};o.unshift({item:r,match:{score:1e3,matches:[[0,t.length]]}})}return o.slice(0,this.limit)}catch(o){return console.error("Error generating suggestions:",o),new g.Notice("Error updating quick switcher suggestions. Please check console for details."),[]}}renderSuggestion(t,e){let{item:i}=t;if("isUnresolved"in i&&i.isUnresolved){let n=i.unresolvedText;e.empty(),e.addClass("mod-complex"),e.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title"}).setText(n);let l=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":"Unresolved link - Enter to create"}});this.createFilePlusIcon(l);return}let s=this.getItemText(i);if("isNewNote"in i){e.empty(),e.addClass("mod-complex"),e.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title"}).setText(s),e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-action"}).setText("Enter to create");return}if(!this.plugin.settings.enableForQuickSwitcher)i instanceof g.TFile?e.setText(i.path.replace(".md","")):e.setText(s);else{if(!(i instanceof g.TFile)){e.setText(s);return}let n=this.matchReasons.get(i.path);if(n&&(n.matchedInTitle||n.matchedInFilename||n.matchedInAlias)){e.addClass("mod-complex");let o=e.createDiv({cls:"suggestion-content"});o.createDiv({cls:"suggestion-title"}).setText(s),i instanceof g.TFile&&o.createDiv({cls:"suggestion-note"}).setText(i.path.replace(".md",""));let r=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":this.getIconLabel(n)}});n.matchedInTitle?this.createTypeIcon(r):n.matchedInFilename?this.createFileIcon(r):n.matchedInAlias&&this.createForwardIcon(r)}else{e.addClass("mod-complex");let o=e.createDiv({cls:"suggestion-content"});o.createDiv({cls:"suggestion-title"}).setText(s),i instanceof g.TFile&&o.createDiv({cls:"suggestion-note"}).setText(i.path.replace(".md",""));let r=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":"Property-based title"}});i instanceof g.TFile&&this.getDisplayName(i)!==i.basename&&this.createTypeIcon(r)}}}getIconLabel(t){return t.matchedInTitle?"Title/Property Match":t.matchedInFilename?"File Name Match":t.matchedInAlias?"Alias Match":"Match"}createTypeIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-type");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","4 7 4 4 20 4 20 7"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","9"),s.setAttribute("y1","20"),s.setAttribute("x2","15"),s.setAttribute("y2","20"),e.appendChild(s);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","12"),n.setAttribute("y1","4"),n.setAttribute("x2","12"),n.setAttribute("y2","20"),e.appendChild(n),t.appendChild(e)}createFileIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-file-text");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","polyline");s.setAttribute("points","14,2 14,8 20,8"),e.appendChild(s);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","16"),n.setAttribute("y1","13"),n.setAttribute("x2","8"),n.setAttribute("y2","13"),e.appendChild(n);let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1","16"),a.setAttribute("y1","17"),a.setAttribute("x2","8"),a.setAttribute("y2","17"),e.appendChild(a);let o=document.createElementNS("http://www.w3.org/2000/svg","polyline");o.setAttribute("points","10,9 9,9 8,9"),e.appendChild(o),t.appendChild(e)}createForwardIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-forward");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","15 17 20 12 15 7"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M4 18v-2a4 4 0 0 1 4-4h12"),e.appendChild(s),t.appendChild(e)}createFilePlusIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-file-plus");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","polyline");s.setAttribute("points","14,2 14,8 20,8"),e.appendChild(s);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","12"),n.setAttribute("y1","18"),n.setAttribute("x2","12"),n.setAttribute("y2","12"),e.appendChild(n);let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1","9"),a.setAttribute("y1","15"),a.setAttribute("x2","15"),a.setAttribute("y2","15"),e.appendChild(a),t.appendChild(e)}isUsingCustomProperty(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=i==null?void 0:i[this.plugin.settings.propertyKey];return s!=null&&String(s).trim()!==""}isUsingAlias(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=i==null?void 0:i.aliases;return s?!this.isUsingCustomProperty(t)&&s:!1}onChooseItem(t,e){var i,s;if("isUnresolved"in t&&t.isUnresolved){let n=t.unresolvedText,a=this.app.workspace.getActiveViewOfType(g.MarkdownView),o=((i=a==null?void 0:a.file)==null?void 0:i.path)||"";this.app.workspace.openLinkText(n,o).catch(c=>{new g.Notice(`Error creating note: ${c.message}`)});return}if("isNewNote"in t){let n=this.app.workspace.getActiveViewOfType(g.MarkdownView),a=((s=n==null?void 0:n.file)==null?void 0:s.path)||"";this.app.workspace.openLinkText(t.newName,a).catch(o=>{new g.Notice(`Error creating note: ${o.message}`)})}else t instanceof g.TFile&&(e instanceof KeyboardEvent?e.ctrlKey&&e.altKey?this.app.workspace.getLeaf(!0).openFile(t):e.ctrlKey?this.app.workspace.getLeaf().openFile(t):e.shiftKey?this.app.workspace.getLeaf().openFile(t):this.app.workspace.getLeaf().openFile(t):this.app.workspace.getLeaf().openFile(t))}}});var q={};U(q,{default:()=>D});module.exports=j(q);var k=require("obsidian");var V={propertyKey:"title",enableForLinking:!0,enableForQuickSwitcher:!0,includeFilenameInSearch:!0,includeAliasesInSearch:!0,enableForDragDrop:!0,useSimpleSearch:!1};var y=require("obsidian");L();var T=class extends y.EditorSuggest{constructor(t){super(t.app);this.fileCache=new Map;this.searchTimeout=null;this.matchReasons=new Map;this.plugin=t,this.buildFileCache()}open(){super.open();let t=this.suggestEl;if(t&&(t.addClass("property-over-filename-suggestion"),!t.querySelector(".prompt-instructions"))){let e=t.createDiv({cls:"prompt-instructions"});e.createDiv({cls:"prompt-instruction"}).setText("Type # to link heading"),e.createDiv({cls:"prompt-instruction"}).setText("Type ^ to link blocks"),e.createDiv({cls:"prompt-instruction"}).setText("Type | to change display text")}this.addKeyboardNavigation()}addKeyboardNavigation(){let t=this.suggestEl;t&&t.addEventListener("keydown",e=>{e.key==="Escape"&&(this.close(),e.preventDefault(),e.stopPropagation())})}onTrigger(t,e,i){if(!this.plugin.settings.enableForLinking)return null;let s=e.getLine(t.line).substring(0,t.ch),n=/\[\[([^#^|\]]*)$/.exec(s);return n?{start:{line:t.line,ch:s.lastIndexOf("[[")},end:t,query:n[1]}:null}buildFileCache(){this.fileCache=x(this.app.vault.getMarkdownFiles(),this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=t.basename,n=!1,a=[];if(i&&i[this.plugin.settings.propertyKey]!==void 0&&i[this.plugin.settings.propertyKey]!==null){let o=String(i[this.plugin.settings.propertyKey]).trim();o!==""&&(s=o,n=!0)}i!=null&&i.aliases&&(a=Array.isArray(i.aliases)?i.aliases:[i.aliases],a=a.map(o=>String(o).trim()).filter(o=>o!=="")),this.fileCache.set(t.path,{file:t,displayName:s,aliases:a,lastModified:t.stat.mtime,isCustomDisplay:n})}getSuggestions(t){let e=t.query.trim();return this.performSearch(e)}performSearch(t){var o;if(!t||t.trim()===""){let c=[];for(let l of this.fileCache.values())c.push({file:l.file,display:l.displayName,isCustomDisplay:l.isCustomDisplay});return c}let e=this.plugin.settings.useSimpleSearch?(0,y.prepareSimpleSearch)(t):(0,y.prepareFuzzySearch)(t),i=[];this.matchReasons.clear();for(let c of this.fileCache.values()){let{file:l,displayName:r,aliases:p,isCustomDisplay:d}=c,w={matchedInTitle:!1,matchedInFilename:!1,matchedInAlias:!1},m=e(r),f=m,S=null;if(m&&m.matches.length>0)w.matchedInTitle=!0,S="title";else{if(this.plugin.settings.includeFilenameInSearch&&l.basename!==r){let v=e(l.basename);v&&v.matches.length>0&&(w.matchedInFilename=!0,f={...v,score:v.score-1},S="filename")}if(!S&&this.plugin.settings.includeAliasesInSearch&&p.length>0)for(let v of p){let A=e(v);if(A&&A.matches.length>0){w.matchedInAlias=!0,f={...A,score:A.score-1},S="alias";break}}}if(f&&f.matches.length>0){let v={file:l,display:r,isCustomDisplay:d};i.push({item:v,match:f}),this.matchReasons.set(l.path,w)}}let s=this.getQuickSwitcherOptions(),n=(o=s==null?void 0:s.showExistingOnly)!=null?o:!1;if(!n){let{unresolvedLinks:c}=this.app.metadataCache,l=new Set;for(let r in c)Object.keys(c[r]).forEach(d=>l.add(d));for(let r of l){let p=e(r);p&&p.matches.length>0&&i.push({item:{display:r,isCustomDisplay:!1},match:p})}}(0,y.sortSearchResults)(i);let a=i.map(c=>c.item);return n&&(a=a.filter(c=>c.file!==void 0)),a.length===0&&t&&a.push({display:"No match found",isCustomDisplay:!1,isNoMatch:!0}),a}renderSuggestion(t,e){if(e.empty(),t.isNoMatch){e.setText(t.display);return}if(t.file){let i=this.matchReasons.get(t.file.path);if(i&&(i.matchedInTitle||i.matchedInFilename||i.matchedInAlias)){e.addClass("mod-complex");let n=e.createDiv({cls:"suggestion-content"});n.createDiv({cls:"suggestion-title"}).setText(t.display),n.createDiv({cls:"suggestion-note"}).setText(t.file.path.replace(".md",""));let l=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":this.getIconLabel(i)}});i.matchedInTitle?this.createTypeIcon(l):i.matchedInFilename?this.createFileIcon(l):i.matchedInAlias&&this.createForwardIcon(l)}else{let n=e.createDiv({cls:"suggestion-content"});n.createDiv({cls:"suggestion-title",text:t.display}),n.createDiv({cls:"suggestion-note",text:t.file.path.replace(".md","")})}}}getIconLabel(t){return t.matchedInTitle?"Title/Property Match":t.matchedInFilename?"File Name Match":t.matchedInAlias?"Alias Match":"Match"}createTypeIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-type");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","4 7 4 4 20 4 20 7"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","9"),s.setAttribute("y1","20"),s.setAttribute("x2","15"),s.setAttribute("y2","20"),e.appendChild(s);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","12"),n.setAttribute("y1","4"),n.setAttribute("x2","12"),n.setAttribute("y2","20"),e.appendChild(n),t.appendChild(e)}createFileIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-file-text");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","polyline");s.setAttribute("points","14,2 14,8 20,8"),e.appendChild(s);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","16"),n.setAttribute("y1","13"),n.setAttribute("x2","8"),n.setAttribute("y2","13"),e.appendChild(n);let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1","16"),a.setAttribute("y1","17"),a.setAttribute("x2","8"),a.setAttribute("y2","17"),e.appendChild(a);let o=document.createElementNS("http://www.w3.org/2000/svg","polyline");o.setAttribute("points","10,9 9,9 8,9"),e.appendChild(o),t.appendChild(e)}createForwardIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-forward");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","15 17 20 12 15 7"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M4 18v-2a4 4 0 0 1 4-4h12"),e.appendChild(s),t.appendChild(e)}isUsingCustomProperty(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=i==null?void 0:i[this.plugin.settings.propertyKey];return s!=null&&String(s).trim()!==""}isUsingAlias(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=i==null?void 0:i.aliases;return s?!this.isUsingCustomProperty(t)&&s:!1}selectSuggestion(t,e){var w,m;if(t.isNoMatch)return;let i=this.app.workspace.getActiveViewOfType(y.MarkdownView);if(!i||!this.context)return;let s=i.editor,{start:n,end:a}=this.context,o=s.getLine(n.line),c=a;if(o.slice(a.ch,a.ch+2)==="]]"&&(c={line:a.line,ch:a.ch+2}),!t.file)return;let l=this.app.vault,r=(m=(w=l.getConfig)==null?void 0:w.call(l,"useMarkdownLinks"))!=null?m:!1,p;r?p=`[${t.display}](${encodeURI(t.file.path)})`:p=`[[${t.file.path.replace(".md","")}|${t.display}]]`,s.replaceRange(p,{line:n.line,ch:n.ch},c);let d=n.ch+p.length;try{s.setCursor({line:n.line,ch:d})}catch(f){console.error("Error setting cursor:",f),new y.Notice("Error setting cursor position. Please check console for details.")}}getQuickSwitcherOptions(){var t;try{let e=this.app.internalPlugins;if(!e)return null;let i=(t=e.getPluginById)==null?void 0:t.call(e,"switcher");return!i||!i.instance?null:i.instance.options||null}catch(e){return console.warn("Property Over Filename: Could not access Quick Switcher options:",e),null}}};var b=require("obsidian"),I=class extends b.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.addClass("property-over-filename-settings"),new b.Setting(t).setName("Property key").setDesc("The property to use as the display title.").addText(e=>e.setPlaceholder("title").setValue(this.plugin.settings.propertyKey).onChange(async i=>{this.plugin.settings.propertyKey=i.trim()||"title",await this.plugin.saveData(this.plugin.settings),this.plugin.updateLinkSuggester()})),new b.Setting(t).setName("When linking notes").setDesc("Enable property-based titles in the link suggester.").addToggle(e=>e.setValue(this.plugin.settings.enableForLinking).onChange(async i=>{this.plugin.settings.enableForLinking=i,await this.plugin.saveData(this.plugin.settings),this.plugin.updateLinkSuggester()})),new b.Setting(t).setName("In quick switcher").setDesc("Enable property-based titles in the quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.enableForQuickSwitcher).onChange(async i=>{let s=this.plugin.settings.enableForQuickSwitcher;this.plugin.settings.enableForQuickSwitcher=i,await this.plugin.saveSettings(s)})),new b.Setting(t).setName("Include file name in fuzzy searches").setDesc("Include note file names in fuzzy search results for link suggester and quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.includeFilenameInSearch).onChange(async i=>{this.plugin.settings.includeFilenameInSearch=i,await this.plugin.saveData(this.plugin.settings)})),new b.Setting(t).setName("Include aliases in fuzzy searches").setDesc("Include property aliases in fuzzy search results for link suggester and quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.includeAliasesInSearch).onChange(async i=>{this.plugin.settings.includeAliasesInSearch=i,await this.plugin.saveData(this.plugin.settings)})),new b.Setting(t).setName("Use simple search for large vaults").setDesc("Use simple search instead of fuzzy search for better performance with very large vaults (thousands of files). Simple search is faster but less flexible than fuzzy search.").addToggle(e=>e.setValue(this.plugin.settings.useSimpleSearch).onChange(async i=>{this.plugin.settings.useSimpleSearch=i,await this.plugin.saveData(this.plugin.settings)})),new b.Setting(t).setName("When dragging notes").setDesc("Use property-based titles when dragging notes from the file explorer.").addToggle(e=>e.setValue(this.plugin.settings.enableForDragDrop).onChange(async i=>{this.plugin.settings.enableForDragDrop=i,await this.plugin.saveData(this.plugin.settings)}))}};var F=require("obsidian");function K(u){u.addCommand({id:"open-quick-switcher",name:"Open quick switcher (property-based)",callback:async()=>{let{QuickSwitchModal:h}=await Promise.resolve().then(()=>(R(),Q));new h(u.app,u).open()}}),u.addCommand({id:"toggle-linking",name:"Toggle property-based linking",callback:async()=>{u.settings.enableForLinking=!u.settings.enableForLinking,await u.saveData(u.settings),u.updateLinkSuggester(),new F.Notice(`Property-based linking ${u.settings.enableForLinking?"enabled":"disabled"}`)}}),u.addCommand({id:"toggle-quick-switcher",name:"Toggle property-based quick switcher",callback:async()=>{let h=u.settings.enableForQuickSwitcher;u.settings.enableForQuickSwitcher=!u.settings.enableForQuickSwitcher,await u.saveSettings(h),new F.Notice(`Property-based Quick Switcher ${u.settings.enableForQuickSwitcher?"enabled":"disabled"}`)}}),u.addCommand({id:"rebuild-cache",name:"Rebuild file cache",callback:()=>{u.rebuildCache(),new F.Notice("File cache rebuilt")}}),u.addCommand({id:"toggle-drag-drop",name:"Toggle property-based drag and drop",callback:async()=>{u.settings.enableForDragDrop=!u.settings.enableForDragDrop,await u.saveData(u.settings),new F.Notice(`Property-based drag and drop ${u.settings.enableForDragDrop?"enabled":"disabled"}`)}})}var E=class{constructor(h){this.isCommandOverridden=!1;this.plugin=h}updateQuickSwitcher(){this.plugin.settings.enableForQuickSwitcher&&!this.isCommandOverridden?this.overrideQuickSwitcherCommand():!this.plugin.settings.enableForQuickSwitcher&&this.isCommandOverridden&&this.restoreOriginalCommand()}overrideQuickSwitcherCommand(){var e;let h=this.plugin.app.commands.commands;if(h["switcher:open"]&&!this.originalSwitcherCommand){let i=h["switcher:open"];this.originalSwitcherCommand={id:i.id||"switcher:open",name:i.name||"Quick Switcher",icon:i.icon,hotkeys:i.hotkeys?[...i.hotkeys]:[],callback:i.callback}}h["switcher:open"]&&delete h["switcher:open"];let t={id:"switcher:open",name:"Quick Switcher",icon:(e=this.originalSwitcherCommand)==null?void 0:e.icon,hotkeys:[{modifiers:["Mod"],key:"o"}],callback:()=>{let i=this.plugin.app.workspace;i.switcher&&typeof i.switcher.close=="function"&&i.switcher.close(),document.querySelectorAll(".modal").forEach(n=>{n instanceof HTMLElement&&!n.classList.contains("hidden")&&n.addClass("hidden")});try{Promise.resolve().then(()=>(R(),Q)).then(({QuickSwitchModal:n})=>{new n(this.plugin.app,this.plugin).open()}).catch(n=>{console.error("Error loading QuickSwitchModal:",n),this.originalSwitcherCommand&&this.originalSwitcherCommand.callback&&this.originalSwitcherCommand.callback()})}catch(n){console.error("Error creating QuickSwitchModal:",n),this.originalSwitcherCommand&&this.originalSwitcherCommand.callback&&this.originalSwitcherCommand.callback()}}};h["switcher:open"]=t,this.isCommandOverridden=!0}restoreOriginalCommand(){if(!this.originalSwitcherCommand)return;let h=this.plugin.app.commands.commands;h["switcher:open"]&&delete h["switcher:open"],h["switcher:open"]={id:this.originalSwitcherCommand.id,name:this.originalSwitcherCommand.name,icon:this.originalSwitcherCommand.icon,hotkeys:this.originalSwitcherCommand.hotkeys,callback:this.originalSwitcherCommand.callback},this.isCommandOverridden=!1}};var C=require("obsidian"),N=class{constructor(h){this.plugin=h}handleDragDrop(h,t){if(!h.dataTransfer||!h.dataTransfer.files.length)return;let e=h.dataTransfer.getData("text/plain");if(!e||!e.endsWith(".md"))return;let i=this.plugin.app.vault.getAbstractFileByPath(e);if(!i||!(i instanceof C.TFile))return;let s=this.getDisplayName(i);setTimeout(()=>{this.replaceLastInsertedLink(i,s,t)},50)}handleDOMDrop(h){var a;let t=h.target;if(!t||!t.closest(".cm-editor"))return;let e=(a=h.dataTransfer)==null?void 0:a.getData("text/plain");if(!e)return;let i=e;if(e.startsWith("obsidian://open?")){let c=new URL(e).searchParams.get("file");if(c)i=decodeURIComponent(c)+".md";else return}else if(!e.endsWith(".md"))return;let s=this.plugin.app.vault.getAbstractFileByPath(i);if(!s||!(s instanceof C.TFile))return;let n=this.getDisplayName(s);setTimeout(()=>{let o=this.plugin.app.workspace.getActiveViewOfType(C.MarkdownView);o&&o.editor&&this.replaceLastInsertedLink(s,n,o.editor)},50)}getDisplayName(h){let t=this.plugin.app.metadataCache.getFileCache(h),e=t==null?void 0:t.frontmatter,i=h.basename;if(e&&e[this.plugin.settings.propertyKey]!==void 0&&e[this.plugin.settings.propertyKey]!==null){let s=String(e[this.plugin.settings.propertyKey]).trim();s!==""&&(i=s)}return i}replaceLastInsertedLink(h,t,e){let i=e.getValue(),s=e.getCursor(),a=i.split(`
`)[s.line],o=/\[\[([^\]]+)\]\]/g,c=/\[([^\]]+)\]\(([^)]+)\)/g,l,r=null;for(;(l=o.exec(a))!==null;)r=l;if(r){let d=`[[${r[1]}|${t}]]`,w={line:s.line,ch:r.index},m={line:s.line,ch:r.index+r[0].length};e.replaceRange(d,w,m);return}for(c.lastIndex=0;(l=c.exec(a))!==null;)r=l;if(r){let p=r[2],d=`[${t}](${p})`,w={line:s.line,ch:r.index},m={line:s.line,ch:r.index+r[0].length};e.replaceRange(d,w,m)}}};var P=class{constructor(h){this.plugin=h}setSuggest(h){this.suggest=h}invalidateCache(h){this.suggest&&this.suggest.updateFileCache(h)}rebuildCache(){this.suggest&&this.suggest.buildFileCache()}};var D=class extends k.Plugin{async onload(){await this.loadSettings(),this.quickSwitcherService=new E(this),this.dragDropService=new N(this),this.cacheService=new P(this),setTimeout(()=>{this.updateLinkSuggester(),this.updateQuickSwitcher()},1e3),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof k.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.vault.on("rename",(t,e)=>{t instanceof k.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.vault.on("delete",t=>{t instanceof k.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.metadataCache.on("changed",t=>{t instanceof k.TFile&&t.extension==="md"&&this.cacheService.rebuildCache()})),this.registerEvent(this.app.metadataCache.on("resolved",()=>{this.cacheService.rebuildCache()})),this.registerEvent(this.app.workspace.on("editor-drop",(t,e)=>{this.settings.enableForDragDrop&&this.dragDropService.handleDragDrop(t,e)})),this.registerDomEvent(document,"drop",t=>{this.settings.enableForDragDrop&&this.dragDropService.handleDOMDrop(t)}),K(this),this.addSettingTab(new I(this.app,this))}updateLinkSuggester(){let t=this.app.workspace.editorSuggest;t&&(this.suggest&&(t.suggests=t.suggests.filter(e=>e!==this.suggest),this.suggest=void 0),this.settings.enableForLinking&&(this.suggest=new T(this),this.registerEditorSuggest(this.suggest),this.cacheService.setSuggest(this.suggest),t.suggests=t.suggests.filter(e=>!e.constructor.name.includes("LinkSuggest")),t.suggests.unshift(this.suggest)))}updateQuickSwitcher(){this.quickSwitcherService.updateQuickSwitcher()}rebuildCache(){this.cacheService.rebuildCache()}onunload(){let t=this.app.workspace.editorSuggest;t&&this.suggest&&(t.suggests=t.suggests.filter(e=>e!==this.suggest)),this.quickSwitcherService.restoreOriginalCommand()}async loadSettings(){this.settings=Object.assign({},V,await this.loadData())}async saveSettings(t){await this.saveData(this.settings),t!==void 0&&t!==this.settings.enableForQuickSwitcher&&this.updateQuickSwitcher()}};
