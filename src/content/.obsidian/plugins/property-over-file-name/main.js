/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var U=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var ee=Object.prototype.hasOwnProperty;var _=(u,s)=>()=>(u&&(s=u(u=0)),s);var j=(u,s)=>{for(var t in s)U(u,t,{get:s[t],enumerable:!0})},te=(u,s,t,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of Z(s))!ee.call(u,i)&&i!==t&&U(u,i,{get:()=>s[i],enumerable:!(e=Y(s,i))||e.enumerable});return u};var ie=u=>te(U({},"__esModule",{value:!0}),u);function A(u,s,t){let e=new Map;return u.forEach(i=>{let n=s.getFileCache(i),a=n==null?void 0:n.frontmatter,r=i.basename,o=!1,l=[];if(a&&a[t]!==void 0&&a[t]!==null){let p=String(a[t]).trim();p!==""&&(r=p,o=!0)}a!=null&&a.aliases&&(l=Array.isArray(a.aliases)?a.aliases:[a.aliases],l=l.map(p=>String(p).trim()).filter(p=>p!=="")),e.set(i.path,{file:i,displayName:r,aliases:l,lastModified:i.stat.mtime,isCustomDisplay:o})}),e}var G=_(()=>{"use strict"});var W={};j(W,{QuickSwitchModal:()=>Q});var f,Q,K=_(()=>{"use strict";f=require("obsidian");G();Q=class extends f.FuzzySuggestModal{constructor(t,e){super(t);this.fileCache=new Map;this.recentFiles=[];this.searchTimeout=null;this.matchReasons=new Map;this.plugin=e,this.limit=8,this.plugin.settings.enableForQuickSwitcher?this.setPlaceholder("Type to search notes by title or file name..."):this.setPlaceholder("Type to search files..."),this.buildFileCache(),this.updateRecentFiles(),this.addKeyboardNavigation(),this.addFooter(),this.plugin.settings.enableForQuickSwitcher&&this.containerEl.addClass("property-over-filename-modal")}addKeyboardNavigation(){this.inputEl.addEventListener("keydown",t=>{t.key==="Escape"&&(this.close(),t.preventDefault(),t.stopPropagation())})}addFooter(){let t=this.containerEl.querySelector(".prompt");if(t){let e=t.createDiv({cls:"prompt-instructions"});[{command:"\u2191\u2193",action:"to navigate"},{command:"\u21B5",action:"to open"},{command:"ctrl \u21B5",action:"to open in new tab"},{command:"ctrl alt \u21B5",action:"to open to the right"},{command:"shift \u21B5",action:"to create"},{command:"esc",action:"to dismiss"}].forEach(({command:n,action:a})=>{let r=e.createDiv({cls:"prompt-instruction"});r.createSpan({cls:"prompt-instruction-command",text:n}),r.createSpan({text:a})})}}buildFileCache(){let t=this.getFilteredFiles();this.fileCache=A(t,this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=t.basename,a=!1,r=[];if(i&&i[this.plugin.settings.propertyKey]!==void 0&&i[this.plugin.settings.propertyKey]!==null){let o=String(i[this.plugin.settings.propertyKey]).trim();o!==""&&(n=o,a=!0)}i!=null&&i.aliases&&(r=Array.isArray(i.aliases)?i.aliases:[i.aliases],r=r.map(o=>String(o).trim()).filter(o=>o!=="")),this.fileCache.set(t.path,{file:t,displayName:n,aliases:r,lastModified:t.stat.mtime,isCustomDisplay:a})}updateRecentFiles(){var o,l;let t=[],e=this.app.workspace,i=this.getQuickSwitcherOptions(),n=(o=i==null?void 0:i.showAttachments)!=null?o:!0;(l=e.recentFileTracker)!=null&&l.getLastOpenFiles&&(t=e.recentFileTracker.getLastOpenFiles().map(c=>this.app.vault.getAbstractFileByPath(c)).filter(c=>c instanceof f.TFile)),t.length===0&&(t=[...this.app.workspace.getLeavesOfType("markdown").map(c=>c.view).filter(c=>c instanceof f.MarkdownView).map(c=>c.file).filter(c=>c!==null).filter((c,h,g)=>g.indexOf(c)===h)]),n||(t=t.filter(p=>p.extension==="md"));let a=8,r=new Set(t.map(p=>p.path));if(t.length<a)if(n){let c=this.app.vault.getFiles().filter(h=>h instanceof f.TFile).filter(h=>!r.has(h.path)).slice(0,a-t.length);t.push(...c)}else{let c=this.app.vault.getMarkdownFiles().filter(h=>!r.has(h.path)).slice(0,a-t.length);t.push(...c)}this.recentFiles=t.slice(0,a)}getItems(){return this.getFilteredFiles()}getFilteredFiles(){let t=this.getQuickSwitcherOptions(),e=this.app.vault.getMarkdownFiles();return t!=null&&t.showAttachments&&(e=this.app.vault.getFiles().filter(n=>n instanceof f.TFile).filter(n=>n.extension==="md"||this.isAttachment(n))),e}isAttachment(t){return["png","jpg","jpeg","gif","svg","webp","pdf","mp4","mp3","wav","ogg","webm"].includes(t.extension.toLowerCase())}getQuickSwitcherOptions(){var t;try{let e=this.app.internalPlugins;if(!e)return null;let i=(t=e.getPluginById)==null?void 0:t.call(e,"switcher");return!i||!i.instance?null:i.instance.options||null}catch(e){return console.warn("Property Over Filename: Could not access Quick Switcher options:",e),null}}getItemText(t){return"isNewNote"in t?t.newName:"isUnresolved"in t?t.unresolvedText:this.plugin.settings.enableForQuickSwitcher?this.getDisplayName(t):t.basename}getDisplayName(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=i==null?void 0:i[this.plugin.settings.propertyKey];if(n!=null){let a=String(n).trim();if(a!=="")return a}return t.basename}getSuggestions(t){var i;if(!this.plugin.settings.enableForQuickSwitcher){let n=t.trim();if(!n)return this.getRecentFilesResults();let a=this.getFilteredFiles(),r=this.plugin.settings.useSimpleSearch?(0,f.prepareSimpleSearch)(n):(0,f.prepareFuzzySearch)(n),o=[];for(let l of a){let p=(i=r(l.basename))!=null?i:{score:0,matches:[]};p.matches.length>0&&o.push({item:l,match:p})}if((0,f.sortSearchResults)(o),o.length===0){let l={isNewNote:!0,newName:n};o.push({item:l,match:{score:1e3,matches:[[0,n.length]]}})}return o.slice(0,this.limit)}let e=t.trim();return this.searchTimeout&&clearTimeout(this.searchTimeout),e?this.performSearch(e):this.getRecentFilesResults()}getRecentFilesResults(){return this.updateRecentFiles(),this.matchReasons.clear(),this.recentFiles.map(t=>({item:t,match:{score:1e3,matches:[]}}))}performSearch(t){var r;let e=this.plugin.settings.useSimpleSearch?(0,f.prepareSimpleSearch)(t):(0,f.prepareFuzzySearch)(t),i=[];this.matchReasons.clear();for(let o of this.fileCache.values()){let{file:l,displayName:p,aliases:c,isCustomDisplay:h}=o,g={matchedInTitle:!1,matchedInFilename:!1,matchedInAlias:!1},d=null,m=null,v=null;if(h&&(d=e(p),d&&d.matches.length>0&&(g.matchedInTitle=!0,m=d,v="title")),!v){if(this.plugin.settings.includeFilenameInSearch&&l.basename!==p){let w=e(l.basename);w&&w.matches.length>0&&(g.matchedInFilename=!0,m={...w,score:w.score-1},v="filename")}else if(!h){let w=e(l.basename);w&&w.matches.length>0&&(g.matchedInFilename=!0,m=w,v="filename")}}if(!v&&this.plugin.settings.includeAliasesInSearch&&c.length>0)for(let w of c){let b=e(w);if(b&&b.matches.length>0){g.matchedInAlias=!0,g.matchedAliasText=w,m={...b,score:b.score-1},v="alias";break}}m&&m.matches.length>0&&(i.push({item:l,match:m}),this.matchReasons.set(l.path,g))}let n=this.getQuickSwitcherOptions(),a=(r=n==null?void 0:n.showExistingOnly)!=null?r:!1;if(!a){let{unresolvedLinks:o}=this.app.metadataCache,l=new Set;for(let p in o)Object.keys(o[p]).forEach(h=>l.add(h));for(let p of l){let c=e(p);if(c&&c.matches.length>0){let h={isUnresolved:!0,unresolvedText:p};i.push({item:h,match:c})}}}try{(0,f.sortSearchResults)(i);let o=i;a&&(o=i.filter(c=>c.item instanceof f.TFile||"isNewNote"in c.item&&c.item.isNewNote===!0));let l=t.toLowerCase(),p=o.some(c=>{var h;return c.item instanceof f.TFile&&(this.getDisplayName(c.item).toLowerCase()===l||this.plugin.settings.includeFilenameInSearch&&c.item.basename.toLowerCase()===l||this.plugin.settings.includeAliasesInSearch&&((h=this.fileCache.get(c.item.path))==null?void 0:h.aliases.some(g=>g.toLowerCase()===l)))});if(!a&&!p){let{unresolvedLinks:c}=this.app.metadataCache,h=new Set;for(let g in c)Object.keys(c[g]).forEach(m=>h.add(m));p=Array.from(h).some(g=>g.toLowerCase()===l)}if(!p&&t){let c={isNewNote:!0,newName:t};o.unshift({item:c,match:{score:1e3,matches:[[0,t.length]]}})}return o.slice(0,this.limit)}catch(o){return console.error("Error generating suggestions:",o),new f.Notice("Error updating quick switcher suggestions. Please check console for details."),[]}}renderSuggestion(t,e){var a;let{item:i}=t;if("isUnresolved"in i&&i.isUnresolved){let r=i.unresolvedText;e.empty(),e.addClass("mod-complex"),e.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title"}).setText(r);let c=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":"Unresolved link - Enter to create"}});this.createFilePlusIcon(c);return}let n=this.getItemText(i);if("isNewNote"in i){e.empty(),e.addClass("mod-complex"),e.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title"}).setText(n),e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-action"}).setText("Enter to create");return}if(!this.plugin.settings.enableForQuickSwitcher)i instanceof f.TFile?e.setText(i.path.replace(".md","")):e.setText(n);else{if(!(i instanceof f.TFile)){e.setText(n);return}let r=this.fileCache.get(i.path),o=(a=r==null?void 0:r.isCustomDisplay)!=null?a:!1,l=this.matchReasons.get(i.path);if(!o&&(l!=null&&l.matchedInAlias)&&l.matchedAliasText){e.addClass("mod-complex");let p=e.createDiv({cls:"suggestion-content"});p.createDiv({cls:"suggestion-title"}).setText(l.matchedAliasText),p.createDiv({cls:"suggestion-note"}).setText(i.path.replace(".md",""));let d=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":"Alias Match"}});this.createForwardIcon(d)}else if(o)if(l&&(l.matchedInTitle||l.matchedInFilename||l.matchedInAlias)){e.addClass("mod-complex");let c=e.createDiv({cls:"suggestion-content"});c.createDiv({cls:"suggestion-title"}).setText(n),c.createDiv({cls:"suggestion-note"}).setText(i.path.replace(".md",""));let m=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":this.getIconLabel(l)}});l.matchedInTitle?this.createTypeIcon(m):l.matchedInFilename?this.createFileIcon(m):l.matchedInAlias&&this.createForwardIcon(m)}else{e.addClass("mod-complex");let c=e.createDiv({cls:"suggestion-content"});c.createDiv({cls:"suggestion-title"}).setText(n),c.createDiv({cls:"suggestion-note"}).setText(i.path.replace(".md",""));let m=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":"Property-based title"}});this.createTypeIcon(m)}else e.setText(n)}}getIconLabel(t){return t.matchedInTitle?"Title/Property Match":t.matchedInFilename?"File Name Match":t.matchedInAlias?"Alias Match":"Match"}createTypeIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-type");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","4 7 4 4 20 4 20 7"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","9"),n.setAttribute("y1","20"),n.setAttribute("x2","15"),n.setAttribute("y2","20"),e.appendChild(n);let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1","12"),a.setAttribute("y1","4"),a.setAttribute("x2","12"),a.setAttribute("y2","20"),e.appendChild(a),t.appendChild(e)}createFileIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-file-text");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","polyline");n.setAttribute("points","14,2 14,8 20,8"),e.appendChild(n);let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1","16"),a.setAttribute("y1","13"),a.setAttribute("x2","8"),a.setAttribute("y2","13"),e.appendChild(a);let r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1","16"),r.setAttribute("y1","17"),r.setAttribute("x2","8"),r.setAttribute("y2","17"),e.appendChild(r);let o=document.createElementNS("http://www.w3.org/2000/svg","polyline");o.setAttribute("points","10,9 9,9 8,9"),e.appendChild(o),t.appendChild(e)}createForwardIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-forward");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","15 17 20 12 15 7"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M4 18v-2a4 4 0 0 1 4-4h12"),e.appendChild(n),t.appendChild(e)}createFilePlusIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-file-plus");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","polyline");n.setAttribute("points","14,2 14,8 20,8"),e.appendChild(n);let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1","12"),a.setAttribute("y1","18"),a.setAttribute("x2","12"),a.setAttribute("y2","12"),e.appendChild(a);let r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1","9"),r.setAttribute("y1","15"),r.setAttribute("x2","15"),r.setAttribute("y2","15"),e.appendChild(r),t.appendChild(e)}isUsingCustomProperty(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=i==null?void 0:i[this.plugin.settings.propertyKey];return n!=null&&String(n).trim()!==""}isUsingAlias(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=i==null?void 0:i.aliases;return n?!this.isUsingCustomProperty(t)&&n:!1}onChooseItem(t,e){var i,n;if("isUnresolved"in t&&t.isUnresolved){let a=t.unresolvedText,r=this.app.workspace.getActiveViewOfType(f.MarkdownView),o=((i=r==null?void 0:r.file)==null?void 0:i.path)||"";this.app.workspace.openLinkText(a,o).catch(l=>{new f.Notice(`Error creating note: ${l.message}`)});return}if("isNewNote"in t){let a=this.app.workspace.getActiveViewOfType(f.MarkdownView),r=((n=a==null?void 0:a.file)==null?void 0:n.path)||"";this.app.workspace.openLinkText(t.newName,r).catch(o=>{new f.Notice(`Error creating note: ${o.message}`)})}else t instanceof f.TFile&&(e instanceof KeyboardEvent?e.ctrlKey&&e.altKey?this.app.workspace.getLeaf(!0).openFile(t):e.ctrlKey?this.app.workspace.getLeaf().openFile(t):e.shiftKey?this.app.workspace.getLeaf().openFile(t):this.app.workspace.getLeaf().openFile(t):this.app.workspace.getLeaf().openFile(t))}}});var se={};j(se,{default:()=>H});module.exports=ie(se);var S=require("obsidian");var $={propertyKey:"title",enableForLinking:!0,enableForQuickSwitcher:!0,includeFilenameInSearch:!0,includeAliasesInSearch:!0,enableForDragDrop:!0,useSimpleSearch:!1,enableForGraphView:!0,enableForBacklinks:!0,enableForTabs:!0,enableForExplorer:!1,folderNoteFilename:"",enableForWindowFrame:!0};var k=require("obsidian");G();var D=class extends k.EditorSuggest{constructor(t){super(t.app);this.fileCache=new Map;this.searchTimeout=null;this.matchReasons=new Map;this.plugin=t,this.buildFileCache()}open(){super.open();let t=this.suggestEl;if(t&&(t.addClass("property-over-filename-suggestion"),!t.querySelector(".prompt-instructions"))){let e=t.createDiv({cls:"prompt-instructions"});e.createDiv({cls:"prompt-instruction"}).setText("Type # to link heading"),e.createDiv({cls:"prompt-instruction"}).setText("Type ^ to link blocks"),e.createDiv({cls:"prompt-instruction"}).setText("Type | to change display text")}this.addKeyboardNavigation()}addKeyboardNavigation(){let t=this.suggestEl;t&&t.addEventListener("keydown",e=>{e.key==="Escape"&&(this.close(),e.preventDefault(),e.stopPropagation())})}onTrigger(t,e,i){if(!this.plugin.settings.enableForLinking)return null;let n=e.getLine(t.line).substring(0,t.ch),a=/\[\[([^#^|\]]*)$/.exec(n);return a?{start:{line:t.line,ch:n.lastIndexOf("[[")},end:t,query:a[1]}:null}buildFileCache(){this.fileCache=A(this.app.vault.getMarkdownFiles(),this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=t.basename,a=!1,r=[];if(i&&i[this.plugin.settings.propertyKey]!==void 0&&i[this.plugin.settings.propertyKey]!==null){let o=String(i[this.plugin.settings.propertyKey]).trim();o!==""&&(n=o,a=!0)}i!=null&&i.aliases&&(r=Array.isArray(i.aliases)?i.aliases:[i.aliases],r=r.map(o=>String(o).trim()).filter(o=>o!=="")),this.fileCache.set(t.path,{file:t,displayName:n,aliases:r,lastModified:t.stat.mtime,isCustomDisplay:a})}getSuggestions(t){let e=t.query.trim();return this.performSearch(e)}performSearch(t){var o;if(!t||t.trim()===""){let l=[];for(let p of this.fileCache.values())l.push({file:p.file,display:p.displayName,isCustomDisplay:p.isCustomDisplay});return l}let e=this.plugin.settings.useSimpleSearch?(0,k.prepareSimpleSearch)(t):(0,k.prepareFuzzySearch)(t),i=[];this.matchReasons.clear();for(let l of this.fileCache.values()){let{file:p,displayName:c,aliases:h,isCustomDisplay:g}=l,d={matchedInTitle:!1,matchedInFilename:!1,matchedInAlias:!1},m=null,v=null,w=null;if(g&&(m=e(c),m&&m.matches.length>0&&(d.matchedInTitle=!0,v=m,w="title")),!w){if(this.plugin.settings.includeFilenameInSearch&&p.basename!==c){let b=e(p.basename);b&&b.matches.length>0&&(d.matchedInFilename=!0,v={...b,score:b.score-1},w="filename")}else if(!g){let b=e(p.basename);b&&b.matches.length>0&&(d.matchedInFilename=!0,v=b,w="filename")}}if(!w&&this.plugin.settings.includeAliasesInSearch&&h.length>0)for(let b of h){let C=e(b);if(C&&C.matches.length>0){d.matchedInAlias=!0,d.matchedAliasText=b,v={...C,score:C.score-1},w="alias";break}}if(v&&v.matches.length>0){let b={file:p,display:c,isCustomDisplay:g};i.push({item:b,match:v}),this.matchReasons.set(p.path,d)}}let n=this.getQuickSwitcherOptions(),a=(o=n==null?void 0:n.showExistingOnly)!=null?o:!1;if(!a){let{unresolvedLinks:l}=this.app.metadataCache,p=new Set;for(let c in l)Object.keys(l[c]).forEach(g=>p.add(g));for(let c of p){let h=e(c);h&&h.matches.length>0&&i.push({item:{display:c,isCustomDisplay:!1},match:h})}}(0,k.sortSearchResults)(i);let r=i.map(l=>l.item);return a&&(r=r.filter(l=>l.file!==void 0)),r.length===0&&t&&r.push({display:"No match found",isCustomDisplay:!1,isNoMatch:!0}),r}renderSuggestion(t,e){if(e.empty(),t.isNoMatch){e.setText(t.display);return}if(t.file){let i=this.matchReasons.get(t.file.path);if(!t.isCustomDisplay&&(i!=null&&i.matchedInAlias)&&i.matchedAliasText){e.addClass("mod-complex");let n=e.createDiv({cls:"suggestion-content"});n.createDiv({cls:"suggestion-title"}).setText(i.matchedAliasText),n.createDiv({cls:"suggestion-note"}).setText(t.file.path.replace(".md",""));let l=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":"Alias Match"}});this.createForwardIcon(l)}else if(t.isCustomDisplay)if(i&&(i.matchedInTitle||i.matchedInFilename||i.matchedInAlias)){e.addClass("mod-complex");let a=e.createDiv({cls:"suggestion-content"});a.createDiv({cls:"suggestion-title"}).setText(t.display),a.createDiv({cls:"suggestion-note"}).setText(t.file.path.replace(".md",""));let p=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":this.getIconLabel(i)}});i.matchedInTitle?this.createTypeIcon(p):i.matchedInFilename?this.createFileIcon(p):i.matchedInAlias&&this.createForwardIcon(p)}else e.setText(t.display);else e.setText(t.display)}}getIconLabel(t){return t.matchedInTitle?"Title/Property Match":t.matchedInFilename?"File Name Match":t.matchedInAlias?"Alias Match":"Match"}createTypeIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-type");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","4 7 4 4 20 4 20 7"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","9"),n.setAttribute("y1","20"),n.setAttribute("x2","15"),n.setAttribute("y2","20"),e.appendChild(n);let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1","12"),a.setAttribute("y1","4"),a.setAttribute("x2","12"),a.setAttribute("y2","20"),e.appendChild(a),t.appendChild(e)}createFileIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-file-text");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","polyline");n.setAttribute("points","14,2 14,8 20,8"),e.appendChild(n);let a=document.createElementNS("http://www.w3.org/2000/svg","line");a.setAttribute("x1","16"),a.setAttribute("y1","13"),a.setAttribute("x2","8"),a.setAttribute("y2","13"),e.appendChild(a);let r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1","16"),r.setAttribute("y1","17"),r.setAttribute("x2","8"),r.setAttribute("y2","17"),e.appendChild(r);let o=document.createElementNS("http://www.w3.org/2000/svg","polyline");o.setAttribute("points","10,9 9,9 8,9"),e.appendChild(o),t.appendChild(e)}createForwardIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-forward");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","15 17 20 12 15 7"),e.appendChild(i);let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M4 18v-2a4 4 0 0 1 4-4h12"),e.appendChild(n),t.appendChild(e)}isUsingCustomProperty(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=i==null?void 0:i[this.plugin.settings.propertyKey];return n!=null&&String(n).trim()!==""}isUsingAlias(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,n=i==null?void 0:i.aliases;return n?!this.isUsingCustomProperty(t)&&n:!1}selectSuggestion(t,e){var d,m;if(t.isNoMatch)return;let i=this.app.workspace.getActiveViewOfType(k.MarkdownView);if(!i||!this.context)return;let n=i.editor,{start:a,end:r}=this.context,o=n.getLine(a.line),l=r;if(o.slice(r.ch,r.ch+2)==="]]"&&(l={line:r.line,ch:r.ch+2}),!t.file)return;let p=this.app.vault,c=(m=(d=p.getConfig)==null?void 0:d.call(p,"useMarkdownLinks"))!=null?m:!1,h;t.isCustomDisplay?c?h=`[${t.display}](${encodeURI(t.file.path)})`:h=`[[${t.file.path.replace(".md","")}|${t.display}]]`:c?h=`[${t.file.path.replace(".md","")}](${encodeURI(t.file.path)})`:h=`[[${t.file.path.replace(".md","")}]]`,n.replaceRange(h,{line:a.line,ch:a.ch},l);let g=a.ch+h.length;try{n.setCursor({line:a.line,ch:g})}catch(v){console.error("Error setting cursor:",v),new k.Notice("Error setting cursor position. Please check console for details.")}}getQuickSwitcherOptions(){var t;try{let e=this.app.internalPlugins;if(!e)return null;let i=(t=e.getPluginById)==null?void 0:t.call(e,"switcher");return!i||!i.instance?null:i.instance.options||null}catch(e){return console.warn("Property Over Filename: Could not access Quick Switcher options:",e),null}}};var y=require("obsidian"),P=class extends y.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.addClass("property-over-filename-settings"),new y.Setting(t).setName("Property key").setDesc("The property to use as the display title. Falls back to the file name when no property is set for that item.").addText(e=>e.setPlaceholder("title").setValue(this.plugin.settings.propertyKey).onChange(async i=>{this.plugin.settings.propertyKey=i.trim()||"title",await this.plugin.saveData(this.plugin.settings),this.plugin.updateLinkSuggester(),this.plugin.updateGraphView(),this.plugin.updateBacklinks(),this.plugin.updateTabs(),this.plugin.updateExplorer(),this.plugin.updateWindowFrame()})),new y.Setting(t).setName("When linking notes").setDesc("Enable property-based titles in the link suggester.").addToggle(e=>e.setValue(this.plugin.settings.enableForLinking).onChange(async i=>{this.plugin.settings.enableForLinking=i,await this.plugin.saveData(this.plugin.settings),this.plugin.updateLinkSuggester()})),new y.Setting(t).setName("In quick switcher").setDesc("Enable property-based titles in the quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.enableForQuickSwitcher).onChange(async i=>{let n=this.plugin.settings.enableForQuickSwitcher;this.plugin.settings.enableForQuickSwitcher=i,await this.plugin.saveSettings(n)})),new y.Setting(t).setName("Include file name in fuzzy searches").setDesc("Include note file names in fuzzy search results for link suggester and quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.includeFilenameInSearch).onChange(async i=>{this.plugin.settings.includeFilenameInSearch=i,await this.plugin.saveData(this.plugin.settings)})),new y.Setting(t).setName("Include aliases in fuzzy searches").setDesc("Include property aliases in fuzzy search results for link suggester and quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.includeAliasesInSearch).onChange(async i=>{this.plugin.settings.includeAliasesInSearch=i,await this.plugin.saveData(this.plugin.settings)})),new y.Setting(t).setName("When dragging notes").setDesc("Use property-based titles when dragging notes from the file explorer.").addToggle(e=>e.setValue(this.plugin.settings.enableForDragDrop).onChange(async i=>{this.plugin.settings.enableForDragDrop=i,await this.plugin.saveData(this.plugin.settings)})),new y.Setting(t).setName("In graph view").setDesc("Use the property instead of the file name as the note's title in graph view.").addToggle(e=>e.setValue(this.plugin.settings.enableForGraphView).onChange(async i=>{this.plugin.settings.enableForGraphView=i,await this.plugin.saveData(this.plugin.settings),this.plugin.updateGraphView()})),new y.Setting(t).setName("In backlinks and outgoing links").setDesc("Use the property instead of the file name in the linked mentions footer, dedicated backlinks panel, and outgoing links.").addToggle(e=>e.setValue(this.plugin.settings.enableForBacklinks).onChange(async i=>{this.plugin.settings.enableForBacklinks=i,await this.plugin.saveData(this.plugin.settings),this.plugin.updateBacklinks()})),new y.Setting(t).setName("In tab titles").setDesc("Use the property instead of the file name in tab titles.").addToggle(e=>e.setValue(this.plugin.settings.enableForTabs).onChange(async i=>{let n=this.plugin.settings.enableForTabs;this.plugin.settings.enableForTabs=i,await this.plugin.saveSettings(void 0,n)})),new y.Setting(t).setName("In window frame title").setDesc("Use the property instead of the file name in the browser window title bar.").addToggle(e=>e.setValue(this.plugin.settings.enableForWindowFrame).onChange(async i=>{this.plugin.settings.enableForWindowFrame=i,await this.plugin.saveData(this.plugin.settings),this.plugin.updateWindowFrame()})),new y.Setting(t).setName("In file explorer").setDesc("Use the property instead of the file name in the file explorer.").addToggle(e=>e.setValue(this.plugin.settings.enableForExplorer).onChange(async i=>{this.plugin.settings.enableForExplorer=i,await this.plugin.saveData(this.plugin.settings),this.plugin.updateExplorer(),this.display()})),this.plugin.settings.enableForExplorer&&new y.Setting(t).setName("Folder note file name").setDesc("If a folder contains a file with this name that has a title property, the folder will display that title instead. This ensures compatibility with the Folder Notes plugin. Leave blank to disable.").addText(e=>e.setPlaceholder("index").setValue(this.plugin.settings.folderNoteFilename).onChange(async i=>{this.plugin.settings.folderNoteFilename=i.trim(),await this.plugin.saveData(this.plugin.settings),this.plugin.updateExplorer()})),new y.Setting(t).setName("Use simple search").setDesc("Instead of using fuzzy search, simple search provides better performance with very large vaults (thousands of files).").addToggle(e=>e.setValue(this.plugin.settings.useSimpleSearch).onChange(async i=>{this.plugin.settings.useSimpleSearch=i,await this.plugin.saveData(this.plugin.settings)}))}};var E=require("obsidian");function X(u){u.addCommand({id:"open-quick-switcher",name:"Open quick switcher (property-based)",callback:async()=>{let{QuickSwitchModal:s}=await Promise.resolve().then(()=>(K(),W));new s(u.app,u).open()}}),u.addCommand({id:"toggle-linking",name:"Toggle property-based linking",callback:async()=>{u.settings.enableForLinking=!u.settings.enableForLinking,await u.saveData(u.settings),u.updateLinkSuggester(),new E.Notice(`Property-based linking ${u.settings.enableForLinking?"enabled":"disabled"}`)}}),u.addCommand({id:"toggle-quick-switcher",name:"Toggle property-based quick switcher",callback:async()=>{let s=u.settings.enableForQuickSwitcher;u.settings.enableForQuickSwitcher=!u.settings.enableForQuickSwitcher,await u.saveSettings(s),new E.Notice(`Property-based Quick Switcher ${u.settings.enableForQuickSwitcher?"enabled":"disabled"}`)}}),u.addCommand({id:"rebuild-cache",name:"Rebuild file cache",callback:()=>{u.rebuildCache(),new E.Notice("File cache rebuilt")}}),u.addCommand({id:"toggle-drag-drop",name:"Toggle property-based drag and drop",callback:async()=>{u.settings.enableForDragDrop=!u.settings.enableForDragDrop,await u.saveData(u.settings),new E.Notice(`Property-based drag and drop ${u.settings.enableForDragDrop?"enabled":"disabled"}`)}})}var N=class{constructor(s){this.isCommandOverridden=!1;this.plugin=s}updateQuickSwitcher(){this.plugin.settings.enableForQuickSwitcher&&!this.isCommandOverridden?this.overrideQuickSwitcherCommand():!this.plugin.settings.enableForQuickSwitcher&&this.isCommandOverridden&&this.restoreOriginalCommand()}overrideQuickSwitcherCommand(){var e;let s=this.plugin.app.commands.commands;if(s["switcher:open"]&&!this.originalSwitcherCommand){let i=s["switcher:open"];this.originalSwitcherCommand={id:i.id||"switcher:open",name:i.name||"Quick Switcher",icon:i.icon,hotkeys:i.hotkeys?[...i.hotkeys]:[],callback:i.callback}}s["switcher:open"]&&delete s["switcher:open"];let t={id:"switcher:open",name:"Quick Switcher",icon:(e=this.originalSwitcherCommand)==null?void 0:e.icon,hotkeys:[{modifiers:["Mod"],key:"o"}],callback:()=>{let i=this.plugin.app.workspace;i.switcher&&typeof i.switcher.close=="function"&&i.switcher.close(),document.querySelectorAll(".modal").forEach(a=>{a instanceof HTMLElement&&!a.classList.contains("hidden")&&a.addClass("hidden")});try{Promise.resolve().then(()=>(K(),W)).then(({QuickSwitchModal:a})=>{new a(this.plugin.app,this.plugin).open()}).catch(a=>{console.error("Error loading QuickSwitchModal:",a),this.originalSwitcherCommand&&this.originalSwitcherCommand.callback&&this.originalSwitcherCommand.callback()})}catch(a){console.error("Error creating QuickSwitchModal:",a),this.originalSwitcherCommand&&this.originalSwitcherCommand.callback&&this.originalSwitcherCommand.callback()}}};s["switcher:open"]=t,this.isCommandOverridden=!0}restoreOriginalCommand(){if(!this.originalSwitcherCommand)return;let s=this.plugin.app.commands.commands;s["switcher:open"]&&delete s["switcher:open"],s["switcher:open"]={id:this.originalSwitcherCommand.id,name:this.originalSwitcherCommand.name,icon:this.originalSwitcherCommand.icon,hotkeys:this.originalSwitcherCommand.hotkeys,callback:this.originalSwitcherCommand.callback},this.isCommandOverridden=!1}};var F=require("obsidian"),I=class{constructor(s){this.lastDropTime=0;this.lastDropData=null;this.DROP_DEBOUNCE_MS=100;this.plugin=s}handleDragDrop(s,t){let e=s.dataTransfer;if(!e){console.warn("[PropertyOverFileName] handleDragDrop: dataTransfer is undefined");return}let i=e.getData("text/plain");if(!i||!i.endsWith(".md"))return;let n=Date.now();if(n-this.lastDropTime<this.DROP_DEBOUNCE_MS&&this.lastDropData===i){console.log("[PropertyOverFileName] handleDragDrop: Ignoring duplicate drop event");return}this.lastDropTime=n,this.lastDropData=i;let a=this.plugin.app.vault.getAbstractFileByPath(i);if(!a||!(a instanceof F.TFile)){console.warn("[PropertyOverFileName] handleDragDrop: File not found:",i);return}let r=this.getDisplayName(a);r!==null&&setTimeout(()=>{this.replaceLastInsertedLink(a,r,t)},50)}handleDOMDrop(s){let t=s.target,e=t==null?void 0:t.closest(".cm-editor"),i=this.plugin.app.workspace.getActiveViewOfType(F.MarkdownView),n=i&&i.editor;if(!e&&!n)return;let a=s.dataTransfer;if(!a){console.warn("[PropertyOverFileName] handleDOMDrop: dataTransfer is undefined");return}let r=a.getData("text/plain");if(!r)return;let o=r;if(r.startsWith("obsidian://open?"))try{let g=new URL(r).searchParams.get("file");if(g)o=decodeURIComponent(g)+".md";else return}catch(h){console.warn("[PropertyOverFileName] handleDOMDrop: Failed to parse obsidian:// URL:",h);return}else if(!r.endsWith(".md"))return;let l=Date.now();if(l-this.lastDropTime<this.DROP_DEBOUNCE_MS&&this.lastDropData===o){console.log("[PropertyOverFileName] handleDOMDrop: Ignoring duplicate drop event");return}this.lastDropTime=l,this.lastDropData=o;let p=this.plugin.app.vault.getAbstractFileByPath(o);if(!p||!(p instanceof F.TFile)){console.warn("[PropertyOverFileName] handleDOMDrop: File not found:",o);return}let c=this.getDisplayName(p);c!==null&&setTimeout(()=>{let h=this.plugin.app.workspace.getActiveViewOfType(F.MarkdownView);h&&h.editor&&this.replaceLastInsertedLink(p,c,h.editor)},50)}getDisplayName(s){let t=this.plugin.app.metadataCache.getFileCache(s),e=t==null?void 0:t.frontmatter;if(e&&e[this.plugin.settings.propertyKey]!==void 0&&e[this.plugin.settings.propertyKey]!==null){let i=String(e[this.plugin.settings.propertyKey]).trim();if(i!=="")return i}return null}replaceLastInsertedLink(s,t,e){let i=e.getValue(),n=e.getCursor(),r=i.split(`
`)[n.line],o=/\[\[([^\]]+)\]\]/g,l=/\[([^\]]+)\]\(([^)]+)\)/g,p,c=null;for(;(p=o.exec(r))!==null;)c=p;if(c){let g=`[[${c[1]}|${t}]]`,d={line:n.line,ch:c.index},m={line:n.line,ch:c.index+c[0].length};e.replaceRange(g,d,m);return}for(l.lastIndex=0;(p=l.exec(r))!==null;)c=p;if(c){let h=c[2],g=`[${t}](${h})`,d={line:n.line,ch:c.index},m={line:n.line,ch:c.index+c[0].length};e.replaceRange(g,d,m)}}};var L=class{constructor(s){this.plugin=s}setSuggest(s){this.suggest=s}invalidateCache(s){this.suggest&&this.suggest.updateFileCache(s)}rebuildCache(){this.suggest&&this.suggest.buildFileCache()}};var z=require("obsidian"),M=class{constructor(s){this.modifiedPrototypes=[];this.plugin=s}createGetDisplayText(s){return function(){let e=this.pov_plugin;if(!e||!e.settings.enableForGraphView){if(this.pov_originalGetDisplayText)return this.pov_originalGetDisplayText();throw new Error("pov_originalGetDisplayText does not exist on node")}let i=s.vault.getFileByPath(this.id);if(i){let n=s.metadataCache.getFileCache(i),a=n==null?void 0:n.frontmatter;if(a&&a[e.settings.propertyKey]!==void 0&&a[e.settings.propertyKey]!==null){let r=String(a[e.settings.propertyKey]).trim();if(r!=="")return r}}if(this.pov_originalGetDisplayText)return this.pov_originalGetDisplayText();throw new Error("pov_originalGetDisplayText does not exist on node")}}getGraphLeaves(){let s=[];return s.push(...this.plugin.app.workspace.getLeavesOfType("graph")),s.push(...this.plugin.app.workspace.getLeavesOfType("localgraph")),[...new Set(s)]}overridePrototypes(){if(!this.plugin.settings.enableForGraphView)return;let s=this.getGraphLeaves();for(let t of s){if(!(t.view instanceof z.View)||t.isDeferred)continue;let e=t.view;this.overridePrototype(e)}}overridePrototype(s){let t;if(typeof s.renderer.nodes.first=="function")t=s.renderer.nodes.first();else if(s.renderer.nodes instanceof Set)t=s.renderer.nodes.values().next().value;else for(let e of s.renderer.nodes){t=e;break}if(t){let e=t.constructor.prototype;if(!e.hasOwnProperty("pov_originalGetDisplayText")&&!this.modifiedPrototypes.includes(e)){e.pov_originalGetDisplayText=e.getDisplayText,e.getDisplayText=this.createGetDisplayText(this.plugin.app),e.pov_plugin=this.plugin;for(let i of s.renderer.nodes)i.text&&(i.text.text=i.getDisplayText());s.renderer.changed(),this.modifiedPrototypes.push(e)}}}restorePrototypes(){for(let s of this.modifiedPrototypes)typeof s.pov_originalGetDisplayText=="function"&&(s.getDisplayText=s.pov_originalGetDisplayText,delete s.pov_originalGetDisplayText),delete s.pov_plugin;this.modifiedPrototypes=[],this.rewriteNames()}rewriteNames(){let s=this.getGraphLeaves();for(let t of s){if(!(t.view instanceof z.View)||t.isDeferred)continue;let e=t.view;for(let i of e.renderer.nodes)i.text&&(i.text.text=i.getDisplayText());e.renderer.changed()}}onLayoutChange(){var e,i;if(!this.plugin.settings.enableForGraphView){this.restorePrototypes();return}let t=(i=(e=this.plugin.app.internalPlugins)==null?void 0:e.getPluginById)==null?void 0:i.call(e,"graph");t!=null&&t._loaded&&this.overridePrototypes()}updateGraphView(){this.plugin.settings.enableForGraphView?this.overridePrototypes():this.restorePrototypes()}refreshGraphView(){this.plugin.settings.enableForGraphView&&this.rewriteNames()}onunload(){this.restorePrototypes()}};var T=require("obsidian"),O=class{constructor(s){this.processedElements=new WeakSet;this.modifiedElements=new WeakSet;this.originalTextContentDescriptors=new Map;this.plugin=s}getDisplayName(s){if(!this.plugin.settings.enableForBacklinks)return null;let t=this.plugin.app.metadataCache.getFileCache(s),e=t==null?void 0:t.frontmatter;if(e&&e[this.plugin.settings.propertyKey]!==void 0&&e[this.plugin.settings.propertyKey]!==null){let i=String(e[this.plugin.settings.propertyKey]).trim();if(i!=="")return i}return null}updateBacklinks(){if(!this.plugin.settings.enableForBacklinks){this.stopObserving();return}this.updateEmbeddedBacklinks(),this.updateDedicatedBacklinksPanel(),this.startObserving()}updateEmbeddedBacklinks(){for(let s of this.plugin.app.workspace.getLeavesOfType("markdown")){if(!(s.view instanceof T.MarkdownView))continue;let t=s.view.containerEl.querySelector(".embedded-backlinks");t&&this.updateBacklinkContainer(t)}}async updateDedicatedBacklinksPanel(){let s=this.plugin.app.workspace.getLeavesOfType("backlink");for(let t of s)if(await t.loadIfDeferred(),t.view){let e=t.view.containerEl;if(e){let i=e.querySelector(".backlinks-pane")||e.querySelector(".backlink-pane");i&&this.updateBacklinkContainer(i);let n=e.querySelector(".outgoing-link-pane")||e.querySelector(".outgoing-links");n&&this.updateBacklinkContainer(n)}}}extractFilePathFromElement(s){var n;let t=s.getAttribute("data-path");if(t){let a=this.plugin.app.vault.getAbstractFileByPath(t);if(a instanceof T.TFile)return a}let e=s.closest("a")||s.querySelector("a");if(e){let a=e.href||e.getAttribute("href");if(a){if(a.startsWith("obsidian://"))try{let p=new URL(a).searchParams.get("file");if(p){let c=decodeURIComponent(p),h=this.plugin.app.vault.getAbstractFileByPath(c+".md");if(h instanceof T.TFile)return h}}catch(l){}let r=a.match(/#file\/(.+)/);if(r){let l=decodeURIComponent(r[1]),p=this.plugin.app.vault.getAbstractFileByPath(l);if(p instanceof T.TFile)return p}let o=e.getAttribute("data-href");if(o){let l=this.plugin.app.vault.getAbstractFileByPath(o);if(l instanceof T.TFile)return l}}}let i=(n=s.textContent)==null?void 0:n.trim();if(i){let r=this.plugin.app.vault.getMarkdownFiles().find(o=>o.basename===i);if(r)return r}return null}updateBacklinkContainer(s){let t=[".tree-item-inner",".backlink-title",".backlink-file-link",".outgoing-link-file-link",".tree-item-self",".nav-file-title","[data-path]","a.internal-link"],e=new Set;t.forEach(i=>{try{s.querySelectorAll(i).forEach(n=>{e.add(n)})}catch(n){}}),e.forEach(i=>{if(this.processedElements.has(i))return;let n=this.extractFilePathFromElement(i);n&&n instanceof T.TFile&&this.updateElementWithFile(i,n)})}updateElementWithFile(s,t){var a;let e=this.getDisplayName(t);if(e===null)return;this.processedElements.add(s),s.setAttribute("data-pov-processed","true");let i=((a=s.textContent)==null?void 0:a.trim())||"",n=t.basename;if(i===n||i===t.name||i.endsWith(n)){let o=s.closest("a")||s.querySelector("a")||s,l=p=>{var h,g;if(p.childNodes.length===1&&p.childNodes[0].nodeType===Node.TEXT_NODE)return p.textContent=e,!0;let c=Array.from(p.childNodes).filter(d=>d.nodeType===Node.TEXT_NODE);if(c.length>0){c[0].textContent=e;for(let d=1;d<c.length;d++)c[d].remove();return!0}return((h=p.textContent)==null?void 0:h.trim())===n||((g=p.textContent)==null?void 0:g.trim())===t.name?(p.textContent=e,!0):!1};l(o)||l(s)}}startObserving(){if(this.observer)return;this.overrideBacklinkElements();let s=null;this.observer=new MutationObserver(t=>{let e=!1,i=[];for(let n of t)if(n.type==="childList"){for(let a of Array.from(n.addedNodes))if(a instanceof HTMLElement){let r=a.closest(".embedded-backlinks"),o=a.closest(".backlinks-pane, .backlink-pane, .outgoing-link-pane, .outgoing-links, .backlink-container");(r||o)&&(e=!0,[".tree-item-inner",".backlink-title",".backlink-file-link",".outgoing-link-file-link",".tree-item-self",".nav-file-title","[data-path]","a.internal-link"].forEach(p=>{var c;try{let h=(c=a.querySelectorAll)==null?void 0:c.call(a,p);h==null||h.forEach(g=>{g instanceof HTMLElement&&i.push(g)})}catch(h){}}))}}else if(n.type==="characterData"){let a=n.target;if(a instanceof HTMLElement){let r=a.closest(".embedded-backlinks"),o=a.closest(".backlinks-pane, .backlink-pane, .outgoing-link-pane, .outgoing-links, .backlink-container");(r||o)&&(e=!0)}else if(a.parentElement){let r=a.parentElement.closest(".embedded-backlinks"),o=a.parentElement.closest(".backlinks-pane, .backlink-pane, .outgoing-link-pane, .outgoing-links, .backlink-container");(r||o)&&(e=!0)}}i.forEach(n=>{var r;this.overrideElementTextContent(n);let a=this.extractFilePathFromElement(n);if(a&&a instanceof T.TFile){let o=this.getDisplayName(a);if(o){let l=((r=n.textContent)==null?void 0:r.trim())||"";(l===a.basename||l===a.name)&&(n.textContent=o,n.setAttribute("data-pov-processed","true"),this.processedElements.add(n))}}}),e&&(this.processedElements=new WeakSet,s&&clearTimeout(s),s=setTimeout(()=>{this.updateBacklinks(),this.overrideBacklinkElements(),s=null},10))}),this.observer.observe(document.body,{childList:!0,subtree:!0,characterData:!0})}overrideBacklinkElements(){let s=[".tree-item-inner",".backlink-title",".backlink-file-link",".outgoing-link-file-link",".tree-item-self",".nav-file-title","[data-path]","a.internal-link"];[...Array.from(document.querySelectorAll(".embedded-backlinks")),...Array.from(document.querySelectorAll(".backlinks-pane")),...Array.from(document.querySelectorAll(".backlink-pane")),...Array.from(document.querySelectorAll(".outgoing-link-pane")),...Array.from(document.querySelectorAll(".outgoing-links")),...Array.from(document.querySelectorAll(".backlink-container"))].forEach(e=>{s.forEach(i=>{try{e.querySelectorAll(i).forEach(n=>{n instanceof HTMLElement&&this.overrideElementTextContent(n)})}catch(n){}})})}overrideElementTextContent(s){if(this.modifiedElements.has(s))return;let t=Object.getPrototypeOf(s),e=Object.getOwnPropertyDescriptor(t,"textContent");if(e&&e.set){this.originalTextContentDescriptors.set(s,e);try{Object.defineProperty(s,"textContent",{set:i=>{let n=this.extractFilePathFromElement(s);if(n&&n instanceof T.TFile){let a=this.getDisplayName(n);if(a&&(i===n.basename||i===n.name||i.endsWith(n.basename))){e.set.call(s,a),s.setAttribute("data-pov-processed","true"),this.processedElements.add(s);return}}e.set.call(s,i),s.setAttribute("data-pov-processed","true")},get:e.get||function(){var i,n;return((n=(i=Object.getOwnPropertyDescriptor(HTMLElement.prototype,"textContent"))==null?void 0:i.get)==null?void 0:n.call(this))||""},configurable:!0,enumerable:!0})}catch(i){s.setAttribute("data-pov-processed","true")}}else s.setAttribute("data-pov-processed","true");this.modifiedElements.add(s)}stopObserving(){this.observer&&(this.observer.disconnect(),this.observer=void 0)}onLayoutChange(){this.plugin.settings.enableForBacklinks?setTimeout(()=>{this.updateBacklinks()},100):this.stopObserving()}onFileOpen(){this.plugin.settings.enableForBacklinks&&setTimeout(()=>{this.updateEmbeddedBacklinks()},200)}onunload(){this.stopObserving(),this.originalTextContentDescriptors.forEach((s,t)=>{try{Object.defineProperty(t,"textContent",s)}catch(e){}}),this.originalTextContentDescriptors.clear(),this.modifiedElements=new WeakSet}};var V=class{constructor(s){this.observer=null;this.originalSetText=null;this.modifiedElements=new WeakSet;this.plugin=s}async renameTabs(){document.querySelectorAll(".workspace-tab-header").forEach(i=>{i.setAttribute("data-pov-processed","true")});let t=["markdown","graph","localgraph","backlink","file-explorer"];for(let i of t)this.plugin.app.workspace.getLeavesOfType(i).forEach(a=>{let r=a.tabHeaderEl;r&&r.setAttribute("data-pov-processed","true")});if(!this.plugin.settings.enableForTabs)return;this.plugin.app.workspace.getLeavesOfType("markdown").forEach(i=>{var r,o;let n=i.view,a=i.getViewState();if((r=a.state)!=null&&r.file&&!(n!=null&&n.file)&&i.setViewState({type:a.type,state:a.state}),n!=null&&n.file){let l=n.file,p=this.plugin.app.metadataCache.getFileCache(l),c=(o=p==null?void 0:p.frontmatter)==null?void 0:o[this.plugin.settings.propertyKey],h=i.tabHeaderEl;if(h){let g=h.querySelector(".workspace-tab-header-inner-title");if(g){let m=c&&String(c).trim()||l.basename||"";m&&g.setText(m)}let d=c&&String(c).trim()||l.basename||"";d&&(h.setAttribute("aria-label",d),h.setAttribute("title",d)),h.setAttribute("data-pov-processed","true")}}})}registerEvents(){if(this.startObserving(),!this.plugin.settings.enableForTabs){this.renameTabs();return}this.plugin.registerEvent(this.plugin.app.workspace.on("layout-change",()=>this.renameTabs())),this.plugin.registerEvent(this.plugin.app.workspace.on("active-leaf-change",()=>this.renameTabs())),this.plugin.registerEvent(this.plugin.app.workspace.on("file-open",()=>this.renameTabs())),this.plugin.registerEvent(this.plugin.app.vault.on("rename",()=>this.renameTabs())),this.plugin.registerEvent(this.plugin.app.metadataCache.on("changed",()=>this.renameTabs()))}startObserving(){this.observer||(this.overrideSetText(),setTimeout(()=>{this.overrideSetText()},100),this.observer=new MutationObserver(s=>{var t,e,i,n;for(let a of s)if(a.type==="childList"){for(let r of Array.from(a.addedNodes))if(r instanceof HTMLElement){let o=null;(t=r.classList)!=null&&t.contains("workspace-tab-header")?o=r:o=(e=r.querySelector)==null?void 0:e.call(r,".workspace-tab-header"),o&&(o.setAttribute("data-pov-processed","true"),this.overrideTitleElement(o),this.renameTab(o))}}else if(a.type==="characterData"){let o=(n=(i=a.target.parentElement)==null?void 0:i.closest)==null?void 0:n.call(i,".workspace-tab-header-inner-title");if(o){let l=o.closest(".workspace-tab-header");l&&(l.setAttribute("data-pov-processed","true"),this.overrideTitleElement(l),this.renameTab(l))}}}),this.observer.observe(document.body,{childList:!0,subtree:!0,characterData:!0}))}overrideSetText(){document.querySelectorAll(".workspace-tab-header-inner-title").forEach(t=>{this.overrideTitleElement(t)})}overrideTitleElement(s){let t=s.querySelector(".workspace-tab-header-inner-title");if(!t||this.modifiedElements.has(t))return;let e=t.setText;e&&typeof e=="function"&&(t.pov_originalSetText=e,t.setText=i=>{s.setAttribute("data-pov-processed","true");let a=this.shouldReplaceTitle(s,i||"").newText||i||"";a.trim()?(e.call(t,a.trim()),s.setAttribute("aria-label",a.trim()),s.setAttribute("title",a.trim())):i&&i.trim()&&e.call(t,i.trim())},this.modifiedElements.add(t))}shouldReplaceTitle(s,t){var i;if(!this.plugin.settings.enableForTabs)return{newText:null};let e=this.plugin.app.workspace.getLeavesOfType("markdown");for(let n of e)if(n.tabHeaderEl===s){let r=n.view;if(r!=null&&r.file){let o=r.file,l=this.plugin.app.metadataCache.getFileCache(o),p=(i=l==null?void 0:l.frontmatter)==null?void 0:i[this.plugin.settings.propertyKey];return p&&String(p).trim()?{newText:String(p).trim()}:{newText:o.basename||t||""||null}}if(t&&t.trim())return{newText:t.trim()};break}return t&&t.trim()?{newText:t.trim()}:{newText:null}}renameTab(s){var e;if(s.setAttribute("data-pov-processed","true"),!this.plugin.settings.enableForTabs)return;let t=this.plugin.app.workspace.getLeavesOfType("markdown");for(let i of t)if(i.tabHeaderEl===s){let a=i.view;if(a!=null&&a.file){let r=a.file,o=this.plugin.app.metadataCache.getFileCache(r),l=(e=o==null?void 0:o.frontmatter)==null?void 0:e[this.plugin.settings.propertyKey],p=s.querySelector(".workspace-tab-header-inner-title");if(p){let c=l&&String(l).trim()||r.basename||"";c&&(p.textContent||"")!==c&&(p.setText(c),s.setAttribute("aria-label",c),s.setAttribute("title",c)),s.setAttribute("data-pov-processed","true")}}break}}updateTabs(){this.renameTabs()}onunload(){this.observer&&(this.observer.disconnect(),this.observer=null),document.querySelectorAll(".workspace-tab-header-inner-title").forEach(t=>{let e=t;e.pov_originalSetText&&(e.setText=e.pov_originalSetText,delete e.pov_originalSetText)})}};var x=require("obsidian"),R=class{constructor(s){this.explorerView=null;this.modified=new WeakMap;this.plugin=s}getExplorerView(){if(this.explorerView===null){let s=this.plugin.app.workspace.getLeavesOfType("file-explorer");if(s.length===0)return null;let t=s[0];t&&t.view&&(this.explorerView=t.view)}return this.explorerView}getFolderNoteTitle(s){var n;if(!this.plugin.settings.folderNoteFilename||this.plugin.settings.folderNoteFilename.trim()==="")return null;let t=this.plugin.settings.folderNoteFilename.trim(),e=`${s.path}/${t}.md`,i=this.plugin.app.vault.getAbstractFileByPath(e);if(i instanceof x.TFile){let a=this.plugin.app.metadataCache.getFileCache(i),r=(n=a==null?void 0:a.frontmatter)==null?void 0:n[this.plugin.settings.propertyKey];if(r)return r}return null}resolveTitle(s){var t;if(s.file instanceof x.TFile){let e=this.plugin.app.metadataCache.getFileCache(s.file);return((t=e==null?void 0:e.frontmatter)==null?void 0:t[this.plugin.settings.propertyKey])||null}else if(s.file instanceof x.TFolder)return this.getFolderNoteTitle(s.file);return null}updateAllItems(){let s=this.getExplorerView();if(!s||!s.fileItems)return;let t=Object.values(s.fileItems);for(let e of t)this.modified.has(e)||this.modified.set(e,new q(e,this)),e.updateTitle()}restoreAllItems(){let s=this.getExplorerView();if(!s||!s.fileItems)return;let t=Object.values(s.fileItems);for(let e of t)if(this.modified.has(e)){let i=this.modified.get(e);i==null||i.destroy(),this.modified.delete(e),e.updateTitle()}}registerEvents(){this.plugin.settings.enableForExplorer&&(this.plugin.app.workspace.onLayoutReady(()=>{this.explorerView=null,this.updateAllItems()}),this.plugin.registerEvent(this.plugin.app.workspace.on("layout-change",()=>{this.explorerView=null,this.plugin.settings.enableForExplorer&&this.updateAllItems()})),this.plugin.registerEvent(this.plugin.app.metadataCache.on("changed",()=>{this.plugin.settings.enableForExplorer&&this.updateAllItems()})),this.plugin.registerEvent(this.plugin.app.vault.on("rename",()=>{this.plugin.settings.enableForExplorer&&(this.explorerView=null,setTimeout(()=>this.updateAllItems(),100))})))}updateExplorer(){this.plugin.settings.enableForExplorer?(this.explorerView=null,this.registerEvents(),setTimeout(()=>this.updateAllItems(),100)):this.restoreAllItems()}onunload(){this.restoreAllItems(),this.explorerView=null}},q=class{constructor(s,t){this.item=s;this.service=t;var i;let e=Object.getPrototypeOf(s);this.originalUpdateTitle=e.updateTitle.bind(s),this.originalStartRename=(i=e.startRename)==null?void 0:i.bind(s),s.updateTitle=this.updateTitle.bind(this),e.startRename&&(s.startRename=this.startRename.bind(this))}updateTitle(){if(this.originalUpdateTitle(),this.service.plugin.settings.enableForExplorer){let s=this.service.resolveTitle(this.item);s&&s.length>0&&this.item.innerEl.setText(s)}}startRename(){var s;return this.item.innerEl.setText(this.item.getTitle()),(s=this.originalStartRename)==null?void 0:s.call(this)}destroy(){let s=Object.getPrototypeOf(this.item);this.item.updateTitle=this.originalUpdateTitle,s.startRename&&(this.item.startRename=this.originalStartRename)}};var J=require("obsidian"),B=class{constructor(s){this.originalUpdateTitle=null;this.enabled=!1;this.plugin=s}getActiveFileTitle(){var t;let s=this.plugin.app.workspace.getActiveFile();if(s instanceof J.TFile){let e=this.plugin.app.metadataCache.getFileCache(s),i=(t=e==null?void 0:e.frontmatter)==null?void 0:t[this.plugin.settings.propertyKey];return i||s.basename}return""}updateTitle(){if(!this.enabled){this.originalUpdateTitle&&this.originalUpdateTitle();return}let s=this.getActiveFileTitle();if(s){let t=this.plugin.app;if(typeof t.getAppTitle=="function")document.title=t.getAppTitle(s);else{let e=this.plugin.app.vault.getName();document.title=`${s} - ${e}`}}else this.originalUpdateTitle&&this.originalUpdateTitle()}enable(){if(this.enabled)return;let s=this.plugin.app.workspace;s.updateTitle&&(this.originalUpdateTitle=s.updateTitle.bind(s),s.updateTitle=this.updateTitle.bind(this),this.updateTitle(),this.enabled=!0)}disable(){if(!this.enabled)return;let s=this.plugin.app.workspace;s.updateTitle&&this.originalUpdateTitle&&(s.updateTitle=this.originalUpdateTitle,s.updateTitle(),this.originalUpdateTitle=null,this.enabled=!1)}registerEvents(){this.plugin.settings.enableForWindowFrame&&(this.plugin.registerEvent(this.plugin.app.workspace.on("file-open",()=>{this.enabled&&this.updateTitle()})),this.plugin.registerEvent(this.plugin.app.metadataCache.on("changed",()=>{this.enabled&&this.updateTitle()})))}updateWindowFrame(){this.plugin.settings.enableForWindowFrame?(this.enable(),this.registerEvents()):this.disable()}onunload(){this.disable()}};var H=class extends S.Plugin{async onload(){await this.loadSettings(),this.quickSwitcherService=new N(this),this.dragDropService=new I(this),this.cacheService=new L(this),this.graphViewService=new M(this),this.backlinkService=new O(this),this.tabService=new V(this),this.explorerService=new R(this),this.windowFrameService=new B(this),this.tabService.registerEvents(),await this.tabService.renameTabs(),this.explorerService.registerEvents(),this.windowFrameService.registerEvents(),setTimeout(()=>{this.updateLinkSuggester(),this.updateQuickSwitcher(),this.updateBacklinks(),this.updateTabs(),this.updateExplorer(),this.updateWindowFrame()},1e3),this.app.workspace.onLayoutReady(()=>{this.graphViewService.onLayoutChange(),this.backlinkService.onLayoutChange(),this.tabService.renameTabs(),this.updateExplorer(),this.updateWindowFrame()}),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.graphViewService.onLayoutChange(),this.backlinkService.onLayoutChange()})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.backlinkService.onFileOpen()})),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof S.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.vault.on("rename",(t,e)=>{t instanceof S.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.vault.on("delete",t=>{t instanceof S.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.metadataCache.on("changed",t=>{t instanceof S.TFile&&t.extension==="md"&&(this.cacheService.rebuildCache(),this.settings.enableForGraphView&&this.graphViewService.refreshGraphView(),this.settings.enableForBacklinks&&this.backlinkService.updateBacklinks(),this.settings.enableForExplorer&&this.explorerService.updateExplorer(),this.settings.enableForWindowFrame&&this.windowFrameService.updateWindowFrame())})),this.registerEvent(this.app.metadataCache.on("resolved",()=>{this.cacheService.rebuildCache()})),this.registerEvent(this.app.workspace.on("editor-drop",(t,e)=>{this.settings.enableForDragDrop&&this.dragDropService.handleDragDrop(t,e)})),this.registerDomEvent(document,"drop",t=>{this.settings.enableForDragDrop&&this.dragDropService.handleDOMDrop(t)}),X(this),this.addSettingTab(new P(this.app,this))}updateLinkSuggester(){let t=this.app.workspace.editorSuggest;t&&(this.suggest&&(t.suggests=t.suggests.filter(e=>e!==this.suggest),this.suggest=void 0),this.settings.enableForLinking&&(this.suggest=new D(this),this.registerEditorSuggest(this.suggest),this.cacheService.setSuggest(this.suggest),t.suggests=t.suggests.filter(e=>!e.constructor.name.includes("LinkSuggest")),t.suggests.unshift(this.suggest)))}updateQuickSwitcher(){this.quickSwitcherService.updateQuickSwitcher()}updateGraphView(){this.graphViewService.updateGraphView()}updateBacklinks(){this.backlinkService.updateBacklinks()}updateTabs(){this.tabService.updateTabs()}updateExplorer(){this.explorerService.updateExplorer()}updateWindowFrame(){this.windowFrameService.updateWindowFrame()}rebuildCache(){this.cacheService.rebuildCache()}onunload(){let t=this.app.workspace.editorSuggest;t&&this.suggest&&(t.suggests=t.suggests.filter(e=>e!==this.suggest)),this.quickSwitcherService.restoreOriginalCommand(),this.graphViewService.onunload(),this.backlinkService.onunload(),this.tabService.onunload(),this.explorerService.onunload(),this.windowFrameService.onunload()}async loadSettings(){this.settings=Object.assign({},$,await this.loadData())}async saveSettings(t,e){await this.saveData(this.settings),t!==void 0&&t!==this.settings.enableForQuickSwitcher&&this.updateQuickSwitcher(),e!==void 0&&e!==this.settings.enableForTabs&&(this.tabService.registerEvents(),this.updateTabs())}};
