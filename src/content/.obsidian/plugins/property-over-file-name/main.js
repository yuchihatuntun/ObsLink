/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var V=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var K=(h,a)=>()=>(h&&(a=h(h=0)),a);var U=(h,a)=>{for(var t in a)V(h,t,{get:a[t],enumerable:!0})},j=(h,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of $(a))!q.call(h,i)&&i!==t&&V(h,i,{get:()=>a[i],enumerable:!(e=_(a,i))||e.enumerable});return h};var X=h=>j(V({},"__esModule",{value:!0}),h);function A(h,a,t){let e=new Map;return h.forEach(i=>{let s=a.getFileCache(i),n=s==null?void 0:s.frontmatter,r=i.basename,p=!1,l=[];if(n&&n[t]!==void 0&&n[t]!==null){let c=String(n[t]).trim();c!==""&&(r=c,p=!0)}n!=null&&n.aliases&&(l=Array.isArray(n.aliases)?n.aliases:[n.aliases],l=l.map(c=>String(c).trim()).filter(c=>c!=="")),e.set(i.path,{file:i,displayName:r,aliases:l,lastModified:i.stat.mtime,isCustomDisplay:p})}),e}var G=K(()=>{"use strict"});var B={};U(B,{QuickSwitchModal:()=>Q});var m,Q,R=K(()=>{"use strict";m=require("obsidian");G();Q=class extends m.FuzzySuggestModal{constructor(t,e){super(t);this.fileCache=new Map;this.recentFiles=[];this.searchTimeout=null;this.matchReasons=new Map;this.plugin=e,this.limit=8,this.plugin.settings.enableForQuickSwitcher?this.setPlaceholder("Type to search notes by title or file name..."):this.setPlaceholder("Type to search files..."),this.buildFileCache(),this.updateRecentFiles(),this.addKeyboardNavigation(),this.addFooter(),this.plugin.settings.enableForQuickSwitcher&&this.containerEl.addClass("property-over-filename-modal")}addKeyboardNavigation(){this.inputEl.addEventListener("keydown",t=>{t.key==="Escape"&&(this.close(),t.preventDefault(),t.stopPropagation())})}addFooter(){let t=this.containerEl.querySelector(".prompt");if(t){let e=t.createDiv({cls:"prompt-instructions"});[{command:"\u2191\u2193",action:"to navigate"},{command:"\u21B5",action:"to open"},{command:"ctrl \u21B5",action:"to open in new tab"},{command:"ctrl alt \u21B5",action:"to open to the right"},{command:"shift \u21B5",action:"to create"},{command:"esc",action:"to dismiss"}].forEach(({command:s,action:n})=>{let r=e.createDiv({cls:"prompt-instruction"});r.createSpan({cls:"prompt-instruction-command",text:s}),r.createSpan({text:n})})}}buildFileCache(){let t=this.getFilteredFiles();this.fileCache=A(t,this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=t.basename,n=!1,r=[];if(i&&i[this.plugin.settings.propertyKey]!==void 0&&i[this.plugin.settings.propertyKey]!==null){let p=String(i[this.plugin.settings.propertyKey]).trim();p!==""&&(s=p,n=!0)}i!=null&&i.aliases&&(r=Array.isArray(i.aliases)?i.aliases:[i.aliases],r=r.map(p=>String(p).trim()).filter(p=>p!=="")),this.fileCache.set(t.path,{file:t,displayName:s,aliases:r,lastModified:t.stat.mtime,isCustomDisplay:n})}updateRecentFiles(){var p,l;let t=[],e=this.app.workspace,i=this.getQuickSwitcherOptions(),s=(p=i==null?void 0:i.showAttachments)!=null?p:!0;(l=e.recentFileTracker)!=null&&l.getLastOpenFiles&&(t=e.recentFileTracker.getLastOpenFiles().map(o=>this.app.vault.getAbstractFileByPath(o)).filter(o=>o instanceof m.TFile)),t.length===0&&(t=[...this.app.workspace.getLeavesOfType("markdown").map(o=>o.view).filter(o=>o instanceof m.MarkdownView).map(o=>o.file).filter(o=>o!==null).filter((o,u,g)=>g.indexOf(o)===u)]),s||(t=t.filter(c=>c.extension==="md"));let n=8,r=new Set(t.map(c=>c.path));if(t.length<n)if(s){let o=this.app.vault.getFiles().filter(u=>u instanceof m.TFile).filter(u=>!r.has(u.path)).slice(0,n-t.length);t.push(...o)}else{let o=this.app.vault.getMarkdownFiles().filter(u=>!r.has(u.path)).slice(0,n-t.length);t.push(...o)}this.recentFiles=t.slice(0,n)}getItems(){return this.getFilteredFiles()}getFilteredFiles(){let t=this.getQuickSwitcherOptions(),e=this.app.vault.getMarkdownFiles();return t!=null&&t.showAttachments&&(e=this.app.vault.getFiles().filter(s=>s instanceof m.TFile).filter(s=>s.extension==="md"||this.isAttachment(s))),e}isAttachment(t){return["png","jpg","jpeg","gif","svg","webp","pdf","mp4","mp3","wav","ogg","webm"].includes(t.extension.toLowerCase())}getQuickSwitcherOptions(){var t;try{let e=this.app.internalPlugins;if(!e)return null;let i=(t=e.getPluginById)==null?void 0:t.call(e,"switcher");return!i||!i.instance?null:i.instance.options||null}catch(e){return console.warn("Property Over Filename: Could not access Quick Switcher options:",e),null}}getItemText(t){return"isNewNote"in t?t.newName:"isUnresolved"in t?t.unresolvedText:this.plugin.settings.enableForQuickSwitcher?this.getDisplayName(t):t.basename}getDisplayName(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=i==null?void 0:i[this.plugin.settings.propertyKey];if(s!=null){let n=String(s).trim();if(n!=="")return n}return t.basename}getSuggestions(t){var i;if(!this.plugin.settings.enableForQuickSwitcher){let s=t.trim();if(!s)return this.getRecentFilesResults();let n=this.getFilteredFiles(),r=this.plugin.settings.useSimpleSearch?(0,m.prepareSimpleSearch)(s):(0,m.prepareFuzzySearch)(s),p=[];for(let l of n){let c=(i=r(l.basename))!=null?i:{score:0,matches:[]};c.matches.length>0&&p.push({item:l,match:c})}if((0,m.sortSearchResults)(p),p.length===0){let l={isNewNote:!0,newName:s};p.push({item:l,match:{score:1e3,matches:[[0,s.length]]}})}return p.slice(0,this.limit)}let e=t.trim();return this.searchTimeout&&clearTimeout(this.searchTimeout),e?this.performSearch(e):this.getRecentFilesResults()}getRecentFilesResults(){return this.updateRecentFiles(),this.matchReasons.clear(),this.recentFiles.map(t=>({item:t,match:{score:1e3,matches:[]}}))}performSearch(t){var r;let e=this.plugin.settings.useSimpleSearch?(0,m.prepareSimpleSearch)(t):(0,m.prepareFuzzySearch)(t),i=[];this.matchReasons.clear();for(let p of this.fileCache.values()){let{file:l,displayName:c,aliases:o,isCustomDisplay:u}=p,g={matchedInTitle:!1,matchedInFilename:!1,matchedInAlias:!1},d=null,f=null,w=null;if(u&&(d=e(c),d&&d.matches.length>0&&(g.matchedInTitle=!0,f=d,w="title")),!w){if(this.plugin.settings.includeFilenameInSearch&&l.basename!==c){let v=e(l.basename);v&&v.matches.length>0&&(g.matchedInFilename=!0,f={...v,score:v.score-1},w="filename")}else if(!u){let v=e(l.basename);v&&v.matches.length>0&&(g.matchedInFilename=!0,f=v,w="filename")}}if(!w&&this.plugin.settings.includeAliasesInSearch&&o.length>0)for(let v of o){let y=e(v);if(y&&y.matches.length>0){g.matchedInAlias=!0,g.matchedAliasText=v,f={...y,score:y.score-1},w="alias";break}}f&&f.matches.length>0&&(i.push({item:l,match:f}),this.matchReasons.set(l.path,g))}let s=this.getQuickSwitcherOptions(),n=(r=s==null?void 0:s.showExistingOnly)!=null?r:!1;if(!n){let{unresolvedLinks:p}=this.app.metadataCache,l=new Set;for(let c in p)Object.keys(p[c]).forEach(u=>l.add(u));for(let c of l){let o=e(c);if(o&&o.matches.length>0){let u={isUnresolved:!0,unresolvedText:c};i.push({item:u,match:o})}}}try{(0,m.sortSearchResults)(i);let p=i;n&&(p=i.filter(o=>o.item instanceof m.TFile||"isNewNote"in o.item&&o.item.isNewNote===!0));let l=t.toLowerCase(),c=p.some(o=>{var u;return o.item instanceof m.TFile&&(this.getDisplayName(o.item).toLowerCase()===l||this.plugin.settings.includeFilenameInSearch&&o.item.basename.toLowerCase()===l||this.plugin.settings.includeAliasesInSearch&&((u=this.fileCache.get(o.item.path))==null?void 0:u.aliases.some(g=>g.toLowerCase()===l)))});if(!n&&!c){let{unresolvedLinks:o}=this.app.metadataCache,u=new Set;for(let g in o)Object.keys(o[g]).forEach(f=>u.add(f));c=Array.from(u).some(g=>g.toLowerCase()===l)}if(!c&&t){let o={isNewNote:!0,newName:t};p.unshift({item:o,match:{score:1e3,matches:[[0,t.length]]}})}return p.slice(0,this.limit)}catch(p){return console.error("Error generating suggestions:",p),new m.Notice("Error updating quick switcher suggestions. Please check console for details."),[]}}renderSuggestion(t,e){var n;let{item:i}=t;if("isUnresolved"in i&&i.isUnresolved){let r=i.unresolvedText;e.empty(),e.addClass("mod-complex"),e.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title"}).setText(r);let o=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":"Unresolved link - Enter to create"}});this.createFilePlusIcon(o);return}let s=this.getItemText(i);if("isNewNote"in i){e.empty(),e.addClass("mod-complex"),e.createDiv({cls:"suggestion-content"}).createDiv({cls:"suggestion-title"}).setText(s),e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-action"}).setText("Enter to create");return}if(!this.plugin.settings.enableForQuickSwitcher)i instanceof m.TFile?e.setText(i.path.replace(".md","")):e.setText(s);else{if(!(i instanceof m.TFile)){e.setText(s);return}let r=this.fileCache.get(i.path),p=(n=r==null?void 0:r.isCustomDisplay)!=null?n:!1,l=this.matchReasons.get(i.path);if(!p&&(l!=null&&l.matchedInAlias)&&l.matchedAliasText){e.addClass("mod-complex");let c=e.createDiv({cls:"suggestion-content"});c.createDiv({cls:"suggestion-title"}).setText(l.matchedAliasText),c.createDiv({cls:"suggestion-note"}).setText(i.path.replace(".md",""));let d=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":"Alias Match"}});this.createForwardIcon(d)}else if(p)if(l&&(l.matchedInTitle||l.matchedInFilename||l.matchedInAlias)){e.addClass("mod-complex");let o=e.createDiv({cls:"suggestion-content"});o.createDiv({cls:"suggestion-title"}).setText(s),o.createDiv({cls:"suggestion-note"}).setText(i.path.replace(".md",""));let f=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":this.getIconLabel(l)}});l.matchedInTitle?this.createTypeIcon(f):l.matchedInFilename?this.createFileIcon(f):l.matchedInAlias&&this.createForwardIcon(f)}else{e.addClass("mod-complex");let o=e.createDiv({cls:"suggestion-content"});o.createDiv({cls:"suggestion-title"}).setText(s),o.createDiv({cls:"suggestion-note"}).setText(i.path.replace(".md",""));let f=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":"Property-based title"}});this.createTypeIcon(f)}else e.setText(s)}}getIconLabel(t){return t.matchedInTitle?"Title/Property Match":t.matchedInFilename?"File Name Match":t.matchedInAlias?"Alias Match":"Match"}createTypeIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-type");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","4 7 4 4 20 4 20 7"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","9"),s.setAttribute("y1","20"),s.setAttribute("x2","15"),s.setAttribute("y2","20"),e.appendChild(s);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","12"),n.setAttribute("y1","4"),n.setAttribute("x2","12"),n.setAttribute("y2","20"),e.appendChild(n),t.appendChild(e)}createFileIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-file-text");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","polyline");s.setAttribute("points","14,2 14,8 20,8"),e.appendChild(s);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","16"),n.setAttribute("y1","13"),n.setAttribute("x2","8"),n.setAttribute("y2","13"),e.appendChild(n);let r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1","16"),r.setAttribute("y1","17"),r.setAttribute("x2","8"),r.setAttribute("y2","17"),e.appendChild(r);let p=document.createElementNS("http://www.w3.org/2000/svg","polyline");p.setAttribute("points","10,9 9,9 8,9"),e.appendChild(p),t.appendChild(e)}createForwardIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-forward");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","15 17 20 12 15 7"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M4 18v-2a4 4 0 0 1 4-4h12"),e.appendChild(s),t.appendChild(e)}createFilePlusIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-file-plus");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","polyline");s.setAttribute("points","14,2 14,8 20,8"),e.appendChild(s);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","12"),n.setAttribute("y1","18"),n.setAttribute("x2","12"),n.setAttribute("y2","12"),e.appendChild(n);let r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1","9"),r.setAttribute("y1","15"),r.setAttribute("x2","15"),r.setAttribute("y2","15"),e.appendChild(r),t.appendChild(e)}isUsingCustomProperty(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=i==null?void 0:i[this.plugin.settings.propertyKey];return s!=null&&String(s).trim()!==""}isUsingAlias(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=i==null?void 0:i.aliases;return s?!this.isUsingCustomProperty(t)&&s:!1}onChooseItem(t,e){var i,s;if("isUnresolved"in t&&t.isUnresolved){let n=t.unresolvedText,r=this.app.workspace.getActiveViewOfType(m.MarkdownView),p=((i=r==null?void 0:r.file)==null?void 0:i.path)||"";this.app.workspace.openLinkText(n,p).catch(l=>{new m.Notice(`Error creating note: ${l.message}`)});return}if("isNewNote"in t){let n=this.app.workspace.getActiveViewOfType(m.MarkdownView),r=((s=n==null?void 0:n.file)==null?void 0:s.path)||"";this.app.workspace.openLinkText(t.newName,r).catch(p=>{new m.Notice(`Error creating note: ${p.message}`)})}else t instanceof m.TFile&&(e instanceof KeyboardEvent?e.ctrlKey&&e.altKey?this.app.workspace.getLeaf(!0).openFile(t):e.ctrlKey?this.app.workspace.getLeaf().openFile(t):e.shiftKey?this.app.workspace.getLeaf().openFile(t):this.app.workspace.getLeaf().openFile(t):this.app.workspace.getLeaf().openFile(t))}}});var J={};U(J,{default:()=>O});module.exports=X(J);var F=require("obsidian");var H={propertyKey:"title",enableForLinking:!0,enableForQuickSwitcher:!0,includeFilenameInSearch:!0,includeAliasesInSearch:!0,enableForDragDrop:!0,useSimpleSearch:!1,enableForGraphView:!0,enableForBacklinks:!0};var k=require("obsidian");G();var E=class extends k.EditorSuggest{constructor(t){super(t.app);this.fileCache=new Map;this.searchTimeout=null;this.matchReasons=new Map;this.plugin=t,this.buildFileCache()}open(){super.open();let t=this.suggestEl;if(t&&(t.addClass("property-over-filename-suggestion"),!t.querySelector(".prompt-instructions"))){let e=t.createDiv({cls:"prompt-instructions"});e.createDiv({cls:"prompt-instruction"}).setText("Type # to link heading"),e.createDiv({cls:"prompt-instruction"}).setText("Type ^ to link blocks"),e.createDiv({cls:"prompt-instruction"}).setText("Type | to change display text")}this.addKeyboardNavigation()}addKeyboardNavigation(){let t=this.suggestEl;t&&t.addEventListener("keydown",e=>{e.key==="Escape"&&(this.close(),e.preventDefault(),e.stopPropagation())})}onTrigger(t,e,i){if(!this.plugin.settings.enableForLinking)return null;let s=e.getLine(t.line).substring(0,t.ch),n=/\[\[([^#^|\]]*)$/.exec(s);return n?{start:{line:t.line,ch:s.lastIndexOf("[[")},end:t,query:n[1]}:null}buildFileCache(){this.fileCache=A(this.app.vault.getMarkdownFiles(),this.app.metadataCache,this.plugin.settings.propertyKey)}updateFileCache(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=t.basename,n=!1,r=[];if(i&&i[this.plugin.settings.propertyKey]!==void 0&&i[this.plugin.settings.propertyKey]!==null){let p=String(i[this.plugin.settings.propertyKey]).trim();p!==""&&(s=p,n=!0)}i!=null&&i.aliases&&(r=Array.isArray(i.aliases)?i.aliases:[i.aliases],r=r.map(p=>String(p).trim()).filter(p=>p!=="")),this.fileCache.set(t.path,{file:t,displayName:s,aliases:r,lastModified:t.stat.mtime,isCustomDisplay:n})}getSuggestions(t){let e=t.query.trim();return this.performSearch(e)}performSearch(t){var p;if(!t||t.trim()===""){let l=[];for(let c of this.fileCache.values())l.push({file:c.file,display:c.displayName,isCustomDisplay:c.isCustomDisplay});return l}let e=this.plugin.settings.useSimpleSearch?(0,k.prepareSimpleSearch)(t):(0,k.prepareFuzzySearch)(t),i=[];this.matchReasons.clear();for(let l of this.fileCache.values()){let{file:c,displayName:o,aliases:u,isCustomDisplay:g}=l,d={matchedInTitle:!1,matchedInFilename:!1,matchedInAlias:!1},f=null,w=null,v=null;if(g&&(f=e(o),f&&f.matches.length>0&&(d.matchedInTitle=!0,w=f,v="title")),!v){if(this.plugin.settings.includeFilenameInSearch&&c.basename!==o){let y=e(c.basename);y&&y.matches.length>0&&(d.matchedInFilename=!0,w={...y,score:y.score-1},v="filename")}else if(!g){let y=e(c.basename);y&&y.matches.length>0&&(d.matchedInFilename=!0,w=y,v="filename")}}if(!v&&this.plugin.settings.includeAliasesInSearch&&u.length>0)for(let y of u){let T=e(y);if(T&&T.matches.length>0){d.matchedInAlias=!0,d.matchedAliasText=y,w={...T,score:T.score-1},v="alias";break}}if(w&&w.matches.length>0){let y={file:c,display:o,isCustomDisplay:g};i.push({item:y,match:w}),this.matchReasons.set(c.path,d)}}let s=this.getQuickSwitcherOptions(),n=(p=s==null?void 0:s.showExistingOnly)!=null?p:!1;if(!n){let{unresolvedLinks:l}=this.app.metadataCache,c=new Set;for(let o in l)Object.keys(l[o]).forEach(g=>c.add(g));for(let o of c){let u=e(o);u&&u.matches.length>0&&i.push({item:{display:o,isCustomDisplay:!1},match:u})}}(0,k.sortSearchResults)(i);let r=i.map(l=>l.item);return n&&(r=r.filter(l=>l.file!==void 0)),r.length===0&&t&&r.push({display:"No match found",isCustomDisplay:!1,isNoMatch:!0}),r}renderSuggestion(t,e){if(e.empty(),t.isNoMatch){e.setText(t.display);return}if(t.file){let i=this.matchReasons.get(t.file.path);if(!t.isCustomDisplay&&(i!=null&&i.matchedInAlias)&&i.matchedAliasText){e.addClass("mod-complex");let s=e.createDiv({cls:"suggestion-content"});s.createDiv({cls:"suggestion-title"}).setText(i.matchedAliasText),s.createDiv({cls:"suggestion-note"}).setText(t.file.path.replace(".md",""));let l=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":"Alias Match"}});this.createForwardIcon(l)}else if(t.isCustomDisplay)if(i&&(i.matchedInTitle||i.matchedInFilename||i.matchedInAlias)){e.addClass("mod-complex");let n=e.createDiv({cls:"suggestion-content"});n.createDiv({cls:"suggestion-title"}).setText(t.display),n.createDiv({cls:"suggestion-note"}).setText(t.file.path.replace(".md",""));let c=e.createDiv({cls:"suggestion-aux"}).createSpan({cls:"suggestion-flair",attr:{"aria-label":this.getIconLabel(i)}});i.matchedInTitle?this.createTypeIcon(c):i.matchedInFilename?this.createFileIcon(c):i.matchedInAlias&&this.createForwardIcon(c)}else e.setText(t.display);else e.setText(t.display)}}getIconLabel(t){return t.matchedInTitle?"Title/Property Match":t.matchedInFilename?"File Name Match":t.matchedInAlias?"Alias Match":"Match"}createTypeIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-type");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","4 7 4 4 20 4 20 7"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1","9"),s.setAttribute("y1","20"),s.setAttribute("x2","15"),s.setAttribute("y2","20"),e.appendChild(s);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","12"),n.setAttribute("y1","4"),n.setAttribute("x2","12"),n.setAttribute("y2","20"),e.appendChild(n),t.appendChild(e)}createFileIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-file-text");let i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","polyline");s.setAttribute("points","14,2 14,8 20,8"),e.appendChild(s);let n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","16"),n.setAttribute("y1","13"),n.setAttribute("x2","8"),n.setAttribute("y2","13"),e.appendChild(n);let r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1","16"),r.setAttribute("y1","17"),r.setAttribute("x2","8"),r.setAttribute("y2","17"),e.appendChild(r);let p=document.createElementNS("http://www.w3.org/2000/svg","polyline");p.setAttribute("points","10,9 9,9 8,9"),e.appendChild(p),t.appendChild(e)}createForwardIcon(t){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.classList.add("svg-icon","lucide-forward");let i=document.createElementNS("http://www.w3.org/2000/svg","polyline");i.setAttribute("points","15 17 20 12 15 7"),e.appendChild(i);let s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M4 18v-2a4 4 0 0 1 4-4h12"),e.appendChild(s),t.appendChild(e)}isUsingCustomProperty(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=i==null?void 0:i[this.plugin.settings.propertyKey];return s!=null&&String(s).trim()!==""}isUsingAlias(t){let e=this.app.metadataCache.getFileCache(t),i=e==null?void 0:e.frontmatter,s=i==null?void 0:i.aliases;return s?!this.isUsingCustomProperty(t)&&s:!1}selectSuggestion(t,e){var d,f;if(t.isNoMatch)return;let i=this.app.workspace.getActiveViewOfType(k.MarkdownView);if(!i||!this.context)return;let s=i.editor,{start:n,end:r}=this.context,p=s.getLine(n.line),l=r;if(p.slice(r.ch,r.ch+2)==="]]"&&(l={line:r.line,ch:r.ch+2}),!t.file)return;let c=this.app.vault,o=(f=(d=c.getConfig)==null?void 0:d.call(c,"useMarkdownLinks"))!=null?f:!1,u;t.isCustomDisplay?o?u=`[${t.display}](${encodeURI(t.file.path)})`:u=`[[${t.file.path.replace(".md","")}|${t.display}]]`:o?u=`[${t.file.path.replace(".md","")}](${encodeURI(t.file.path)})`:u=`[[${t.file.path.replace(".md","")}]]`,s.replaceRange(u,{line:n.line,ch:n.ch},l);let g=n.ch+u.length;try{s.setCursor({line:n.line,ch:g})}catch(w){console.error("Error setting cursor:",w),new k.Notice("Error setting cursor position. Please check console for details.")}}getQuickSwitcherOptions(){var t;try{let e=this.app.internalPlugins;if(!e)return null;let i=(t=e.getPluginById)==null?void 0:t.call(e,"switcher");return!i||!i.instance?null:i.instance.options||null}catch(e){return console.warn("Property Over Filename: Could not access Quick Switcher options:",e),null}}};var b=require("obsidian"),P=class extends b.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.addClass("property-over-filename-settings"),new b.Setting(t).setName("Property key").setDesc("The property to use as the display title. Falls back to the file name when no property is set for that item.").addText(e=>e.setPlaceholder("title").setValue(this.plugin.settings.propertyKey).onChange(async i=>{this.plugin.settings.propertyKey=i.trim()||"title",await this.plugin.saveData(this.plugin.settings),this.plugin.updateLinkSuggester(),this.plugin.updateGraphView(),this.plugin.updateBacklinks()})),new b.Setting(t).setName("When linking notes").setDesc("Enable property-based titles in the link suggester.").addToggle(e=>e.setValue(this.plugin.settings.enableForLinking).onChange(async i=>{this.plugin.settings.enableForLinking=i,await this.plugin.saveData(this.plugin.settings),this.plugin.updateLinkSuggester()})),new b.Setting(t).setName("In quick switcher").setDesc("Enable property-based titles in the quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.enableForQuickSwitcher).onChange(async i=>{let s=this.plugin.settings.enableForQuickSwitcher;this.plugin.settings.enableForQuickSwitcher=i,await this.plugin.saveSettings(s)})),new b.Setting(t).setName("Include file name in fuzzy searches").setDesc("Include note file names in fuzzy search results for link suggester and quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.includeFilenameInSearch).onChange(async i=>{this.plugin.settings.includeFilenameInSearch=i,await this.plugin.saveData(this.plugin.settings)})),new b.Setting(t).setName("Include aliases in fuzzy searches").setDesc("Include property aliases in fuzzy search results for link suggester and quick switcher.").addToggle(e=>e.setValue(this.plugin.settings.includeAliasesInSearch).onChange(async i=>{this.plugin.settings.includeAliasesInSearch=i,await this.plugin.saveData(this.plugin.settings)})),new b.Setting(t).setName("When dragging notes").setDesc("Use property-based titles when dragging notes from the file explorer.").addToggle(e=>e.setValue(this.plugin.settings.enableForDragDrop).onChange(async i=>{this.plugin.settings.enableForDragDrop=i,await this.plugin.saveData(this.plugin.settings)})),new b.Setting(t).setName("In graph view").setDesc("Use the property instead of the file name as the note's title in graph view.").addToggle(e=>e.setValue(this.plugin.settings.enableForGraphView).onChange(async i=>{this.plugin.settings.enableForGraphView=i,await this.plugin.saveData(this.plugin.settings),this.plugin.updateGraphView()})),new b.Setting(t).setName("In backlinks and outgoing links").setDesc("Use the property instead of the file name in the linked mentions footer, dedicated backlinks panel, and outgoing links.").addToggle(e=>e.setValue(this.plugin.settings.enableForBacklinks).onChange(async i=>{this.plugin.settings.enableForBacklinks=i,await this.plugin.saveData(this.plugin.settings),this.plugin.updateBacklinks()})),new b.Setting(t).setName("Use simple search").setDesc("Instead of using fuzzy search, simple search provides better performance with very large vaults (thousands of files).").addToggle(e=>e.setValue(this.plugin.settings.useSimpleSearch).onChange(async i=>{this.plugin.settings.useSimpleSearch=i,await this.plugin.saveData(this.plugin.settings)}))}};var C=require("obsidian");function W(h){h.addCommand({id:"open-quick-switcher",name:"Open quick switcher (property-based)",callback:async()=>{let{QuickSwitchModal:a}=await Promise.resolve().then(()=>(R(),B));new a(h.app,h).open()}}),h.addCommand({id:"toggle-linking",name:"Toggle property-based linking",callback:async()=>{h.settings.enableForLinking=!h.settings.enableForLinking,await h.saveData(h.settings),h.updateLinkSuggester(),new C.Notice(`Property-based linking ${h.settings.enableForLinking?"enabled":"disabled"}`)}}),h.addCommand({id:"toggle-quick-switcher",name:"Toggle property-based quick switcher",callback:async()=>{let a=h.settings.enableForQuickSwitcher;h.settings.enableForQuickSwitcher=!h.settings.enableForQuickSwitcher,await h.saveSettings(a),new C.Notice(`Property-based Quick Switcher ${h.settings.enableForQuickSwitcher?"enabled":"disabled"}`)}}),h.addCommand({id:"rebuild-cache",name:"Rebuild file cache",callback:()=>{h.rebuildCache(),new C.Notice("File cache rebuilt")}}),h.addCommand({id:"toggle-drag-drop",name:"Toggle property-based drag and drop",callback:async()=>{h.settings.enableForDragDrop=!h.settings.enableForDragDrop,await h.saveData(h.settings),new C.Notice(`Property-based drag and drop ${h.settings.enableForDragDrop?"enabled":"disabled"}`)}})}var D=class{constructor(a){this.isCommandOverridden=!1;this.plugin=a}updateQuickSwitcher(){this.plugin.settings.enableForQuickSwitcher&&!this.isCommandOverridden?this.overrideQuickSwitcherCommand():!this.plugin.settings.enableForQuickSwitcher&&this.isCommandOverridden&&this.restoreOriginalCommand()}overrideQuickSwitcherCommand(){var e;let a=this.plugin.app.commands.commands;if(a["switcher:open"]&&!this.originalSwitcherCommand){let i=a["switcher:open"];this.originalSwitcherCommand={id:i.id||"switcher:open",name:i.name||"Quick Switcher",icon:i.icon,hotkeys:i.hotkeys?[...i.hotkeys]:[],callback:i.callback}}a["switcher:open"]&&delete a["switcher:open"];let t={id:"switcher:open",name:"Quick Switcher",icon:(e=this.originalSwitcherCommand)==null?void 0:e.icon,hotkeys:[{modifiers:["Mod"],key:"o"}],callback:()=>{let i=this.plugin.app.workspace;i.switcher&&typeof i.switcher.close=="function"&&i.switcher.close(),document.querySelectorAll(".modal").forEach(n=>{n instanceof HTMLElement&&!n.classList.contains("hidden")&&n.addClass("hidden")});try{Promise.resolve().then(()=>(R(),B)).then(({QuickSwitchModal:n})=>{new n(this.plugin.app,this.plugin).open()}).catch(n=>{console.error("Error loading QuickSwitchModal:",n),this.originalSwitcherCommand&&this.originalSwitcherCommand.callback&&this.originalSwitcherCommand.callback()})}catch(n){console.error("Error creating QuickSwitchModal:",n),this.originalSwitcherCommand&&this.originalSwitcherCommand.callback&&this.originalSwitcherCommand.callback()}}};a["switcher:open"]=t,this.isCommandOverridden=!0}restoreOriginalCommand(){if(!this.originalSwitcherCommand)return;let a=this.plugin.app.commands.commands;a["switcher:open"]&&delete a["switcher:open"],a["switcher:open"]={id:this.originalSwitcherCommand.id,name:this.originalSwitcherCommand.name,icon:this.originalSwitcherCommand.icon,hotkeys:this.originalSwitcherCommand.hotkeys,callback:this.originalSwitcherCommand.callback},this.isCommandOverridden=!1}};var x=require("obsidian"),I=class{constructor(a){this.plugin=a}handleDragDrop(a,t){if(!a.dataTransfer||!a.dataTransfer.files.length)return;let e=a.dataTransfer.getData("text/plain");if(!e||!e.endsWith(".md"))return;let i=this.plugin.app.vault.getAbstractFileByPath(e);if(!i||!(i instanceof x.TFile))return;let s=this.getDisplayName(i);s!==null&&setTimeout(()=>{this.replaceLastInsertedLink(i,s,t)},50)}handleDOMDrop(a){var r;let t=a.target;if(!t||!t.closest(".cm-editor"))return;let e=(r=a.dataTransfer)==null?void 0:r.getData("text/plain");if(!e)return;let i=e;if(e.startsWith("obsidian://open?")){let l=new URL(e).searchParams.get("file");if(l)i=decodeURIComponent(l)+".md";else return}else if(!e.endsWith(".md"))return;let s=this.plugin.app.vault.getAbstractFileByPath(i);if(!s||!(s instanceof x.TFile))return;let n=this.getDisplayName(s);n!==null&&setTimeout(()=>{let p=this.plugin.app.workspace.getActiveViewOfType(x.MarkdownView);p&&p.editor&&this.replaceLastInsertedLink(s,n,p.editor)},50)}getDisplayName(a){let t=this.plugin.app.metadataCache.getFileCache(a),e=t==null?void 0:t.frontmatter;if(e&&e[this.plugin.settings.propertyKey]!==void 0&&e[this.plugin.settings.propertyKey]!==null){let i=String(e[this.plugin.settings.propertyKey]).trim();if(i!=="")return i}return null}replaceLastInsertedLink(a,t,e){let i=e.getValue(),s=e.getCursor(),r=i.split(`
`)[s.line],p=/\[\[([^\]]+)\]\]/g,l=/\[([^\]]+)\]\(([^)]+)\)/g,c,o=null;for(;(c=p.exec(r))!==null;)o=c;if(o){let g=`[[${o[1]}|${t}]]`,d={line:s.line,ch:o.index},f={line:s.line,ch:o.index+o[0].length};e.replaceRange(g,d,f);return}for(l.lastIndex=0;(c=l.exec(r))!==null;)o=c;if(o){let u=o[2],g=`[${t}](${u})`,d={line:s.line,ch:o.index},f={line:s.line,ch:o.index+o[0].length};e.replaceRange(g,d,f)}}};var N=class{constructor(a){this.plugin=a}setSuggest(a){this.suggest=a}invalidateCache(a){this.suggest&&this.suggest.updateFileCache(a)}rebuildCache(){this.suggest&&this.suggest.buildFileCache()}};var z=require("obsidian"),L=class{constructor(a){this.modifiedPrototypes=[];this.plugin=a}createGetDisplayText(a){return function(){let e=this.pov_plugin;if(!e||!e.settings.enableForGraphView){if(this.pov_originalGetDisplayText)return this.pov_originalGetDisplayText();throw new Error("pov_originalGetDisplayText does not exist on node")}let i=a.vault.getFileByPath(this.id);if(i){let s=a.metadataCache.getFileCache(i),n=s==null?void 0:s.frontmatter;if(n&&n[e.settings.propertyKey]!==void 0&&n[e.settings.propertyKey]!==null){let r=String(n[e.settings.propertyKey]).trim();if(r!=="")return r}}if(this.pov_originalGetDisplayText)return this.pov_originalGetDisplayText();throw new Error("pov_originalGetDisplayText does not exist on node")}}getGraphLeaves(){let a=[];return a.push(...this.plugin.app.workspace.getLeavesOfType("graph")),a.push(...this.plugin.app.workspace.getLeavesOfType("localgraph")),[...new Set(a)]}overridePrototypes(){if(!this.plugin.settings.enableForGraphView)return;let a=this.getGraphLeaves();for(let t of a){if(!(t.view instanceof z.View)||t.isDeferred)continue;let e=t.view;this.overridePrototype(e)}}overridePrototype(a){let t;if(typeof a.renderer.nodes.first=="function")t=a.renderer.nodes.first();else if(a.renderer.nodes instanceof Set)t=a.renderer.nodes.values().next().value;else for(let e of a.renderer.nodes){t=e;break}if(t){let e=t.constructor.prototype;if(!e.hasOwnProperty("pov_originalGetDisplayText")&&!this.modifiedPrototypes.includes(e)){e.pov_originalGetDisplayText=e.getDisplayText,e.getDisplayText=this.createGetDisplayText(this.plugin.app),e.pov_plugin=this.plugin;for(let i of a.renderer.nodes)i.text&&(i.text.text=i.getDisplayText());a.renderer.changed(),this.modifiedPrototypes.push(e)}}}restorePrototypes(){for(let a of this.modifiedPrototypes)typeof a.pov_originalGetDisplayText=="function"&&(a.getDisplayText=a.pov_originalGetDisplayText,delete a.pov_originalGetDisplayText),delete a.pov_plugin;this.modifiedPrototypes=[],this.rewriteNames()}rewriteNames(){let a=this.getGraphLeaves();for(let t of a){if(!(t.view instanceof z.View)||t.isDeferred)continue;let e=t.view;for(let i of e.renderer.nodes)i.text&&(i.text.text=i.getDisplayText());e.renderer.changed()}}onLayoutChange(){var e,i;if(!this.plugin.settings.enableForGraphView){this.restorePrototypes();return}let t=(i=(e=this.plugin.app.internalPlugins)==null?void 0:e.getPluginById)==null?void 0:i.call(e,"graph");t!=null&&t._loaded&&this.overridePrototypes()}updateGraphView(){this.plugin.settings.enableForGraphView?this.overridePrototypes():this.restorePrototypes()}refreshGraphView(){this.plugin.settings.enableForGraphView&&this.rewriteNames()}onunload(){this.restorePrototypes()}};var S=require("obsidian"),M=class{constructor(a){this.processedElements=new WeakSet;this.plugin=a}getDisplayName(a){if(!this.plugin.settings.enableForBacklinks)return null;let t=this.plugin.app.metadataCache.getFileCache(a),e=t==null?void 0:t.frontmatter;if(e&&e[this.plugin.settings.propertyKey]!==void 0&&e[this.plugin.settings.propertyKey]!==null){let i=String(e[this.plugin.settings.propertyKey]).trim();if(i!=="")return i}return null}updateBacklinks(){if(!this.plugin.settings.enableForBacklinks){this.stopObserving();return}this.updateEmbeddedBacklinks(),this.updateDedicatedBacklinksPanel(),this.startObserving()}updateEmbeddedBacklinks(){for(let a of this.plugin.app.workspace.getLeavesOfType("markdown")){if(!(a.view instanceof S.MarkdownView))continue;let t=a.view.containerEl.querySelector(".embedded-backlinks");t&&this.updateBacklinkContainer(t)}}async updateDedicatedBacklinksPanel(){let a=this.plugin.app.workspace.getLeavesOfType("backlink");for(let t of a)if(await t.loadIfDeferred(),t.view){let e=t.view.containerEl;if(e){let i=e.querySelector(".backlinks-pane")||e.querySelector(".backlink-pane");i&&this.updateBacklinkContainer(i);let s=e.querySelector(".outgoing-link-pane")||e.querySelector(".outgoing-links");s&&this.updateBacklinkContainer(s)}}}extractFilePathFromElement(a){var s;let t=a.getAttribute("data-path");if(t){let n=this.plugin.app.vault.getAbstractFileByPath(t);if(n instanceof S.TFile)return n}let e=a.closest("a")||a.querySelector("a");if(e){let n=e.href||e.getAttribute("href");if(n){if(n.startsWith("obsidian://"))try{let c=new URL(n).searchParams.get("file");if(c){let o=decodeURIComponent(c),u=this.plugin.app.vault.getAbstractFileByPath(o+".md");if(u instanceof S.TFile)return u}}catch(l){}let r=n.match(/#file\/(.+)/);if(r){let l=decodeURIComponent(r[1]),c=this.plugin.app.vault.getAbstractFileByPath(l);if(c instanceof S.TFile)return c}let p=e.getAttribute("data-href");if(p){let l=this.plugin.app.vault.getAbstractFileByPath(p);if(l instanceof S.TFile)return l}}}let i=(s=a.textContent)==null?void 0:s.trim();if(i){let r=this.plugin.app.vault.getMarkdownFiles().find(p=>p.basename===i);if(r)return r}return null}updateBacklinkContainer(a){let t=[".tree-item-inner",".backlink-title",".backlink-file-link",".outgoing-link-file-link",".tree-item-self",".nav-file-title","[data-path]","a.internal-link"],e=new Set;t.forEach(i=>{try{a.querySelectorAll(i).forEach(s=>{e.add(s)})}catch(s){}}),e.forEach(i=>{if(this.processedElements.has(i))return;let s=this.extractFilePathFromElement(i);s&&s instanceof S.TFile&&this.updateElementWithFile(i,s)})}updateElementWithFile(a,t){var n;let e=this.getDisplayName(t);if(e===null)return;this.processedElements.add(a);let i=((n=a.textContent)==null?void 0:n.trim())||"",s=t.basename;if(i===s||i===t.name||i.endsWith(s)){let p=a.closest("a")||a.querySelector("a")||a,l=c=>{var u,g;if(c.childNodes.length===1&&c.childNodes[0].nodeType===Node.TEXT_NODE)return c.textContent=e,!0;let o=Array.from(c.childNodes).filter(d=>d.nodeType===Node.TEXT_NODE);if(o.length>0){o[0].textContent=e;for(let d=1;d<o.length;d++)o[d].remove();return!0}return((u=c.textContent)==null?void 0:u.trim())===s||((g=c.textContent)==null?void 0:g.trim())===t.name?(c.textContent=e,!0):!1};l(p)||l(a)}}startObserving(){if(this.observer)return;let a=null;this.observer=new MutationObserver(t=>{let e=!1;for(let i of t)if(i.type==="childList"||i.type==="characterData"){let s=i.target;if(s instanceof HTMLElement){let n=s.closest(".embedded-backlinks"),r=s.closest(".backlinks-pane, .backlink-pane, .outgoing-link-pane, .outgoing-links, .backlink-container");if(n||r){e=!0;break}}else if(s.parentElement){let n=s.parentElement.closest(".embedded-backlinks"),r=s.parentElement.closest(".backlinks-pane, .backlink-pane, .outgoing-link-pane, .outgoing-links, .backlink-container");if(n||r){e=!0;break}}}e&&(this.processedElements=new WeakSet,a&&clearTimeout(a),a=setTimeout(()=>{this.updateBacklinks(),a=null},150))}),this.observer.observe(document.body,{childList:!0,subtree:!0,characterData:!0})}stopObserving(){this.observer&&(this.observer.disconnect(),this.observer=void 0)}onLayoutChange(){this.plugin.settings.enableForBacklinks?setTimeout(()=>{this.updateBacklinks()},100):this.stopObserving()}onFileOpen(){this.plugin.settings.enableForBacklinks&&setTimeout(()=>{this.updateEmbeddedBacklinks()},200)}onunload(){this.stopObserving()}};var O=class extends F.Plugin{async onload(){await this.loadSettings(),this.quickSwitcherService=new D(this),this.dragDropService=new I(this),this.cacheService=new N(this),this.graphViewService=new L(this),this.backlinkService=new M(this),setTimeout(()=>{this.updateLinkSuggester(),this.updateQuickSwitcher(),this.updateBacklinks()},1e3),this.app.workspace.onLayoutReady(()=>{this.graphViewService.onLayoutChange(),this.backlinkService.onLayoutChange()}),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.graphViewService.onLayoutChange(),this.backlinkService.onLayoutChange()})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.backlinkService.onFileOpen()})),this.registerEvent(this.app.vault.on("modify",t=>{t instanceof F.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.vault.on("rename",(t,e)=>{t instanceof F.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.vault.on("delete",t=>{t instanceof F.TFile&&t.extension==="md"&&this.cacheService.invalidateCache(t)})),this.registerEvent(this.app.metadataCache.on("changed",t=>{t instanceof F.TFile&&t.extension==="md"&&(this.cacheService.rebuildCache(),this.settings.enableForGraphView&&this.graphViewService.refreshGraphView(),this.settings.enableForBacklinks&&this.backlinkService.updateBacklinks())})),this.registerEvent(this.app.metadataCache.on("resolved",()=>{this.cacheService.rebuildCache()})),this.registerEvent(this.app.workspace.on("editor-drop",(t,e)=>{this.settings.enableForDragDrop&&this.dragDropService.handleDragDrop(t,e)})),this.registerDomEvent(document,"drop",t=>{this.settings.enableForDragDrop&&this.dragDropService.handleDOMDrop(t)}),W(this),this.addSettingTab(new P(this.app,this))}updateLinkSuggester(){let t=this.app.workspace.editorSuggest;t&&(this.suggest&&(t.suggests=t.suggests.filter(e=>e!==this.suggest),this.suggest=void 0),this.settings.enableForLinking&&(this.suggest=new E(this),this.registerEditorSuggest(this.suggest),this.cacheService.setSuggest(this.suggest),t.suggests=t.suggests.filter(e=>!e.constructor.name.includes("LinkSuggest")),t.suggests.unshift(this.suggest)))}updateQuickSwitcher(){this.quickSwitcherService.updateQuickSwitcher()}updateGraphView(){this.graphViewService.updateGraphView()}updateBacklinks(){this.backlinkService.updateBacklinks()}rebuildCache(){this.cacheService.rebuildCache()}onunload(){let t=this.app.workspace.editorSuggest;t&&this.suggest&&(t.suggests=t.suggests.filter(e=>e!==this.suggest)),this.quickSwitcherService.restoreOriginalCommand(),this.graphViewService.onunload(),this.backlinkService.onunload()}async loadSettings(){this.settings=Object.assign({},H,await this.loadData())}async saveSettings(t){await this.saveData(this.settings),t!==void 0&&t!==this.settings.enableForQuickSwitcher&&this.updateQuickSwitcher()}};
