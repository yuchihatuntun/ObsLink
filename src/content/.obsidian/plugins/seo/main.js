/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var he=Object.defineProperty;var dt=Object.getOwnPropertyDescriptor;var pt=Object.getOwnPropertyNames;var gt=Object.prototype.hasOwnProperty;var O=(a,r)=>()=>(a&&(r=a(a=0)),r);var We=(a,r)=>{for(var t in r)he(a,t,{get:r[t],enumerable:!0})},ft=(a,r,t,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of pt(r))!gt.call(a,s)&&s!==t&&he(a,s,{get:()=>r[s],enumerable:!(e=dt(r,s))||e.enumerable});return a};var mt=a=>ft(he({},"__esModule",{value:!0}),a);function _(a){let r=a.startsWith("/")?a.slice(1):a,t=r.split("/");return t.length<=1?r:t.slice(-2).join("/")}function X(a,r){let t="Vault folders: ";if(!a||a.trim()==="")t+="all";else{let e=a.split(",").map(s=>s.trim()).filter(s=>s.length>0);t+=e.join(", ")}return r!==void 0&&(t+=`; ${r} files analyzed`),t}function Ve(a,r){let t=[...a];switch(r){case"warnings-desc":t.sort((e,s)=>{if(s.warningsCount!==e.warningsCount)return s.warningsCount-e.warningsCount;if(s.issuesCount!==e.issuesCount)return s.issuesCount-e.issuesCount;if(s.noticesCount!==e.noticesCount)return s.noticesCount-e.noticesCount;let i=e.file.split("/").pop()||"",n=s.file.split("/").pop()||"";return i.localeCompare(n)});break;case"warnings-asc":t.sort((e,s)=>{if(e.warningsCount!==s.warningsCount)return e.warningsCount-s.warningsCount;if(e.issuesCount!==s.issuesCount)return e.issuesCount-s.issuesCount;if(e.noticesCount!==s.noticesCount)return e.noticesCount-s.noticesCount;let i=e.file.split("/").pop()||"",n=s.file.split("/").pop()||"";return i.localeCompare(n)});break;case"issues-desc":t.sort((e,s)=>{if(s.issuesCount!==e.issuesCount)return s.issuesCount-e.issuesCount;if(s.warningsCount!==e.warningsCount)return s.warningsCount-e.warningsCount;if(s.noticesCount!==e.noticesCount)return s.noticesCount-e.noticesCount;let i=e.file.split("/").pop()||"",n=s.file.split("/").pop()||"";return i.localeCompare(n)});break;case"issues-asc":t.sort((e,s)=>{if(e.issuesCount!==s.issuesCount)return e.issuesCount-s.issuesCount;if(e.warningsCount!==s.warningsCount)return e.warningsCount-s.warningsCount;if(e.noticesCount!==s.noticesCount)return e.noticesCount-s.noticesCount;let i=e.file.split("/").pop()||"",n=s.file.split("/").pop()||"";return i.localeCompare(n)});break;case"notices-desc":t.sort((e,s)=>{if(s.noticesCount!==e.noticesCount)return s.noticesCount-e.noticesCount;if(s.issuesCount!==e.issuesCount)return s.issuesCount-e.issuesCount;if(s.warningsCount!==e.warningsCount)return s.warningsCount-e.warningsCount;let i=e.file.split("/").pop()||"",n=s.file.split("/").pop()||"";return i.localeCompare(n)});break;case"notices-asc":t.sort((e,s)=>{if(e.noticesCount!==s.noticesCount)return e.noticesCount-s.noticesCount;if(e.issuesCount!==s.issuesCount)return e.issuesCount-s.issuesCount;if(e.warningsCount!==s.warningsCount)return e.warningsCount-s.warningsCount;let i=e.file.split("/").pop()||"",n=s.file.split("/").pop()||"";return i.localeCompare(n)});break;case"filename-asc":t.sort((e,s)=>{let i=e.file.split("/").pop()||"",n=s.file.split("/").pop()||"",o=i.localeCompare(n);if(o!==0)return o;let l=e.file.split("/"),u=s.file.split("/"),c=l.length>1&&l[l.length-2]||"",h=u.length>1&&u[u.length-2]||"",d=c.localeCompare(h);return d!==0?d:s.issuesCount!==e.issuesCount?s.issuesCount-e.issuesCount:s.warningsCount!==e.warningsCount?s.warningsCount-e.warningsCount:s.noticesCount-e.noticesCount});break;case"filename-desc":t.sort((e,s)=>{let i=e.file.split("/").pop()||"",o=(s.file.split("/").pop()||"").localeCompare(i);if(o!==0)return o;let l=e.file.split("/"),u=s.file.split("/"),c=l.length>1&&l[l.length-2]||"",d=(u.length>1&&u[u.length-2]||"").localeCompare(c);return d!==0?d:s.issuesCount!==e.issuesCount?s.issuesCount-e.issuesCount:s.warningsCount!==e.warningsCount?s.warningsCount-e.warningsCount:s.noticesCount-e.noticesCount});break}return t}var j=O(()=>{"use strict"});function N(a){return a.replace(/```[\s\S]*?```/g,"").replace(/~~~[\s\S]*?~~~/g,"").replace(/`[^`\n]+`/g,"").replace(/<[^>]*>/g,"").replace(/^---\n[\s\S]*?\n---\n/,"").replace(/::\w+\{[^}]*\}/g,"")}function pe(a){return a.replace(/```[\s\S]*?```/g,"").replace(/~~~[\s\S]*?~~~/g,"").replace(/`[^`\n]+`/g,"").replace(/<[^>]*>/g,"").replace(/^---\n[\s\S]*?\n---\n/,"").replace(/::\w+\{[^}]*\}/g,"")}var H=O(()=>{"use strict"});function F(a,r){let t=a.split(`
`);for(let e=0;e<t.length;e++){let s=t[e];if(s&&s.includes(r))return e+1}return 1}function x(a,r,t=2){let e=a.split(`
`),s=Math.max(0,r-1-t),i=Math.min(e.length,r-1+t+1);return e.slice(s,i).join(`
`)}var q=O(()=>{"use strict"});function ge(a,r,t){let e=[];if(!t.checkAltText)return Promise.resolve([]);let s=N(a),i=s.match(/!\[([^\]]*)\]\([^)]+\)/g);if(i){let l=i.filter(u=>{var h;let c=(h=u.match(/!\[([^\]]*)\]/))==null?void 0:h[1];return!c||c.trim()===""});l.length>0&&l.forEach((u,c)=>{let h=u.match(/!\[[^\]]*\]\(([^)]+)\)/),d=h?h[1]:u,f=F(a,u);e.push({passed:!1,message:`Media missing alt text: ${d}`,suggestion:"Add descriptive alt text for accessibility",severity:"error",position:{line:f,searchText:u,context:x(a,f)}})})}let n=s.match(/!\[\[([^\]]+)\]\]/g);if(n){let l=n.filter(u=>!u.includes("|"));l.length>0&&l.forEach((u,c)=>{let h=u.match(/!\[\[([^\]]+)\]\]/),d=h?h[1]:u,f=F(a,u);e.push({passed:!1,message:`Wikilink media missing alt text: ${d}`,suggestion:"Add alt text using ![[media.png|alt text]] syntax or consider using standard markdown media syntax",severity:"error",position:{line:f,searchText:u,context:x(a,f)}})})}let o=s.match(/<img[^>]*>/g);if(o){let l=o.filter(u=>{let c=u.match(/alt\s*=\s*["']([^"']*)["']/);return!c||!c[1]||c[1].trim()===""});l.length>0&&l.forEach((u,c)=>{let h=u.match(/src\s*=\s*["']([^"']*)["']/),d=h?h[1]:"HTML img tag",f=F(a,u);e.push({passed:!1,message:`HTML media missing alt attribute: ${d}`,suggestion:"Add alt attribute to HTML media tag",severity:"error",position:{line:f,searchText:u,context:x(a,f)}})})}return e.length===0&&(i&&i.length>0||o&&o.length>0||n&&n.length>0?e.push({passed:!0,message:"All media elements have alt text",severity:"info"}):e.push({passed:!0,message:"No media elements in this post",severity:"info"})),Promise.resolve(e)}var Ge=O(()=>{"use strict";H();q()});function fe(a,r,t){let e=[];if(!t.checkNakedLinks)return Promise.resolve([]);let i=pe(a).match(/(?<!\]\()(?<!https?:\/\/[^\s)]*\/)https?:\/\/[^\s)]+/g);return i&&i.forEach((n,o)=>{if(n.includes("web.archive.org/web/")||n.includes("archive.today/")||n.includes("archive.is/")||n.includes("web.archive.org/save/"))return;let l=F(a,n);e.push({passed:!1,message:`Naked link found: ${n}`,suggestion:"Convert to markdown link format: [link text](url)",severity:"warning",position:{line:l,searchText:n,context:x(a,l)}})}),e.length===0&&e.push({passed:!0,message:"No naked links found",severity:"info"}),Promise.resolve(e)}function ee(a,r,t,e){let s=[];if(!t.checkBrokenLinks)return Promise.resolve([]);let i=a.match(/\[\[([^\]]+)\]\]/g);if(i){let o=[];for(let l of i){let u=a.indexOf(l);if(u===-1)continue;let c=a.substring(0,u),h=c.match(/```[\s\S]*?```|~~~[\s\S]*?~~~/g),d=(c.match(/```/g)||[]).length-(h||[]).length,f=(c.match(/~~~/g)||[]).length-(h||[]).length;if(d>0||f>0)continue;let p=l.match(/\[\[([^\]]+)\]\]/);if(!p||!p[1])continue;let m=p[1],y,k,g=null;if(m.includes("|")){let w=m.split("|"),E=w[0]||"";if(k=w[1]||E,E.includes("#")){let P=E.split("#");y=P[0]||"",g=P[1]||null}else y=E}else if(m.includes("#")){let w=m.split("#");y=w[0]||"",g=w[1]||null,k=y}else y=m,k=m;e&&(e.metadataCache.getFirstLinkpathDest(y,r.path)||o.push({link:l,path:y,displayText:k,anchor:g}))}o.length>0&&o.forEach(({link:l,path:u,displayText:c,anchor:h})=>{let d=F(a,l),f=`Check if the file "${u}.md" exists or update the link`;h&&(f+=` (anchor: #${h})`),s.push({passed:!1,message:`Broken internal link: ${c}`,suggestion:f,severity:"error",position:{line:d,searchText:l,context:x(a,d)}})})}let n=a.match(/\[([^\]]+)\]\(([^)]+)\)/g);if(n)for(let o of n){let l=a.indexOf(o);if(l===-1)continue;let u=a.substring(0,l),c=u.match(/```[\s\S]*?```|~~~[\s\S]*?~~~/g),h=(u.match(/```/g)||[]).length-(c||[]).length,d=(u.match(/~~~/g)||[]).length-(c||[]).length;if(h>0||d>0)continue;let f=o.match(/\[([^\]]+)\]\(([^)]+)\)/);if(!f||!f[1]||!f[2])continue;let p=f[1],m=f[2];if(!(o.startsWith("![")||p.startsWith("!["))&&!m.startsWith("http://")&&!m.startsWith("https://")&&!m.startsWith("mailto:")&&!m.startsWith("#")){if(t.publishMode&&m.startsWith("/"))continue;if(e){let y=m,k=null;if(y.includes("#")){let w=y.split("#");y=w[0]||"",k=w[1]||null}if(!e.metadataCache.getFirstLinkpathDest(y,r.path)){let w=F(a,o),P=`Check if the file "${y.endsWith(".md")?y:y+".md"}" exists or update the link`;k&&(P+=` (anchor: #${k})`),s.push({passed:!1,message:`Broken internal link: ${p}`,suggestion:P,severity:"error",position:{line:w,searchText:o,context:x(a,w)}})}}}}return s.length===0&&s.push({passed:!0,message:"No broken internal links found",severity:"info"}),Promise.resolve(s)}async function me(a,r,t,e){let s=[];if(!t.checkPotentiallyBrokenLinks||!t.publishMode)return Promise.resolve([]);let i=await ee(a,r,t,e),n=new Set;i.forEach(u=>{var c;!u.passed&&((c=u.position)!=null&&c.searchText)&&n.add(u.position.searchText)});let o=0;for(;o<a.length;){let u=a.indexOf("[",o);if(u===-1)break;let c=a.substring(0,u),h=c.match(/```[\s\S]*?```|~~~[\s\S]*?~~~/g),d=(c.match(/```/g)||[]).length-(h||[]).length,f=(c.match(/~~~/g)||[]).length-(h||[]).length;if(d>0||f>0){o=u+1;continue}let p=1,m=u+1;for(;m<a.length&&p>0;)a[m]==="["?p++:a[m]==="]"&&p--,m++;if(p>0){o=u+1;continue}if(m<a.length&&a[m]==="("){let y=1,k=m+1;for(;k<a.length&&y>0;)a[k]==="("?y++:a[k]===")"&&y--,k++;if(y===0){let g=a.substring(u+1,m-1),w=a.substring(m+1,k-1),E=a.substring(u,k);if(g.startsWith("![")){o=k;continue}if(t.publishMode&&w.startsWith("/")&&!w.startsWith("http://")&&!w.startsWith("https://")){let P=F(a,E);s.push({passed:!0,message:`Relative path link: ${g}`,suggestion:"This link may be valid for static site generators but may not work in Obsidian",severity:"notice",position:{line:P,searchText:E,context:x(a,P)}})}o=k}else o=m}else o=m}let l=a.match(/\[\[([^\]]+)\]\]/g);if(l){let u=[];for(let c of l){let h=a.indexOf(c);if(h===-1)continue;let d=a.substring(0,h),f=d.match(/```[\s\S]*?```|~~~[\s\S]*?~~~/g),p=(d.match(/```/g)||[]).length-(f||[]).length,m=(d.match(/~~~/g)||[]).length-(f||[]).length;if(p>0||m>0)continue;let y=c.match(/\[\[([^\]]+)\]\]/);if(!y||!y[1]||n.has(c))continue;let k=y[1],g,w,E=null;if(k.includes("|")){let P=k.split("|"),T=P[0]||"";if(w=P[1]||T,T.includes("#")){let R=T.split("#");g=R[0]||"",E=R[1]||null}else g=T}else if(k.includes("#")){let P=k.split("#");g=P[0]||"",E=P[1]||null,w=g}else g=k,w=k;if(e&&g&&!e.metadataCache.getFirstLinkpathDest(g,r.path)){let R=e.vault.getMarkdownFiles().filter(V=>V.path.toLowerCase().includes(g.toLowerCase())||V.basename.toLowerCase().includes(g.toLowerCase()));R.length>0&&u.push({link:c,path:g,displayText:w,anchor:E,suggestions:R.map(V=>V.path)})}}u.length>0&&u.forEach(({link:c,path:h,displayText:d,suggestions:f})=>{let p=F(a,c);s.push({passed:!1,message:`Potentially broken link: ${d}`,suggestion:`Consider these similar files: ${f.slice(0,3).join(", ")}`,severity:"warning",position:{line:p,searchText:c,context:x(a,p)}})})}return s.length===0&&s.push({passed:!0,message:"No potentially broken links found",severity:"info"}),Promise.resolve(s)}var Ue=O(()=>{"use strict";H();q()});function qe(a){if(a.includes("&gt;")||a.includes("&lt;")||a.includes("&amp;")||a.includes("&quot;")||a.includes("&apos;")||a.includes("&nbsp;")||a.includes("<")||a.includes(">")||a.includes('"')||a.includes("'")||a.endsWith("&gt;")||a.endsWith("&lt;")||a.endsWith("&amp;")||a.endsWith("&quot;")||a.endsWith("&apos;")||a.endsWith("&nbsp;")||a.includes("/a&gt;")||a.includes("/p&gt;")||a.includes("/div&gt;")||a.includes("/span&gt;")||a.includes("/img&gt;")||a.includes("/script&gt;"))return!1;try{let r=new URL(a);return!(r.protocol!=="http:"&&r.protocol!=="https:"||!r.hostname||r.hostname.length===0||r.hostname.includes("<")||r.hostname.includes(">")||r.hostname.includes('"')||r.hostname.includes("'"))}catch(r){return!1}}function ze(a){let r=N(a),t=[],e=0;for(;e<r.length;){let i=r.indexOf("[",e);if(i===-1)break;let n=1,o=i+1;for(;o<r.length&&n>0;)r[o]==="["?n++:r[o]==="]"&&n--,o++;if(n>0){e=i+1;continue}if(o<r.length&&r[o]==="("){let l=1,u=o+1;for(;u<r.length&&l>0;)r[u]==="("?l++:r[u]===")"&&l--,u++;if(l===0){let c=r.substring(o+1,u-1);(c.startsWith("http://")||c.startsWith("https://"))&&qe(c)&&t.push(c),e=u}else e=o}else e=o}let s=r.match(/https?:\/\/[^\s)\]]+/g);if(s){let i=new Set(t);s.forEach(n=>{i.has(n)||n.includes("web.archive.org/web/")||n.includes("archive.today/")||n.includes("archive.is/")||n.includes("web.archive.org/save/")||qe(n)&&t.push(n)})}return[...new Set(t)]}function ke(a,r,t){let e=[];if(!t.checkExternalLinks)return Promise.resolve([]);let s=ze(a);return s.length>0?s.forEach((i,n)=>{let o=F(a,i);e.push({passed:!0,message:`External link: ${i}`,suggestion:"To find if any of these are broken, use the 'Check external links for 404s' button to trigger it.",severity:"notice",position:{line:o,searchText:i,context:x(a,o)}})}):e.push({passed:!0,message:"No external links found",severity:"info"}),Promise.resolve(e)}async function we(a,r,t,e){let s=[];if(!t.enableExternalLinkVaultCheck)return Promise.resolve([]);let i=ze(a);if(i.length===0)return s.push({passed:!0,message:"No external links found",severity:"info"}),Promise.resolve(s);for(let n of i){if(e!=null&&e.signal.aborted)throw console.debug("External link check cancelled"),new DOMException("Operation was aborted","AbortError");let o=!1,l="",u="";try{let c=await(0,Ke.requestUrl)({url:n,headers:{"User-Agent":"Mozilla/5.0 (compatible; Obsidian-SEO-Plugin/1.0)"}});c.status>=400&&(o=!0,c.status>=400&&c.status<500?(l=`External link error (${c.status}): ${n}`,u=`This link returned a ${c.status} error. The page may not exist or may require authentication.`):c.status>=500?(l=`External link server error (${c.status}): ${n}`,u=`This link returned a ${c.status} server error. The server may be experiencing issues.`):(l=`External link error (${c.status}): ${n}`,u=`This link returned an unexpected status code: ${c.status}`))}catch(c){o=!0,c instanceof Error&&(c.message.includes("timeout")||c.message.includes("Timeout"))?(l=`External link timeout: ${n}`,u="This link took too long to respond. The server might be slow or the link might be broken."):c instanceof Error&&(c.message.includes("Failed to fetch")||c.message.includes("net::ERR_")||c.message.includes("NetworkError"))?(l=`External link unreachable: ${n}`,u="This link could not be reached. Check if the URL is correct or if the server is down."):(l=`External link error: ${n}`,u="This link could not be verified. Please check the URL manually.")}if(o){let c=a.split(`
`),h=1;for(let d=0;d<c.length;d++){let f=c[d];if(f&&n&&f.includes(n)){h=d+1;break}}s.push({passed:!1,message:l,suggestion:u,severity:"error",position:{line:h,searchText:n,context:x(a,h)}})}}if(s.length===0&&i.length>0)s.push({passed:!0,message:`Found ${i.length} external link(s), all appear to resolve and are working`,severity:"info"});else if(i.length>0){let n=i.length-s.filter(o=>!o.passed).length;n>0&&s.push({passed:!0,message:`${n} of ${i.length} external link(s) are working`,severity:"info"})}return Promise.resolve(s)}var Ke,je=O(()=>{"use strict";Ke=require("obsidian");q();H()});function ye(a){let r=a.toLowerCase().replace(/[^a-z]/g,"");if(r.length===0)return 0;let t=0,e=!1;for(let s=0;s<r.length;s++){let i=r[s];if(i){let n=/[aeiouy]/.test(i);n&&!e&&t++,e=n}}return r.endsWith("e")&&t>1&&t--,Math.max(1,t)}function ve(a){return a<=6?"Very easy to read":a<=9?"Easy to read":a<=12?"Moderately easy to read":a<=15?"Moderately difficult to read":a<=18?"Difficult to read":"Very difficult to read"}var Ce=O(()=>{"use strict"});function Ee(a,r,t){let e=[];if(!t.checkContentLength)return Promise.resolve([]);let s=a.replace(/^---\n[\s\S]*?\n---\n/,"");s=s.replace(/```[\s\S]*?```/g,""),s=s.replace(/~~~[\s\S]*?~~~/g,"");let i=s.split(/\s+/).filter(n=>n.length>0).length;return i<t.minContentLength?e.push({passed:!1,message:`Content too short: ${i} words`,suggestion:`Aim for at least ${t.minContentLength} words`,severity:"warning"}):e.push({passed:!0,message:`Good content length: ${i} words`,severity:"info"}),Promise.resolve(e)}function Se(a,r,t){let e=[];if(!t.checkReadingLevel)return Promise.resolve([]);let s=N(a),i=s.split(/[.!?]+/).filter(d=>d.trim().length>0),n=s.split(/\s+/).filter(d=>d.length>0);if(i.length===0||n.length===0)return e.push({passed:!0,message:"No readable content found for reading level analysis",severity:"info"}),Promise.resolve(e);let o=n.reduce((d,f)=>d+ye(f),0),l=n.length/i.length,u=o/n.length,c=.39*l+11.8*u-15.59,h=ve(c);return c>12?e.push({passed:!1,message:`Reading level too high: ${c.toFixed(1)} (${h})`,suggestion:"Consider simplifying sentence structure and using shorter words",severity:"warning"}):e.push({passed:!0,message:`Good reading level: ${c.toFixed(1)} (${h})`,severity:"info"}),Promise.resolve(e)}function be(a,r,t){let e=[];if(!t.checkDuplicateContent)return Promise.resolve([]);let i=N(a).split(/\n\s*\n/).filter(o=>o.trim().length>20),n=[];for(let o=0;o<i.length;o++)for(let l=o+1;l<i.length;l++){let u=i[o],c=i[l];if(u&&c){let h=kt(u,c);h>t.duplicateThreshold&&n.push({paragraph1:o+1,paragraph2:l+1,similarity:h})}}return n.length>0?n.forEach(({paragraph1:o,paragraph2:l,similarity:u})=>{e.push({passed:!1,message:`Duplicate content detected between paragraphs ${o} and ${l}`,suggestion:`Similarity: ${u.toFixed(1)}% - consider rewriting one of these paragraphs`,severity:"warning"})}):e.push({passed:!0,message:"No duplicate content detected",severity:"info"}),Promise.resolve(e)}function kt(a,r){let t=a.toLowerCase().split(/\s+/),e=r.toLowerCase().split(/\s+/),s=new Set(t),i=new Set(e),n=new Set([...s].filter(l=>i.has(l))),o=new Set([...s,...i]);return n.size/o.size*100}async function Je(a,r,t,e){return await e.checkDuplicateTitles(r,t)}async function Ze(a,r,t,e){return await e.checkDuplicateDescriptions(r,t)}async function _e(a,r,t,e){return await e.checkDuplicateContent(r,t)}var xe=O(()=>{"use strict";H();Ce()});function Pe(a,r,t){let e=[];if(!t.descriptionProperty)return Promise.resolve([]);let s=a.match(/^---\n([\s\S]*?)\n---/);if(!s)return e.push({passed:!1,message:"No frontmatter found",suggestion:"Add frontmatter with description property",severity:"warning"}),Promise.resolve(e);let i=s[1];if(!i)return e.push({passed:!1,message:"No frontmatter content found",suggestion:"Add frontmatter with description property",severity:"warning"}),Promise.resolve(e);let n=i.match(new RegExp(`^${t.descriptionProperty}:\\s*(.+)$`,"m"));if(!n||!n[1])return e.push({passed:!1,message:`No ${t.descriptionProperty} found in frontmatter`,suggestion:`Add ${t.descriptionProperty} to frontmatter`,severity:"warning"}),Promise.resolve(e);let o=n[1].trim();(o.startsWith('"')&&o.endsWith('"')||o.startsWith("'")&&o.endsWith("'"))&&(o=o.slice(1,-1));let l=o.length;return l<120?e.push({passed:!1,message:`Description too short: ${l} characters`,suggestion:"Aim for 120-160 characters",severity:"warning"}):l>160?e.push({passed:!1,message:`Description too long: ${l} characters`,suggestion:"Aim for 120-160 characters",severity:"warning"}):e.push({passed:!0,message:`Good description length: ${l} characters`,severity:"info"}),Promise.resolve(e)}function Te(a,r,t){let e=[];if(!t.checkTitleLength)return Promise.resolve([]);let s="";if(t.titleProperty){let o=a.match(/^---\n([\s\S]*?)\n---/);if(o&&o[1]){let u=o[1].match(new RegExp(`^${t.titleProperty}:\\s*(.+)$`,"m"));u&&u[1]&&(s=u[1].trim())}}if(!s&&t.useFilenameAsTitle&&(s=r.basename),!s){let o=a.match(/^#\s+(.+)$/m);o&&o[1]&&(s=o[1].trim())}if(!s)return Promise.resolve(e);let n=(t.titlePrefixSuffix?`${s} ${t.titlePrefixSuffix}`:s).length;if(n<30){let o=t.titlePrefixSuffix?`Title too short: ${n} characters (${s} + " ${t.titlePrefixSuffix}")`:`Title too short: ${n} characters`;e.push({passed:!1,message:o,suggestion:"Aim for 30-60 characters",severity:"warning"})}else if(n>60){let o=t.titlePrefixSuffix?`Title too long: ${n} characters (${s} + " ${t.titlePrefixSuffix}")`:`Title too long: ${n} characters`;e.push({passed:!1,message:o,suggestion:"Aim for 30-60 characters",severity:"warning"})}else{let o=t.titlePrefixSuffix?`Good title length: ${n} characters (${s} + " ${t.titlePrefixSuffix}")`:`Good title length: ${n} characters`;e.push({passed:!0,message:o,severity:"info"})}return Promise.resolve(e)}function Le(a,r,t){let e=[];if(!t.keywordProperty)return Promise.resolve([]);let s=a.match(/^---\n([\s\S]*?)\n---/);if(!s)return e.push({passed:!1,message:"No frontmatter found",suggestion:"Add frontmatter with keyword property",severity:"warning"}),Promise.resolve(e);let i=s[1];if(!i)return e.push({passed:!1,message:"No frontmatter content found",suggestion:"Add frontmatter with keyword property",severity:"warning"}),Promise.resolve(e);let n=i.split(`
`),o="",l=!1;for(let w of n)if(w.startsWith(t.keywordProperty+":")){l=!0,o=w.substring(t.keywordProperty.length+1).trim();break}if(!l)return e.push({passed:!0,message:`No ${t.keywordProperty} defined in properties`,severity:"notice"}),Promise.resolve(e);if(!o||o==="false"||o==="true"||o==="null"||o==="undefined")return e.push({passed:!0,message:"No valid keyword defined in properties",severity:"notice"}),Promise.resolve(e);let u=N(a),c=a.match(/^---\n([\s\S]*?)\n---/);if(c&&c[1]&&t.titleProperty){let E=c[1].split(`
`);for(let P of E)if(P.startsWith(t.titleProperty+":")){let T=P.substring(t.titleProperty.length+1).trim();(T.startsWith('"')&&T.endsWith('"')||T.startsWith("'")&&T.endsWith("'"))&&(T=T.slice(1,-1)),u=T+" "+u;break}}let h=o.toLowerCase(),d=u.toLowerCase(),f=h.split(/\s+/).filter(w=>w.length>0),p=0,m=d.split(/\s+/);for(let w=0;w<=m.length-f.length;w++){let E=m.slice(w,w+f.length).join(" ");f.every(T=>E.includes(T))&&p++}let k=u.split(/\s+/).filter(w=>w.length>0).length;if(k===0)return e.push({passed:!1,message:"No content found for keyword analysis",severity:"warning"}),Promise.resolve(e);let g=p/k*100;return g<t.keywordDensityMin?e.push({passed:!1,message:`Keyword density too low: ${g.toFixed(1)}%`,suggestion:`Aim for at least ${t.keywordDensityMin}% density`,severity:"warning"}):g>t.keywordDensityMax?e.push({passed:!1,message:`Keyword density too high: ${g.toFixed(1)}%`,suggestion:`Aim for no more than ${t.keywordDensityMax}% density`,severity:"warning"}):e.push({passed:!0,message:`Good keyword density: ${g.toFixed(1)}%`,severity:"info"}),Promise.resolve(e)}function Re(a,r,t){let e=[];if(!t.keywordProperty||!t.descriptionProperty)return Promise.resolve([]);let s=a.match(/^---\n([\s\S]*?)\n---/);if(!s)return Promise.resolve(e);let i=s[1];if(!i)return Promise.resolve(e);let n=i.split(`
`),o="",l=!1;for(let m of n)if(m.startsWith(t.keywordProperty+":")){l=!0,o=m.substring(t.keywordProperty.length+1).trim();break}if(!l||!o||o==="false"||o==="true"||o==="null"||o==="undefined")return Promise.resolve(e);let u="",c=!1;for(let m of n)if(m.startsWith(t.descriptionProperty+":")){c=!0,u=m.substring(t.descriptionProperty.length+1).trim();break}if(!c)return e.push({passed:!1,message:"No description found",suggestion:"Add a meta description to your frontmatter",severity:"warning"}),Promise.resolve(e);let h=o.toLowerCase(),d=u.toLowerCase();return h.split(/\s+/).filter(m=>m.length>0).every(m=>d.includes(m))?e.push({passed:!0,message:"Keyword found in description",severity:"info"}):e.push({passed:!1,message:"Keyword not found in description",suggestion:"Include your target keyword in the description",severity:"warning"}),Promise.resolve(e)}function Fe(a,r,t){let e=[];if(!t.titleProperty)return Promise.resolve(e);let s=a.match(/^---\n([\s\S]*?)\n---/);if(!s)return Promise.resolve(e);let i=s[1];if(!i)return Promise.resolve(e);let n="",o=i.split(`
`);for(let h of o)if(h.startsWith(t.titleProperty+":")){n=h.substring(t.titleProperty.length+1).trim(),(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))&&(n=n.slice(1,-1));break}if(!n)return Promise.resolve(e);let l="";if(t.skipH1Check){if(t.titlePrefixSuffix&&t.titlePrefixSuffix.trim())return e.push({passed:!0,message:"Meta title and H1 are unique (prefix/suffix configured)",severity:"info"}),Promise.resolve(e);if(l=n,t.titlePrefixSuffix){let h=t.titlePrefixSuffix;l.startsWith(h)&&(l=l.substring(h.length).trim()),l.endsWith(h)&&(l=l.substring(0,l.length-h.length).trim())}}else{let h=a.split(`
`);for(let d of h){if(!d)continue;let f=d.match(/^#\s+(.+)$/);if(f&&f[1]){l=f[1].trim();break}}}if(!l)return e.push({passed:!1,message:"No H1 heading found to compare with meta title",suggestion:"Add an H1 heading to your content, or enable 'Title property is H1' if your static site generator creates H1s from the title",severity:"warning"}),Promise.resolve(e);let u=n.toLowerCase().trim(),c=l.toLowerCase().trim();return u===c?e.push({passed:!1,message:"Meta title and H1 are identical",suggestion:"Modify one to be unique, or specify a suffix/prefix in plugin settings",severity:"warning"}):e.push({passed:!0,message:"Meta title and H1 are unique",severity:"info"}),Promise.resolve(e)}function Oe(a,r,t){let e=[];if(!t.keywordProperty)return Promise.resolve(e);let s=a.match(/^---\n([\s\S]*?)\n---/);if(!s)return Promise.resolve(e);let i=s[1];if(!i)return Promise.resolve(e);let n=i.split(`
`),o="",l=!1;for(let p of n)if(p.startsWith(t.keywordProperty+":")){l=!0,o=p.substring(t.keywordProperty.length+1).trim();break}if(!l)return e.push({passed:!0,message:`No ${t.keywordProperty} defined in properties`,severity:"notice"}),Promise.resolve(e);if(!o||o==="false"||o==="true"||o==="null"||o==="undefined")return e.push({passed:!0,message:"No valid keyword defined in properties",severity:"notice"}),Promise.resolve(e);let u=[];if(t.skipH1Check&&t.titleProperty){let p=a.match(/^---\n([\s\S]*?)\n---/);if(p&&p[1]){let y=p[1].split(`
`);for(let k of y)if(k.startsWith(t.titleProperty+":")){let g=k.substring(t.titleProperty.length+1).trim();if((g.startsWith('"')&&g.endsWith('"')||g.startsWith("'")&&g.endsWith("'"))&&(g=g.slice(1,-1)),t.titlePrefixSuffix){let w=t.titlePrefixSuffix;g.startsWith(w)&&(g=g.substring(w.length).trim()),g.endsWith(w)&&(g=g.substring(0,g.length-w.length).trim())}u.push({text:g});break}}}let c=a.split(`
`);for(let p of c){if(!p)continue;let m=p.match(/^#\s+(.+)$/);m&&m[1]&&u.push({text:m[1].trim()})}if(u.length===0)return e.push({passed:!1,message:"No H1 heading found in content",suggestion:"Add an H1 heading to structure your content and include your target keyword",severity:"warning"}),Promise.resolve(e);let d=o.toLowerCase().split(/\s+/).filter(p=>p.length>0),f=!1;for(let p of u){let m=p.text.toLowerCase();if(d.every(k=>m.includes(k))){f=!0;break}}return f?e.push({passed:!0,message:"Keyword found in H1",severity:"info"}):e.push({passed:!1,message:"Keyword not found in H1",suggestion:"Include your target keyword in the H1 heading for better SEO",severity:"warning"}),Promise.resolve(e)}function Ne(a,r,t){let e=[];if(!t.keywordProperty||!t.titleProperty)return Promise.resolve([]);let s=a.match(/^---\n([\s\S]*?)\n---/);if(!s)return Promise.resolve(e);let i=s[1];if(!i)return Promise.resolve(e);let n=i.split(`
`),o="",l=!1,u="",c=!1;for(let m of n)if(m.startsWith(t.keywordProperty+":")){l=!0,o=m.substring(t.keywordProperty.length+1).trim();break}for(let m of n)if(m.startsWith(t.titleProperty+":")){c=!0,u=m.substring(t.titleProperty.length+1).trim();break}if(!l)return e.push({passed:!0,message:`No ${t.keywordProperty} defined in properties`,severity:"notice"}),Promise.resolve(e);if(!o||o==="false"||o==="true"||o==="null"||o==="undefined")return e.push({passed:!0,message:"No valid keyword defined in properties",severity:"notice"}),Promise.resolve(e);if(!c||!u)return Promise.resolve(e);let h=u.toLowerCase();return o.toLowerCase().split(/\s+/).filter(m=>m.length>0).every(m=>h.includes(m))?e.push({passed:!0,message:"Keyword found in title",severity:"info"}):e.push({passed:!1,message:"Keyword not found in title",suggestion:"Include your target keyword in the title",severity:"warning"}),Promise.resolve(e)}var Xe=O(()=>{"use strict";H()});function Ae(a,r,t){let e=[];if(!t.checkHeadingOrder)return Promise.resolve([]);let s=a.split(`
`),i=null,n=!1,o=!1,l=!1;for(let u=0;u<s.length;u++){let c=s[u];if(!c)continue;if(c.match(/^```(\w+)?/)){l?l=!1:l=!0;continue}if(l)continue;let d=c.match(/^(#{1,6})\s+(.+)/);if(d&&d[1]&&d[2]){n=!0;let f=d[1].length,p=d[2].trim(),m=u+1;if(f===1&&(o=!0),i===null){i=f;continue}f>i+1&&e.push({passed:!1,message:`"${p}" (H${f}) skips heading level(s) after H${i}`,suggestion:"Use heading levels in order (H1 \u2192 H2 \u2192 H3, etc.)",severity:"warning",position:{line:m,searchText:c,context:x(a,m)}}),f===1&&i>1&&e.push({passed:!1,message:`"${p}" (H1) appears after H${i}`,suggestion:"H1 should be the first heading or not used at all",severity:"warning",position:{line:m,searchText:c,context:x(a,m)}}),i=f}}return n&&!t.skipH1Check&&!o&&e.unshift({passed:!1,message:"No H1 heading found",suggestion:"Add an H1 heading at the beginning of your content",severity:"warning"}),n?e.length===0&&e.push({passed:!0,message:"Heading structure is correct",severity:"info"}):e.push({passed:!0,message:"No heading structure issues found",severity:"info"}),Promise.resolve(e)}var Ye=O(()=>{"use strict";q()});function De(a,r,t){let e=[];if(!t.checkImageNaming)return Promise.resolve([]);let i=N(a).match(/!\[[^\]]*\]\(([^)]+)\)/g);return i&&i.forEach((n,o)=>{var u;let l=(u=n.match(/!\[[^\]]*\]\(([^)]+)\)/))==null?void 0:u[1];if(l){let c=l.split("/").pop()||"",h=F(a,n);c.includes(" ")||c.includes("%20")?e.push({passed:!1,message:`Image ${o+1} has spaces in file name: ${c}`,suggestion:"Use kebab-case or underscores instead of spaces",severity:"warning",position:{line:h,searchText:n,context:x(a,h)}}):c.match(/^[a-f0-9]{8,}$/)||c.match(/^[a-f0-9]{8,}_[A-Z0-9]+\./)||c.match(/^[a-f0-9]{8,}_MD5\./)||c.match(/^[a-f0-9]{20,}\./)?e.push({passed:!1,message:`Image ${o+1} has random file name: ${c}`,suggestion:"Use descriptive file names",severity:"warning",position:{line:h,searchText:n,context:x(a,h)}}):c.toLowerCase().includes("pasted")||c.toLowerCase().includes("untitled")||c.toLowerCase().includes("photo")||c.match(/^screenshot\d*\.(png|jpg|jpeg|gif|webp)$/i)||c.toLowerCase().includes("screenshot")&&c.match(/^screenshot[a-f0-9]{6,}\.(png|jpg|jpeg|gif|webp)$/i)?e.push({passed:!1,message:`Image ${o+1} has a potentially generic file name: ${c}`,suggestion:"Use descriptive file names",severity:"warning",position:{line:h,searchText:n,context:x(a,h)}}):(c.length<5||c.length>50)&&e.push({passed:!1,message:`Image ${o+1} exceeds suggested file name length: ${c}`,suggestion:"Use descriptive file names between 5-50 characters",severity:"warning",position:{line:h,searchText:n,context:x(a,h)}})}}),e.length===0&&e.push({passed:!0,message:"All images have good file names",severity:"info"}),Promise.resolve(e)}var Qe=O(()=>{"use strict";H();q()});function et(a,r,t){return Promise.resolve([])}function tt(a,r,t){let e=[];if(!t.keywordProperty)return Promise.resolve(e);let s=a.match(/^---\n([\s\S]*?)\n---/);if(!s)return Promise.resolve(e);let i=s[1];if(!i)return Promise.resolve(e);let n=i.split(`
`),o="",l=!1;for(let f of n)if(f.startsWith(t.keywordProperty+":")){l=!0,o=f.substring(t.keywordProperty.length+1).trim();break}if(!l)return e.push({passed:!0,message:`No ${t.keywordProperty} defined in properties`,severity:"notice"}),Promise.resolve(e);if(!o||o==="false"||o==="true"||o==="null"||o==="undefined")return e.push({passed:!0,message:"No valid keyword defined in properties",severity:"notice"}),Promise.resolve(e);let u=r.basename.toLowerCase();return o.toLowerCase().split(/\s+/).filter(f=>f.length>0).every(f=>u.includes(f))?e.push({passed:!0,message:`Target keyword "${o}" found in slug`,severity:"info"}):e.push({passed:!1,message:`Target keyword "${o}" not found in slug`,suggestion:"Include your target keyword in the filename",severity:"warning"}),Promise.resolve(e)}function st(a,r,t){return Promise.resolve([])}function it(a,r,t){if(t.useNoteTitles&&t.titleProperty.trim()){let e=r.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(e||(e=r.match(/^---\n([\s\S]*?)\n---/)),e||(e=r.match(/^---\s*\n([\s\S]*?)\n\s*---/)),e&&e[1]){let i=e[1].split(`
`);for(let n of i){if(!n)continue;let o=n.trim();if(o.startsWith(t.titleProperty+":")){let l=o.indexOf(":");if(l!==-1){let u=o.substring(l+1).trim();if((u.startsWith('"')&&u.endsWith('"')||u.startsWith("'")&&u.endsWith("'"))&&(u=u.slice(1,-1)),u)return u}}}}}return _(a.path)}var nt=O(()=>{"use strict";Ge();Ue();je();xe();Xe();Ye();Qe();H();q();Ce();j()});var te,rt=O(()=>{"use strict";H();te=class{constructor(r,t){this.vaultData=null;this.app=r,this.settings=t}async collectVaultData(){let r={files:new Map,titleMap:new Map,descriptionMap:new Map,lastUpdated:Date.now()},e=this.app.vault.getMarkdownFiles().filter(s=>this.settings.ignoreUnderscoreFiles&&s.basename.startsWith("_")?!1:this.settings.scanDirectories?this.settings.scanDirectories.split(",").map(n=>n.trim()).some(n=>s.path.startsWith(n)):!0);for(let s of e)try{let i=await this.app.vault.read(s),n=this.extractFileMetadata(s,i);if(!n.ignored){r.files.set(s.path,n);let o=n.title.toLowerCase().trim();if(o&&(r.titleMap.has(o)||r.titleMap.set(o,[]),r.titleMap.get(o).push(s.path)),n.description){let l=n.description.toLowerCase().trim();l&&(r.descriptionMap.has(l)||r.descriptionMap.set(l,[]),r.descriptionMap.get(l).push(s.path))}}}catch(i){console.warn(`Failed to process file ${s.path}:`,i)}return this.vaultData=r,r}extractFileMetadata(r,t){let e=t.match(/^---\n([\s\S]*?)\n---\n/),s={};if(e&&e[1]){let l=e[1].split(`
`);for(let u of l){let c=u.match(/^(\w+):\s*(.*)$/);if(c&&c[1]&&c[2]!==void 0){let h=c[1],d=c[2];(d.startsWith('"')&&d.endsWith('"')||d.startsWith("'")&&d.endsWith("'"))&&(d=d.slice(1,-1)),s[h]=d}}}let i="";if(this.settings.titleProperty&&s[this.settings.titleProperty]){let o=s[this.settings.titleProperty];i=typeof o=="string"?o:r.basename}else this.settings.useFilenameAsTitle,i=r.basename;let n;if(this.settings.descriptionProperty&&s[this.settings.descriptionProperty]){let o=s[this.settings.descriptionProperty];n=typeof o=="string"?o:void 0}return{path:r.path,title:i,description:n,content:t,ignored:!1}}async checkDuplicateTitles(r,t){var o;let e=[];if(!t.checkDuplicateContent||!t.titleProperty&&!t.useFilenameAsTitle)return e;this.vaultData||await this.collectVaultData();let s=this.vaultData.files.get(r.path);if(!s)return e;let i=s.title.toLowerCase().trim();if(!i)return e;let n=((o=this.vaultData)==null?void 0:o.titleMap.get(i))||[];if(n.length>1){let l=n.filter(p=>p!==r.path),c=["untitled","new note","untitled note","new file","document"].includes(i),h=c?"warning":"error",d=c?`Generic title "${s.title}" used in ${n.length} files`:`Duplicate title "${s.title}" found in ${n.length} files`,f=c?"Consider using a more descriptive title":`This title is also used in: ${l.map(p=>`<a href="#" data-file-path="${p}" class="seo-file-link">${this.getDisplayPath(p)}</a>`).join(", ")}`;e.push({passed:!1,message:d,suggestion:f,severity:h,position:{line:1,searchText:this.settings.titleProperty||"title",context:`title: "${s.title}"`}})}else e.push({passed:!0,message:`Unique title: "${s.title}"`,severity:"info"});return e}async checkDuplicateDescriptions(r,t){var o;let e=[];if(!t.checkDuplicateContent||!t.descriptionProperty)return e;this.vaultData||await this.collectVaultData();let s=this.vaultData.files.get(r.path);if(!s||!s.description)return e;let i=s.description.toLowerCase().trim(),n=((o=this.vaultData)==null?void 0:o.descriptionMap.get(i))||[];if(n.length>1){let l=n.filter(p=>p!==r.path),c=["description","meta description","page description"].includes(i),h=c?"warning":"error",d=c?`Generic description "${s.description}" used in ${n.length} files`:`Duplicate description "${s.description}" found in ${n.length} files`,f=c?"Consider using a more descriptive meta description":`This description is also used in: ${l.map(p=>`<a href="#" data-file-path="${p}" class="seo-file-link">${this.getDisplayPath(p)}</a>`).join(", ")}`;e.push({passed:!1,message:d,suggestion:f,severity:h,position:{line:1,searchText:this.settings.descriptionProperty||"description",context:`description: "${s.description}"`}})}else e.push({passed:!0,message:`Unique description: "${s.description}"`,severity:"info"});return e}async checkDuplicateContent(r,t){var o,l;let e=[];if(!t.checkDuplicateContent)return e;this.vaultData||await this.collectVaultData();let s=(o=this.vaultData)==null?void 0:o.files.get(r.path);if(!s)return e;let i=this.splitIntoParagraphs(s.content),n=[];for(let u=0;u<i.length;u++){let c=i[u];if(!c||c.length<50)continue;let h=[];for(let[d,f]of((l=this.vaultData)==null?void 0:l.files)||[]){if(d===r.path)continue;let p=this.splitIntoParagraphs(f.content);for(let m of p){if(!m||m.length<50)continue;let y=this.calculateJaccardSimilarity(c,m);y>=t.duplicateThreshold&&h.push({file:d,similarity:y})}}h.length>0&&n.push({paragraph:u+1,similarFiles:h})}return n.length>0?n.forEach(({paragraph:u,similarFiles:c})=>{var f;let h=Math.max(...c.map(p=>p.similarity)),d=c.sort((p,m)=>m.similarity-p.similarity).slice(0,3).map(p=>`<a href="#" data-file-path="${p.file}" class="seo-file-link">${this.getDisplayPath(p.file)}</a> (${p.similarity.toFixed(1)}%)`).join(", ");e.push({passed:!1,message:`Duplicate content detected in paragraph ${u}`,suggestion:`Similarity: ${h.toFixed(1)}% with: ${d}`,severity:"error",position:{line:this.findParagraphLine(s.content,u-1),searchText:((f=i[u-1])==null?void 0:f.substring(0,50))+"...",context:`Paragraph ${u} content`}})}):e.push({passed:!0,message:"No duplicate content detected",severity:"info"}),e}splitIntoParagraphs(r){let t=N(r);return t=t.replace(/^#{1,6}\s+/gm,"").replace(/^\s*[-*+]\s+/gm,"").replace(/^\s*\d+\.\s+/gm,"").replace(/^\s*>\s*/gm,"").replace(/^\s*\|.*\|.*$/gm,"").replace(/^\s*\|.*$/gm,"").replace(/\[\[.*?\]\]/g,"").replace(/!\[\[.*?\]\]/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/^\s*---\s*$/gm,"").replace(/^\s*\+\+\+\s*$/gm,"").replace(/^\s*==\s*$/gm,"").replace(/^\s*!!\s*$/gm,"").replace(/^\s*>\s*\[!.*?\]\s*$/gm,"").replace(/^\s*>\s*$/gm,"").replace(/^\s*$/gm,"").trim(),t.split(/\n\s*\n/).map(e=>e.trim()).filter(e=>!(e.length<30||(e.match(/<[^>]*>/g)||[]).join("").length/e.length>.3||(e.match(/[^\w\s.,!?;:'"()-]/g)||[]).length/e.length>.5||(e.match(/\b\w+\b/g)||[]).length/e.split(/\s+/).length<.3))}calculateJaccardSimilarity(r,t){let e=h=>h.toLowerCase().replace(/\s+/g," ").trim(),s=e(r),i=e(t),n=new Set(["the","and","or","but","in","on","at","to","for","of","with","by","a","an","is","are","was","were","be","been","have","has","had","do","does","did","will","would","could","should","may","might","can","this","that","these","those","i","you","he","she","it","we","they","me","him","her","us","them"]),o=new Set(s.split(/\s+/).filter(h=>h.length>2&&!n.has(h)).map(h=>h.replace(/[^\w]/g,"")).filter(h=>h.length>0)),l=new Set(i.split(/\s+/).filter(h=>h.length>2&&!n.has(h)).map(h=>h.replace(/[^\w]/g,"")).filter(h=>h.length>0));if(o.size===0||l.size===0)return 0;let u=new Set([...o].filter(h=>l.has(h))),c=new Set([...o,...l]);return u.size/c.size*100}findParagraphLine(r,t){let e=this.splitIntoParagraphs(r);if(t>=e.length)return 1;let s=e[t];if(!s)return 1;let i=r.split(`
`);for(let n=0;n<i.length;n++){let o=i[n];if(o&&o.includes(s.substring(0,50)))return n+1}return 1}getDisplayPath(r){if(this.vaultData&&this.settings.useNoteTitles){let e=this.vaultData.files.get(r);if(e&&e.title)return e.title}let t=r.split("/");return t[t.length-1]||r}clearCache(){this.vaultData=null}getVaultData(){return this.vaultData}}});var W={};We(W,{clearAllCache:()=>Tt,clearCache:()=>bt,clearCacheForFile:()=>Pt,getCacheStats:()=>xt,runSEOCheck:()=>yt});async function yt(a,r,t){let e=[],s=new te(a.app,a.settings);a.settings.checkDuplicateContent&&await s.collectVaultData();for(let i of r){if(t!=null&&t.signal.aborted)throw new DOMException("Operation was aborted","AbortError");try{let n=Et(i,a);if(n){e.push(n);continue}let o=await a.app.vault.read(i),l=await vt(a,i,o,s,t);St(i,l,a),e.push(l)}catch(n){if(n instanceof Error&&n.name==="AbortError")throw n;console.error(`Error checking file ${i.path}:`,n)}}return e}async function vt(a,r,t,e,s){let i={titleLength:await Te(t,r,a.settings),metaDescription:await Pe(t,r,a.settings),titleH1Uniqueness:await Fe(t,r,a.settings),keywordInTitle:await Ne(t,r,a.settings),keywordInDescription:await Re(t,r,a.settings),keywordInHeadings:await Oe(t,r,a.settings),keywordInSlug:await tt(t,r,a.settings),slugFormat:await st(t,r,a.settings),keywordDensity:await Le(t,r,a.settings),headingOrder:await Ae(t,r,a.settings),contentLength:await Ee(t,r,a.settings),duplicateTitles:await Je(t,r,a.settings,e),duplicateDescriptions:await Ze(t,r,a.settings,e),duplicateContent:a.settings.checkDuplicateContent?await _e(t,r,a.settings,e):await be(t,r,a.settings),altText:await ge(t,r,a.settings),imageFileNames:await De(t,r,a.settings),nakedLinks:await fe(t,r,a.settings),brokenLinks:await ee(t,r,a.settings,a.app),potentiallyBrokenLinks:await me(t,r,a.settings,a.app),potentiallyBrokenEmbeds:await et(t,r,a.settings),externalBrokenLinks:a.settings.enableExternalLinkVaultCheck?await we(t,r,a.settings,s):a.settings.checkExternalLinks?await ke(t,r,a.settings):[],readingLevel:await Se(t,r,a.settings)},n=Object.values(i).flat(),o=n.filter(h=>h.severity==="error").length,l=n.filter(h=>h.severity==="warning").length,u=n.filter(h=>h.severity==="notice").length,c;if(n.length===0)c=100;else{let h=0,d=0;n.forEach(g=>{if(g.severity==="notice")return;let w=1,E=0;g.message.includes("Broken link")&&!g.passed||g.message.includes("title")&&!g.passed&&g.message.includes("No frontmatter")?(w=10,E=0):g.message.includes("alt text")&&!g.passed||g.message.includes("meta description")&&!g.passed?(w=5,E=0):g.message.includes("keyword")&&!g.passed&&(g.message.includes("density")||g.message.includes("not found in title")||g.message.includes("not found in slug"))?(w=8,E=0):g.message.includes("content length")&&!g.passed?(w=3,E=0):g.message.includes("title")&&!g.passed&&(g.message.includes("too short")||g.message.includes("too long"))?(w=2,E=0):g.message.includes("reading level")&&!g.passed||g.severity==="warning"&&!g.passed?(w=1,E=0):g.passed&&(E=100),h+=E*w,d+=w});let f=d>0?h/d:100,p=0,m=n.filter(g=>g.severity==="error"&&!g.passed&&g.message.includes("Broken link")).length;p+=Math.min(m*2,10);let y=n.filter(g=>g.severity==="error"&&!g.passed&&g.message.includes("alt text")).length;p+=Math.min(y*1,5);let k=n.filter(g=>g.severity==="warning"&&!g.passed).length;p+=Math.min(k*.5,5),p=Math.min(p,20),c=Math.max(40,Math.min(100,f-p))}return{file:r.path,displayName:it(r,t,a.settings),checks:i,overallScore:c,issuesCount:o,warningsCount:l,noticesCount:u}}async function Ct(a,r){try{let t=await r.vault.read(a),e=await r.vault.adapter.stat(a.path);return`${t.length}-${(e==null?void 0:e.mtime)||Date.now()}`}catch(t){return`${Date.now()}`}}function ot(a){let r={keywordProperty:a.keywordProperty||"",keywordDensityMin:a.keywordDensityMin,keywordDensityMax:a.keywordDensityMax,descriptionProperty:a.descriptionProperty||"",titleProperty:a.titleProperty||"",useFilenameAsTitle:a.useFilenameAsTitle,checkContentLength:a.checkContentLength,minContentLength:a.minContentLength,scanDirectories:a.scanDirectories||"",checkExternalLinks:a.checkExternalLinks,enableExternalLinkVaultCheck:a.enableExternalLinkVaultCheck,checkPotentiallyBrokenLinks:a.checkPotentiallyBrokenLinks,checkPotentiallyBrokenEmbeds:a.checkPotentiallyBrokenEmbeds,checkAltText:a.checkAltText,checkBrokenLinks:a.checkBrokenLinks,checkNakedLinks:a.checkNakedLinks,checkHeadingOrder:a.checkHeadingOrder,checkTitleLength:a.checkTitleLength,checkImageNaming:a.checkImageNaming,checkDuplicateContent:a.checkDuplicateContent,checkReadingLevel:a.checkReadingLevel,duplicateThreshold:a.duplicateThreshold};return JSON.stringify(r)}function Et(a,r){let t=K.get(a.path);if(!t)return null;let s=Date.now()-t.timestamp>wt,i=ot(r.settings),n=t.settingsHash!==i;return s||n?(K.delete(a.path),null):t.result}async function St(a,r,t){let e=await Ct(a,t.app),s=ot(t.settings);K.set(a.path,{result:r,timestamp:Date.now(),fileHash:e,settingsHash:s})}function bt(){K.clear()}function xt(){return{size:K.size}}function Pt(a){K.delete(a)}function Tt(){K.clear()}var K,wt,B=O(()=>{"use strict";nt();xe();rt();K=new Map,wt=24*60*60*1e3});var Lt={};We(Lt,{default:()=>le});module.exports=mt(Lt);var ht=require("obsidian");var de={scanDirectories:"",ignoreUnderscoreFiles:!1,keywordProperty:"",descriptionProperty:"",titleProperty:"",useFilenameAsTitle:!1,slugProperty:"",useFilenameAsSlug:!1,parentFolderSlugFilename:"",titlePrefixSuffix:"",checkTitleLength:!0,checkHeadingOrder:!0,checkAltText:!0,checkImageNaming:!0,checkBrokenLinks:!0,checkExternalLinks:!0,enableExternalLinkButton:!0,enableExternalLinkVaultCheck:!1,checkNakedLinks:!0,checkContentLength:!0,checkDuplicateContent:!1,checkReadingLevel:!0,checkPotentiallyBrokenLinks:!0,checkPotentiallyBrokenEmbeds:!0,useNoteTitles:!1,skipH1Check:!1,publishMode:!1,defaultSort:"issues-desc",minContentLength:300,keywordDensityMin:1,keywordDensityMax:2,duplicateThreshold:80,cachedGlobalResults:[],lastScanTimestamp:0};function Be(a){a.addCommand({id:"open-current",name:"Open current note audit",icon:"search-check",callback:()=>{a.openCurrentPanel()}}),a.addCommand({id:"open-global",name:"Open vault audit",icon:"search-check",callback:()=>{a.openGlobalPanel()}}),a.addCommand({id:"run-current",name:"Run current note audit",icon:"search-check",callback:()=>{a.openCurrentPanel(),setTimeout(()=>{let r=a.app.workspace.getLeavesOfType("seo-current-panel")[0];if(r&&r.view){let t=r.view.containerEl.querySelector(".seo-top-btn");t&&t.click()}},200)}}),a.addCommand({id:"run-global",name:"Run vault audit",icon:"search-check",callback:()=>{a.openGlobalPanel(),setTimeout(()=>{(async()=>{let r=a.app.workspace.getLeavesOfType("seo-global-panel");if(r.length===0){a.openGlobalPanel();return}let t=r[0];if(t!=null&&t.view){let e=t.view;await e.actions.refreshGlobalResults(),e.render()}})()},300)}})}var C=require("obsidian"),Q=class extends C.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new C.Setting(t).setName("Global").setHeading(),new C.Setting(t).setName("Scan directories").setDesc("Comma-separated list of directory names to scan. Leave blank to scan all directories.").addText(i=>i.setPlaceholder("e.g., blog, posts, public").setValue(this.plugin.settings.scanDirectories).onChange(async n=>{this.plugin.settings.scanDirectories=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Use note titles instead of file names").setDesc("Display note titles from frontmatter instead of file names in the issues list and current note audit").addToggle(i=>i.setValue(this.plugin.settings.useNoteTitles).onChange(async n=>{this.plugin.settings.useNoteTitles=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Title prefix / suffix").setDesc("Specify an optional prefix or suffix that gets appended to your meta title - used to factor in character count for the title length check").addText(i=>i.setPlaceholder("Author name").setValue(this.plugin.settings.titlePrefixSuffix).onChange(async n=>{this.plugin.settings.titlePrefixSuffix=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Ignores files with an underscore prefix").setDesc("Don't process files that begin with an underscore, like _example.md").addToggle(i=>i.setValue(this.plugin.settings.ignoreUnderscoreFiles).onChange(async n=>{this.plugin.settings.ignoreUnderscoreFiles=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Property names").setHeading(),new C.Setting(t).setName("Keyword property").setDesc("Property name for target keyword (e.g., targetKeyword, seo, keyword)").addText(i=>i.setPlaceholder("targetKeyword").setValue(this.plugin.settings.keywordProperty).onChange(async n=>{this.plugin.settings.keywordProperty=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Description property").setDesc("Property name for meta description").addText(i=>i.setPlaceholder("description").setValue(this.plugin.settings.descriptionProperty).onChange(async n=>{this.plugin.settings.descriptionProperty=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Title property").setDesc("Property name for title (leave blank to skip title checks)").addText(i=>i.setPlaceholder("title").setValue(this.plugin.settings.titleProperty).onChange(async n=>{this.plugin.settings.titleProperty=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Use file name as title").setDesc("Use file name as title instead of a property").addToggle(i=>i.setValue(this.plugin.settings.useFilenameAsTitle).onChange(async n=>{this.plugin.settings.useFilenameAsTitle=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Slug property").setDesc("Property name for slug (leave blank to skip slug checks)").addText(i=>i.setPlaceholder("slug").setValue(this.plugin.settings.slugProperty).onChange(async n=>{this.plugin.settings.slugProperty=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Use file/folder name as slug").setDesc("Use file/folder name as slug instead of a property").addToggle(i=>i.setValue(this.plugin.settings.useFilenameAsSlug).onChange(async n=>{this.plugin.settings.useFilenameAsSlug=n,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.useFilenameAsSlug&&new C.Setting(t).setName("Use parent folder name instead when specified file name is used").setDesc("If a markdown file matches this file name, use the parent folder name as the slug instead").addText(i=>i.setPlaceholder("index").setValue(this.plugin.settings.parentFolderSlugFilename).onChange(async n=>{this.plugin.settings.parentFolderSlugFilename=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Audit options").setHeading(),new C.Setting(t).setName("Check meta title length").setDesc("Enable meta title length checking").addToggle(i=>i.setValue(this.plugin.settings.checkTitleLength).onChange(async n=>{this.plugin.settings.checkTitleLength=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Check heading order").setDesc("Enable heading hierarchy checking").addToggle(i=>i.setValue(this.plugin.settings.checkHeadingOrder).onChange(async n=>{this.plugin.settings.checkHeadingOrder=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Check content length").setDesc("Enable content length checking").addToggle(i=>i.setValue(this.plugin.settings.checkContentLength).onChange(async n=>{this.plugin.settings.checkContentLength=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Check duplicate content").setDesc("Enable duplicate content detection").addToggle(i=>i.setValue(this.plugin.settings.checkDuplicateContent).onChange(async n=>{this.plugin.settings.checkDuplicateContent=n,await this.plugin.saveSettings()})).descEl.createEl("div",{text:"\u26A0\uFE0F Warning: This feature can be very resource-intensive with large vaults and many notes. Disable for faster audits.",cls:"setting-item-description seo-warning-message"}),new C.Setting(t).setName("Check alt text").setDesc("Enable alt text checking for media content (images, videos, embeds, etc.)").addToggle(i=>i.setValue(this.plugin.settings.checkAltText).onChange(async n=>{this.plugin.settings.checkAltText=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Check image file names").setDesc("Enable image file name checking").addToggle(i=>i.setValue(this.plugin.settings.checkImageNaming).onChange(async n=>{this.plugin.settings.checkImageNaming=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Check broken internal links").setDesc("Enable broken internal link detection").addToggle(i=>i.setValue(this.plugin.settings.checkBrokenLinks).onChange(async n=>{this.plugin.settings.checkBrokenLinks=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Check external links").setDesc("Return a list of external links").addToggle(i=>i.setValue(this.plugin.settings.checkExternalLinks).onChange(async n=>{this.plugin.settings.checkExternalLinks=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Enable broken external link check button").setDesc('Show "Check external links for 404s" button in current note panel').addToggle(i=>i.setValue(this.plugin.settings.enableExternalLinkButton).onChange(async n=>{this.plugin.settings.enableExternalLinkButton=n,await this.plugin.saveSettings(),this.plugin.sidePanel&&this.plugin.sidePanel.refresh()})),new C.Setting(t).setName("Check naked links").setDesc("Enable naked URL detection").addToggle(i=>i.setValue(this.plugin.settings.checkNakedLinks).onChange(async n=>{this.plugin.settings.checkNakedLinks=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Check reading level").setDesc("Enable reading level analysis").addToggle(i=>i.setValue(this.plugin.settings.checkReadingLevel).onChange(async n=>{this.plugin.settings.checkReadingLevel=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Check potentially broken links").setDesc("Check for potentially broken internal links that may not work on web publishing").addToggle(i=>i.setValue(this.plugin.settings.checkPotentiallyBrokenLinks).onChange(async n=>{this.plugin.settings.checkPotentiallyBrokenLinks=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Check potentially broken embeds").setDesc("Check for potentially broken markdown or wikilink-based embedded media that may not work on web publishing").addToggle(i=>i.setValue(this.plugin.settings.checkPotentiallyBrokenEmbeds).onChange(async n=>{this.plugin.settings.checkPotentiallyBrokenEmbeds=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Flexible relative link check").setDesc("Uses flexible validation for relative paths like /page that can be resolved by a static site generator, but may be considered broken by typical Obsidian validation").addToggle(i=>i.setValue(this.plugin.settings.publishMode).onChange(async n=>{this.plugin.settings.publishMode=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Title property is H1").setDesc("Enable when your static site generator uses the title frontmatter property to automatically generate the H1 heading. This prevents H1 validation errors while still flagging H1s that appear after other heading levels.").addToggle(i=>i.setValue(this.plugin.settings.skipH1Check).onChange(async n=>{this.plugin.settings.skipH1Check=n,await this.plugin.saveSettings()})),new C.Setting(t).setName("Automatically include broken external link checks in audits (not recommended)").setDesc("Include broken external link checking in vault-wide and current note audits").addToggle(i=>i.setValue(this.plugin.settings.enableExternalLinkVaultCheck).onChange(async n=>{this.plugin.settings.enableExternalLinkVaultCheck=n,await this.plugin.saveSettings(),this.plugin.sidePanel&&this.plugin.sidePanel.refresh()})).descEl.createEl("div",{text:'\u26A0\uFE0F Warning: This will make vault audits extremely slow. Use the "Check external links" button instead for individual notes.',cls:"setting-item-description seo-warning-message"}),new C.Setting(t).setName("Thresholds").setHeading(),new C.Setting(t).setName("Minimum content length").setDesc("Minimum word count for content length check").addText(i=>i.setPlaceholder("300").setValue(this.plugin.settings.minContentLength.toString()).onChange(async n=>{let o=parseInt(n);isNaN(o)||(this.plugin.settings.minContentLength=o,await this.plugin.saveSettings())})),new C.Setting(t).setName("Keyword density minimum").setDesc("Minimum keyword density percentage").addText(i=>i.setPlaceholder("1").setValue(this.plugin.settings.keywordDensityMin.toString()).onChange(async n=>{let o=parseFloat(n);isNaN(o)||(this.plugin.settings.keywordDensityMin=o,await this.plugin.saveSettings())})),new C.Setting(t).setName("Keyword density maximum").setDesc("Maximum keyword density percentage").addText(i=>i.setPlaceholder("2").setValue(this.plugin.settings.keywordDensityMax.toString()).onChange(async n=>{let o=parseFloat(n);isNaN(o)||(this.plugin.settings.keywordDensityMax=o,await this.plugin.saveSettings())})),new C.Setting(t).setName("Duplicate content threshold").setDesc("Similarity percentage threshold for duplicate content detection").addText(i=>i.setPlaceholder("80").setValue(this.plugin.settings.duplicateThreshold.toString()).onChange(async n=>{let o=parseInt(n);isNaN(o)||(this.plugin.settings.duplicateThreshold=o,await this.plugin.saveSettings())}))}};var ne=require("obsidian");var G="seo-current-panel",U="seo-global-panel";j();var S=require("obsidian");j();var se=class{constructor(r,t,e){this.app=r;this.plugin=t;this.panelType=e}async runInitialScan(){try{let r=await this.plugin.getFilesToCheck();if(r.length===0)return[];r.length>20&&new S.Notice(`Running SEO audit on ${r.length} files... This may take a moment.`);let{runSEOCheck:t}=await Promise.resolve().then(()=>(B(),W)),e=await t(this.plugin,r);return this.plugin.settings.cachedGlobalResults=e,this.plugin.settings.lastScanTimestamp=Date.now(),await this.plugin.saveSettings(),new S.Notice(`SEO audit complete with ${e.length} files.`),e}catch(r){return console.error("Error running initial scan:",r),new S.Notice("Error analyzing files. Check console for details."),[]}}async checkCurrentNote(r){let t=this.app.workspace.getActiveFile();if(!t||!t.path.endsWith(".md"))return new S.Notice("Please open a markdown file first."),null;try{let{clearCacheForFile:e}=await Promise.resolve().then(()=>(B(),W));e(t.path);let{runSEOCheck:s}=await Promise.resolve().then(()=>(B(),W)),i=await s(this.plugin,[t],r?{signal:r}:void 0);return i.length>0?(new S.Notice("SEO audit complete."),i[0]||null):null}catch(e){if(e instanceof Error&&e.name==="AbortError")throw new S.Notice("SEO audit cancelled."),e;return console.error("Error checking current note:",e),new S.Notice("Error analyzing current note. Check console for details."),null}}async checkExternalLinks(){let r=this.app.workspace.getActiveFile();if(!r||!r.path.endsWith(".md"))return new S.Notice("Please open a markdown file first."),null;try{let t=this.plugin.settings.enableExternalLinkVaultCheck,e=this.plugin.settings.checkExternalLinks;this.plugin.settings.enableExternalLinkVaultCheck=!0,this.plugin.settings.checkExternalLinks=!1;let{clearCacheForFile:s}=await Promise.resolve().then(()=>(B(),W));s(r.path);let{runSEOCheck:i}=await Promise.resolve().then(()=>(B(),W)),n=await i(this.plugin,[r]);return this.plugin.settings.enableExternalLinkVaultCheck=t,this.plugin.settings.checkExternalLinks=e,n.length>0?(new S.Notice("External links check complete."),n[0]||null):null}catch(t){return console.error("Error checking external links:",t),new S.Notice("Error checking external links. Check console for details."),null}}async refreshGlobalResults(r){let t=null;try{let{clearAllCache:e}=await Promise.resolve().then(()=>(B(),W));e();let s=await this.plugin.getFilesToCheck();if(s.length===0)return new S.Notice("No markdown files found in configured directories."),[];s.length>20&&(t=new S.Notice(`Refreshing SEO audit on ${s.length} files... This may take a moment.`,0));let{runSEOCheck:i}=await Promise.resolve().then(()=>(B(),W)),n=await i(this.plugin,s,r?{signal:r}:void 0);return this.plugin.settings.cachedGlobalResults=n,this.plugin.settings.lastScanTimestamp=Date.now(),await this.plugin.saveSettings(),t&&t.hide(),new S.Notice(`SEO audit complete with ${n.length} files.`),n}catch(e){return t&&t.hide(),e instanceof Error&&e.name==="AbortError"?(console.debug("Vault audit cancelled by user"),new S.Notice("Vault audit cancelled."),[]):(console.error("Error checking all notes:",e),new S.Notice("Error analyzing files. Check console for details."),[])}}async openFile(r){try{let t=this.app.vault.getAbstractFileByPath(r);if(t&&t instanceof S.TFile)try{await this.app.workspace.getLeaf().openFile(t)}catch(e){await this.app.workspace.openLinkText(r,"",!0)}else new S.Notice(`File not found: ${r}
This file may have been renamed or deleted.`)}catch(t){console.error(`Error opening file ${r}:`,t),new S.Notice(`Error opening file: ${r}`)}}async openFileAndAudit(r){var e;let t=this.app.vault.getAbstractFileByPath(r);if(!t||!(t instanceof S.TFile)){new S.Notice(`File not found: ${r}
This file may have been renamed or deleted.`);return}await this.app.workspace.getLeaf().openFile(t),this.plugin.openCurrentPanel(),await new Promise(s=>{let i=()=>{let n=this.app.workspace.getLeavesOfType("seo-current-panel");if(n.length>0){let o=n[0];o&&o.view?(this.app.workspace.setActiveLeaf(o),o.view instanceof b&&o.view.render(),s()):setTimeout(i,50)}else setTimeout(i,50)};i()});try{b.globalAuditController||(b.globalAuditController=new AbortController),await new Promise(n=>setTimeout(n,100));let s=this.app.workspace.getLeavesOfType("seo-current-panel");if(s.length>0){let n=s[0];if(n&&n.view){let o=n.view.containerEl.querySelector("button[data-refresh-btn]");o&&(o.disabled=!0,o.textContent="Auditing...")}}let i=await this.checkCurrentNote((e=b.globalAuditController)==null?void 0:e.signal);i&&this.plugin.sidePanel&&this.plugin.sidePanel.panelType==="current"&&(this.plugin.sidePanel.currentNoteResults=i,this.plugin.sidePanel.render())}catch(s){console.error("Error running audit after opening file:",s)}finally{let s=this.app.workspace.getLeavesOfType("seo-current-panel");if(s.length>0){let i=s[0];if(i&&i.view){let n=i.view.containerEl.querySelector("button[data-refresh-btn]");n&&(n.disabled=!1,n.textContent="Refresh")}}}}showSortMenu(r,t,e,s,i,n){let o=new S.Menu,l=n?n.checkPotentiallyBrokenLinks&&n.checkPotentiallyBrokenEmbeds:!0,u=!l&&(s==="notices-desc"||s==="notices-asc")?"issues-desc":s;o.addItem(c=>{c.setTitle("Issues (high to low)").onClick(()=>{i("issues-desc"),this.sortAndRenderFiles(t,e,"issues-desc",n)}),u==="issues-desc"&&c.setIcon("check")}),o.addItem(c=>{c.setTitle("Issues (low to high)").onClick(()=>{i("issues-asc"),this.sortAndRenderFiles(t,e,"issues-asc",n)}),u==="issues-asc"&&c.setIcon("check")}),o.addSeparator(),o.addItem(c=>{c.setTitle("Warnings (high to low)").onClick(()=>{i("warnings-desc"),this.sortAndRenderFiles(t,e,"warnings-desc",n)}),u==="warnings-desc"&&c.setIcon("check")}),o.addItem(c=>{c.setTitle("Warnings (low to high)").onClick(()=>{i("warnings-asc"),this.sortAndRenderFiles(t,e,"warnings-asc",n)}),u==="warnings-asc"&&c.setIcon("check")}),o.addSeparator(),l&&(o.addItem(c=>{c.setTitle("Notices (high to low)").onClick(()=>{i("notices-desc"),this.sortAndRenderFiles(t,e,"notices-desc",n)}),u==="notices-desc"&&c.setIcon("check")}),o.addItem(c=>{c.setTitle("Notices (low to high)").onClick(()=>{i("notices-asc"),this.sortAndRenderFiles(t,e,"notices-asc",n)}),u==="notices-asc"&&c.setIcon("check")}),o.addSeparator()),o.addItem(c=>{c.setTitle("File name (A to Z)").onClick(()=>{i("filename-asc"),this.sortAndRenderFiles(t,e,"filename-asc",n)}),u==="filename-asc"&&c.setIcon("check")}),o.addItem(c=>{c.setTitle("File name (Z to A)").onClick(()=>{i("filename-desc"),this.sortAndRenderFiles(t,e,"filename-desc",n)}),u==="filename-desc"&&c.setIcon("check")}),o.showAtPosition({x:r.clientX,y:r.clientY})}sortAndRenderFiles(r,t,e,s){let i=Ve([...r],e),n=t.querySelector(".seo-files-list-container");n&&(n.querySelectorAll(".seo-file-issue").forEach(o=>o.remove()),this.renderFilesList(i,n,s))}renderFilesList(r,t,e){r.forEach(s=>{let i=t.createEl("div",{cls:"seo-file-issue"});i.setAttribute("data-file-path",s.file),i.createEl("a",{text:s.displayName||this.getDisplayPath(s.file),cls:"seo-file-link",href:"#"}).addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),this.openFile(s.file)});let o=i.createEl("div",{cls:"seo-stats-container"}),l=e?e.checkPotentiallyBrokenLinks&&e.checkPotentiallyBrokenEmbeds:!0,u=[];s.issuesCount>0&&u.push(`${s.issuesCount} issues`),s.warningsCount>0&&u.push(`${s.warningsCount} warnings`),l&&s.noticesCount>0&&u.push(`${s.noticesCount} notices`),o.createEl("span",{text:u.join(", "),cls:"seo-file-stats"});let c=o.createEl("button",{cls:"clickable-icon seo-audit-btn",attr:{"aria-label":"Audit this note"}});(0,S.setIcon)(c,"search-check"),c.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),(async()=>await this.openFileAndAudit(s.file))()})})}getDisplayPath(r){let t=r.startsWith("/")?r.slice(1):r,e=t.split("/");return e.length<=1?t:e.slice(-2).join("/")}};var A=require("obsidian");j();function Me(){let a=document.createElement("span");return(0,A.setIcon)(a,"chevron-down"),a}var $=class{constructor(r,t,e){this.container=r;this.onFileClick=t;this.onFileAudit=e;this.isCollapsed=!1;this.individualCollapseStates=new Map}updateContainer(r){this.container=r}async navigateToPosition(r){var t;try{let e=window.app;if(!e){console.warn("Obsidian app not found");return}let s=e.workspace.getActiveFile();if(!s){console.warn("No active file found for navigation");return}await this.onFileClick(s.path);let i=null,n=null;if(e.workspace.getLeavesOfType){let l=e.workspace.getLeavesOfType("markdown");l.length>0&&(i=(t=l[0])==null?void 0:t.view)}if(i||e.workspace.iterateAllLeaves(l=>{l.view&&"editor"in l.view&&!i&&(i=l.view)}),!i){console.warn("No markdown view found");return}if(typeof i=="object"&&i!==null&&"editor"in i&&(n=i.editor),!n){console.warn("No editor found in markdown view");return}if(typeof n!="object"||n===null){console.warn("Editor is not an object");return}let o=n;if(r.line&&o.setCursor){let l=Math.max(0,r.line-1);if(o.setCursor({line:l,ch:0}),o.scrollIntoView)try{o.scrollIntoView({line:l,ch:0})}catch(u){try{o.scrollIntoView(l)}catch(c){}}if(o.getLine&&o.addHighlights&&o.removeHighlights)try{let u=o.getLine(l).length;o.addHighlights([{from:{line:l,ch:0},to:{line:l,ch:u}}]),setTimeout(()=>{try{o.removeHighlights&&o.removeHighlights()}catch(c){}},2e3)}catch(u){}}}catch(e){console.error("Error navigating to position:",e)}}renderResults(r){let t=r.noticesCount,e=this.container.createEl("div",{cls:"seo-score-header"}),s=e.createEl("div",{cls:"seo-score-text"});s.createEl("span",{text:"Score: "});let i=s.createEl("span",{text:`${Math.round(r.overallScore)}%`});r.overallScore>=80?i.addClass("seo-score-excellent"):r.overallScore>=60?i.addClass("seo-score-good"):r.overallScore>=40?i.addClass("seo-score-fair"):i.addClass("seo-score-poor"),r.issuesCount>0||r.warningsCount>0||t>0?(s.createEl("span",{text:" ("}),s.createEl("span",{text:`${r.issuesCount} issues`,cls:"seo-issues-count-text"}),s.createEl("span",{text:", "}),s.createEl("span",{text:`${r.warningsCount} warnings`,cls:"seo-warnings-count-text"}),t>0&&(s.createEl("span",{text:", "}),s.createEl("span",{text:`${t} notices`,cls:"seo-notices-count-text"})),s.createEl("span",{text:")"})):s.createEl("span",{text:" (All checks passed!)",cls:"seo-success"});let n=e.createEl("div",{cls:"seo-toggle-icon"});(0,A.setIcon)(n,this.isCollapsed?"chevrons-up-down":"chevrons-down-up"),n.addEventListener("mousedown",l=>{l.preventDefault(),l.stopPropagation(),this.isCollapsed=!this.isCollapsed,(0,A.setIcon)(n,this.isCollapsed?"chevrons-up-down":"chevrons-down-up"),this.toggleChecksVisibility()});let o=this.container.createEl("div",{cls:"seo-checks"});Object.entries(r.checks).forEach(([l,u])=>{if(u.length===0)return;let c=u.some(v=>v.severity==="error"),h=u.some(v=>v.severity==="warning"),d=u.some(v=>v.severity==="notice"),f=u.every(v=>v.severity==="info"),p="seo-passed";c?p="seo-error":h?p="seo-warning":d?p="seo-notice":f&&(p="seo-passed");let m=o.createEl("div",{cls:`seo-check ${p}`}),y=m.createEl("div",{cls:"seo-check-header seo-collapsible-header"});y.setAttribute("data-check-name",l);let k=l.replace(/([A-Z])/g," $1").trim().replace(/^./,v=>v.toUpperCase());if(l==="brokenLinks")k="Broken Internal Links";else if(l==="externalBrokenLinks"){let v=u.some(L=>L.severity==="notice"),z=u.some(L=>L.severity==="error");v&&!z?k="External Links":k="External Broken Links"}else l==="duplicateTitles"?k="Duplicate Titles":l==="duplicateDescriptions"?k="Duplicate Descriptions":l==="duplicateContent"&&(k="Duplicate Content");let g=y.createEl("span",{cls:"seo-collapse-icon"});g.appendChild(Me()),y.createEl("span",{text:k});let w=y.createEl("span",{cls:"seo-status"}),E=u.some(v=>v.severity==="error"),P=u.some(v=>v.severity==="warning"),T=u.some(v=>v.severity==="notice");E?(0,A.setIcon)(w,"x-circle"):P?(0,A.setIcon)(w,"triangle-alert"):T?(0,A.setIcon)(w,"info"):(0,A.setIcon)(w,"circle-check");let R=m.createEl("ul",{cls:"seo-results seo-results-list-expanded"}),V=this.individualCollapseStates.get(l);if(V!==void 0)if(V){R.classList.add("seo-results-list-collapsed"),R.classList.remove("seo-results-list-expanded");let v=g.querySelector("svg");v&&(v.classList.add("seo-collapse-icon-rotated"),v.classList.remove("seo-collapse-icon-normal"))}else{R.classList.add("seo-results-list-expanded"),R.classList.remove("seo-results-list-collapsed");let v=g.querySelector("svg");v&&(v.classList.add("seo-collapse-icon-normal"),v.classList.remove("seo-collapse-icon-rotated"))}u.forEach(v=>{let z=R.createEl("li",{cls:`seo-result seo-${v.severity}`});if(v.position){let L=z.createEl("span",{text:v.message,cls:"seo-result-message seo-clickable"});L.addEventListener("click",I=>{I.preventDefault(),I.stopPropagation(),(async()=>await this.navigateToPosition(v.position))()}),L.addClass("seo-clickable-message"),L.title="Click to jump to this issue in the note"}else z.createEl("span",{text:v.message,cls:"seo-result-message"});if(v.suggestion){let L=z.createEl("div",{cls:"seo-suggestion"});if(v.suggestion.includes('<a href="#" data-file-path=')){let Z=new DOMParser().parseFromString(v.suggestion,"text/html").body;for(;Z.firstChild;)L.appendChild(Z.firstChild);L.addEventListener("click",ue=>{(async()=>{let Y=ue.target;if(Y&&Y.tagName==="A"&&Y.hasAttribute("data-file-path")){ue.preventDefault(),ue.stopPropagation();let He=Y.getAttribute("data-file-path");He&&await this.onFileClick(He)}})()})}else L.textContent=v.suggestion}}),y.addEventListener("mousedown",v=>{var ce;v.preventDefault(),v.stopPropagation();let L=!((ce=this.individualCollapseStates.get(l))!=null?ce:!1);this.individualCollapseStates.set(l,L),L?(R.classList.remove("seo-results-list-expanded"),R.classList.add("seo-results-list-collapsed")):(R.classList.remove("seo-results-list-collapsed"),R.classList.add("seo-results-list-expanded"));let I=g.querySelector("svg");if(I&&(L?(I.classList.remove("seo-collapse-icon-normal"),I.classList.add("seo-collapse-icon-rotated")):(I.classList.remove("seo-collapse-icon-rotated"),I.classList.add("seo-collapse-icon-normal"))),!L){this.isCollapsed=!1;let Z=this.container.querySelector(".seo-toggle-icon");Z&&(0,A.setIcon)(Z,"chevrons-down-up")}})})}renderGlobalResults(r,t){let e=this.container.createEl("div",{cls:"seo-vault-summary"}),s=r.length,i=r.reduce((k,g)=>k+g.issuesCount,0),n=r.reduce((k,g)=>k+g.warningsCount,0),o=r.reduce((k,g)=>k+g.noticesCount,0),l=Math.round(r.reduce((k,g)=>k+g.overallScore,0)/s),u=t?t.checkPotentiallyBrokenLinks&&t.checkPotentiallyBrokenEmbeds:!0,c=e.createEl("div",{cls:"seo-stats-grid"}),h=c.createEl("div",{cls:"seo-stat-item"}),d=h.createEl("div",{cls:"seo-stat-number",text:`${l}%`});l>=80?d.addClass("seo-score-excellent"):l>=60?d.addClass("seo-score-good"):l>=40?d.addClass("seo-score-fair"):d.addClass("seo-score-poor"),h.createEl("div",{cls:"seo-stat-label",text:"Average score"});let f=c.createEl("div",{cls:"seo-stat-item"}),p=f.createEl("div",{cls:"seo-stat-number",text:i.toString()});i>0&&p.addClass("seo-issues-count"),f.createEl("div",{cls:"seo-stat-label",text:"Issues"});let m=c.createEl("div",{cls:"seo-stat-item"}),y=m.createEl("div",{cls:"seo-stat-number",text:n.toString()});if(n>0&&y.addClass("seo-warnings-count"),m.createEl("div",{cls:"seo-stat-label",text:"Warnings"}),u){let k=c.createEl("div",{cls:"seo-stat-item"}),g=k.createEl("div",{cls:"seo-stat-number",text:o.toString()});o>0&&g.addClass("seo-notices-count"),k.createEl("div",{cls:"seo-stat-label",text:"Notices"})}}renderIssuesList(r,t,e,s,i){let n=i?i.checkPotentiallyBrokenLinks&&i.checkPotentiallyBrokenEmbeds:!0,o=r.filter(p=>{let m=p.issuesCount>0,y=p.warningsCount>0,k=n&&p.noticesCount>0;return m||y||k});if(o.length===0)return;let l=this.container.createEl("div",{cls:"seo-issues-list"}),u=l.createEl("div",{cls:"seo-issues-header-container"}),c=u.createEl("span",{cls:"seo-collapse-icon seo-collapsible-header"});c.appendChild(Me()),u.createEl("h4",{text:"Files with results",cls:"seo-issues-header"});let h=u.createEl("button",{cls:"seo-sort-btn",attr:{"aria-label":"Sort files"}});(0,A.setIcon)(h,"arrow-up-narrow-wide"),h.addEventListener("click",s);let d=l.createEl("div",{cls:"seo-files-list-container"});this.sortFiles(o,t).forEach(p=>{let m=d.createEl("div",{cls:"seo-file-issue"});m.setAttribute("data-file-path",p.file),m.createEl("a",{text:p.displayName||_(p.file),cls:"seo-file-link",href:"#"}).addEventListener("click",E=>{E.preventDefault(),(async()=>await this.onFileClick(p.file))()});let k=m.createEl("div",{cls:"seo-stats-container"}),g=[];p.issuesCount>0&&g.push(`${p.issuesCount} issues`),p.warningsCount>0&&g.push(`${p.warningsCount} warnings`),n&&p.noticesCount>0&&g.push(`${p.noticesCount} notices`),k.createEl("span",{text:g.join(", "),cls:"seo-file-stats"});let w=k.createEl("button",{cls:"clickable-icon seo-audit-btn",attr:{"aria-label":"Audit this note"}});(0,A.setIcon)(w,"search-check"),w.addEventListener("click",E=>{E.preventDefault(),E.stopPropagation(),(async()=>await this.onFileAudit(p.file))()})}),c.addEventListener("mousedown",p=>{p.preventDefault(),p.stopPropagation();let m=d.classList.contains("seo-results-list-collapsed");m?(d.classList.remove("seo-results-list-collapsed"),d.classList.add("seo-results-list-expanded")):(d.classList.remove("seo-results-list-expanded"),d.classList.add("seo-results-list-collapsed"));let y=c.querySelector("svg");y&&(m?(y.classList.remove("seo-collapse-icon-rotated"),y.classList.add("seo-collapse-icon-normal")):(y.classList.remove("seo-collapse-icon-normal"),y.classList.add("seo-collapse-icon-rotated")))}),this.renderPassingFilesList(r,t,n)}renderPassingFilesList(r,t,e){let s=r.filter(d=>{let f=d.issuesCount>0,p=d.warningsCount>0;return!f&&!p});if(s.length===0)return;let i=this.container.createEl("div",{cls:"seo-issues-list"}),n=i.createEl("div",{cls:"seo-issues-header-container"}),o=n.createEl("span",{cls:"seo-collapse-icon seo-collapsible-header"});o.appendChild(Me());let l=o.querySelector("svg");l&&l.classList.add("seo-collapse-icon-rotated"),n.createEl("div",{cls:"seo-heading-center"}).createEl("h4",{text:"Files that pass",cls:"seo-issues-header"});let c=i.createEl("div",{cls:"seo-files-list-container seo-results-list-collapsed"});this.sortFiles(s,t).forEach(d=>{let f=c.createEl("div",{cls:"seo-file-issue"});f.setAttribute("data-file-path",d.file),f.createEl("a",{text:d.displayName||_(d.file),cls:"seo-file-link",href:"#"}).addEventListener("click",k=>{k.preventDefault(),(async()=>await this.onFileClick(d.file))()});let m=f.createEl("div",{cls:"seo-stats-container"});e&&d.noticesCount>0&&m.createEl("span",{text:`${d.noticesCount} notices`,cls:"seo-file-stats"});let y=m.createEl("button",{cls:"clickable-icon seo-audit-btn",attr:{"aria-label":"Audit this note"}});(0,A.setIcon)(y,"search-check"),y.addEventListener("click",k=>{k.preventDefault(),k.stopPropagation(),(async()=>await this.onFileAudit(d.file))()})}),o.addEventListener("mousedown",d=>{d.preventDefault(),d.stopPropagation();let f=c.classList.contains("seo-results-list-collapsed");f?(c.classList.remove("seo-results-list-collapsed"),c.classList.add("seo-results-list-expanded")):(c.classList.remove("seo-results-list-expanded"),c.classList.add("seo-results-list-collapsed"));let p=o.querySelector("svg");p&&(f?(p.classList.remove("seo-collapse-icon-rotated"),p.classList.add("seo-collapse-icon-normal")):(p.classList.remove("seo-collapse-icon-normal"),p.classList.add("seo-collapse-icon-rotated")))})}sortFiles(r,t){let e=[...r];switch(t){case"notices-desc":e.sort((s,i)=>{let n=i.noticesCount-s.noticesCount;if(n!==0)return n;let o=i.issuesCount-s.issuesCount;if(o!==0)return o;let l=i.warningsCount-s.warningsCount;if(l!==0)return l;let u=s.file.split("/").pop()||"",c=i.file.split("/").pop()||"";return u.localeCompare(c)});break;case"notices-asc":e.sort((s,i)=>{let n=s.noticesCount-i.noticesCount;if(n!==0)return n;let o=s.issuesCount-i.issuesCount;if(o!==0)return o;let l=s.warningsCount-i.warningsCount;if(l!==0)return l;let u=s.file.split("/").pop()||"",c=i.file.split("/").pop()||"";return u.localeCompare(c)});break;case"warnings-desc":e.sort((s,i)=>{let n=i.warningsCount-s.warningsCount;if(n!==0)return n;let o=i.issuesCount-s.issuesCount;if(o!==0)return o;let l=s.file.split("/").pop()||"",u=i.file.split("/").pop()||"";return l.localeCompare(u)});break;case"warnings-asc":e.sort((s,i)=>{let n=s.warningsCount-i.warningsCount;if(n!==0)return n;let o=s.issuesCount-i.issuesCount;if(o!==0)return o;let l=s.file.split("/").pop()||"",u=i.file.split("/").pop()||"";return l.localeCompare(u)});break;case"issues-desc":e.sort((s,i)=>{let n=i.issuesCount-s.issuesCount;if(n!==0)return n;let o=i.warningsCount-s.warningsCount;if(o!==0)return o;let l=s.file.split("/").pop()||"",u=i.file.split("/").pop()||"";return l.localeCompare(u)});break;case"issues-asc":e.sort((s,i)=>{let n=s.issuesCount-i.issuesCount;if(n!==0)return n;let o=s.warningsCount-i.warningsCount;if(o!==0)return o;let l=s.file.split("/").pop()||"",u=i.file.split("/").pop()||"";return l.localeCompare(u)});break;case"filename-asc":e.sort((s,i)=>{let n=s.file.split("/").pop()||"",o=i.file.split("/").pop()||"",l=n.localeCompare(o);if(l!==0)return l;let u=s.file.split("/"),c=i.file.split("/"),h=u.length>1&&u[u.length-2]||"",d=c.length>1&&c[c.length-2]||"",f=h.localeCompare(d);return f!==0?f:i.issuesCount!==s.issuesCount?i.issuesCount-s.issuesCount:i.warningsCount!==s.warningsCount?i.warningsCount-s.warningsCount:i.noticesCount-s.noticesCount});break;case"filename-desc":e.sort((s,i)=>{let n=s.file.split("/").pop()||"",l=(i.file.split("/").pop()||"").localeCompare(n);if(l!==0)return l;let u=s.file.split("/"),c=i.file.split("/"),h=u.length>1&&u[u.length-2]||"",f=(c.length>1&&c[c.length-2]||"").localeCompare(h);return f!==0?f:i.issuesCount!==s.issuesCount?i.issuesCount-s.issuesCount:i.warningsCount!==s.warningsCount?i.warningsCount-s.warningsCount:i.noticesCount-s.noticesCount});break}return e}toggleChecksVisibility(){let r=this.container.querySelector(".seo-checks");if(!r)return;r.querySelectorAll(".seo-check-header").forEach(e=>{var l;let s=e,i=(l=s.parentElement)==null?void 0:l.querySelector(".seo-results"),n=s.querySelector(".seo-collapse-icon svg"),o=this.findCheckNameForHeader(s);i&&n&&(o&&this.individualCollapseStates.set(o,this.isCollapsed),this.isCollapsed?(i.classList.remove("seo-results-list-expanded"),i.classList.add("seo-results-list-collapsed"),n.classList.remove("seo-collapse-icon-normal"),n.classList.add("seo-collapse-icon-rotated")):(i.classList.remove("seo-results-list-collapsed"),i.classList.add("seo-results-list-expanded"),n.classList.remove("seo-collapse-icon-rotated"),n.classList.add("seo-collapse-icon-normal")))})}findCheckNameForHeader(r){return r.getAttribute("data-check-name")}};j();var ie=class{constructor(r,t,e){this.app=r;this.plugin=t;this.actions=e}render(r,t,e,s,i,n){try{r.empty(),r.addClass("seo-panel");let o=r.createEl("div",{cls:"seo-panel-header"});if(o.createEl("h2",{text:t==="current"?"SEO audit: current note":"SEO audit: vault"}),t==="current")this.renderCurrentNoteHeader(o,e);else{let l=s.length,u=X(this.plugin.settings.scanDirectories,l),c=o.createEl("div",{cls:"seo-filename"});c.textContent=u}t==="current"&&this.renderCurrentNoteActions(r,i,n),t==="current"?this.renderCurrentNoteContent(r,e):s.length>0?this.renderGlobalResults(r,s):r.createEl("div",{cls:"seo-no-results"}).createEl("p",{text:'Click "Audit all notes" to audit your files in your configured directories.'})}catch(o){console.error("Error rendering SEO panel:",o),r.createEl("div",{text:"Error loading SEO panel. Please try again."})}}renderCurrentNoteHeader(r,t){let e=this.app.workspace.getActiveFile();if(e&&e.path.endsWith(".md")){let s=r.createEl("div",{cls:"seo-filename"}),i=e.path;if(t&&t.file===e.path)i=t.displayName||e.path;else if(this.plugin.settings.cachedGlobalResults){let n=this.plugin.settings.cachedGlobalResults.find(o=>o.file===e.path);n&&(i=n.displayName||e.path)}s.textContent=`Target note: ${i}`}}renderCurrentNoteActions(r,t,e){let s=r.createEl("button",{text:"Refresh",cls:"mod-cta seo-btn seo-top-btn",attr:{"data-refresh-btn":"true"}});if(s.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),(async()=>await t(s))()}),this.plugin.settings.enableExternalLinkButton&&!this.plugin.settings.enableExternalLinkVaultCheck){let i=r.createEl("button",{text:"Check external links for 404s",cls:"seo-btn"});i.addEventListener("click",()=>{(async()=>{i.disabled=!0,i.textContent="This may take some time...",i.addClass("seo-btn-disabled");try{await e()}finally{i.disabled=!1,i.textContent="Check external links for 404s",i.removeClass("seo-btn-disabled"),i.addClass("seo-btn-enabled")}})()})}}renderCurrentNoteContent(r,t){let e=this.app.workspace.getActiveFile(),s=null;e&&this.plugin.settings.cachedGlobalResults&&(s=this.plugin.settings.cachedGlobalResults.find(n=>n.file===e.path)||null);let i=t||s;if(i){let n=r.createEl("div",{cls:"seo-results-container"});new $(n,async l=>await this.actions.openFile(l),async l=>await this.actions.openFileAndAudit(l)).renderResults(i)}else r.createEl("div",{cls:"seo-no-results"}).createEl("p",{text:'Open a markdown file and click "Refresh" to audit it.'})}renderGlobalResults(r,t){let e=new $(r,async i=>await this.actions.openFile(i),async i=>await this.actions.openFileAndAudit(i));e.renderGlobalResults(t,this.plugin.settings);let s=r.createEl("button",{text:"Refresh",cls:"mod-cta seo-btn seo-refresh-btn",attr:{"data-refresh-btn":"true"}});s.addEventListener("click",()=>{(async()=>{var i;if(s.textContent==="Cancel"){b.globalAuditController&&(b.globalAuditController.abort(),b.globalAuditController=null,console.debug("Vault audit cancelled by user")),s.textContent="Refresh",s.disabled=!1;return}s.textContent="Cancel",s.disabled=!1,b.globalAuditController=new AbortController;try{let n=await this.actions.refreshGlobalResults((i=b.globalAuditController)==null?void 0:i.signal);n.length>0&&b.globalAuditController&&!b.globalAuditController.signal.aborted&&r.dispatchEvent(new CustomEvent("seo-refresh-complete",{detail:{results:n}}))}catch(n){n instanceof Error&&n.name==="AbortError"?console.debug("Vault audit cancelled in panel renderer"):console.error("Error in vault audit:",n)}finally{s.textContent="Refresh",s.disabled=!1}})()}),e.renderIssuesList(t,this.plugin.settings.defaultSort,i=>{r.dispatchEvent(new CustomEvent("seo-sort-change",{detail:{sortType:i}}))},i=>{let n=this.plugin.settings.checkPotentiallyBrokenLinks&&this.plugin.settings.checkPotentiallyBrokenEmbeds,o=t.filter(l=>{let u=l.issuesCount>0,c=l.warningsCount>0,h=n&&l.noticesCount>0;return u||c||h});this.actions.showSortMenu(i,o,r,this.plugin.settings.defaultSort,l=>{r.dispatchEvent(new CustomEvent("seo-sort-change",{detail:{sortType:l}}))},this.plugin.settings)},this.plugin.settings)}};var M=class extends ne.ItemView{constructor(t,e="current",s){super(s||t.app.workspace.getLeaf());this.currentNoteResults=null;this.globalResults=[];this.panelType="current";this.hasRunInitialScan=!1;this.isRefreshing=!1;this.currentAuditController=null;this.plugin=t,this.panelType=e,this.currentSort=t.settings.defaultSort,this.actions=new se(this.app,this.plugin,this.panelType),this.resultsDisplay=new $(this.containerEl,async i=>await this.actions.openFile(i),async i=>await this.actions.openFileAndAudit(i)),this.renderer=new ie(this.app,this.plugin,this.actions),this.panelType==="current"&&this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{if(M.globalAuditController&&(M.globalAuditController.abort(),M.globalAuditController=null,console.debug("Audit cancelled due to file switch")),this.isRefreshing)return;let i=this.app.workspace.getActiveFile();i&&i&&this.updateCurrentNoteResults(i)}))}getViewType(){return this.panelType==="current"?G:U}async handleRefreshClick(t){if(!t.disabled){M.globalAuditController&&M.globalAuditController.abort(),M.globalAuditController=new AbortController,this.isRefreshing=!0,t.textContent="Refreshing...",t.disabled=!0;try{let e=await this.actions.checkCurrentNote(M.globalAuditController.signal);if(e){this.currentNoteResults=e,this.containerEl.querySelectorAll(".seo-results-container, .seo-file-issue, .seo-issue, .seo-warning, .seo-notice, .seo-info-note, .seo-check, .seo-result, .seo-score-header, .seo-score-text, .seo-score-number, .seo-toggle-icon, .seo-collapse-icon").forEach(n=>n.remove());let i=this.containerEl.createEl("div",{cls:"seo-results-container"});this.resultsDisplay.updateContainer(i),this.resultsDisplay.renderResults(e),this.updateGlobalResultsIfExists(e)}}catch(e){if(e instanceof Error&&e.name==="AbortError"){console.debug("Audit was cancelled");return}console.error("Error in refresh button:",e)}finally{this.isRefreshing=!1,t.textContent="Refresh",t.disabled=!1,M.globalAuditController=null}}}getDisplayText(){return this.panelType==="current"?"SEO audit: current note":"SEO audit: vault"}getIcon(){return"search-check"}async onOpen(){try{this.panelType==="global"&&this.plugin.settings.cachedGlobalResults.length>0&&(this.globalResults=this.plugin.settings.cachedGlobalResults),this.forceIconRefresh(),this.panelType==="global"&&!this.hasRunInitialScan&&this.globalResults.length===0?(this.showLoadingState(),this.hasRunInitialScan=!0,await this.runInitialScan()):this.render()}catch(t){console.error("Error opening SEO panel:",t)}}async onClose(){}cleanup(){}async runInitialScan(){let t=await this.actions.runInitialScan();t.length>0&&(this.globalResults=t,this.render())}forceIconRefresh(){this.leaf&&this.leaf.setViewState({type:this.getViewType(),state:this.leaf.view.getState()}),setTimeout(()=>{let t=this.containerEl.querySelector(".view-header-icon");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);t.setAttribute("data-icon","search-check"),t.setAttribute("data-icon",""),t.offsetHeight,t.setAttribute("data-icon","search-check")}let e=this.containerEl.querySelector(".view-header");e&&(e.addClass("seo-header-hidden"),e.offsetHeight,e.removeClass("seo-header-hidden"),e.addClass("seo-header-visible")),this.app.workspace.trigger("layout-change")},50)}updateCurrentNoteResults(t){if(!(!t||!t.path.endsWith(".md")))try{let e=null;this.plugin.settings.cachedGlobalResults&&(e=this.plugin.settings.cachedGlobalResults.find(n=>n.file===t.path)||null),e?this.currentNoteResults=e:this.currentNoteResults=null;let s=this.currentNoteResults;if(this.containerEl.querySelectorAll(".seo-results-container, .seo-file-issue, .seo-issue, .seo-warning, .seo-notice, .seo-info-note, .seo-check, .seo-result, .seo-score-header, .seo-score-text, .seo-score-number, .seo-toggle-icon, .seo-collapse-icon").forEach(n=>n.remove()),s){let n=this.containerEl.createEl("div",{cls:"seo-results-container"});this.resultsDisplay?this.resultsDisplay.updateContainer(n):this.resultsDisplay=new $(n,async o=>await this.actions.openFile(o),async o=>await this.actions.openFileAndAudit(o)),this.resultsDisplay.renderResults(s)}else this.containerEl.createEl("div",{cls:"seo-info-note seo-no-results-message",text:'No SEO results available for this file. Click "Refresh" to run an audit.'});this.updateHeaderAndResults()}catch(e){console.error("Error updating current note results:",e)}}updateHeaderAndResults(){let t=this.containerEl.querySelector(".seo-panel-header");if(t){let e=t.querySelector(".seo-filename");if(e){let s=this.app.workspace.getActiveFile();if(s&&s.path.endsWith(".md")){let i=s.path;if(this.currentNoteResults&&this.currentNoteResults.file===s.path)i=this.currentNoteResults.displayName||s.path;else if(this.plugin.settings.cachedGlobalResults){let n=this.plugin.settings.cachedGlobalResults.find(o=>o.file===s.path);n&&(i=n.displayName||s.path)}e.textContent=`Target note: ${i}`}}}}updateResults(t){this.globalResults=t,this.render()}showLoadingState(){let{containerEl:t}=this;t.empty(),t.addClass("seo-panel");let e=t.createEl("div",{cls:"seo-panel-header"});if(e.createEl("h2",{text:this.panelType==="current"?"SEO audit: current note":"SEO audit: vault"}),this.panelType==="global"){let n=X(this.plugin.settings.scanDirectories),o=e.createEl("div",{cls:"seo-filename"});o.textContent=n}let s=t.createEl("div",{cls:"seo-loading-container"}),i=s.createEl("div",{cls:"seo-loading-spinner"});(0,ne.setIcon)(i,"loader-circle"),s.createEl("h3",{text:"Running SEO audit...",cls:"seo-loading-title"}),s.createEl("p",{text:"This may take a moment for large vaults. Please wait...",cls:"seo-loading-message"})}refresh(){this.render()}render(){this.renderer.render(this.containerEl,this.panelType,this.currentNoteResults,this.globalResults,async t=>await this.handleRefreshClick(t),async()=>{let t=await this.actions.checkExternalLinks();t&&(this.currentNoteResults=t,this.updateGlobalResultsIfExists(t),this.render())}),this.containerEl.addEventListener("seo-refresh-complete",t=>{let e=t;this.globalResults=e.detail.results,this.render()}),this.containerEl.addEventListener("seo-sort-change",t=>{let e=t;this.currentSort=e.detail.sortType,this.plugin.settings.defaultSort=e.detail.sortType,this.plugin.saveSettings(),this.render()})}renderLegacy(){try{let{containerEl:t}=this;t.empty(),t.addClass("seo-panel");let e=t.createEl("div",{cls:"seo-panel-header"});if(e.createEl("h2",{text:this.panelType==="current"?"SEO audit: current note":"SEO audit: vault"}),this.panelType==="current"){let s=this.app.workspace.getActiveFile();if(s&&s.path.endsWith(".md")){let i=e.createEl("div",{cls:"seo-filename"}),n=s.path;if(this.currentNoteResults&&this.currentNoteResults.file===s.path)n=this.currentNoteResults.displayName||s.path;else if(this.plugin.settings.cachedGlobalResults){let o=this.plugin.settings.cachedGlobalResults.find(l=>l.file===s.path);o&&(n=o.displayName||s.path)}i.textContent=`Target note: ${n}`}}else{let s=this.globalResults.length,i=X(this.plugin.settings.scanDirectories,s),n=e.createEl("div",{cls:"seo-filename"});n.textContent=i}if(this.panelType==="current"){let s=t.createEl("button",{text:"Refresh",cls:"mod-cta seo-btn seo-top-btn"});if(s.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),(async()=>await this.handleRefreshClick(s))()}),this.plugin.settings.enableExternalLinkButton&&!this.plugin.settings.enableExternalLinkVaultCheck){let i=t.createEl("button",{text:"Check external links for 404s",cls:"seo-btn"});i.addEventListener("click",()=>{(async()=>{i.disabled=!0,i.textContent="This may take some time...",i.addClass("seo-btn-disabled");try{let n=await this.actions.checkExternalLinks();n&&(this.currentNoteResults=n,this.updateGlobalResultsIfExists(n),this.render())}finally{i.disabled=!1,i.textContent="Check external links for 404s",i.removeClass("seo-btn-disabled"),i.addClass("seo-btn-enabled")}})()})}}if(this.panelType==="current"){let s=this.app.workspace.getActiveFile(),i=null;s&&this.plugin.settings.cachedGlobalResults&&(i=this.plugin.settings.cachedGlobalResults.find(o=>o.file===s.path)||null);let n=this.currentNoteResults||i;if(n){let o=this.containerEl.createEl("div",{cls:"seo-results-container"});new $(o,async u=>await this.actions.openFile(u),async u=>await this.actions.openFileAndAudit(u)).renderResults(n)}else t.createEl("div",{cls:"seo-no-results"}).createEl("p",{text:'Open a markdown file and click "Refresh" to audit it.'})}else this.globalResults.length>0?this.renderGlobalResults(t):t.createEl("div",{cls:"seo-no-results"}).createEl("p",{text:'Click "Audit all notes" to audit your files in your configured directories.'})}catch(t){console.error("Error rendering SEO panel:",t),this.containerEl.createEl("div",{text:"Error loading SEO panel. Please try again."})}}shouldIncludeFileInGlobalResults(t){if(this.plugin.settings.ignoreUnderscoreFiles&&(t.split("/").pop()||"").replace(/\.[^/.]+$/,"").startsWith("_"))return!1;let{scanDirectories:e}=this.plugin.settings;return e.trim()?e.split(",").map(n=>n.trim()).some(n=>t.startsWith(n+"/")||t===n):!0}updateGlobalResultsIfExists(t){if(this.plugin.settings.cachedGlobalResults&&this.plugin.settings.cachedGlobalResults.length>0){if(!this.shouldIncludeFileInGlobalResults(t.file))return;let e=this.plugin.settings.cachedGlobalResults,s=e.findIndex(i=>i.file===t.file);s!==-1?e[s]=t:e.push(t),this.plugin.saveSettings(),this.updateGlobalPanelIfOpen()}}updateDisplayName(){let t=this.app.workspace.getActiveFile();if(t&&t.path.endsWith(".md")){let e=this.containerEl.querySelector(".seo-filename");if(e){let s=t.path;if(this.currentNoteResults&&this.currentNoteResults.file===t.path)s=this.currentNoteResults.displayName||t.path;else if(this.plugin.settings.cachedGlobalResults){let i=this.plugin.settings.cachedGlobalResults.find(n=>n.file===t.path);i&&(s=i.displayName||t.path)}e.textContent=`Target note: ${s}`}this.updateResultsForCurrentFile()}}updateResultsForCurrentFile(){let t=this.app.workspace.getActiveFile(),e=null;t&&this.plugin.settings.cachedGlobalResults&&(e=this.plugin.settings.cachedGlobalResults.find(n=>n.file===t.path)||null);let s=this.currentNoteResults||e;if(this.containerEl.querySelectorAll(".seo-results-container, .seo-file-issue, .seo-issue, .seo-warning, .seo-notice, .seo-info-note, .seo-check, .seo-result, .seo-score-header, .seo-score-text, .seo-score-number, .seo-toggle-icon, .seo-collapse-icon").forEach(n=>n.remove()),s){let n=this.containerEl.createEl("div",{cls:"seo-results-container"});new $(n,async l=>await this.actions.openFile(l),async l=>await this.actions.openFileAndAudit(l)).renderResults(s)}else this.containerEl.createEl("div",{cls:"seo-no-results"}).createEl("p",{text:'Open a markdown file and click "Refresh" to audit it.'})}updateGlobalPanelIfOpen(){let t=this.app.workspace.getLeavesOfType("seo-global-panel");if(t.length>0){let e=t[0];if(e!=null&&e.view&&e.view instanceof M){let s=e.view;s.globalResults=[...this.plugin.settings.cachedGlobalResults],s.render()}}}renderGlobalResults(t){this.resultsDisplay.renderGlobalResults(this.globalResults,this.plugin.settings);let e=t.createEl("button",{text:"Refresh",cls:"mod-cta seo-btn seo-refresh-btn",attr:{"data-refresh-btn":"true"}});e.addEventListener("click",()=>{(async()=>{e.textContent="Refreshing...",e.disabled=!0;try{let s=await this.actions.refreshGlobalResults();s.length>0&&(this.globalResults=s,this.render())}finally{e.textContent="Refresh",e.disabled=!1}})()}),this.resultsDisplay.renderIssuesList(this.globalResults,this.currentSort,s=>{this.currentSort=s,this.plugin.settings.defaultSort=s,this.plugin.saveSettings()},s=>{let i=this.plugin.settings.checkPotentiallyBrokenLinks&&this.plugin.settings.checkPotentiallyBrokenEmbeds,n=this.globalResults.filter(o=>{let l=o.issuesCount>0,u=o.warningsCount>0,c=i&&o.noticesCount>0;return l||u||c});this.actions.showSortMenu(s,n,t,this.currentSort,o=>{this.currentSort=o,this.plugin.settings.defaultSort=o,this.plugin.saveSettings()},this.plugin.settings)},this.plugin.settings)}},b=M;b.globalAuditController=null;var at=require("obsidian");var re=class{constructor(r,t){this.app=r;this.plugin=t}openCurrentPanel(){this.openPanel(G,"current")}openGlobalPanel(){this.openPanel(U,"global")}openPanel(r,t){let e=this.app.workspace.getLeavesOfType(r)[0];if(e){if(this.app.workspace.revealLeaf(e),this.app.workspace.setActiveLeaf(e),e.view instanceof b&&(this.plugin.sidePanel=e.view),e.view instanceof b){let s=e.view;typeof s.forceIconRefresh=="function"&&setTimeout(()=>s.forceIconRefresh(),100)}}else{let s=this.app.workspace.getRightLeaf(!1);if(s){let i=new b(this.plugin,t,s);this.plugin.sidePanel=i,s.open(i),this.app.workspace.setActiveLeaf(s),setTimeout(()=>{s.view instanceof b&&typeof s.view.forceIconRefresh=="function"&&s.view.forceIconRefresh()},100)}}}getFilesToCheck(){let{vault:r}=this.app,{scanDirectories:t,ignoreUnderscoreFiles:e}=this.plugin.settings,s;if(!t.trim())s=r.getMarkdownFiles();else{let i=t.split(",").map(n=>n.trim());s=[];for(let n of i){let o=r.getAbstractFileByPath(n);o&&o instanceof at.TFolder&&s.push(...r.getMarkdownFiles().filter(l=>l.path.startsWith(n+"/")||l.path===n))}}return e&&(s=s.filter(i=>!i.basename.startsWith("_"))),Promise.resolve(s)}};var lt=require("obsidian");var oe=class extends Error{constructor(t,e="error",s,i){super(t);this.name="SEOPluginError",this.severity=e,this.userMessage=s||t,this.suggestion=i}};function D(a,r,t=!0){let e,s="error",i;if(a instanceof oe?(e=a.userMessage,s=a.severity,i=a.suggestion):a instanceof Error?(e=a.message,s="error",i="Please try again or check the plugin settings"):(e="An unexpected error occurred",s="critical",i="Please restart Obsidian and try again"),console.error(`[SEO Plugin] Error in ${r}:`,a),t){let n=i?`${e} - ${i}`:e;new lt.Notice(n,5e3)}return{message:e,severity:s,suggestion:i}}async function J(a,r,t){try{return await a()}catch(e){return D(e,r,!0),t}}function ct(a,r){let t=Object.entries(a).filter(([e,s])=>s==null).map(([e])=>e);if(t.length>0)throw new oe(`Missing required parameters: ${t.join(", ")}`,"error",`Missing required parameters: ${t.join(", ")}`,"Please check your plugin configuration")}var ae=class{constructor(r={}){this.cache=new Map;this.cleanupTimer=null;this.config={maxSize:r.maxSize||100,maxAge:r.maxAge||30*60*1e3,cleanupInterval:r.cleanupInterval||5*60*1e3},this.startCleanupTimer()}get(r){let t=this.cache.get(r);if(t){if(this.isExpired(t)){this.cache.delete(r);return}return t.accessCount++,t.lastAccessed=Date.now(),t.value}}set(r,t){this.cache.has(r)&&this.cache.delete(r),this.cache.size>=this.config.maxSize&&this.evictLRU(),this.cache.set(r,{value:t,timestamp:Date.now(),accessCount:1,lastAccessed:Date.now()})}has(r){let t=this.cache.get(r);return t?this.isExpired(t)?(this.cache.delete(r),!1):!0:!1}delete(r){return this.cache.delete(r)}clear(){this.cache.clear()}getStats(){let r=Array.from(this.cache.values());return{size:this.cache.size,maxSize:this.config.maxSize,hitRate:this.calculateHitRate(),oldestEntry:Math.min(...r.map(t=>t.timestamp)),newestEntry:Math.max(...r.map(t=>t.timestamp)),expiredEntries:r.filter(t=>this.isExpired(t)).length}}cleanup(){let r=[];for(let[t,e]of this.cache.entries())this.isExpired(e)&&r.push(t);r.forEach(t=>this.cache.delete(t))}destroy(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null),this.clear()}isExpired(r){return Date.now()-r.timestamp>this.config.maxAge}evictLRU(){let r="",t=Date.now();for(let[e,s]of this.cache.entries())s.lastAccessed<t&&(t=s.lastAccessed,r=e);r&&this.cache.delete(r)}calculateHitRate(){let r=Array.from(this.cache.values()),t=r.reduce((e,s)=>e+s.accessCount,0);return t>0?r.length/t:0}startCleanupTimer(){this.cleanupTimer=setInterval(()=>{this.cleanup()},this.config.cleanupInterval)}},$e=class{constructor(){this.resultsCache=new ae({maxSize:50,maxAge:60*60*1e3,cleanupInterval:10*60*1e3}),this.fileCache=new ae({maxSize:200,maxAge:30*60*1e3,cleanupInterval:5*60*1e3})}getResults(r){return this.resultsCache.get(r)}setResults(r,t){this.resultsCache.set(r,t)}getFileContent(r){return this.fileCache.get(r)}setFileContent(r,t){this.fileCache.set(r,t)}clearAll(){this.resultsCache.clear(),this.fileCache.clear()}getStats(){return{results:this.resultsCache.getStats(),files:this.fileCache.getStats()}}cleanup(){this.resultsCache.cleanup(),this.fileCache.cleanup()}destroy(){this.resultsCache.destroy(),this.fileCache.destroy()}},Ie=new $e;function ut(){Ie.clearAll()}var le=class extends ht.Plugin{constructor(){super(...arguments);this.panelManager=null;this.sidePanel=null}async onload(){try{await this.loadSettings(),ct({app:this.app,settings:this.settings},"plugin initialization"),this.panelManager=await J(()=>Promise.resolve(new re(this.app,this)),"panel manager initialization",null),this.forceIconRefresh(),await J(()=>{this.registerView(G,t=>{let e=new b(this,"current",t);return this.sidePanel=e,e}),this.registerView(U,t=>{let e=new b(this,"global",t);return this.sidePanel=e,e})},"side panel registration",void 0),await J(()=>{Be(this)},"command registration",void 0),await J(()=>{this.addSettingTab(new Q(this.app,this))},"settings tab registration",void 0),await J(()=>{this.addRibbonIcon("search-check","Open SEO audit panel",()=>{try{let e=this.app.workspace.getLeavesOfType("seo-global-panel").length===0;this.openGlobalPanel(),e||setTimeout(()=>{(async()=>{try{let s=this.app.workspace.getLeavesOfType("seo-global-panel");if(s.length>0){let i=s[0];if(i!=null&&i.view){let n=i.view;await n.actions.refreshGlobalResults(),n.render()}}}catch(s){D(s,"ribbon icon panel refresh",!0)}})()},500)}catch(t){D(t,"ribbon icon click handler",!0)}})},"ribbon icon registration",void 0)}catch(t){D(t,"plugin initialization",!0)}}onunload(){try{Ie.destroy()}catch(t){D(t,"plugin unload",!1)}}async loadSettings(){try{this.settings=Object.assign({},de,await this.loadData())}catch(t){D(t,"loading settings",!0),this.settings={...de}}}async saveSettings(){try{await this.saveData(this.settings),ut()}catch(t){D(t,"saving settings",!0)}}addStatusBar(){}removeStatusBar(){}openCurrentPanel(){try{if(this.panelManager)this.panelManager.openCurrentPanel();else throw new Error("Panel manager not initialized")}catch(t){D(t,"opening current panel",!0)}}openGlobalPanel(){try{if(this.panelManager)this.panelManager.openGlobalPanel();else throw new Error("Panel manager not initialized")}catch(t){D(t,"opening global panel",!0)}}async runBulkCheck(){try{let{runSEOCheck:t}=await Promise.resolve().then(()=>(B(),W)),e=await this.getFilesToCheck();return e.length===0?[]:await t(this,e)}catch(t){return D(t,"running bulk check",!0),[]}}async getFilesToCheck(){try{if(this.panelManager)return await this.panelManager.getFilesToCheck();throw new Error("Panel manager not initialized")}catch(t){return D(t,"getting files to check",!0),[]}}forceIconRefresh(){this.app.workspace.onLayoutReady(()=>{let t=this.app.workspace.getLeavesOfType(G),e=this.app.workspace.getLeavesOfType(U);[...t,...e].forEach(s=>{s.view instanceof b&&s.view.render()})})}};
