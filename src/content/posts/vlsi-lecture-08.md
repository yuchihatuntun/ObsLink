---
title: VLSI-Lecture-08
date: 2025-10-27
description: Sequential Logic (including differences between sequential and combinational circuits, classification and principles of static/dynamic sequential cells, and bistable characteristics)
tags:
  - 2025-autumn
  - VLSI
  - Notebook
image: "[[attachments/cover-07.png]]"
imageAlt: Reze(Chainsaw Man)
imageOG: true
hideCoverImage: false
hideTOC: false
targetKeyword: vlsi combined logic circuit
draft: false
---
# 时序逻辑基础

![](attachments/标准时序逻辑电路.png)
*标准时序逻辑电路*

- **组合电路**：$Output = f(Input)$。输出不仅在时间上==即时响应==（忽略延迟），且逻辑上仅由当前输入决定。
    
- **时序电路**：$Output = f(Input, State)$。输出是当前输入变量和电路内部状态变量的函数。这意味着电路具有==记忆功能==。

**两种存储机理**：

- **正反馈 (Positive Feedback)**：**静态存储器** 的基础。利用双稳态电路将信号锁定在高电平或低电平，只要==电源不断电，状态即可维持==。
    
- **基于电荷 (Charge-based)**：**动态存储器** 的基础。利用==电容存储电荷==的能力来表示逻辑状态（有电荷为1，无电荷为0）。由于漏电流存在，需要定期刷新（这一点和[动态逻辑的充电逻辑](vlsi-lecture-07.md#电荷泄露)类似）。

# 关键时序单元

**时序单元**是时序电路中用于==存储状态==的基本电路单元，须满足两个充要条件：

- **保持**：在没有写入操作时，能够长时间维持当前的状态值不变。
    
- **写入/触发**：在特定的控制信号作用下，能够接收新的输入并更新内部状态。

## 分类

### 按存储机制分类

- **静态存储器**：基于正反馈原理。具有双稳态特性，==抗干扰能力强==，不需要刷新，但通常占用==更多的晶体管面积==。
    
- **动态存储器**：基于电荷存储原理。依赖栅极电容或寄生电容存储电荷。其特点是==集成度高==，但数据会随时间衰减，通常用于==高密度存储==。

### 按触发方式分类

分类依据是电路对**时钟信号** 的敏感方式：

- **电平触发/电平敏感**：电路在时钟信号处于特定电平（高电平或低电平）的**整个持续时间段内**，输出都会随输入变化。对应器件为**锁存器**。
    
- **边沿触发/边沿敏感**：电路仅在时钟信号发生跳变（上升沿或下降沿）的**瞬间**采样输入并改变状态，其余时间状态锁定。对应器件为**寄存器/触发器**。

## 锁存器（Latch）

![](attachments/锁存器.png)
*锁存器*

- **触发特性**：电平敏感，时钟为高时写入数据。
    
    - 当 $Clk$ 为高电平期间，输入 $D$ 发生变化，输出 $Q$ **立即跟随** $D$ 变化。
        
    - 在此期间，电路处于透明状态。
        
    - 当 $Clk$ 回到低电平时，$Q$ 保持 $Clk$ 下降沿瞬间的值不变。

### 正、负电平锁存器

![](attachments/正负电平锁存器.png)
*正负电平锁存器*

顾名思义，分别对正、负电平敏感（这个在电路图上CLK信号有无==反相泡==就能看出来）。

### 静态锁存器

#### 双稳态原理

![](attachments/标准锁存器环.png)
*标准锁存器环*

- 第一级反相器输入为 $V_{i1}$，输出为 $V_{o1}$。
    
- 第二级反相器输入为 $V_{i2}$（等于 $V_{o1}$），输出为 $V_{o2}$（反馈回 $V_{i1}$）。

![](attachments/双稳态原理图.png)
*双稳态原理图*

该原理类似于先前静态反相器级连的信号完整性机制，同样借助了电平响应曲线的==凸函数特性==。

也是通过这一特性，两根导线被自锁在 A、B 两个稳态工作点（这就是“双稳态原理”的双字所在）。

**特点**：

- 静态（只要供电，无限期保持）、鲁棒性好（详见信号完整性章节）。

- **对触发脉冲要求**（写入数据的物理限制）：==触发脉冲宽度须稍大于沿环路总的传播时间。至少是两个反相器平均延时 ($t_{pd}$) 的两倍==。如果脉冲太短，信号还没走完一圈反馈回路，输入就撤销了，电路会恢复原先的双稳态（这也是矛盾点，双稳态保持效果太好导致新数据不容易写入），导致写入失败。

- **过渡区增益**：为了使电路能从亚稳态点（上一页的点 C）迅速翻转到稳态，反相器在==过渡区电压增益必须大于 1==。

**翻转方法**：

- **切断反馈环**：在写入新数据时，暂时断开两个反相器之间的连接。
    
- **强制驱动**：不切断反馈，而是使用一个驱动能力极强的信号源，强行覆盖掉内部反馈节点的电压。但是进行仔细的**尺寸设计**。

#### 静态锁存器

![](attachments/两种静态锁存器电路.png)
*两种静态锁存器电路*

##### 多路开关锁存器 (Multiplexer Based Latch)

- **写入方法**：切断反馈环（利用**传输门**作为开关）
        
- **工作原理**：
    
    -  $CLK$ 有效时：输入通路接通，反馈通路断开。数据 $D$ 直接进入电路，无视旧状态。
        
    -  $CLK$ 无效时：输入通路断开，反馈通路接通。两个反相器闭合成环，锁存数据。
        
- **优缺点**：
    
    - **优点**：晶体管尺寸容易设计，不需要考虑驱动能力的强弱比值。
        
    - **缺点**：使用的==晶体管数目较多==，且传输门给时钟信号带来了较大的电容负载 ($CLK$ 和 $\overline{CLK}$ 都要接，虽然另一个也是，但是这个接的更多)，增加了功耗。

###### 使用NMOS传输管优化设计

![](attachments/NMOS多路开关锁存器.png)
*NMOS多路开关锁存器*

对照前图可见，开关和输入信号的传输门都仅使用一个NMOS。

- **优点**：
    
    - **晶体管数目减少**：每个开关省去了一个PMOS管，显著减小了电路面积。
        
    - **时钟负载小**：时钟信号只需要驱动NMOS的栅极电容，降低了时钟网络的动态功耗。
        
- **缺点**：
    
    - **阈值损失**：NMOS传输高电平的能力较差。当它传输 $V_{DD}$ 时，源极电压最高只能达到 $V_{DD} - V_{tn}$ ，节点无法达到满幅度的 $V_{DD}$。
        
    - **静态功耗**：由于节点电压只有 $V_{DD} - V_{tn}$（弱“1”），连接在后面的CMOS反相器的PMOS管无法完全截止（$V_{gs}$ 不为0），导致反相器内部形成从电源到地的直通电流，产生持续的静态功耗。

- **不重叠时钟**：$CLK$ 和 $\overline{CLK}$ **不能同时为高电平**（不然就变成强制写入锁存器了，但是很明显多路开关锁存器没有设计这一点）。

	- **解决方案**：引入**死区时间**，在 $CLK$ 下降后，经过一段微小的延迟，$\overline{CLK}$ 才上升。在此期间，两个开关都断开，节点依靠寄生电容暂时保持电荷（动态存储），从而安全地完成回路切换。

>[!tip] CLK和CLK#怎么会同时为高电平呢
>
>在物理世界中， $\overline{CLK}$ 通常是由 $CLK$ 经过一个反相器产生的。根据VLSI实验可以知道，反相器是存在延时的，因此会出现二者同时为较高电平的时刻。而且这个时刻正好位于写入的最后一刻，同时也是锁存的前一刻，引入了很强的不确定性。

##### 强制写入锁存器 (Force-Write / Jam Latch)

- **写入方法**：强制驱动，反馈回路中包含了一个特殊的==弱反相器（反馈反相器）==。

- **工作原理**：
    
    - 当需要写入 $D$ 时，外部信号经过传输门进入（假设输入节点原先为0，外部信号想要输入1），此时，输入节点上出现了==电压竞争==：

		1. **外部驱动力**：输入信号 $D$ 试图通过传输门将输入节点 **拉高** 到 $V_{DD}$。
		    
		2. **内部抵抗力**：下方的反馈反相器试图将输入节点 **拉低** 到 $GND$。

    - 但是由于反馈管（弱驱动能力）竞争不过输入信号，所以得以写入新的信号值。
    
    - 这里的传输门可以简化==仅由 NMOS 实现==（虽然有阈值损失，但为了减少面积有时会这样做）。
        
- **优缺点**：
    
    - **优点**：晶体管数目少，对时钟负载小（寄生参数小）。
        
    - **缺点**：**晶体管尺寸需要精心设计**。必须保证输入驱动器的驱动能力远大于反馈弱反相器的能力，否则无法写入。类似于有比电路。

###### 尺寸设计
![](attachments/强制写入反相器尺寸设计.png)
*强制写入锁存器剖析*

为确保电路在任何情况下都能正确翻转，设计必须基于==最困难的写入场景==进行：

- **当前状态**：锁存器内部存储逻辑“0”。即反馈反相器的输出（节点 $S$ 的驱动源）试图将 $S$ 拉低到地（GND）。
    
- **写入操作**：外部输入 $D$ 试图写入逻辑“1”，输入驱动器试图将节点 $S$ 拉高到电源电压（$V_{DD}$）。

**翻转条件**：S点的电位高于反相器阈值电压 $V_M$ 。

问题可以简化为一条从 **VDD - M1 - CLK#传输管 - M2 - GND** 的电压通路，也就是M2的分压必须大于反相器阈值电压 $V_M$ 。

即：

$$\frac{R_{M2}}{R_{M1+TG} + R_{M2}} V_{DD} > V_M$$
为了满足不等式，$R_{M2}$ 必须足够大，或者$R_{M1+TG}$ 必须足够小。在集成电路设计中，电阻大意味着晶体管的宽长比 ($W/L$) 小（也就是W比较小），因此，必须将反馈管 $M2$ 设计为**小尺寸（弱）**，将输入管 $M1$ 和传输门设计为**大尺寸（强）**，从数学上严谨证明了弱反相器的设计。


## 寄存器（Register）
![](attachments/寄存器.png)
*寄存器*

- **触发特性**：边沿敏感，时钟上升时存储数据。
    
    - 尽管 $D$ 信号在 $Clk$ 高电平期间发生了变化，输出 $Q$ 并未跟随变化。
        
    - $Q$ 仅在 $Clk$ 从低电平变为高电平的**上升沿** 瞬间发生更新。
        
    - 体现了严格的同步特性，能有效过滤掉非时钟边沿期间输入端的==毛刺信号==。

### 上升、下降边沿敏感寄存器

顾名思义，输出对上升沿和下降沿（CLK有==反相泡==）敏感而变化的寄存器。

### 主从边沿触发寄存器

![](attachments/主从边沿触发器.png)
*主从边沿寄存器示意图*



# 时序参数与约束

# 时钟技术
